(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const P of document.querySelectorAll('link[rel="modulepreload"]'))I(P);new MutationObserver(P=>{for(const O of P)if(O.type==="childList")for(const N of O.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&I(N)}).observe(document,{childList:!0,subtree:!0});function T(P){const O={};return P.integrity&&(O.integrity=P.integrity),P.referrerPolicy&&(O.referrerPolicy=P.referrerPolicy),P.crossOrigin==="use-credentials"?O.credentials="include":P.crossOrigin==="anonymous"?O.credentials="omit":O.credentials="same-origin",O}function I(P){if(P.ep)return;P.ep=!0;const O=T(P);fetch(P.href,O)}})();/**
* @vue/shared v3.5.12
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function r0(a){const f=Object.create(null);for(const T of a.split(","))f[T]=1;return T=>T in f}const zr={},Xu=[],Vo=()=>{},FI=()=>!1,Hm=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&(a.charCodeAt(2)>122||a.charCodeAt(2)<97),n0=a=>a.startsWith("onUpdate:"),In=Object.assign,s0=(a,f)=>{const T=a.indexOf(f);T>-1&&a.splice(T,1)},BI=Object.prototype.hasOwnProperty,vr=(a,f)=>BI.call(a,f),Mi=Array.isArray,Yu=a=>Af(a)==="[object Map]",ch=a=>Af(a)==="[object Set]",ob=a=>Af(a)==="[object Date]",ji=a=>typeof a=="function",mn=a=>typeof a=="string",_o=a=>typeof a=="symbol",Ur=a=>a!==null&&typeof a=="object",Zw=a=>(Ur(a)||ji(a))&&ji(a.then)&&ji(a.catch),Xw=Object.prototype.toString,Af=a=>Xw.call(a),NI=a=>Af(a).slice(8,-1),Yw=a=>Af(a)==="[object Object]",o0=a=>mn(a)&&a!=="NaN"&&a[0]!=="-"&&""+parseInt(a,10)===a,of=r0(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Wm=a=>{const f=Object.create(null);return T=>f[T]||(f[T]=a(T))},UI=/-(\w)/g,Js=Wm(a=>a.replace(UI,(f,T)=>T?T.toUpperCase():"")),VI=/\B([A-Z])/g,Mc=Wm(a=>a.replace(VI,"-$1").toLowerCase()),Zm=Wm(a=>a.charAt(0).toUpperCase()+a.slice(1)),ry=Wm(a=>a?`on${Zm(a)}`:""),xl=(a,f)=>!Object.is(a,f),Cm=(a,...f)=>{for(let T=0;T<a.length;T++)a[T](...f)},Kw=(a,f,T,I=!1)=>{Object.defineProperty(a,f,{configurable:!0,enumerable:!1,writable:I,value:T})},km=a=>{const f=parseFloat(a);return isNaN(f)?a:f};let ab;const Xm=()=>ab||(ab=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function a0(a){if(Mi(a)){const f={};for(let T=0;T<a.length;T++){const I=a[T],P=mn(I)?qI(I):a0(I);if(P)for(const O in P)f[O]=P[O]}return f}else if(mn(a)||Ur(a))return a}const jI=/;(?![^(]*\))/g,GI=/:([^]+)/,$I=/\/\*[^]*?\*\//g;function qI(a){const f={};return a.replace($I,"").split(jI).forEach(T=>{if(T){const I=T.split(GI);I.length>1&&(f[I[0].trim()]=I[1].trim())}}),f}function Ym(a){let f="";if(mn(a))f=a;else if(Mi(a))for(let T=0;T<a.length;T++){const I=Ym(a[T]);I&&(f+=I+" ")}else if(Ur(a))for(const T in a)a[T]&&(f+=T+" ");return f.trim()}const HI="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",WI=r0(HI);function Jw(a){return!!a||a===""}function ZI(a,f){if(a.length!==f.length)return!1;let T=!0;for(let I=0;T&&I<a.length;I++)T=Ec(a[I],f[I]);return T}function Ec(a,f){if(a===f)return!0;let T=ob(a),I=ob(f);if(T||I)return T&&I?a.getTime()===f.getTime():!1;if(T=_o(a),I=_o(f),T||I)return a===f;if(T=Mi(a),I=Mi(f),T||I)return T&&I?ZI(a,f):!1;if(T=Ur(a),I=Ur(f),T||I){if(!T||!I)return!1;const P=Object.keys(a).length,O=Object.keys(f).length;if(P!==O)return!1;for(const N in a){const H=a.hasOwnProperty(N),n=f.hasOwnProperty(N);if(H&&!n||!H&&n||!Ec(a[N],f[N]))return!1}}return String(a)===String(f)}function l0(a,f){return a.findIndex(T=>Ec(T,f))}const Qw=a=>!!(a&&a.__v_isRef===!0),Xs=a=>mn(a)?a:a==null?"":Mi(a)||Ur(a)&&(a.toString===Xw||!ji(a.toString))?Qw(a)?Xs(a.value):JSON.stringify(a,eT,2):String(a),eT=(a,f)=>Qw(f)?eT(a,f.value):Yu(f)?{[`Map(${f.size})`]:[...f.entries()].reduce((T,[I,P],O)=>(T[ny(I,O)+" =>"]=P,T),{})}:ch(f)?{[`Set(${f.size})`]:[...f.values()].map(T=>ny(T))}:_o(f)?ny(f):Ur(f)&&!Mi(f)&&!Yw(f)?String(f):f,ny=(a,f="")=>{var T;return _o(a)?`Symbol(${(T=a.description)!=null?T:f})`:a};/**
* @vue/reactivity v3.5.12
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Rs;class tT{constructor(f=!1){this.detached=f,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Rs,!f&&Rs&&(this.index=(Rs.scopes||(Rs.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let f,T;if(this.scopes)for(f=0,T=this.scopes.length;f<T;f++)this.scopes[f].pause();for(f=0,T=this.effects.length;f<T;f++)this.effects[f].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let f,T;if(this.scopes)for(f=0,T=this.scopes.length;f<T;f++)this.scopes[f].resume();for(f=0,T=this.effects.length;f<T;f++)this.effects[f].resume()}}run(f){if(this._active){const T=Rs;try{return Rs=this,f()}finally{Rs=T}}}on(){Rs=this}off(){Rs=this.parent}stop(f){if(this._active){let T,I;for(T=0,I=this.effects.length;T<I;T++)this.effects[T].stop();for(T=0,I=this.cleanups.length;T<I;T++)this.cleanups[T]();if(this.scopes)for(T=0,I=this.scopes.length;T<I;T++)this.scopes[T].stop(!0);if(!this.detached&&this.parent&&!f){const P=this.parent.scopes.pop();P&&P!==this&&(this.parent.scopes[this.index]=P,P.index=this.index)}this.parent=void 0,this._active=!1}}}function XI(a){return new tT(a)}function YI(){return Rs}let Nr;const sy=new WeakSet;class iT{constructor(f){this.fn=f,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Rs&&Rs.active&&Rs.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,sy.has(this)&&(sy.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||nT(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,lb(this),sT(this);const f=Nr,T=mo;Nr=this,mo=!0;try{return this.fn()}finally{oT(this),Nr=f,mo=T,this.flags&=-3}}stop(){if(this.flags&1){for(let f=this.deps;f;f=f.nextDep)h0(f);this.deps=this.depsTail=void 0,lb(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?sy.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Ty(this)&&this.run()}get dirty(){return Ty(this)}}let rT=0,af,lf;function nT(a,f=!1){if(a.flags|=8,f){a.next=lf,lf=a;return}a.next=af,af=a}function c0(){rT++}function u0(){if(--rT>0)return;if(lf){let f=lf;for(lf=void 0;f;){const T=f.next;f.next=void 0,f.flags&=-9,f=T}}let a;for(;af;){let f=af;for(af=void 0;f;){const T=f.next;if(f.next=void 0,f.flags&=-9,f.flags&1)try{f.trigger()}catch(I){a||(a=I)}f=T}}if(a)throw a}function sT(a){for(let f=a.deps;f;f=f.nextDep)f.version=-1,f.prevActiveLink=f.dep.activeLink,f.dep.activeLink=f}function oT(a){let f,T=a.depsTail,I=T;for(;I;){const P=I.prevDep;I.version===-1?(I===T&&(T=P),h0(I),KI(I)):f=I,I.dep.activeLink=I.prevActiveLink,I.prevActiveLink=void 0,I=P}a.deps=f,a.depsTail=T}function Ty(a){for(let f=a.deps;f;f=f.nextDep)if(f.dep.version!==f.version||f.dep.computed&&(aT(f.dep.computed)||f.dep.version!==f.version))return!0;return!!a._dirty}function aT(a){if(a.flags&4&&!(a.flags&16)||(a.flags&=-17,a.globalVersion===ff))return;a.globalVersion=ff;const f=a.dep;if(a.flags|=2,f.version>0&&!a.isSSR&&a.deps&&!Ty(a)){a.flags&=-3;return}const T=Nr,I=mo;Nr=a,mo=!0;try{sT(a);const P=a.fn(a._value);(f.version===0||xl(P,a._value))&&(a._value=P,f.version++)}catch(P){throw f.version++,P}finally{Nr=T,mo=I,oT(a),a.flags&=-3}}function h0(a,f=!1){const{dep:T,prevSub:I,nextSub:P}=a;if(I&&(I.nextSub=P,a.prevSub=void 0),P&&(P.prevSub=I,a.nextSub=void 0),T.subs===a&&(T.subs=I,!I&&T.computed)){T.computed.flags&=-5;for(let O=T.computed.deps;O;O=O.nextDep)h0(O,!0)}!f&&!--T.sc&&T.map&&T.map.delete(T.key)}function KI(a){const{prevDep:f,nextDep:T}=a;f&&(f.nextDep=T,a.prevDep=void 0),T&&(T.prevDep=f,a.nextDep=void 0)}let mo=!0;const lT=[];function wl(){lT.push(mo),mo=!1}function Tl(){const a=lT.pop();mo=a===void 0?!0:a}function lb(a){const{cleanup:f}=a;if(a.cleanup=void 0,f){const T=Nr;Nr=void 0;try{f()}finally{Nr=T}}}let ff=0;class JI{constructor(f,T){this.sub=f,this.dep=T,this.version=T.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class d0{constructor(f){this.computed=f,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(f){if(!Nr||!mo||Nr===this.computed)return;let T=this.activeLink;if(T===void 0||T.sub!==Nr)T=this.activeLink=new JI(Nr,this),Nr.deps?(T.prevDep=Nr.depsTail,Nr.depsTail.nextDep=T,Nr.depsTail=T):Nr.deps=Nr.depsTail=T,cT(T);else if(T.version===-1&&(T.version=this.version,T.nextDep)){const I=T.nextDep;I.prevDep=T.prevDep,T.prevDep&&(T.prevDep.nextDep=I),T.prevDep=Nr.depsTail,T.nextDep=void 0,Nr.depsTail.nextDep=T,Nr.depsTail=T,Nr.deps===T&&(Nr.deps=I)}return T}trigger(f){this.version++,ff++,this.notify(f)}notify(f){c0();try{for(let T=this.subs;T;T=T.prevSub)T.sub.notify()&&T.sub.dep.notify()}finally{u0()}}}function cT(a){if(a.dep.sc++,a.sub.flags&4){const f=a.dep.computed;if(f&&!a.dep.subs){f.flags|=20;for(let I=f.deps;I;I=I.nextDep)cT(I)}const T=a.dep.subs;T!==a&&(a.prevSub=T,T&&(T.nextSub=a)),a.dep.subs=a}}const Ey=new WeakMap,bc=Symbol(""),Sy=Symbol(""),pf=Symbol("");function Wn(a,f,T){if(mo&&Nr){let I=Ey.get(a);I||Ey.set(a,I=new Map);let P=I.get(T);P||(I.set(T,P=new d0),P.map=I,P.key=T),P.track()}}function da(a,f,T,I,P,O){const N=Ey.get(a);if(!N){ff++;return}const H=n=>{n&&n.trigger()};if(c0(),f==="clear")N.forEach(H);else{const n=Mi(a),ne=n&&o0(T);if(n&&T==="length"){const ae=Number(I);N.forEach((ue,Me)=>{(Me==="length"||Me===pf||!_o(Me)&&Me>=ae)&&H(ue)})}else switch((T!==void 0||N.has(void 0))&&H(N.get(T)),ne&&H(N.get(pf)),f){case"add":n?ne&&H(N.get("length")):(H(N.get(bc)),Yu(a)&&H(N.get(Sy)));break;case"delete":n||(H(N.get(bc)),Yu(a)&&H(N.get(Sy)));break;case"set":Yu(a)&&H(N.get(bc));break}}u0()}function $u(a){const f=xr(a);return f===a?f:(Wn(f,"iterate",pf),Ys(a)?f:f.map(Zn))}function Km(a){return Wn(a=xr(a),"iterate",pf),a}const QI={__proto__:null,[Symbol.iterator](){return oy(this,Symbol.iterator,Zn)},concat(...a){return $u(this).concat(...a.map(f=>Mi(f)?$u(f):f))},entries(){return oy(this,"entries",a=>(a[1]=Zn(a[1]),a))},every(a,f){return la(this,"every",a,f,void 0,arguments)},filter(a,f){return la(this,"filter",a,f,T=>T.map(Zn),arguments)},find(a,f){return la(this,"find",a,f,Zn,arguments)},findIndex(a,f){return la(this,"findIndex",a,f,void 0,arguments)},findLast(a,f){return la(this,"findLast",a,f,Zn,arguments)},findLastIndex(a,f){return la(this,"findLastIndex",a,f,void 0,arguments)},forEach(a,f){return la(this,"forEach",a,f,void 0,arguments)},includes(...a){return ay(this,"includes",a)},indexOf(...a){return ay(this,"indexOf",a)},join(a){return $u(this).join(a)},lastIndexOf(...a){return ay(this,"lastIndexOf",a)},map(a,f){return la(this,"map",a,f,void 0,arguments)},pop(){return Jd(this,"pop")},push(...a){return Jd(this,"push",a)},reduce(a,...f){return cb(this,"reduce",a,f)},reduceRight(a,...f){return cb(this,"reduceRight",a,f)},shift(){return Jd(this,"shift")},some(a,f){return la(this,"some",a,f,void 0,arguments)},splice(...a){return Jd(this,"splice",a)},toReversed(){return $u(this).toReversed()},toSorted(a){return $u(this).toSorted(a)},toSpliced(...a){return $u(this).toSpliced(...a)},unshift(...a){return Jd(this,"unshift",a)},values(){return oy(this,"values",Zn)}};function oy(a,f,T){const I=Km(a),P=I[f]();return I!==a&&!Ys(a)&&(P._next=P.next,P.next=()=>{const O=P._next();return O.value&&(O.value=T(O.value)),O}),P}const eM=Array.prototype;function la(a,f,T,I,P,O){const N=Km(a),H=N!==a&&!Ys(a),n=N[f];if(n!==eM[f]){const ue=n.apply(a,O);return H?Zn(ue):ue}let ne=T;N!==a&&(H?ne=function(ue,Me){return T.call(this,Zn(ue),Me,a)}:T.length>2&&(ne=function(ue,Me){return T.call(this,ue,Me,a)}));const ae=n.call(N,ne,I);return H&&P?P(ae):ae}function cb(a,f,T,I){const P=Km(a);let O=T;return P!==a&&(Ys(a)?T.length>3&&(O=function(N,H,n){return T.call(this,N,H,n,a)}):O=function(N,H,n){return T.call(this,N,Zn(H),n,a)}),P[f](O,...I)}function ay(a,f,T){const I=xr(a);Wn(I,"iterate",pf);const P=I[f](...T);return(P===-1||P===!1)&&m0(T[0])?(T[0]=xr(T[0]),I[f](...T)):P}function Jd(a,f,T=[]){wl(),c0();const I=xr(a)[f].apply(a,T);return u0(),Tl(),I}const tM=r0("__proto__,__v_isRef,__isVue"),uT=new Set(Object.getOwnPropertyNames(Symbol).filter(a=>a!=="arguments"&&a!=="caller").map(a=>Symbol[a]).filter(_o));function iM(a){_o(a)||(a=String(a));const f=xr(this);return Wn(f,"has",a),f.hasOwnProperty(a)}class hT{constructor(f=!1,T=!1){this._isReadonly=f,this._isShallow=T}get(f,T,I){const P=this._isReadonly,O=this._isShallow;if(T==="__v_isReactive")return!P;if(T==="__v_isReadonly")return P;if(T==="__v_isShallow")return O;if(T==="__v_raw")return I===(P?O?dM:mT:O?pT:fT).get(f)||Object.getPrototypeOf(f)===Object.getPrototypeOf(I)?f:void 0;const N=Mi(f);if(!P){let n;if(N&&(n=QI[T]))return n;if(T==="hasOwnProperty")return iM}const H=Reflect.get(f,T,Nn(f)?f:I);return(_o(T)?uT.has(T):tM(T))||(P||Wn(f,"get",T),O)?H:Nn(H)?N&&o0(T)?H:H.value:Ur(H)?P?gT(H):Jm(H):H}}class dT extends hT{constructor(f=!1){super(!1,f)}set(f,T,I,P){let O=f[T];if(!this._isShallow){const n=Sc(O);if(!Ys(I)&&!Sc(I)&&(O=xr(O),I=xr(I)),!Mi(f)&&Nn(O)&&!Nn(I))return n?!1:(O.value=I,!0)}const N=Mi(f)&&o0(T)?Number(T)<f.length:vr(f,T),H=Reflect.set(f,T,I,Nn(f)?f:P);return f===xr(P)&&(N?xl(I,O)&&da(f,"set",T,I):da(f,"add",T,I)),H}deleteProperty(f,T){const I=vr(f,T);f[T];const P=Reflect.deleteProperty(f,T);return P&&I&&da(f,"delete",T,void 0),P}has(f,T){const I=Reflect.has(f,T);return(!_o(T)||!uT.has(T))&&Wn(f,"has",T),I}ownKeys(f){return Wn(f,"iterate",Mi(f)?"length":bc),Reflect.ownKeys(f)}}class rM extends hT{constructor(f=!1){super(!0,f)}set(f,T){return!0}deleteProperty(f,T){return!0}}const nM=new dT,sM=new rM,oM=new dT(!0);const Ay=a=>a,wm=a=>Reflect.getPrototypeOf(a);function aM(a,f,T){return function(...I){const P=this.__v_raw,O=xr(P),N=Yu(O),H=a==="entries"||a===Symbol.iterator&&N,n=a==="keys"&&N,ne=P[a](...I),ae=T?Ay:f?Iy:Zn;return!f&&Wn(O,"iterate",n?Sy:bc),{next(){const{value:ue,done:Me}=ne.next();return Me?{value:ue,done:Me}:{value:H?[ae(ue[0]),ae(ue[1])]:ae(ue),done:Me}},[Symbol.iterator](){return this}}}}function Tm(a){return function(...f){return a==="delete"?!1:a==="clear"?void 0:this}}function lM(a,f){const T={get(P){const O=this.__v_raw,N=xr(O),H=xr(P);a||(xl(P,H)&&Wn(N,"get",P),Wn(N,"get",H));const{has:n}=wm(N),ne=f?Ay:a?Iy:Zn;if(n.call(N,P))return ne(O.get(P));if(n.call(N,H))return ne(O.get(H));O!==N&&O.get(P)},get size(){const P=this.__v_raw;return!a&&Wn(xr(P),"iterate",bc),Reflect.get(P,"size",P)},has(P){const O=this.__v_raw,N=xr(O),H=xr(P);return a||(xl(P,H)&&Wn(N,"has",P),Wn(N,"has",H)),P===H?O.has(P):O.has(P)||O.has(H)},forEach(P,O){const N=this,H=N.__v_raw,n=xr(H),ne=f?Ay:a?Iy:Zn;return!a&&Wn(n,"iterate",bc),H.forEach((ae,ue)=>P.call(O,ne(ae),ne(ue),N))}};return In(T,a?{add:Tm("add"),set:Tm("set"),delete:Tm("delete"),clear:Tm("clear")}:{add(P){!f&&!Ys(P)&&!Sc(P)&&(P=xr(P));const O=xr(this);return wm(O).has.call(O,P)||(O.add(P),da(O,"add",P,P)),this},set(P,O){!f&&!Ys(O)&&!Sc(O)&&(O=xr(O));const N=xr(this),{has:H,get:n}=wm(N);let ne=H.call(N,P);ne||(P=xr(P),ne=H.call(N,P));const ae=n.call(N,P);return N.set(P,O),ne?xl(O,ae)&&da(N,"set",P,O):da(N,"add",P,O),this},delete(P){const O=xr(this),{has:N,get:H}=wm(O);let n=N.call(O,P);n||(P=xr(P),n=N.call(O,P)),H&&H.call(O,P);const ne=O.delete(P);return n&&da(O,"delete",P,void 0),ne},clear(){const P=xr(this),O=P.size!==0,N=P.clear();return O&&da(P,"clear",void 0,void 0),N}}),["keys","values","entries",Symbol.iterator].forEach(P=>{T[P]=aM(P,a,f)}),T}function f0(a,f){const T=lM(a,f);return(I,P,O)=>P==="__v_isReactive"?!a:P==="__v_isReadonly"?a:P==="__v_raw"?I:Reflect.get(vr(T,P)&&P in I?T:I,P,O)}const cM={get:f0(!1,!1)},uM={get:f0(!1,!0)},hM={get:f0(!0,!1)};const fT=new WeakMap,pT=new WeakMap,mT=new WeakMap,dM=new WeakMap;function fM(a){switch(a){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function pM(a){return a.__v_skip||!Object.isExtensible(a)?0:fM(NI(a))}function Jm(a){return Sc(a)?a:p0(a,!1,nM,cM,fT)}function _T(a){return p0(a,!1,oM,uM,pT)}function gT(a){return p0(a,!0,sM,hM,mT)}function p0(a,f,T,I,P){if(!Ur(a)||a.__v_raw&&!(f&&a.__v_isReactive))return a;const O=P.get(a);if(O)return O;const N=pM(a);if(N===0)return a;const H=new Proxy(a,N===2?I:T);return P.set(a,H),H}function Ku(a){return Sc(a)?Ku(a.__v_raw):!!(a&&a.__v_isReactive)}function Sc(a){return!!(a&&a.__v_isReadonly)}function Ys(a){return!!(a&&a.__v_isShallow)}function m0(a){return a?!!a.__v_raw:!1}function xr(a){const f=a&&a.__v_raw;return f?xr(f):a}function mM(a){return!vr(a,"__v_skip")&&Object.isExtensible(a)&&Kw(a,"__v_skip",!0),a}const Zn=a=>Ur(a)?Jm(a):a,Iy=a=>Ur(a)?gT(a):a;function Nn(a){return a?a.__v_isRef===!0:!1}function _0(a){return xT(a,!1)}function yT(a){return xT(a,!0)}function xT(a,f){return Nn(a)?a:new _M(a,f)}class _M{constructor(f,T){this.dep=new d0,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=T?f:xr(f),this._value=T?f:Zn(f),this.__v_isShallow=T}get value(){return this.dep.track(),this._value}set value(f){const T=this._rawValue,I=this.__v_isShallow||Ys(f)||Sc(f);f=I?f:xr(f),xl(f,T)&&(this._rawValue=f,this._value=I?f:Zn(f),this.dep.trigger())}}function Ju(a){return Nn(a)?a.value:a}const gM={get:(a,f,T)=>f==="__v_raw"?a:Ju(Reflect.get(a,f,T)),set:(a,f,T,I)=>{const P=a[f];return Nn(P)&&!Nn(T)?(P.value=T,!0):Reflect.set(a,f,T,I)}};function vT(a){return Ku(a)?a:new Proxy(a,gM)}class yM{constructor(f,T,I){this.fn=f,this.setter=T,this._value=void 0,this.dep=new d0(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=ff-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!T,this.isSSR=I}notify(){if(this.flags|=16,!(this.flags&8)&&Nr!==this)return nT(this,!0),!0}get value(){const f=this.dep.track();return aT(this),f&&(f.version=this.dep.version),this._value}set value(f){this.setter&&this.setter(f)}}function xM(a,f,T=!1){let I,P;return ji(a)?I=a:(I=a.get,P=a.set),new yM(I,P,T)}const Em={},Fm=new WeakMap;let yc;function vM(a,f=!1,T=yc){if(T){let I=Fm.get(T);I||Fm.set(T,I=[]),I.push(a)}}function bM(a,f,T=zr){const{immediate:I,deep:P,once:O,scheduler:N,augmentJob:H,call:n}=T,ne=nt=>P?nt:Ys(nt)||P===!1||P===0?fa(nt,1):fa(nt);let ae,ue,Me,Be,st=!1,Qe=!1;if(Nn(a)?(ue=()=>a.value,st=Ys(a)):Ku(a)?(ue=()=>ne(a),st=!0):Mi(a)?(Qe=!0,st=a.some(nt=>Ku(nt)||Ys(nt)),ue=()=>a.map(nt=>{if(Nn(nt))return nt.value;if(Ku(nt))return ne(nt);if(ji(nt))return n?n(nt,2):nt()})):ji(a)?f?ue=n?()=>n(a,2):a:ue=()=>{if(Me){wl();try{Me()}finally{Tl()}}const nt=yc;yc=ae;try{return n?n(a,3,[Be]):a(Be)}finally{yc=nt}}:ue=Vo,f&&P){const nt=ue,ft=P===!0?1/0:P;ue=()=>fa(nt(),ft)}const Xe=YI(),Ne=()=>{ae.stop(),Xe&&s0(Xe.effects,ae)};if(O&&f){const nt=f;f=(...ft)=>{nt(...ft),Ne()}}let Ve=Qe?new Array(a.length).fill(Em):Em;const ht=nt=>{if(!(!(ae.flags&1)||!ae.dirty&&!nt))if(f){const ft=ae.run();if(P||st||(Qe?ft.some((Bt,Et)=>xl(Bt,Ve[Et])):xl(ft,Ve))){Me&&Me();const Bt=yc;yc=ae;try{const Et=[ft,Ve===Em?void 0:Qe&&Ve[0]===Em?[]:Ve,Be];n?n(f,3,Et):f(...Et),Ve=ft}finally{yc=Bt}}}else ae.run()};return H&&H(ht),ae=new iT(ue),ae.scheduler=N?()=>N(ht,!1):ht,Be=nt=>vM(nt,!1,ae),Me=ae.onStop=()=>{const nt=Fm.get(ae);if(nt){if(n)n(nt,4);else for(const ft of nt)ft();Fm.delete(ae)}},f?I?ht(!0):Ve=ae.run():N?N(ht.bind(null,!0),!0):ae.run(),Ne.pause=ae.pause.bind(ae),Ne.resume=ae.resume.bind(ae),Ne.stop=Ne,Ne}function fa(a,f=1/0,T){if(f<=0||!Ur(a)||a.__v_skip||(T=T||new Set,T.has(a)))return a;if(T.add(a),f--,Nn(a))fa(a.value,f,T);else if(Mi(a))for(let I=0;I<a.length;I++)fa(a[I],f,T);else if(ch(a)||Yu(a))a.forEach(I=>{fa(I,f,T)});else if(Yw(a)){for(const I in a)fa(a[I],f,T);for(const I of Object.getOwnPropertySymbols(a))Object.prototype.propertyIsEnumerable.call(a,I)&&fa(a[I],f,T)}return a}/**
* @vue/runtime-core v3.5.12
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function If(a,f,T,I){try{return I?a(...I):a()}catch(P){Qm(P,f,T)}}function Go(a,f,T,I){if(ji(a)){const P=If(a,f,T,I);return P&&Zw(P)&&P.catch(O=>{Qm(O,f,T)}),P}if(Mi(a)){const P=[];for(let O=0;O<a.length;O++)P.push(Go(a[O],f,T,I));return P}}function Qm(a,f,T,I=!0){const P=f?f.vnode:null,{errorHandler:O,throwUnhandledErrorInProduction:N}=f&&f.appContext.config||zr;if(f){let H=f.parent;const n=f.proxy,ne=`https://vuejs.org/error-reference/#runtime-${T}`;for(;H;){const ae=H.ec;if(ae){for(let ue=0;ue<ae.length;ue++)if(ae[ue](a,n,ne)===!1)return}H=H.parent}if(O){wl(),If(O,null,10,[a,n,ne]),Tl();return}}wM(a,T,P,I,N)}function wM(a,f,T,I=!0,P=!1){if(P)throw a;console.error(a)}const ls=[];let No=-1;const Qu=[];let _l=null,qu=0;const bT=Promise.resolve();let Bm=null;function g0(a){const f=Bm||bT;return a?f.then(this?a.bind(this):a):f}function TM(a){let f=No+1,T=ls.length;for(;f<T;){const I=f+T>>>1,P=ls[I],O=mf(P);O<a||O===a&&P.flags&2?f=I+1:T=I}return f}function y0(a){if(!(a.flags&1)){const f=mf(a),T=ls[ls.length-1];!T||!(a.flags&2)&&f>=mf(T)?ls.push(a):ls.splice(TM(f),0,a),a.flags|=1,wT()}}function wT(){Bm||(Bm=bT.then(ET))}function EM(a){Mi(a)?Qu.push(...a):_l&&a.id===-1?_l.splice(qu+1,0,a):a.flags&1||(Qu.push(a),a.flags|=1),wT()}function ub(a,f,T=No+1){for(;T<ls.length;T++){const I=ls[T];if(I&&I.flags&2){if(a&&I.id!==a.uid)continue;ls.splice(T,1),T--,I.flags&4&&(I.flags&=-2),I(),I.flags&4||(I.flags&=-2)}}}function TT(a){if(Qu.length){const f=[...new Set(Qu)].sort((T,I)=>mf(T)-mf(I));if(Qu.length=0,_l){_l.push(...f);return}for(_l=f,qu=0;qu<_l.length;qu++){const T=_l[qu];T.flags&4&&(T.flags&=-2),T.flags&8||T(),T.flags&=-2}_l=null,qu=0}}const mf=a=>a.id==null?a.flags&2?-1:1/0:a.id;function ET(a){try{for(No=0;No<ls.length;No++){const f=ls[No];f&&!(f.flags&8)&&(f.flags&4&&(f.flags&=-2),If(f,f.i,f.i?15:14),f.flags&4||(f.flags&=-2))}}finally{for(;No<ls.length;No++){const f=ls[No];f&&(f.flags&=-2)}No=-1,ls.length=0,TT(),Bm=null,(ls.length||Qu.length)&&ET()}}let An=null,ST=null;function Nm(a){const f=An;return An=a,ST=a&&a.type.__scopeId||null,f}function nf(a,f=An,T){if(!f||a._n)return a;const I=(...P)=>{I._d&&xb(-1);const O=Nm(f);let N;try{N=a(...P)}finally{Nm(O),I._d&&xb(1)}return N};return I._n=!0,I._c=!0,I._d=!0,I}function AT(a,f){if(An===null)return a;const T=i_(An),I=a.dirs||(a.dirs=[]);for(let P=0;P<f.length;P++){let[O,N,H,n=zr]=f[P];O&&(ji(O)&&(O={mounted:O,updated:O}),O.deep&&fa(N),I.push({dir:O,instance:T,value:N,oldValue:void 0,arg:H,modifiers:n}))}return a}function _c(a,f,T,I){const P=a.dirs,O=f&&f.dirs;for(let N=0;N<P.length;N++){const H=P[N];O&&(H.oldValue=O[N].value);let n=H.dir[I];n&&(wl(),Go(n,T,8,[a.el,H,a,f]),Tl())}}const SM=Symbol("_vte"),AM=a=>a.__isTeleport;function x0(a,f){a.shapeFlag&6&&a.component?(a.transition=f,x0(a.component.subTree,f)):a.shapeFlag&128?(a.ssContent.transition=f.clone(a.ssContent),a.ssFallback.transition=f.clone(a.ssFallback)):a.transition=f}/*! #__NO_SIDE_EFFECTS__ */function Mf(a,f){return ji(a)?In({name:a.name},f,{setup:a}):a}function IT(a){a.ids=[a.ids[0]+a.ids[2]+++"-",0,0]}function My(a,f,T,I,P=!1){if(Mi(a)){a.forEach((st,Qe)=>My(st,f&&(Mi(f)?f[Qe]:f),T,I,P));return}if(eh(I)&&!P)return;const O=I.shapeFlag&4?i_(I.component):I.el,N=P?null:O,{i:H,r:n}=a,ne=f&&f.r,ae=H.refs===zr?H.refs={}:H.refs,ue=H.setupState,Me=xr(ue),Be=ue===zr?()=>!1:st=>vr(Me,st);if(ne!=null&&ne!==n&&(mn(ne)?(ae[ne]=null,Be(ne)&&(ue[ne]=null)):Nn(ne)&&(ne.value=null)),ji(n))If(n,H,12,[N,ae]);else{const st=mn(n),Qe=Nn(n);if(st||Qe){const Xe=()=>{if(a.f){const Ne=st?Be(n)?ue[n]:ae[n]:n.value;P?Mi(Ne)&&s0(Ne,O):Mi(Ne)?Ne.includes(O)||Ne.push(O):st?(ae[n]=[O],Be(n)&&(ue[n]=ae[n])):(n.value=[O],a.k&&(ae[a.k]=n.value))}else st?(ae[n]=N,Be(n)&&(ue[n]=N)):Qe&&(n.value=N,a.k&&(ae[a.k]=N))};N?(Xe.id=-1,Ps(Xe,T)):Xe()}}}Xm().requestIdleCallback;Xm().cancelIdleCallback;const eh=a=>!!a.type.__asyncLoader,MT=a=>a.type.__isKeepAlive;function IM(a,f){CT(a,"a",f)}function MM(a,f){CT(a,"da",f)}function CT(a,f,T=Bn){const I=a.__wdc||(a.__wdc=()=>{let P=T;for(;P;){if(P.isDeactivated)return;P=P.parent}return a()});if(e_(f,I,T),T){let P=T.parent;for(;P&&P.parent;)MT(P.parent.vnode)&&CM(I,f,T,P),P=P.parent}}function CM(a,f,T,I){const P=e_(f,a,I,!0);v0(()=>{s0(I[f],P)},T)}function e_(a,f,T=Bn,I=!1){if(T){const P=T[a]||(T[a]=[]),O=f.__weh||(f.__weh=(...N)=>{wl();const H=Pf(T),n=Go(f,T,a,N);return H(),Tl(),n});return I?P.unshift(O):P.push(O),O}}const ga=a=>(f,T=Bn)=>{(!xf||a==="sp")&&e_(a,(...I)=>f(...I),T)},PM=ga("bm"),PT=ga("m"),RM=ga("bu"),LM=ga("u"),DM=ga("bum"),v0=ga("um"),zM=ga("sp"),OM=ga("rtg"),kM=ga("rtc");function FM(a,f=Bn){e_("ec",a,f)}const BM="components";function Ac(a,f){return UM(BM,a,!0,f)||a}const NM=Symbol.for("v-ndc");function UM(a,f,T=!0,I=!1){const P=An||Bn;if(P){const O=P.type;{const H=IC(O,!1);if(H&&(H===f||H===Js(f)||H===Zm(Js(f))))return O}const N=hb(P[a]||O[a],f)||hb(P.appContext[a],f);return!N&&I?O:N}}function hb(a,f){return a&&(a[f]||a[Js(f)]||a[Zm(Js(f))])}function b0(a,f,T,I){let P;const O=T,N=Mi(a);if(N||mn(a)){const H=N&&Ku(a);let n=!1;H&&(n=!Ys(a),a=Km(a)),P=new Array(a.length);for(let ne=0,ae=a.length;ne<ae;ne++)P[ne]=f(n?Zn(a[ne]):a[ne],ne,void 0,O)}else if(typeof a=="number"){P=new Array(a);for(let H=0;H<a;H++)P[H]=f(H+1,H,void 0,O)}else if(Ur(a))if(a[Symbol.iterator])P=Array.from(a,(H,n)=>f(H,n,void 0,O));else{const H=Object.keys(a);P=new Array(H.length);for(let n=0,ne=H.length;n<ne;n++){const ae=H[n];P[n]=f(a[ae],ae,n,O)}}else P=[];return P}function VM(a,f,T={},I,P){if(An.ce||An.parent&&eh(An.parent)&&An.parent.ce)return Qr(),Dy(Fn,null,[Cr("slot",T,I&&I())],64);let O=a[f];O&&O._c&&(O._d=!1),Qr();const N=O&&RT(O(T)),H=T.key||N&&N.key,n=Dy(Fn,{key:(H&&!_o(H)?H:`_${f}`)+(!N&&I?"_fb":"")},N||(I?I():[]),N&&a._===1?64:-2);return O&&O._c&&(O._d=!0),n}function RT(a){return a.some(f=>gf(f)?!(f.type===vl||f.type===Fn&&!RT(f.children)):!0)?a:null}const Cy=a=>a?KT(a)?i_(a):Cy(a.parent):null,cf=In(Object.create(null),{$:a=>a,$el:a=>a.vnode.el,$data:a=>a.data,$props:a=>a.props,$attrs:a=>a.attrs,$slots:a=>a.slots,$refs:a=>a.refs,$parent:a=>Cy(a.parent),$root:a=>Cy(a.root),$host:a=>a.ce,$emit:a=>a.emit,$options:a=>w0(a),$forceUpdate:a=>a.f||(a.f=()=>{y0(a.update)}),$nextTick:a=>a.n||(a.n=g0.bind(a.proxy)),$watch:a=>lC.bind(a)}),ly=(a,f)=>a!==zr&&!a.__isScriptSetup&&vr(a,f),jM={get({_:a},f){if(f==="__v_skip")return!0;const{ctx:T,setupState:I,data:P,props:O,accessCache:N,type:H,appContext:n}=a;let ne;if(f[0]!=="$"){const Be=N[f];if(Be!==void 0)switch(Be){case 1:return I[f];case 2:return P[f];case 4:return T[f];case 3:return O[f]}else{if(ly(I,f))return N[f]=1,I[f];if(P!==zr&&vr(P,f))return N[f]=2,P[f];if((ne=a.propsOptions[0])&&vr(ne,f))return N[f]=3,O[f];if(T!==zr&&vr(T,f))return N[f]=4,T[f];Py&&(N[f]=0)}}const ae=cf[f];let ue,Me;if(ae)return f==="$attrs"&&Wn(a.attrs,"get",""),ae(a);if((ue=H.__cssModules)&&(ue=ue[f]))return ue;if(T!==zr&&vr(T,f))return N[f]=4,T[f];if(Me=n.config.globalProperties,vr(Me,f))return Me[f]},set({_:a},f,T){const{data:I,setupState:P,ctx:O}=a;return ly(P,f)?(P[f]=T,!0):I!==zr&&vr(I,f)?(I[f]=T,!0):vr(a.props,f)||f[0]==="$"&&f.slice(1)in a?!1:(O[f]=T,!0)},has({_:{data:a,setupState:f,accessCache:T,ctx:I,appContext:P,propsOptions:O}},N){let H;return!!T[N]||a!==zr&&vr(a,N)||ly(f,N)||(H=O[0])&&vr(H,N)||vr(I,N)||vr(cf,N)||vr(P.config.globalProperties,N)},defineProperty(a,f,T){return T.get!=null?a._.accessCache[f]=0:vr(T,"value")&&this.set(a,f,T.value,null),Reflect.defineProperty(a,f,T)}};function db(a){return Mi(a)?a.reduce((f,T)=>(f[T]=null,f),{}):a}let Py=!0;function GM(a){const f=w0(a),T=a.proxy,I=a.ctx;Py=!1,f.beforeCreate&&fb(f.beforeCreate,a,"bc");const{data:P,computed:O,methods:N,watch:H,provide:n,inject:ne,created:ae,beforeMount:ue,mounted:Me,beforeUpdate:Be,updated:st,activated:Qe,deactivated:Xe,beforeDestroy:Ne,beforeUnmount:Ve,destroyed:ht,unmounted:nt,render:ft,renderTracked:Bt,renderTriggered:Et,errorCaptured:zt,serverPrefetch:zi,expose:or,inheritAttrs:$t,components:jt,directives:Pr,filters:un}=f;if(ne&&$M(ne,I,null),N)for(const Ii in N){const Oi=N[Ii];ji(Oi)&&(I[Ii]=Oi.bind(T))}if(P){const Ii=P.call(T,T);Ur(Ii)&&(a.data=Jm(Ii))}if(Py=!0,O)for(const Ii in O){const Oi=O[Ii],Sr=ji(Oi)?Oi.bind(T,T):ji(Oi.get)?Oi.get.bind(T,T):Vo,ei=!ji(Oi)&&ji(Oi.set)?Oi.set.bind(T):Vo,Vr=Xn({get:Sr,set:ei});Object.defineProperty(I,Ii,{enumerable:!0,configurable:!0,get:()=>Vr.value,set:Or=>Vr.value=Or})}if(H)for(const Ii in H)LT(H[Ii],I,T,Ii);if(n){const Ii=ji(n)?n.call(T):n;Reflect.ownKeys(Ii).forEach(Oi=>{Pm(Oi,Ii[Oi])})}ae&&fb(ae,a,"c");function Jt(Ii,Oi){Mi(Oi)?Oi.forEach(Sr=>Ii(Sr.bind(T))):Oi&&Ii(Oi.bind(T))}if(Jt(PM,ue),Jt(PT,Me),Jt(RM,Be),Jt(LM,st),Jt(IM,Qe),Jt(MM,Xe),Jt(FM,zt),Jt(kM,Bt),Jt(OM,Et),Jt(DM,Ve),Jt(v0,nt),Jt(zM,zi),Mi(or))if(or.length){const Ii=a.exposed||(a.exposed={});or.forEach(Oi=>{Object.defineProperty(Ii,Oi,{get:()=>T[Oi],set:Sr=>T[Oi]=Sr})})}else a.exposed||(a.exposed={});ft&&a.render===Vo&&(a.render=ft),$t!=null&&(a.inheritAttrs=$t),jt&&(a.components=jt),Pr&&(a.directives=Pr),zi&&IT(a)}function $M(a,f,T=Vo){Mi(a)&&(a=Ry(a));for(const I in a){const P=a[I];let O;Ur(P)?"default"in P?O=jo(P.from||I,P.default,!0):O=jo(P.from||I):O=jo(P),Nn(O)?Object.defineProperty(f,I,{enumerable:!0,configurable:!0,get:()=>O.value,set:N=>O.value=N}):f[I]=O}}function fb(a,f,T){Go(Mi(a)?a.map(I=>I.bind(f.proxy)):a.bind(f.proxy),f,T)}function LT(a,f,T,I){let P=I.includes(".")?HT(T,I):()=>T[I];if(mn(a)){const O=f[a];ji(O)&&wc(P,O)}else if(ji(a))wc(P,a.bind(T));else if(Ur(a))if(Mi(a))a.forEach(O=>LT(O,f,T,I));else{const O=ji(a.handler)?a.handler.bind(T):f[a.handler];ji(O)&&wc(P,O,a)}}function w0(a){const f=a.type,{mixins:T,extends:I}=f,{mixins:P,optionsCache:O,config:{optionMergeStrategies:N}}=a.appContext,H=O.get(f);let n;return H?n=H:!P.length&&!T&&!I?n=f:(n={},P.length&&P.forEach(ne=>Um(n,ne,N,!0)),Um(n,f,N)),Ur(f)&&O.set(f,n),n}function Um(a,f,T,I=!1){const{mixins:P,extends:O}=f;O&&Um(a,O,T,!0),P&&P.forEach(N=>Um(a,N,T,!0));for(const N in f)if(!(I&&N==="expose")){const H=qM[N]||T&&T[N];a[N]=H?H(a[N],f[N]):f[N]}return a}const qM={data:pb,props:mb,emits:mb,methods:sf,computed:sf,beforeCreate:os,created:os,beforeMount:os,mounted:os,beforeUpdate:os,updated:os,beforeDestroy:os,beforeUnmount:os,destroyed:os,unmounted:os,activated:os,deactivated:os,errorCaptured:os,serverPrefetch:os,components:sf,directives:sf,watch:WM,provide:pb,inject:HM};function pb(a,f){return f?a?function(){return In(ji(a)?a.call(this,this):a,ji(f)?f.call(this,this):f)}:f:a}function HM(a,f){return sf(Ry(a),Ry(f))}function Ry(a){if(Mi(a)){const f={};for(let T=0;T<a.length;T++)f[a[T]]=a[T];return f}return a}function os(a,f){return a?[...new Set([].concat(a,f))]:f}function sf(a,f){return a?In(Object.create(null),a,f):f}function mb(a,f){return a?Mi(a)&&Mi(f)?[...new Set([...a,...f])]:In(Object.create(null),db(a),db(f??{})):f}function WM(a,f){if(!a)return f;if(!f)return a;const T=In(Object.create(null),a);for(const I in f)T[I]=os(a[I],f[I]);return T}function DT(){return{app:null,config:{isNativeTag:FI,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let ZM=0;function XM(a,f){return function(I,P=null){ji(I)||(I=In({},I)),P!=null&&!Ur(P)&&(P=null);const O=DT(),N=new WeakSet,H=[];let n=!1;const ne=O.app={_uid:ZM++,_component:I,_props:P,_container:null,_context:O,_instance:null,version:CC,get config(){return O.config},set config(ae){},use(ae,...ue){return N.has(ae)||(ae&&ji(ae.install)?(N.add(ae),ae.install(ne,...ue)):ji(ae)&&(N.add(ae),ae(ne,...ue))),ne},mixin(ae){return O.mixins.includes(ae)||O.mixins.push(ae),ne},component(ae,ue){return ue?(O.components[ae]=ue,ne):O.components[ae]},directive(ae,ue){return ue?(O.directives[ae]=ue,ne):O.directives[ae]},mount(ae,ue,Me){if(!n){const Be=ne._ceVNode||Cr(I,P);return Be.appContext=O,Me===!0?Me="svg":Me===!1&&(Me=void 0),ue&&f?f(Be,ae):a(Be,ae,Me),n=!0,ne._container=ae,ae.__vue_app__=ne,i_(Be.component)}},onUnmount(ae){H.push(ae)},unmount(){n&&(Go(H,ne._instance,16),a(null,ne._container),delete ne._container.__vue_app__)},provide(ae,ue){return O.provides[ae]=ue,ne},runWithContext(ae){const ue=th;th=ne;try{return ae()}finally{th=ue}}};return ne}}let th=null;function Pm(a,f){if(Bn){let T=Bn.provides;const I=Bn.parent&&Bn.parent.provides;I===T&&(T=Bn.provides=Object.create(I)),T[a]=f}}function jo(a,f,T=!1){const I=Bn||An;if(I||th){const P=th?th._context.provides:I?I.parent==null?I.vnode.appContext&&I.vnode.appContext.provides:I.parent.provides:void 0;if(P&&a in P)return P[a];if(arguments.length>1)return T&&ji(f)?f.call(I&&I.proxy):f}}const zT={},OT=()=>Object.create(zT),kT=a=>Object.getPrototypeOf(a)===zT;function YM(a,f,T,I=!1){const P={},O=OT();a.propsDefaults=Object.create(null),FT(a,f,P,O);for(const N in a.propsOptions[0])N in P||(P[N]=void 0);T?a.props=I?P:_T(P):a.type.props?a.props=P:a.props=O,a.attrs=O}function KM(a,f,T,I){const{props:P,attrs:O,vnode:{patchFlag:N}}=a,H=xr(P),[n]=a.propsOptions;let ne=!1;if((I||N>0)&&!(N&16)){if(N&8){const ae=a.vnode.dynamicProps;for(let ue=0;ue<ae.length;ue++){let Me=ae[ue];if(t_(a.emitsOptions,Me))continue;const Be=f[Me];if(n)if(vr(O,Me))Be!==O[Me]&&(O[Me]=Be,ne=!0);else{const st=Js(Me);P[st]=Ly(n,H,st,Be,a,!1)}else Be!==O[Me]&&(O[Me]=Be,ne=!0)}}}else{FT(a,f,P,O)&&(ne=!0);let ae;for(const ue in H)(!f||!vr(f,ue)&&((ae=Mc(ue))===ue||!vr(f,ae)))&&(n?T&&(T[ue]!==void 0||T[ae]!==void 0)&&(P[ue]=Ly(n,H,ue,void 0,a,!0)):delete P[ue]);if(O!==H)for(const ue in O)(!f||!vr(f,ue))&&(delete O[ue],ne=!0)}ne&&da(a.attrs,"set","")}function FT(a,f,T,I){const[P,O]=a.propsOptions;let N=!1,H;if(f)for(let n in f){if(of(n))continue;const ne=f[n];let ae;P&&vr(P,ae=Js(n))?!O||!O.includes(ae)?T[ae]=ne:(H||(H={}))[ae]=ne:t_(a.emitsOptions,n)||(!(n in I)||ne!==I[n])&&(I[n]=ne,N=!0)}if(O){const n=xr(T),ne=H||zr;for(let ae=0;ae<O.length;ae++){const ue=O[ae];T[ue]=Ly(P,n,ue,ne[ue],a,!vr(ne,ue))}}return N}function Ly(a,f,T,I,P,O){const N=a[T];if(N!=null){const H=vr(N,"default");if(H&&I===void 0){const n=N.default;if(N.type!==Function&&!N.skipFactory&&ji(n)){const{propsDefaults:ne}=P;if(T in ne)I=ne[T];else{const ae=Pf(P);I=ne[T]=n.call(null,f),ae()}}else I=n;P.ce&&P.ce._setProp(T,I)}N[0]&&(O&&!H?I=!1:N[1]&&(I===""||I===Mc(T))&&(I=!0))}return I}const JM=new WeakMap;function BT(a,f,T=!1){const I=T?JM:f.propsCache,P=I.get(a);if(P)return P;const O=a.props,N={},H=[];let n=!1;if(!ji(a)){const ae=ue=>{n=!0;const[Me,Be]=BT(ue,f,!0);In(N,Me),Be&&H.push(...Be)};!T&&f.mixins.length&&f.mixins.forEach(ae),a.extends&&ae(a.extends),a.mixins&&a.mixins.forEach(ae)}if(!O&&!n)return Ur(a)&&I.set(a,Xu),Xu;if(Mi(O))for(let ae=0;ae<O.length;ae++){const ue=Js(O[ae]);_b(ue)&&(N[ue]=zr)}else if(O)for(const ae in O){const ue=Js(ae);if(_b(ue)){const Me=O[ae],Be=N[ue]=Mi(Me)||ji(Me)?{type:Me}:In({},Me),st=Be.type;let Qe=!1,Xe=!0;if(Mi(st))for(let Ne=0;Ne<st.length;++Ne){const Ve=st[Ne],ht=ji(Ve)&&Ve.name;if(ht==="Boolean"){Qe=!0;break}else ht==="String"&&(Xe=!1)}else Qe=ji(st)&&st.name==="Boolean";Be[0]=Qe,Be[1]=Xe,(Qe||vr(Be,"default"))&&H.push(ue)}}const ne=[N,H];return Ur(a)&&I.set(a,ne),ne}function _b(a){return a[0]!=="$"&&!of(a)}const NT=a=>a[0]==="_"||a==="$stable",T0=a=>Mi(a)?a.map(Uo):[Uo(a)],QM=(a,f,T)=>{if(f._n)return f;const I=nf((...P)=>T0(f(...P)),T);return I._c=!1,I},UT=(a,f,T)=>{const I=a._ctx;for(const P in a){if(NT(P))continue;const O=a[P];if(ji(O))f[P]=QM(P,O,I);else if(O!=null){const N=T0(O);f[P]=()=>N}}},VT=(a,f)=>{const T=T0(f);a.slots.default=()=>T},jT=(a,f,T)=>{for(const I in f)(T||I!=="_")&&(a[I]=f[I])},eC=(a,f,T)=>{const I=a.slots=OT();if(a.vnode.shapeFlag&32){const P=f._;P?(jT(I,f,T),T&&Kw(I,"_",P,!0)):UT(f,I)}else f&&VT(a,f)},tC=(a,f,T)=>{const{vnode:I,slots:P}=a;let O=!0,N=zr;if(I.shapeFlag&32){const H=f._;H?T&&H===1?O=!1:jT(P,f,T):(O=!f.$stable,UT(f,P)),N=f}else f&&(VT(a,f),N={default:1});if(O)for(const H in P)!NT(H)&&N[H]==null&&delete P[H]},Ps=mC;function iC(a){return rC(a)}function rC(a,f){const T=Xm();T.__VUE__=!0;const{insert:I,remove:P,patchProp:O,createElement:N,createText:H,createComment:n,setText:ne,setElementText:ae,parentNode:ue,nextSibling:Me,setScopeId:Be=Vo,insertStaticContent:st}=a,Qe=(Ae,ke,Se,Ct=null,_t=null,ve=null,_e=void 0,Ze=null,pt=!!ke.dynamicChildren)=>{if(Ae===ke)return;Ae&&!Qd(Ae,ke)&&(Ct=Tt(Ae),Or(Ae,_t,ve,!0),Ae=null),ke.patchFlag===-2&&(pt=!1,ke.dynamicChildren=null);const{type:It,ref:Ut,shapeFlag:Ge}=ke;switch(It){case Cf:Xe(Ae,ke,Se,Ct);break;case vl:Ne(Ae,ke,Se,Ct);break;case hy:Ae==null&&Ve(ke,Se,Ct,_e);break;case Fn:jt(Ae,ke,Se,Ct,_t,ve,_e,Ze,pt);break;default:Ge&1?ft(Ae,ke,Se,Ct,_t,ve,_e,Ze,pt):Ge&6?Pr(Ae,ke,Se,Ct,_t,ve,_e,Ze,pt):(Ge&64||Ge&128)&&It.process(Ae,ke,Se,Ct,_t,ve,_e,Ze,pt,ni)}Ut!=null&&_t&&My(Ut,Ae&&Ae.ref,ve,ke||Ae,!ke)},Xe=(Ae,ke,Se,Ct)=>{if(Ae==null)I(ke.el=H(ke.children),Se,Ct);else{const _t=ke.el=Ae.el;ke.children!==Ae.children&&ne(_t,ke.children)}},Ne=(Ae,ke,Se,Ct)=>{Ae==null?I(ke.el=n(ke.children||""),Se,Ct):ke.el=Ae.el},Ve=(Ae,ke,Se,Ct)=>{[Ae.el,Ae.anchor]=st(Ae.children,ke,Se,Ct,Ae.el,Ae.anchor)},ht=({el:Ae,anchor:ke},Se,Ct)=>{let _t;for(;Ae&&Ae!==ke;)_t=Me(Ae),I(Ae,Se,Ct),Ae=_t;I(ke,Se,Ct)},nt=({el:Ae,anchor:ke})=>{let Se;for(;Ae&&Ae!==ke;)Se=Me(Ae),P(Ae),Ae=Se;P(ke)},ft=(Ae,ke,Se,Ct,_t,ve,_e,Ze,pt)=>{ke.type==="svg"?_e="svg":ke.type==="math"&&(_e="mathml"),Ae==null?Bt(ke,Se,Ct,_t,ve,_e,Ze,pt):zi(Ae,ke,_t,ve,_e,Ze,pt)},Bt=(Ae,ke,Se,Ct,_t,ve,_e,Ze)=>{let pt,It;const{props:Ut,shapeFlag:Ge,transition:$e,dirs:Xt}=Ae;if(pt=Ae.el=N(Ae.type,ve,Ut&&Ut.is,Ut),Ge&8?ae(pt,Ae.children):Ge&16&&zt(Ae.children,pt,null,Ct,_t,cy(Ae,ve),_e,Ze),Xt&&_c(Ae,null,Ct,"created"),Et(pt,Ae,Ae.scopeId,_e,Ct),Ut){for(const Ui in Ut)Ui!=="value"&&!of(Ui)&&O(pt,Ui,null,Ut[Ui],ve,Ct);"value"in Ut&&O(pt,"value",null,Ut.value,ve),(It=Ut.onVnodeBeforeMount)&&Fo(It,Ct,Ae)}Xt&&_c(Ae,null,Ct,"beforeMount");const li=nC(_t,$e);li&&$e.beforeEnter(pt),I(pt,ke,Se),((It=Ut&&Ut.onVnodeMounted)||li||Xt)&&Ps(()=>{It&&Fo(It,Ct,Ae),li&&$e.enter(pt),Xt&&_c(Ae,null,Ct,"mounted")},_t)},Et=(Ae,ke,Se,Ct,_t)=>{if(Se&&Be(Ae,Se),Ct)for(let ve=0;ve<Ct.length;ve++)Be(Ae,Ct[ve]);if(_t){let ve=_t.subTree;if(ke===ve||ZT(ve.type)&&(ve.ssContent===ke||ve.ssFallback===ke)){const _e=_t.vnode;Et(Ae,_e,_e.scopeId,_e.slotScopeIds,_t.parent)}}},zt=(Ae,ke,Se,Ct,_t,ve,_e,Ze,pt=0)=>{for(let It=pt;It<Ae.length;It++){const Ut=Ae[It]=Ze?gl(Ae[It]):Uo(Ae[It]);Qe(null,Ut,ke,Se,Ct,_t,ve,_e,Ze)}},zi=(Ae,ke,Se,Ct,_t,ve,_e)=>{const Ze=ke.el=Ae.el;let{patchFlag:pt,dynamicChildren:It,dirs:Ut}=ke;pt|=Ae.patchFlag&16;const Ge=Ae.props||zr,$e=ke.props||zr;let Xt;if(Se&&gc(Se,!1),(Xt=$e.onVnodeBeforeUpdate)&&Fo(Xt,Se,ke,Ae),Ut&&_c(ke,Ae,Se,"beforeUpdate"),Se&&gc(Se,!0),(Ge.innerHTML&&$e.innerHTML==null||Ge.textContent&&$e.textContent==null)&&ae(Ze,""),It?or(Ae.dynamicChildren,It,Ze,Se,Ct,cy(ke,_t),ve):_e||Oi(Ae,ke,Ze,null,Se,Ct,cy(ke,_t),ve,!1),pt>0){if(pt&16)$t(Ze,Ge,$e,Se,_t);else if(pt&2&&Ge.class!==$e.class&&O(Ze,"class",null,$e.class,_t),pt&4&&O(Ze,"style",Ge.style,$e.style,_t),pt&8){const li=ke.dynamicProps;for(let Ui=0;Ui<li.length;Ui++){const Si=li[Ui],sr=Ge[Si],kr=$e[Si];(kr!==sr||Si==="value")&&O(Ze,Si,sr,kr,_t,Se)}}pt&1&&Ae.children!==ke.children&&ae(Ze,ke.children)}else!_e&&It==null&&$t(Ze,Ge,$e,Se,_t);((Xt=$e.onVnodeUpdated)||Ut)&&Ps(()=>{Xt&&Fo(Xt,Se,ke,Ae),Ut&&_c(ke,Ae,Se,"updated")},Ct)},or=(Ae,ke,Se,Ct,_t,ve,_e)=>{for(let Ze=0;Ze<ke.length;Ze++){const pt=Ae[Ze],It=ke[Ze],Ut=pt.el&&(pt.type===Fn||!Qd(pt,It)||pt.shapeFlag&70)?ue(pt.el):Se;Qe(pt,It,Ut,null,Ct,_t,ve,_e,!0)}},$t=(Ae,ke,Se,Ct,_t)=>{if(ke!==Se){if(ke!==zr)for(const ve in ke)!of(ve)&&!(ve in Se)&&O(Ae,ve,ke[ve],null,_t,Ct);for(const ve in Se){if(of(ve))continue;const _e=Se[ve],Ze=ke[ve];_e!==Ze&&ve!=="value"&&O(Ae,ve,Ze,_e,_t,Ct)}"value"in Se&&O(Ae,"value",ke.value,Se.value,_t)}},jt=(Ae,ke,Se,Ct,_t,ve,_e,Ze,pt)=>{const It=ke.el=Ae?Ae.el:H(""),Ut=ke.anchor=Ae?Ae.anchor:H("");let{patchFlag:Ge,dynamicChildren:$e,slotScopeIds:Xt}=ke;Xt&&(Ze=Ze?Ze.concat(Xt):Xt),Ae==null?(I(It,Se,Ct),I(Ut,Se,Ct),zt(ke.children||[],Se,Ut,_t,ve,_e,Ze,pt)):Ge>0&&Ge&64&&$e&&Ae.dynamicChildren?(or(Ae.dynamicChildren,$e,Se,_t,ve,_e,Ze),(ke.key!=null||_t&&ke===_t.subTree)&&GT(Ae,ke,!0)):Oi(Ae,ke,Se,Ut,_t,ve,_e,Ze,pt)},Pr=(Ae,ke,Se,Ct,_t,ve,_e,Ze,pt)=>{ke.slotScopeIds=Ze,Ae==null?ke.shapeFlag&512?_t.ctx.activate(ke,Se,Ct,_e,pt):un(ke,Se,Ct,_t,ve,_e,pt):Mn(Ae,ke,pt)},un=(Ae,ke,Se,Ct,_t,ve,_e)=>{const Ze=Ae.component=wC(Ae,Ct,_t);if(MT(Ae)&&(Ze.ctx.renderer=ni),TC(Ze,!1,_e),Ze.asyncDep){if(_t&&_t.registerDep(Ze,Jt,_e),!Ae.el){const pt=Ze.subTree=Cr(vl);Ne(null,pt,ke,Se)}}else Jt(Ze,Ae,ke,Se,_t,ve,_e)},Mn=(Ae,ke,Se)=>{const Ct=ke.component=Ae.component;if(fC(Ae,ke,Se))if(Ct.asyncDep&&!Ct.asyncResolved){Ii(Ct,ke,Se);return}else Ct.next=ke,Ct.update();else ke.el=Ae.el,Ct.vnode=ke},Jt=(Ae,ke,Se,Ct,_t,ve,_e)=>{const Ze=()=>{if(Ae.isMounted){let{next:Ge,bu:$e,u:Xt,parent:li,vnode:Ui}=Ae;{const en=$T(Ae);if(en){Ge&&(Ge.el=Ui.el,Ii(Ae,Ge,_e)),en.asyncDep.then(()=>{Ae.isUnmounted||Ze()});return}}let Si=Ge,sr;gc(Ae,!1),Ge?(Ge.el=Ui.el,Ii(Ae,Ge,_e)):Ge=Ui,$e&&Cm($e),(sr=Ge.props&&Ge.props.onVnodeBeforeUpdate)&&Fo(sr,li,Ge,Ui),gc(Ae,!0);const kr=uy(Ae),hn=Ae.subTree;Ae.subTree=kr,Qe(hn,kr,ue(hn.el),Tt(hn),Ae,_t,ve),Ge.el=kr.el,Si===null&&pC(Ae,kr.el),Xt&&Ps(Xt,_t),(sr=Ge.props&&Ge.props.onVnodeUpdated)&&Ps(()=>Fo(sr,li,Ge,Ui),_t)}else{let Ge;const{el:$e,props:Xt}=ke,{bm:li,m:Ui,parent:Si,root:sr,type:kr}=Ae,hn=eh(ke);if(gc(Ae,!1),li&&Cm(li),!hn&&(Ge=Xt&&Xt.onVnodeBeforeMount)&&Fo(Ge,Si,ke),gc(Ae,!0),$e&&Ki){const en=()=>{Ae.subTree=uy(Ae),Ki($e,Ae.subTree,Ae,_t,null)};hn&&kr.__asyncHydrate?kr.__asyncHydrate($e,Ae,en):en()}else{sr.ce&&sr.ce._injectChildStyle(kr);const en=Ae.subTree=uy(Ae);Qe(null,en,Se,Ct,Ae,_t,ve),ke.el=en.el}if(Ui&&Ps(Ui,_t),!hn&&(Ge=Xt&&Xt.onVnodeMounted)){const en=ke;Ps(()=>Fo(Ge,Si,en),_t)}(ke.shapeFlag&256||Si&&eh(Si.vnode)&&Si.vnode.shapeFlag&256)&&Ae.a&&Ps(Ae.a,_t),Ae.isMounted=!0,ke=Se=Ct=null}};Ae.scope.on();const pt=Ae.effect=new iT(Ze);Ae.scope.off();const It=Ae.update=pt.run.bind(pt),Ut=Ae.job=pt.runIfDirty.bind(pt);Ut.i=Ae,Ut.id=Ae.uid,pt.scheduler=()=>y0(Ut),gc(Ae,!0),It()},Ii=(Ae,ke,Se)=>{ke.component=Ae;const Ct=Ae.vnode.props;Ae.vnode=ke,Ae.next=null,KM(Ae,ke.props,Ct,Se),tC(Ae,ke.children,Se),wl(),ub(Ae),Tl()},Oi=(Ae,ke,Se,Ct,_t,ve,_e,Ze,pt=!1)=>{const It=Ae&&Ae.children,Ut=Ae?Ae.shapeFlag:0,Ge=ke.children,{patchFlag:$e,shapeFlag:Xt}=ke;if($e>0){if($e&128){ei(It,Ge,Se,Ct,_t,ve,_e,Ze,pt);return}else if($e&256){Sr(It,Ge,Se,Ct,_t,ve,_e,Ze,pt);return}}Xt&8?(Ut&16&&gr(It,_t,ve),Ge!==It&&ae(Se,Ge)):Ut&16?Xt&16?ei(It,Ge,Se,Ct,_t,ve,_e,Ze,pt):gr(It,_t,ve,!0):(Ut&8&&ae(Se,""),Xt&16&&zt(Ge,Se,Ct,_t,ve,_e,Ze,pt))},Sr=(Ae,ke,Se,Ct,_t,ve,_e,Ze,pt)=>{Ae=Ae||Xu,ke=ke||Xu;const It=Ae.length,Ut=ke.length,Ge=Math.min(It,Ut);let $e;for($e=0;$e<Ge;$e++){const Xt=ke[$e]=pt?gl(ke[$e]):Uo(ke[$e]);Qe(Ae[$e],Xt,Se,null,_t,ve,_e,Ze,pt)}It>Ut?gr(Ae,_t,ve,!0,!1,Ge):zt(ke,Se,Ct,_t,ve,_e,Ze,pt,Ge)},ei=(Ae,ke,Se,Ct,_t,ve,_e,Ze,pt)=>{let It=0;const Ut=ke.length;let Ge=Ae.length-1,$e=Ut-1;for(;It<=Ge&&It<=$e;){const Xt=Ae[It],li=ke[It]=pt?gl(ke[It]):Uo(ke[It]);if(Qd(Xt,li))Qe(Xt,li,Se,null,_t,ve,_e,Ze,pt);else break;It++}for(;It<=Ge&&It<=$e;){const Xt=Ae[Ge],li=ke[$e]=pt?gl(ke[$e]):Uo(ke[$e]);if(Qd(Xt,li))Qe(Xt,li,Se,null,_t,ve,_e,Ze,pt);else break;Ge--,$e--}if(It>Ge){if(It<=$e){const Xt=$e+1,li=Xt<Ut?ke[Xt].el:Ct;for(;It<=$e;)Qe(null,ke[It]=pt?gl(ke[It]):Uo(ke[It]),Se,li,_t,ve,_e,Ze,pt),It++}}else if(It>$e)for(;It<=Ge;)Or(Ae[It],_t,ve,!0),It++;else{const Xt=It,li=It,Ui=new Map;for(It=li;It<=$e;It++){const tn=ke[It]=pt?gl(ke[It]):Uo(ke[It]);tn.key!=null&&Ui.set(tn.key,It)}let Si,sr=0;const kr=$e-li+1;let hn=!1,en=0;const Cn=new Array(kr);for(It=0;It<kr;It++)Cn[It]=0;for(It=Xt;It<=Ge;It++){const tn=Ae[It];if(sr>=kr){Or(tn,_t,ve,!0);continue}let jr;if(tn.key!=null)jr=Ui.get(tn.key);else for(Si=li;Si<=$e;Si++)if(Cn[Si-li]===0&&Qd(tn,ke[Si])){jr=Si;break}jr===void 0?Or(tn,_t,ve,!0):(Cn[jr-li]=It+1,jr>=en?en=jr:hn=!0,Qe(tn,ke[jr],Se,null,_t,ve,_e,Ze,pt),sr++)}const zs=hn?sC(Cn):Xu;for(Si=zs.length-1,It=kr-1;It>=0;It--){const tn=li+It,jr=ke[tn],vo=tn+1<Ut?ke[tn+1].el:Ct;Cn[It]===0?Qe(null,jr,Se,vo,_t,ve,_e,Ze,pt):hn&&(Si<0||It!==zs[Si]?Vr(jr,Se,vo,2):Si--)}}},Vr=(Ae,ke,Se,Ct,_t=null)=>{const{el:ve,type:_e,transition:Ze,children:pt,shapeFlag:It}=Ae;if(It&6){Vr(Ae.component.subTree,ke,Se,Ct);return}if(It&128){Ae.suspense.move(ke,Se,Ct);return}if(It&64){_e.move(Ae,ke,Se,ni);return}if(_e===Fn){I(ve,ke,Se);for(let Ge=0;Ge<pt.length;Ge++)Vr(pt[Ge],ke,Se,Ct);I(Ae.anchor,ke,Se);return}if(_e===hy){ht(Ae,ke,Se);return}if(Ct!==2&&It&1&&Ze)if(Ct===0)Ze.beforeEnter(ve),I(ve,ke,Se),Ps(()=>Ze.enter(ve),_t);else{const{leave:Ge,delayLeave:$e,afterLeave:Xt}=Ze,li=()=>I(ve,ke,Se),Ui=()=>{Ge(ve,()=>{li(),Xt&&Xt()})};$e?$e(ve,li,Ui):Ui()}else I(ve,ke,Se)},Or=(Ae,ke,Se,Ct=!1,_t=!1)=>{const{type:ve,props:_e,ref:Ze,children:pt,dynamicChildren:It,shapeFlag:Ut,patchFlag:Ge,dirs:$e,cacheIndex:Xt}=Ae;if(Ge===-2&&(_t=!1),Ze!=null&&My(Ze,null,Se,Ae,!0),Xt!=null&&(ke.renderCache[Xt]=void 0),Ut&256){ke.ctx.deactivate(Ae);return}const li=Ut&1&&$e,Ui=!eh(Ae);let Si;if(Ui&&(Si=_e&&_e.onVnodeBeforeUnmount)&&Fo(Si,ke,Ae),Ut&6)Yn(Ae.component,Se,Ct);else{if(Ut&128){Ae.suspense.unmount(Se,Ct);return}li&&_c(Ae,null,ke,"beforeUnmount"),Ut&64?Ae.type.remove(Ae,ke,Se,ni,Ct):It&&!It.hasOnce&&(ve!==Fn||Ge>0&&Ge&64)?gr(It,ke,Se,!1,!0):(ve===Fn&&Ge&384||!_t&&Ut&16)&&gr(pt,ke,Se),Ct&&_n(Ae)}(Ui&&(Si=_e&&_e.onVnodeUnmounted)||li)&&Ps(()=>{Si&&Fo(Si,ke,Ae),li&&_c(Ae,null,ke,"unmounted")},Se)},_n=Ae=>{const{type:ke,el:Se,anchor:Ct,transition:_t}=Ae;if(ke===Fn){ti(Se,Ct);return}if(ke===hy){nt(Ae);return}const ve=()=>{P(Se),_t&&!_t.persisted&&_t.afterLeave&&_t.afterLeave()};if(Ae.shapeFlag&1&&_t&&!_t.persisted){const{leave:_e,delayLeave:Ze}=_t,pt=()=>_e(Se,ve);Ze?Ze(Ae.el,ve,pt):pt()}else ve()},ti=(Ae,ke)=>{let Se;for(;Ae!==ke;)Se=Me(Ae),P(Ae),Ae=Se;P(ke)},Yn=(Ae,ke,Se)=>{const{bum:Ct,scope:_t,job:ve,subTree:_e,um:Ze,m:pt,a:It}=Ae;gb(pt),gb(It),Ct&&Cm(Ct),_t.stop(),ve&&(ve.flags|=8,Or(_e,Ae,ke,Se)),Ze&&Ps(Ze,ke),Ps(()=>{Ae.isUnmounted=!0},ke),ke&&ke.pendingBranch&&!ke.isUnmounted&&Ae.asyncDep&&!Ae.asyncResolved&&Ae.suspenseId===ke.pendingId&&(ke.deps--,ke.deps===0&&ke.resolve())},gr=(Ae,ke,Se,Ct=!1,_t=!1,ve=0)=>{for(let _e=ve;_e<Ae.length;_e++)Or(Ae[_e],ke,Se,Ct,_t)},Tt=Ae=>{if(Ae.shapeFlag&6)return Tt(Ae.component.subTree);if(Ae.shapeFlag&128)return Ae.suspense.next();const ke=Me(Ae.anchor||Ae.el),Se=ke&&ke[SM];return Se?Me(Se):ke};let Kt=!1;const Zt=(Ae,ke,Se)=>{Ae==null?ke._vnode&&Or(ke._vnode,null,null,!0):Qe(ke._vnode||null,Ae,ke,null,null,null,Se),ke._vnode=Ae,Kt||(Kt=!0,ub(),TT(),Kt=!1)},ni={p:Qe,um:Or,m:Vr,r:_n,mt:un,mc:zt,pc:Oi,pbc:or,n:Tt,o:a};let ge,Ki;return{render:Zt,hydrate:ge,createApp:XM(Zt,ge)}}function cy({type:a,props:f},T){return T==="svg"&&a==="foreignObject"||T==="mathml"&&a==="annotation-xml"&&f&&f.encoding&&f.encoding.includes("html")?void 0:T}function gc({effect:a,job:f},T){T?(a.flags|=32,f.flags|=4):(a.flags&=-33,f.flags&=-5)}function nC(a,f){return(!a||a&&!a.pendingBranch)&&f&&!f.persisted}function GT(a,f,T=!1){const I=a.children,P=f.children;if(Mi(I)&&Mi(P))for(let O=0;O<I.length;O++){const N=I[O];let H=P[O];H.shapeFlag&1&&!H.dynamicChildren&&((H.patchFlag<=0||H.patchFlag===32)&&(H=P[O]=gl(P[O]),H.el=N.el),!T&&H.patchFlag!==-2&&GT(N,H)),H.type===Cf&&(H.el=N.el)}}function sC(a){const f=a.slice(),T=[0];let I,P,O,N,H;const n=a.length;for(I=0;I<n;I++){const ne=a[I];if(ne!==0){if(P=T[T.length-1],a[P]<ne){f[I]=P,T.push(I);continue}for(O=0,N=T.length-1;O<N;)H=O+N>>1,a[T[H]]<ne?O=H+1:N=H;ne<a[T[O]]&&(O>0&&(f[I]=T[O-1]),T[O]=I)}}for(O=T.length,N=T[O-1];O-- >0;)T[O]=N,N=f[N];return T}function $T(a){const f=a.subTree.component;if(f)return f.asyncDep&&!f.asyncResolved?f:$T(f)}function gb(a){if(a)for(let f=0;f<a.length;f++)a[f].flags|=8}const oC=Symbol.for("v-scx"),aC=()=>jo(oC);function wc(a,f,T){return qT(a,f,T)}function qT(a,f,T=zr){const{immediate:I,deep:P,flush:O,once:N}=T,H=In({},T),n=f&&I||!f&&O!=="post";let ne;if(xf){if(O==="sync"){const Be=aC();ne=Be.__watcherHandles||(Be.__watcherHandles=[])}else if(!n){const Be=()=>{};return Be.stop=Vo,Be.resume=Vo,Be.pause=Vo,Be}}const ae=Bn;H.call=(Be,st,Qe)=>Go(Be,ae,st,Qe);let ue=!1;O==="post"?H.scheduler=Be=>{Ps(Be,ae&&ae.suspense)}:O!=="sync"&&(ue=!0,H.scheduler=(Be,st)=>{st?Be():y0(Be)}),H.augmentJob=Be=>{f&&(Be.flags|=4),ue&&(Be.flags|=2,ae&&(Be.id=ae.uid,Be.i=ae))};const Me=bM(a,f,H);return xf&&(ne?ne.push(Me):n&&Me()),Me}function lC(a,f,T){const I=this.proxy,P=mn(a)?a.includes(".")?HT(I,a):()=>I[a]:a.bind(I,I);let O;ji(f)?O=f:(O=f.handler,T=f);const N=Pf(this),H=qT(P,O.bind(I),T);return N(),H}function HT(a,f){const T=f.split(".");return()=>{let I=a;for(let P=0;P<T.length&&I;P++)I=I[T[P]];return I}}const cC=(a,f)=>f==="modelValue"||f==="model-value"?a.modelModifiers:a[`${f}Modifiers`]||a[`${Js(f)}Modifiers`]||a[`${Mc(f)}Modifiers`];function uC(a,f,...T){if(a.isUnmounted)return;const I=a.vnode.props||zr;let P=T;const O=f.startsWith("update:"),N=O&&cC(I,f.slice(7));N&&(N.trim&&(P=T.map(ae=>mn(ae)?ae.trim():ae)),N.number&&(P=T.map(km)));let H,n=I[H=ry(f)]||I[H=ry(Js(f))];!n&&O&&(n=I[H=ry(Mc(f))]),n&&Go(n,a,6,P);const ne=I[H+"Once"];if(ne){if(!a.emitted)a.emitted={};else if(a.emitted[H])return;a.emitted[H]=!0,Go(ne,a,6,P)}}function WT(a,f,T=!1){const I=f.emitsCache,P=I.get(a);if(P!==void 0)return P;const O=a.emits;let N={},H=!1;if(!ji(a)){const n=ne=>{const ae=WT(ne,f,!0);ae&&(H=!0,In(N,ae))};!T&&f.mixins.length&&f.mixins.forEach(n),a.extends&&n(a.extends),a.mixins&&a.mixins.forEach(n)}return!O&&!H?(Ur(a)&&I.set(a,null),null):(Mi(O)?O.forEach(n=>N[n]=null):In(N,O),Ur(a)&&I.set(a,N),N)}function t_(a,f){return!a||!Hm(f)?!1:(f=f.slice(2).replace(/Once$/,""),vr(a,f[0].toLowerCase()+f.slice(1))||vr(a,Mc(f))||vr(a,f))}function uy(a){const{type:f,vnode:T,proxy:I,withProxy:P,propsOptions:[O],slots:N,attrs:H,emit:n,render:ne,renderCache:ae,props:ue,data:Me,setupState:Be,ctx:st,inheritAttrs:Qe}=a,Xe=Nm(a);let Ne,Ve;try{if(T.shapeFlag&4){const nt=P||I,ft=nt;Ne=Uo(ne.call(ft,nt,ae,ue,Be,Me,st)),Ve=H}else{const nt=f;Ne=Uo(nt.length>1?nt(ue,{attrs:H,slots:N,emit:n}):nt(ue,null)),Ve=f.props?H:hC(H)}}catch(nt){uf.length=0,Qm(nt,a,1),Ne=Cr(vl)}let ht=Ne;if(Ve&&Qe!==!1){const nt=Object.keys(Ve),{shapeFlag:ft}=ht;nt.length&&ft&7&&(O&&nt.some(n0)&&(Ve=dC(Ve,O)),ht=ih(ht,Ve,!1,!0))}return T.dirs&&(ht=ih(ht,null,!1,!0),ht.dirs=ht.dirs?ht.dirs.concat(T.dirs):T.dirs),T.transition&&x0(ht,T.transition),Ne=ht,Nm(Xe),Ne}const hC=a=>{let f;for(const T in a)(T==="class"||T==="style"||Hm(T))&&((f||(f={}))[T]=a[T]);return f},dC=(a,f)=>{const T={};for(const I in a)(!n0(I)||!(I.slice(9)in f))&&(T[I]=a[I]);return T};function fC(a,f,T){const{props:I,children:P,component:O}=a,{props:N,children:H,patchFlag:n}=f,ne=O.emitsOptions;if(f.dirs||f.transition)return!0;if(T&&n>=0){if(n&1024)return!0;if(n&16)return I?yb(I,N,ne):!!N;if(n&8){const ae=f.dynamicProps;for(let ue=0;ue<ae.length;ue++){const Me=ae[ue];if(N[Me]!==I[Me]&&!t_(ne,Me))return!0}}}else return(P||H)&&(!H||!H.$stable)?!0:I===N?!1:I?N?yb(I,N,ne):!0:!!N;return!1}function yb(a,f,T){const I=Object.keys(f);if(I.length!==Object.keys(a).length)return!0;for(let P=0;P<I.length;P++){const O=I[P];if(f[O]!==a[O]&&!t_(T,O))return!0}return!1}function pC({vnode:a,parent:f},T){for(;f;){const I=f.subTree;if(I.suspense&&I.suspense.activeBranch===a&&(I.el=a.el),I===a)(a=f.vnode).el=T,f=f.parent;else break}}const ZT=a=>a.__isSuspense;function mC(a,f){f&&f.pendingBranch?Mi(a)?f.effects.push(...a):f.effects.push(a):EM(a)}const Fn=Symbol.for("v-fgt"),Cf=Symbol.for("v-txt"),vl=Symbol.for("v-cmt"),hy=Symbol.for("v-stc"),uf=[];let Ls=null;function Qr(a=!1){uf.push(Ls=a?null:[])}function _C(){uf.pop(),Ls=uf[uf.length-1]||null}let _f=1;function xb(a){_f+=a,a<0&&Ls&&(Ls.hasOnce=!0)}function XT(a){return a.dynamicChildren=_f>0?Ls||Xu:null,_C(),_f>0&&Ls&&Ls.push(a),a}function pn(a,f,T,I,P,O){return XT(sn(a,f,T,I,P,O,!0))}function Dy(a,f,T,I,P){return XT(Cr(a,f,T,I,P,!0))}function gf(a){return a?a.__v_isVNode===!0:!1}function Qd(a,f){return a.type===f.type&&a.key===f.key}const YT=({key:a})=>a??null,Rm=({ref:a,ref_key:f,ref_for:T})=>(typeof a=="number"&&(a=""+a),a!=null?mn(a)||Nn(a)||ji(a)?{i:An,r:a,k:f,f:!!T}:a:null);function sn(a,f=null,T=null,I=0,P=null,O=a===Fn?0:1,N=!1,H=!1){const n={__v_isVNode:!0,__v_skip:!0,type:a,props:f,key:f&&YT(f),ref:f&&Rm(f),scopeId:ST,slotScopeIds:null,children:T,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:O,patchFlag:I,dynamicProps:P,dynamicChildren:null,appContext:null,ctx:An};return H?(E0(n,T),O&128&&a.normalize(n)):T&&(n.shapeFlag|=mn(T)?8:16),_f>0&&!N&&Ls&&(n.patchFlag>0||O&6)&&n.patchFlag!==32&&Ls.push(n),n}const Cr=gC;function gC(a,f=null,T=null,I=0,P=null,O=!1){if((!a||a===NM)&&(a=vl),gf(a)){const H=ih(a,f,!0);return T&&E0(H,T),_f>0&&!O&&Ls&&(H.shapeFlag&6?Ls[Ls.indexOf(a)]=H:Ls.push(H)),H.patchFlag=-2,H}if(MC(a)&&(a=a.__vccOpts),f){f=yC(f);let{class:H,style:n}=f;H&&!mn(H)&&(f.class=Ym(H)),Ur(n)&&(m0(n)&&!Mi(n)&&(n=In({},n)),f.style=a0(n))}const N=mn(a)?1:ZT(a)?128:AM(a)?64:Ur(a)?4:ji(a)?2:0;return sn(a,f,T,I,P,N,O,!0)}function yC(a){return a?m0(a)||kT(a)?In({},a):a:null}function ih(a,f,T=!1,I=!1){const{props:P,ref:O,patchFlag:N,children:H,transition:n}=a,ne=f?xC(P||{},f):P,ae={__v_isVNode:!0,__v_skip:!0,type:a.type,props:ne,key:ne&&YT(ne),ref:f&&f.ref?T&&O?Mi(O)?O.concat(Rm(f)):[O,Rm(f)]:Rm(f):O,scopeId:a.scopeId,slotScopeIds:a.slotScopeIds,children:H,target:a.target,targetStart:a.targetStart,targetAnchor:a.targetAnchor,staticCount:a.staticCount,shapeFlag:a.shapeFlag,patchFlag:f&&a.type!==Fn?N===-1?16:N|16:N,dynamicProps:a.dynamicProps,dynamicChildren:a.dynamicChildren,appContext:a.appContext,dirs:a.dirs,transition:n,component:a.component,suspense:a.suspense,ssContent:a.ssContent&&ih(a.ssContent),ssFallback:a.ssFallback&&ih(a.ssFallback),el:a.el,anchor:a.anchor,ctx:a.ctx,ce:a.ce};return n&&I&&x0(ae,n.clone(ae)),ae}function Zu(a=" ",f=0){return Cr(Cf,null,a,f)}function zy(a="",f=!1){return f?(Qr(),Dy(vl,null,a)):Cr(vl,null,a)}function Uo(a){return a==null||typeof a=="boolean"?Cr(vl):Mi(a)?Cr(Fn,null,a.slice()):gf(a)?gl(a):Cr(Cf,null,String(a))}function gl(a){return a.el===null&&a.patchFlag!==-1||a.memo?a:ih(a)}function E0(a,f){let T=0;const{shapeFlag:I}=a;if(f==null)f=null;else if(Mi(f))T=16;else if(typeof f=="object")if(I&65){const P=f.default;P&&(P._c&&(P._d=!1),E0(a,P()),P._c&&(P._d=!0));return}else{T=32;const P=f._;!P&&!kT(f)?f._ctx=An:P===3&&An&&(An.slots._===1?f._=1:(f._=2,a.patchFlag|=1024))}else ji(f)?(f={default:f,_ctx:An},T=32):(f=String(f),I&64?(T=16,f=[Zu(f)]):T=8);a.children=f,a.shapeFlag|=T}function xC(...a){const f={};for(let T=0;T<a.length;T++){const I=a[T];for(const P in I)if(P==="class")f.class!==I.class&&(f.class=Ym([f.class,I.class]));else if(P==="style")f.style=a0([f.style,I.style]);else if(Hm(P)){const O=f[P],N=I[P];N&&O!==N&&!(Mi(O)&&O.includes(N))&&(f[P]=O?[].concat(O,N):N)}else P!==""&&(f[P]=I[P])}return f}function Fo(a,f,T,I=null){Go(a,f,7,[T,I])}const vC=DT();let bC=0;function wC(a,f,T){const I=a.type,P=(f?f.appContext:a.appContext)||vC,O={uid:bC++,vnode:a,type:I,parent:f,appContext:P,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new tT(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:f?f.provides:Object.create(P.provides),ids:f?f.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:BT(I,P),emitsOptions:WT(I,P),emit:null,emitted:null,propsDefaults:zr,inheritAttrs:I.inheritAttrs,ctx:zr,data:zr,props:zr,attrs:zr,slots:zr,refs:zr,setupState:zr,setupContext:null,suspense:T,suspenseId:T?T.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return O.ctx={_:O},O.root=f?f.root:O,O.emit=uC.bind(null,O),a.ce&&a.ce(O),O}let Bn=null;const yf=()=>Bn||An;let Vm,Oy;{const a=Xm(),f=(T,I)=>{let P;return(P=a[T])||(P=a[T]=[]),P.push(I),O=>{P.length>1?P.forEach(N=>N(O)):P[0](O)}};Vm=f("__VUE_INSTANCE_SETTERS__",T=>Bn=T),Oy=f("__VUE_SSR_SETTERS__",T=>xf=T)}const Pf=a=>{const f=Bn;return Vm(a),a.scope.on(),()=>{a.scope.off(),Vm(f)}},vb=()=>{Bn&&Bn.scope.off(),Vm(null)};function KT(a){return a.vnode.shapeFlag&4}let xf=!1;function TC(a,f=!1,T=!1){f&&Oy(f);const{props:I,children:P}=a.vnode,O=KT(a);YM(a,I,O,f),eC(a,P,T);const N=O?EC(a,f):void 0;return f&&Oy(!1),N}function EC(a,f){const T=a.type;a.accessCache=Object.create(null),a.proxy=new Proxy(a.ctx,jM);const{setup:I}=T;if(I){wl();const P=a.setupContext=I.length>1?AC(a):null,O=Pf(a),N=If(I,a,0,[a.props,P]),H=Zw(N);if(Tl(),O(),(H||a.sp)&&!eh(a)&&IT(a),H){if(N.then(vb,vb),f)return N.then(n=>{bb(a,n,f)}).catch(n=>{Qm(n,a,0)});a.asyncDep=N}else bb(a,N,f)}else JT(a,f)}function bb(a,f,T){ji(f)?a.type.__ssrInlineRender?a.ssrRender=f:a.render=f:Ur(f)&&(a.setupState=vT(f)),JT(a,T)}let wb;function JT(a,f,T){const I=a.type;if(!a.render){if(!f&&wb&&!I.render){const P=I.template||w0(a).template;if(P){const{isCustomElement:O,compilerOptions:N}=a.appContext.config,{delimiters:H,compilerOptions:n}=I,ne=In(In({isCustomElement:O,delimiters:H},N),n);I.render=wb(P,ne)}}a.render=I.render||Vo}{const P=Pf(a);wl();try{GM(a)}finally{Tl(),P()}}}const SC={get(a,f){return Wn(a,"get",""),a[f]}};function AC(a){const f=T=>{a.exposed=T||{}};return{attrs:new Proxy(a.attrs,SC),slots:a.slots,emit:a.emit,expose:f}}function i_(a){return a.exposed?a.exposeProxy||(a.exposeProxy=new Proxy(vT(mM(a.exposed)),{get(f,T){if(T in f)return f[T];if(T in cf)return cf[T](a)},has(f,T){return T in f||T in cf}})):a.proxy}function IC(a,f=!0){return ji(a)?a.displayName||a.name:a.name||f&&a.__name}function MC(a){return ji(a)&&"__vccOpts"in a}const Xn=(a,f)=>xM(a,f,xf);function r_(a,f,T){const I=arguments.length;return I===2?Ur(f)&&!Mi(f)?gf(f)?Cr(a,null,[f]):Cr(a,f):Cr(a,null,f):(I>3?T=Array.prototype.slice.call(arguments,2):I===3&&gf(T)&&(T=[T]),Cr(a,f,T))}const CC="3.5.12";/**
* @vue/runtime-dom v3.5.12
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ky;const Tb=typeof window<"u"&&window.trustedTypes;if(Tb)try{ky=Tb.createPolicy("vue",{createHTML:a=>a})}catch{}const QT=ky?a=>ky.createHTML(a):a=>a,PC="http://www.w3.org/2000/svg",RC="http://www.w3.org/1998/Math/MathML",ha=typeof document<"u"?document:null,Eb=ha&&ha.createElement("template"),LC={insert:(a,f,T)=>{f.insertBefore(a,T||null)},remove:a=>{const f=a.parentNode;f&&f.removeChild(a)},createElement:(a,f,T,I)=>{const P=f==="svg"?ha.createElementNS(PC,a):f==="mathml"?ha.createElementNS(RC,a):T?ha.createElement(a,{is:T}):ha.createElement(a);return a==="select"&&I&&I.multiple!=null&&P.setAttribute("multiple",I.multiple),P},createText:a=>ha.createTextNode(a),createComment:a=>ha.createComment(a),setText:(a,f)=>{a.nodeValue=f},setElementText:(a,f)=>{a.textContent=f},parentNode:a=>a.parentNode,nextSibling:a=>a.nextSibling,querySelector:a=>ha.querySelector(a),setScopeId(a,f){a.setAttribute(f,"")},insertStaticContent(a,f,T,I,P,O){const N=T?T.previousSibling:f.lastChild;if(P&&(P===O||P.nextSibling))for(;f.insertBefore(P.cloneNode(!0),T),!(P===O||!(P=P.nextSibling)););else{Eb.innerHTML=QT(I==="svg"?`<svg>${a}</svg>`:I==="mathml"?`<math>${a}</math>`:a);const H=Eb.content;if(I==="svg"||I==="mathml"){const n=H.firstChild;for(;n.firstChild;)H.appendChild(n.firstChild);H.removeChild(n)}f.insertBefore(H,T)}return[N?N.nextSibling:f.firstChild,T?T.previousSibling:f.lastChild]}},DC=Symbol("_vtc");function zC(a,f,T){const I=a[DC];I&&(f=(f?[f,...I]:[...I]).join(" ")),f==null?a.removeAttribute("class"):T?a.setAttribute("class",f):a.className=f}const Sb=Symbol("_vod"),OC=Symbol("_vsh"),kC=Symbol(""),FC=/(^|;)\s*display\s*:/;function BC(a,f,T){const I=a.style,P=mn(T);let O=!1;if(T&&!P){if(f)if(mn(f))for(const N of f.split(";")){const H=N.slice(0,N.indexOf(":")).trim();T[H]==null&&Lm(I,H,"")}else for(const N in f)T[N]==null&&Lm(I,N,"");for(const N in T)N==="display"&&(O=!0),Lm(I,N,T[N])}else if(P){if(f!==T){const N=I[kC];N&&(T+=";"+N),I.cssText=T,O=FC.test(T)}}else f&&a.removeAttribute("style");Sb in a&&(a[Sb]=O?I.display:"",a[OC]&&(I.display="none"))}const Ab=/\s*!important$/;function Lm(a,f,T){if(Mi(T))T.forEach(I=>Lm(a,f,I));else if(T==null&&(T=""),f.startsWith("--"))a.setProperty(f,T);else{const I=NC(a,f);Ab.test(T)?a.setProperty(Mc(I),T.replace(Ab,""),"important"):a[I]=T}}const Ib=["Webkit","Moz","ms"],dy={};function NC(a,f){const T=dy[f];if(T)return T;let I=Js(f);if(I!=="filter"&&I in a)return dy[f]=I;I=Zm(I);for(let P=0;P<Ib.length;P++){const O=Ib[P]+I;if(O in a)return dy[f]=O}return f}const Mb="http://www.w3.org/1999/xlink";function Cb(a,f,T,I,P,O=WI(f)){I&&f.startsWith("xlink:")?T==null?a.removeAttributeNS(Mb,f.slice(6,f.length)):a.setAttributeNS(Mb,f,T):T==null||O&&!Jw(T)?a.removeAttribute(f):a.setAttribute(f,O?"":_o(T)?String(T):T)}function Pb(a,f,T,I,P){if(f==="innerHTML"||f==="textContent"){T!=null&&(a[f]=f==="innerHTML"?QT(T):T);return}const O=a.tagName;if(f==="value"&&O!=="PROGRESS"&&!O.includes("-")){const H=O==="OPTION"?a.getAttribute("value")||"":a.value,n=T==null?a.type==="checkbox"?"on":"":String(T);(H!==n||!("_value"in a))&&(a.value=n),T==null&&a.removeAttribute(f),a._value=T;return}let N=!1;if(T===""||T==null){const H=typeof a[f];H==="boolean"?T=Jw(T):T==null&&H==="string"?(T="",N=!0):H==="number"&&(T=0,N=!0)}try{a[f]=T}catch{}N&&a.removeAttribute(P||f)}function pa(a,f,T,I){a.addEventListener(f,T,I)}function UC(a,f,T,I){a.removeEventListener(f,T,I)}const Rb=Symbol("_vei");function VC(a,f,T,I,P=null){const O=a[Rb]||(a[Rb]={}),N=O[f];if(I&&N)N.value=I;else{const[H,n]=jC(f);if(I){const ne=O[f]=qC(I,P);pa(a,H,ne,n)}else N&&(UC(a,H,N,n),O[f]=void 0)}}const Lb=/(?:Once|Passive|Capture)$/;function jC(a){let f;if(Lb.test(a)){f={};let I;for(;I=a.match(Lb);)a=a.slice(0,a.length-I[0].length),f[I[0].toLowerCase()]=!0}return[a[2]===":"?a.slice(3):Mc(a.slice(2)),f]}let fy=0;const GC=Promise.resolve(),$C=()=>fy||(GC.then(()=>fy=0),fy=Date.now());function qC(a,f){const T=I=>{if(!I._vts)I._vts=Date.now();else if(I._vts<=T.attached)return;Go(HC(I,T.value),f,5,[I])};return T.value=a,T.attached=$C(),T}function HC(a,f){if(Mi(f)){const T=a.stopImmediatePropagation;return a.stopImmediatePropagation=()=>{T.call(a),a._stopped=!0},f.map(I=>P=>!P._stopped&&I&&I(P))}else return f}const Db=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&a.charCodeAt(2)>96&&a.charCodeAt(2)<123,WC=(a,f,T,I,P,O)=>{const N=P==="svg";f==="class"?zC(a,I,N):f==="style"?BC(a,T,I):Hm(f)?n0(f)||VC(a,f,T,I,O):(f[0]==="."?(f=f.slice(1),!0):f[0]==="^"?(f=f.slice(1),!1):ZC(a,f,I,N))?(Pb(a,f,I),!a.tagName.includes("-")&&(f==="value"||f==="checked"||f==="selected")&&Cb(a,f,I,N,O,f!=="value")):a._isVueCE&&(/[A-Z]/.test(f)||!mn(I))?Pb(a,Js(f),I,O,f):(f==="true-value"?a._trueValue=I:f==="false-value"&&(a._falseValue=I),Cb(a,f,I,N))};function ZC(a,f,T,I){if(I)return!!(f==="innerHTML"||f==="textContent"||f in a&&Db(f)&&ji(T));if(f==="spellcheck"||f==="draggable"||f==="translate"||f==="form"||f==="list"&&a.tagName==="INPUT"||f==="type"&&a.tagName==="TEXTAREA")return!1;if(f==="width"||f==="height"){const P=a.tagName;if(P==="IMG"||P==="VIDEO"||P==="CANVAS"||P==="SOURCE")return!1}return Db(f)&&mn(T)?!1:f in a}const bl=a=>{const f=a.props["onUpdate:modelValue"]||!1;return Mi(f)?T=>Cm(f,T):f};function XC(a){a.target.composing=!0}function zb(a){const f=a.target;f.composing&&(f.composing=!1,f.dispatchEvent(new Event("input")))}const Ks=Symbol("_assign"),Ob={created(a,{modifiers:{lazy:f,trim:T,number:I}},P){a[Ks]=bl(P);const O=I||P.props&&P.props.type==="number";pa(a,f?"change":"input",N=>{if(N.target.composing)return;let H=a.value;T&&(H=H.trim()),O&&(H=km(H)),a[Ks](H)}),T&&pa(a,"change",()=>{a.value=a.value.trim()}),f||(pa(a,"compositionstart",XC),pa(a,"compositionend",zb),pa(a,"change",zb))},mounted(a,{value:f}){a.value=f??""},beforeUpdate(a,{value:f,oldValue:T,modifiers:{lazy:I,trim:P,number:O}},N){if(a[Ks]=bl(N),a.composing)return;const H=(O||a.type==="number")&&!/^0\d/.test(a.value)?km(a.value):a.value,n=f??"";H!==n&&(document.activeElement===a&&a.type!=="range"&&(I&&f===T||P&&a.value.trim()===n)||(a.value=n))}},YC={deep:!0,created(a,f,T){a[Ks]=bl(T),pa(a,"change",()=>{const I=a._modelValue,P=rh(a),O=a.checked,N=a[Ks];if(Mi(I)){const H=l0(I,P),n=H!==-1;if(O&&!n)N(I.concat(P));else if(!O&&n){const ne=[...I];ne.splice(H,1),N(ne)}}else if(ch(I)){const H=new Set(I);O?H.add(P):H.delete(P),N(H)}else N(tE(a,O))})},mounted:kb,beforeUpdate(a,f,T){a[Ks]=bl(T),kb(a,f,T)}};function kb(a,{value:f,oldValue:T},I){a._modelValue=f;let P;if(Mi(f))P=l0(f,I.props.value)>-1;else if(ch(f))P=f.has(I.props.value);else{if(f===T)return;P=Ec(f,tE(a,!0))}a.checked!==P&&(a.checked=P)}const KC={created(a,{value:f},T){a.checked=Ec(f,T.props.value),a[Ks]=bl(T),pa(a,"change",()=>{a[Ks](rh(a))})},beforeUpdate(a,{value:f,oldValue:T},I){a[Ks]=bl(I),f!==T&&(a.checked=Ec(f,I.props.value))}},eE={deep:!0,created(a,{value:f,modifiers:{number:T}},I){const P=ch(f);pa(a,"change",()=>{const O=Array.prototype.filter.call(a.options,N=>N.selected).map(N=>T?km(rh(N)):rh(N));a[Ks](a.multiple?P?new Set(O):O:O[0]),a._assigning=!0,g0(()=>{a._assigning=!1})}),a[Ks]=bl(I)},mounted(a,{value:f}){Fb(a,f)},beforeUpdate(a,f,T){a[Ks]=bl(T)},updated(a,{value:f}){a._assigning||Fb(a,f)}};function Fb(a,f){const T=a.multiple,I=Mi(f);if(!(T&&!I&&!ch(f))){for(let P=0,O=a.options.length;P<O;P++){const N=a.options[P],H=rh(N);if(T)if(I){const n=typeof H;n==="string"||n==="number"?N.selected=f.some(ne=>String(ne)===String(H)):N.selected=l0(f,H)>-1}else N.selected=f.has(H);else if(Ec(rh(N),f)){a.selectedIndex!==P&&(a.selectedIndex=P);return}}!T&&a.selectedIndex!==-1&&(a.selectedIndex=-1)}}function rh(a){return"_value"in a?a._value:a.value}function tE(a,f){const T=f?"_trueValue":"_falseValue";return T in a?a[T]:f}const JC={created(a,f,T){Sm(a,f,T,null,"created")},mounted(a,f,T){Sm(a,f,T,null,"mounted")},beforeUpdate(a,f,T,I){Sm(a,f,T,I,"beforeUpdate")},updated(a,f,T,I){Sm(a,f,T,I,"updated")}};function QC(a,f){switch(a){case"SELECT":return eE;case"TEXTAREA":return Ob;default:switch(f){case"checkbox":return YC;case"radio":return KC;default:return Ob}}}function Sm(a,f,T,I,P){const N=QC(a.tagName,T.props&&T.props.type)[P];N&&N(a,f,T,I)}const eP=["ctrl","shift","alt","meta"],tP={stop:a=>a.stopPropagation(),prevent:a=>a.preventDefault(),self:a=>a.target!==a.currentTarget,ctrl:a=>!a.ctrlKey,shift:a=>!a.shiftKey,alt:a=>!a.altKey,meta:a=>!a.metaKey,left:a=>"button"in a&&a.button!==0,middle:a=>"button"in a&&a.button!==1,right:a=>"button"in a&&a.button!==2,exact:(a,f)=>eP.some(T=>a[`${T}Key`]&&!f.includes(T))},iP=(a,f)=>{const T=a._withMods||(a._withMods={}),I=f.join(".");return T[I]||(T[I]=(P,...O)=>{for(let N=0;N<f.length;N++){const H=tP[f[N]];if(H&&H(P,f))return}return a(P,...O)})},rP=In({patchProp:WC},LC);let Bb;function nP(){return Bb||(Bb=iC(rP))}const sP=(...a)=>{const f=nP().createApp(...a),{mount:T}=f;return f.mount=I=>{const P=aP(I);if(!P)return;const O=f._component;!ji(O)&&!O.render&&!O.template&&(O.template=P.innerHTML),P.nodeType===1&&(P.textContent="");const N=T(P,!1,oP(P));return P instanceof Element&&(P.removeAttribute("v-cloak"),P.setAttribute("data-v-app","")),N},f};function oP(a){if(a instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&a instanceof MathMLElement)return"mathml"}function aP(a){return mn(a)?document.querySelector(a):a}const yo=(a,f)=>{const T=a.__vccOpts||a;for(const[I,P]of f)T[I]=P;return T},lP={name:"NavBar"};function cP(a,f,T,I,P,O){const N=Ac("router-link");return Qr(),pn("nav",null,[Cr(N,{to:"/"},{default:nf(()=>f[0]||(f[0]=[Zu("Home")])),_:1}),Cr(N,{to:"/about"},{default:nf(()=>f[1]||(f[1]=[Zu("About")])),_:1}),Cr(N,{to:"/contact"},{default:nf(()=>f[2]||(f[2]=[Zu("Contact")])),_:1}),Cr(N,{to:"/map"},{default:nf(()=>f[3]||(f[3]=[Zu("Map")])),_:1})])}const uP=yo(lP,[["render",cP],["__scopeId","data-v-1e608ca0"]]),hP={class:"wrapper"},dP={__name:"App",setup(a){return(f,T)=>{const I=Ac("router-view");return Qr(),pn("div",hP,[Cr(uP),Cr(I)])}}},fP=yo(dP,[["__scopeId","data-v-50d780c1"]]);/*!
  * vue-router v4.4.5
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Hu=typeof document<"u";function iE(a){return typeof a=="object"||"displayName"in a||"props"in a||"__vccOpts"in a}function pP(a){return a.__esModule||a[Symbol.toStringTag]==="Module"||a.default&&iE(a.default)}const Tr=Object.assign;function py(a,f){const T={};for(const I in f){const P=f[I];T[I]=go(P)?P.map(a):a(P)}return T}const hf=()=>{},go=Array.isArray,rE=/#/g,mP=/&/g,_P=/\//g,gP=/=/g,yP=/\?/g,nE=/\+/g,xP=/%5B/g,vP=/%5D/g,sE=/%5E/g,bP=/%60/g,oE=/%7B/g,wP=/%7C/g,aE=/%7D/g,TP=/%20/g;function S0(a){return encodeURI(""+a).replace(wP,"|").replace(xP,"[").replace(vP,"]")}function EP(a){return S0(a).replace(oE,"{").replace(aE,"}").replace(sE,"^")}function Fy(a){return S0(a).replace(nE,"%2B").replace(TP,"+").replace(rE,"%23").replace(mP,"%26").replace(bP,"`").replace(oE,"{").replace(aE,"}").replace(sE,"^")}function SP(a){return Fy(a).replace(gP,"%3D")}function AP(a){return S0(a).replace(rE,"%23").replace(yP,"%3F")}function IP(a){return a==null?"":AP(a).replace(_P,"%2F")}function vf(a){try{return decodeURIComponent(""+a)}catch{}return""+a}const MP=/\/$/,CP=a=>a.replace(MP,"");function my(a,f,T="/"){let I,P={},O="",N="";const H=f.indexOf("#");let n=f.indexOf("?");return H<n&&H>=0&&(n=-1),n>-1&&(I=f.slice(0,n),O=f.slice(n+1,H>-1?H:f.length),P=a(O)),H>-1&&(I=I||f.slice(0,H),N=f.slice(H,f.length)),I=DP(I??f,T),{fullPath:I+(O&&"?")+O+N,path:I,query:P,hash:vf(N)}}function PP(a,f){const T=f.query?a(f.query):"";return f.path+(T&&"?")+T+(f.hash||"")}function Nb(a,f){return!f||!a.toLowerCase().startsWith(f.toLowerCase())?a:a.slice(f.length)||"/"}function RP(a,f,T){const I=f.matched.length-1,P=T.matched.length-1;return I>-1&&I===P&&nh(f.matched[I],T.matched[P])&&lE(f.params,T.params)&&a(f.query)===a(T.query)&&f.hash===T.hash}function nh(a,f){return(a.aliasOf||a)===(f.aliasOf||f)}function lE(a,f){if(Object.keys(a).length!==Object.keys(f).length)return!1;for(const T in a)if(!LP(a[T],f[T]))return!1;return!0}function LP(a,f){return go(a)?Ub(a,f):go(f)?Ub(f,a):a===f}function Ub(a,f){return go(f)?a.length===f.length&&a.every((T,I)=>T===f[I]):a.length===1&&a[0]===f}function DP(a,f){if(a.startsWith("/"))return a;if(!a)return f;const T=f.split("/"),I=a.split("/"),P=I[I.length-1];(P===".."||P===".")&&I.push("");let O=T.length-1,N,H;for(N=0;N<I.length;N++)if(H=I[N],H!==".")if(H==="..")O>1&&O--;else break;return T.slice(0,O).join("/")+"/"+I.slice(N).join("/")}const fl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var bf;(function(a){a.pop="pop",a.push="push"})(bf||(bf={}));var df;(function(a){a.back="back",a.forward="forward",a.unknown=""})(df||(df={}));function zP(a){if(!a)if(Hu){const f=document.querySelector("base");a=f&&f.getAttribute("href")||"/",a=a.replace(/^\w+:\/\/[^\/]+/,"")}else a="/";return a[0]!=="/"&&a[0]!=="#"&&(a="/"+a),CP(a)}const OP=/^[^#]+#/;function kP(a,f){return a.replace(OP,"#")+f}function FP(a,f){const T=document.documentElement.getBoundingClientRect(),I=a.getBoundingClientRect();return{behavior:f.behavior,left:I.left-T.left-(f.left||0),top:I.top-T.top-(f.top||0)}}const n_=()=>({left:window.scrollX,top:window.scrollY});function BP(a){let f;if("el"in a){const T=a.el,I=typeof T=="string"&&T.startsWith("#"),P=typeof T=="string"?I?document.getElementById(T.slice(1)):document.querySelector(T):T;if(!P)return;f=FP(P,a)}else f=a;"scrollBehavior"in document.documentElement.style?window.scrollTo(f):window.scrollTo(f.left!=null?f.left:window.scrollX,f.top!=null?f.top:window.scrollY)}function Vb(a,f){return(history.state?history.state.position-f:-1)+a}const By=new Map;function NP(a,f){By.set(a,f)}function UP(a){const f=By.get(a);return By.delete(a),f}let VP=()=>location.protocol+"//"+location.host;function cE(a,f){const{pathname:T,search:I,hash:P}=f,O=a.indexOf("#");if(O>-1){let H=P.includes(a.slice(O))?a.slice(O).length:1,n=P.slice(H);return n[0]!=="/"&&(n="/"+n),Nb(n,"")}return Nb(T,a)+I+P}function jP(a,f,T,I){let P=[],O=[],N=null;const H=({state:Me})=>{const Be=cE(a,location),st=T.value,Qe=f.value;let Xe=0;if(Me){if(T.value=Be,f.value=Me,N&&N===st){N=null;return}Xe=Qe?Me.position-Qe.position:0}else I(Be);P.forEach(Ne=>{Ne(T.value,st,{delta:Xe,type:bf.pop,direction:Xe?Xe>0?df.forward:df.back:df.unknown})})};function n(){N=T.value}function ne(Me){P.push(Me);const Be=()=>{const st=P.indexOf(Me);st>-1&&P.splice(st,1)};return O.push(Be),Be}function ae(){const{history:Me}=window;Me.state&&Me.replaceState(Tr({},Me.state,{scroll:n_()}),"")}function ue(){for(const Me of O)Me();O=[],window.removeEventListener("popstate",H),window.removeEventListener("beforeunload",ae)}return window.addEventListener("popstate",H),window.addEventListener("beforeunload",ae,{passive:!0}),{pauseListeners:n,listen:ne,destroy:ue}}function jb(a,f,T,I=!1,P=!1){return{back:a,current:f,forward:T,replaced:I,position:window.history.length,scroll:P?n_():null}}function GP(a){const{history:f,location:T}=window,I={value:cE(a,T)},P={value:f.state};P.value||O(I.value,{back:null,current:I.value,forward:null,position:f.length-1,replaced:!0,scroll:null},!0);function O(n,ne,ae){const ue=a.indexOf("#"),Me=ue>-1?(T.host&&document.querySelector("base")?a:a.slice(ue))+n:VP()+a+n;try{f[ae?"replaceState":"pushState"](ne,"",Me),P.value=ne}catch(Be){console.error(Be),T[ae?"replace":"assign"](Me)}}function N(n,ne){const ae=Tr({},f.state,jb(P.value.back,n,P.value.forward,!0),ne,{position:P.value.position});O(n,ae,!0),I.value=n}function H(n,ne){const ae=Tr({},P.value,f.state,{forward:n,scroll:n_()});O(ae.current,ae,!0);const ue=Tr({},jb(I.value,n,null),{position:ae.position+1},ne);O(n,ue,!1),I.value=n}return{location:I,state:P,push:H,replace:N}}function $P(a){a=zP(a);const f=GP(a),T=jP(a,f.state,f.location,f.replace);function I(O,N=!0){N||T.pauseListeners(),history.go(O)}const P=Tr({location:"",base:a,go:I,createHref:kP.bind(null,a)},f,T);return Object.defineProperty(P,"location",{enumerable:!0,get:()=>f.location.value}),Object.defineProperty(P,"state",{enumerable:!0,get:()=>f.state.value}),P}function qP(a){return typeof a=="string"||a&&typeof a=="object"}function uE(a){return typeof a=="string"||typeof a=="symbol"}const hE=Symbol("");var Gb;(function(a){a[a.aborted=4]="aborted",a[a.cancelled=8]="cancelled",a[a.duplicated=16]="duplicated"})(Gb||(Gb={}));function sh(a,f){return Tr(new Error,{type:a,[hE]:!0},f)}function ca(a,f){return a instanceof Error&&hE in a&&(f==null||!!(a.type&f))}const $b="[^/]+?",HP={sensitive:!1,strict:!1,start:!0,end:!0},WP=/[.+*?^${}()[\]/\\]/g;function ZP(a,f){const T=Tr({},HP,f),I=[];let P=T.start?"^":"";const O=[];for(const ne of a){const ae=ne.length?[]:[90];T.strict&&!ne.length&&(P+="/");for(let ue=0;ue<ne.length;ue++){const Me=ne[ue];let Be=40+(T.sensitive?.25:0);if(Me.type===0)ue||(P+="/"),P+=Me.value.replace(WP,"\\$&"),Be+=40;else if(Me.type===1){const{value:st,repeatable:Qe,optional:Xe,regexp:Ne}=Me;O.push({name:st,repeatable:Qe,optional:Xe});const Ve=Ne||$b;if(Ve!==$b){Be+=10;try{new RegExp(`(${Ve})`)}catch(nt){throw new Error(`Invalid custom RegExp for param "${st}" (${Ve}): `+nt.message)}}let ht=Qe?`((?:${Ve})(?:/(?:${Ve}))*)`:`(${Ve})`;ue||(ht=Xe&&ne.length<2?`(?:/${ht})`:"/"+ht),Xe&&(ht+="?"),P+=ht,Be+=20,Xe&&(Be+=-8),Qe&&(Be+=-20),Ve===".*"&&(Be+=-50)}ae.push(Be)}I.push(ae)}if(T.strict&&T.end){const ne=I.length-1;I[ne][I[ne].length-1]+=.7000000000000001}T.strict||(P+="/?"),T.end?P+="$":T.strict&&(P+="(?:/|$)");const N=new RegExp(P,T.sensitive?"":"i");function H(ne){const ae=ne.match(N),ue={};if(!ae)return null;for(let Me=1;Me<ae.length;Me++){const Be=ae[Me]||"",st=O[Me-1];ue[st.name]=Be&&st.repeatable?Be.split("/"):Be}return ue}function n(ne){let ae="",ue=!1;for(const Me of a){(!ue||!ae.endsWith("/"))&&(ae+="/"),ue=!1;for(const Be of Me)if(Be.type===0)ae+=Be.value;else if(Be.type===1){const{value:st,repeatable:Qe,optional:Xe}=Be,Ne=st in ne?ne[st]:"";if(go(Ne)&&!Qe)throw new Error(`Provided param "${st}" is an array but it is not repeatable (* or + modifiers)`);const Ve=go(Ne)?Ne.join("/"):Ne;if(!Ve)if(Xe)Me.length<2&&(ae.endsWith("/")?ae=ae.slice(0,-1):ue=!0);else throw new Error(`Missing required param "${st}"`);ae+=Ve}}return ae||"/"}return{re:N,score:I,keys:O,parse:H,stringify:n}}function XP(a,f){let T=0;for(;T<a.length&&T<f.length;){const I=f[T]-a[T];if(I)return I;T++}return a.length<f.length?a.length===1&&a[0]===80?-1:1:a.length>f.length?f.length===1&&f[0]===80?1:-1:0}function dE(a,f){let T=0;const I=a.score,P=f.score;for(;T<I.length&&T<P.length;){const O=XP(I[T],P[T]);if(O)return O;T++}if(Math.abs(P.length-I.length)===1){if(qb(I))return 1;if(qb(P))return-1}return P.length-I.length}function qb(a){const f=a[a.length-1];return a.length>0&&f[f.length-1]<0}const YP={type:0,value:""},KP=/[a-zA-Z0-9_]/;function JP(a){if(!a)return[[]];if(a==="/")return[[YP]];if(!a.startsWith("/"))throw new Error(`Invalid path "${a}"`);function f(Be){throw new Error(`ERR (${T})/"${ne}": ${Be}`)}let T=0,I=T;const P=[];let O;function N(){O&&P.push(O),O=[]}let H=0,n,ne="",ae="";function ue(){ne&&(T===0?O.push({type:0,value:ne}):T===1||T===2||T===3?(O.length>1&&(n==="*"||n==="+")&&f(`A repeatable param (${ne}) must be alone in its segment. eg: '/:ids+.`),O.push({type:1,value:ne,regexp:ae,repeatable:n==="*"||n==="+",optional:n==="*"||n==="?"})):f("Invalid state to consume buffer"),ne="")}function Me(){ne+=n}for(;H<a.length;){if(n=a[H++],n==="\\"&&T!==2){I=T,T=4;continue}switch(T){case 0:n==="/"?(ne&&ue(),N()):n===":"?(ue(),T=1):Me();break;case 4:Me(),T=I;break;case 1:n==="("?T=2:KP.test(n)?Me():(ue(),T=0,n!=="*"&&n!=="?"&&n!=="+"&&H--);break;case 2:n===")"?ae[ae.length-1]=="\\"?ae=ae.slice(0,-1)+n:T=3:ae+=n;break;case 3:ue(),T=0,n!=="*"&&n!=="?"&&n!=="+"&&H--,ae="";break;default:f("Unknown state");break}}return T===2&&f(`Unfinished custom RegExp for param "${ne}"`),ue(),N(),P}function QP(a,f,T){const I=ZP(JP(a.path),T),P=Tr(I,{record:a,parent:f,children:[],alias:[]});return f&&!P.record.aliasOf==!f.record.aliasOf&&f.children.push(P),P}function eR(a,f){const T=[],I=new Map;f=Xb({strict:!1,end:!0,sensitive:!1},f);function P(ue){return I.get(ue)}function O(ue,Me,Be){const st=!Be,Qe=Wb(ue);Qe.aliasOf=Be&&Be.record;const Xe=Xb(f,ue),Ne=[Qe];if("alias"in ue){const nt=typeof ue.alias=="string"?[ue.alias]:ue.alias;for(const ft of nt)Ne.push(Wb(Tr({},Qe,{components:Be?Be.record.components:Qe.components,path:ft,aliasOf:Be?Be.record:Qe})))}let Ve,ht;for(const nt of Ne){const{path:ft}=nt;if(Me&&ft[0]!=="/"){const Bt=Me.record.path,Et=Bt[Bt.length-1]==="/"?"":"/";nt.path=Me.record.path+(ft&&Et+ft)}if(Ve=QP(nt,Me,Xe),Be?Be.alias.push(Ve):(ht=ht||Ve,ht!==Ve&&ht.alias.push(Ve),st&&ue.name&&!Zb(Ve)&&N(ue.name)),fE(Ve)&&n(Ve),Qe.children){const Bt=Qe.children;for(let Et=0;Et<Bt.length;Et++)O(Bt[Et],Ve,Be&&Be.children[Et])}Be=Be||Ve}return ht?()=>{N(ht)}:hf}function N(ue){if(uE(ue)){const Me=I.get(ue);Me&&(I.delete(ue),T.splice(T.indexOf(Me),1),Me.children.forEach(N),Me.alias.forEach(N))}else{const Me=T.indexOf(ue);Me>-1&&(T.splice(Me,1),ue.record.name&&I.delete(ue.record.name),ue.children.forEach(N),ue.alias.forEach(N))}}function H(){return T}function n(ue){const Me=rR(ue,T);T.splice(Me,0,ue),ue.record.name&&!Zb(ue)&&I.set(ue.record.name,ue)}function ne(ue,Me){let Be,st={},Qe,Xe;if("name"in ue&&ue.name){if(Be=I.get(ue.name),!Be)throw sh(1,{location:ue});Xe=Be.record.name,st=Tr(Hb(Me.params,Be.keys.filter(ht=>!ht.optional).concat(Be.parent?Be.parent.keys.filter(ht=>ht.optional):[]).map(ht=>ht.name)),ue.params&&Hb(ue.params,Be.keys.map(ht=>ht.name))),Qe=Be.stringify(st)}else if(ue.path!=null)Qe=ue.path,Be=T.find(ht=>ht.re.test(Qe)),Be&&(st=Be.parse(Qe),Xe=Be.record.name);else{if(Be=Me.name?I.get(Me.name):T.find(ht=>ht.re.test(Me.path)),!Be)throw sh(1,{location:ue,currentLocation:Me});Xe=Be.record.name,st=Tr({},Me.params,ue.params),Qe=Be.stringify(st)}const Ne=[];let Ve=Be;for(;Ve;)Ne.unshift(Ve.record),Ve=Ve.parent;return{name:Xe,path:Qe,params:st,matched:Ne,meta:iR(Ne)}}a.forEach(ue=>O(ue));function ae(){T.length=0,I.clear()}return{addRoute:O,resolve:ne,removeRoute:N,clearRoutes:ae,getRoutes:H,getRecordMatcher:P}}function Hb(a,f){const T={};for(const I of f)I in a&&(T[I]=a[I]);return T}function Wb(a){const f={path:a.path,redirect:a.redirect,name:a.name,meta:a.meta||{},aliasOf:a.aliasOf,beforeEnter:a.beforeEnter,props:tR(a),children:a.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in a?a.components||null:a.component&&{default:a.component}};return Object.defineProperty(f,"mods",{value:{}}),f}function tR(a){const f={},T=a.props||!1;if("component"in a)f.default=T;else for(const I in a.components)f[I]=typeof T=="object"?T[I]:T;return f}function Zb(a){for(;a;){if(a.record.aliasOf)return!0;a=a.parent}return!1}function iR(a){return a.reduce((f,T)=>Tr(f,T.meta),{})}function Xb(a,f){const T={};for(const I in a)T[I]=I in f?f[I]:a[I];return T}function rR(a,f){let T=0,I=f.length;for(;T!==I;){const O=T+I>>1;dE(a,f[O])<0?I=O:T=O+1}const P=nR(a);return P&&(I=f.lastIndexOf(P,I-1)),I}function nR(a){let f=a;for(;f=f.parent;)if(fE(f)&&dE(a,f)===0)return f}function fE({record:a}){return!!(a.name||a.components&&Object.keys(a.components).length||a.redirect)}function sR(a){const f={};if(a===""||a==="?")return f;const I=(a[0]==="?"?a.slice(1):a).split("&");for(let P=0;P<I.length;++P){const O=I[P].replace(nE," "),N=O.indexOf("="),H=vf(N<0?O:O.slice(0,N)),n=N<0?null:vf(O.slice(N+1));if(H in f){let ne=f[H];go(ne)||(ne=f[H]=[ne]),ne.push(n)}else f[H]=n}return f}function Yb(a){let f="";for(let T in a){const I=a[T];if(T=SP(T),I==null){I!==void 0&&(f+=(f.length?"&":"")+T);continue}(go(I)?I.map(O=>O&&Fy(O)):[I&&Fy(I)]).forEach(O=>{O!==void 0&&(f+=(f.length?"&":"")+T,O!=null&&(f+="="+O))})}return f}function oR(a){const f={};for(const T in a){const I=a[T];I!==void 0&&(f[T]=go(I)?I.map(P=>P==null?null:""+P):I==null?I:""+I)}return f}const aR=Symbol(""),Kb=Symbol(""),A0=Symbol(""),pE=Symbol(""),Ny=Symbol("");function ef(){let a=[];function f(I){return a.push(I),()=>{const P=a.indexOf(I);P>-1&&a.splice(P,1)}}function T(){a=[]}return{add:f,list:()=>a.slice(),reset:T}}function yl(a,f,T,I,P,O=N=>N()){const N=I&&(I.enterCallbacks[P]=I.enterCallbacks[P]||[]);return()=>new Promise((H,n)=>{const ne=Me=>{Me===!1?n(sh(4,{from:T,to:f})):Me instanceof Error?n(Me):qP(Me)?n(sh(2,{from:f,to:Me})):(N&&I.enterCallbacks[P]===N&&typeof Me=="function"&&N.push(Me),H())},ae=O(()=>a.call(I&&I.instances[P],f,T,ne));let ue=Promise.resolve(ae);a.length<3&&(ue=ue.then(ne)),ue.catch(Me=>n(Me))})}function _y(a,f,T,I,P=O=>O()){const O=[];for(const N of a)for(const H in N.components){let n=N.components[H];if(!(f!=="beforeRouteEnter"&&!N.instances[H]))if(iE(n)){const ae=(n.__vccOpts||n)[f];ae&&O.push(yl(ae,T,I,N,H,P))}else{let ne=n();O.push(()=>ne.then(ae=>{if(!ae)throw new Error(`Couldn't resolve component "${H}" at "${N.path}"`);const ue=pP(ae)?ae.default:ae;N.mods[H]=ae,N.components[H]=ue;const Be=(ue.__vccOpts||ue)[f];return Be&&yl(Be,T,I,N,H,P)()}))}}return O}function Jb(a){const f=jo(A0),T=jo(pE),I=Xn(()=>{const n=Ju(a.to);return f.resolve(n)}),P=Xn(()=>{const{matched:n}=I.value,{length:ne}=n,ae=n[ne-1],ue=T.matched;if(!ae||!ue.length)return-1;const Me=ue.findIndex(nh.bind(null,ae));if(Me>-1)return Me;const Be=Qb(n[ne-2]);return ne>1&&Qb(ae)===Be&&ue[ue.length-1].path!==Be?ue.findIndex(nh.bind(null,n[ne-2])):Me}),O=Xn(()=>P.value>-1&&hR(T.params,I.value.params)),N=Xn(()=>P.value>-1&&P.value===T.matched.length-1&&lE(T.params,I.value.params));function H(n={}){return uR(n)?f[Ju(a.replace)?"replace":"push"](Ju(a.to)).catch(hf):Promise.resolve()}return{route:I,href:Xn(()=>I.value.href),isActive:O,isExactActive:N,navigate:H}}const lR=Mf({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Jb,setup(a,{slots:f}){const T=Jm(Jb(a)),{options:I}=jo(A0),P=Xn(()=>({[ew(a.activeClass,I.linkActiveClass,"router-link-active")]:T.isActive,[ew(a.exactActiveClass,I.linkExactActiveClass,"router-link-exact-active")]:T.isExactActive}));return()=>{const O=f.default&&f.default(T);return a.custom?O:r_("a",{"aria-current":T.isExactActive?a.ariaCurrentValue:null,href:T.href,onClick:T.navigate,class:P.value},O)}}}),cR=lR;function uR(a){if(!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)&&!a.defaultPrevented&&!(a.button!==void 0&&a.button!==0)){if(a.currentTarget&&a.currentTarget.getAttribute){const f=a.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(f))return}return a.preventDefault&&a.preventDefault(),!0}}function hR(a,f){for(const T in f){const I=f[T],P=a[T];if(typeof I=="string"){if(I!==P)return!1}else if(!go(P)||P.length!==I.length||I.some((O,N)=>O!==P[N]))return!1}return!0}function Qb(a){return a?a.aliasOf?a.aliasOf.path:a.path:""}const ew=(a,f,T)=>a??f??T,dR=Mf({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(a,{attrs:f,slots:T}){const I=jo(Ny),P=Xn(()=>a.route||I.value),O=jo(Kb,0),N=Xn(()=>{let ne=Ju(O);const{matched:ae}=P.value;let ue;for(;(ue=ae[ne])&&!ue.components;)ne++;return ne}),H=Xn(()=>P.value.matched[N.value]);Pm(Kb,Xn(()=>N.value+1)),Pm(aR,H),Pm(Ny,P);const n=_0();return wc(()=>[n.value,H.value,a.name],([ne,ae,ue],[Me,Be,st])=>{ae&&(ae.instances[ue]=ne,Be&&Be!==ae&&ne&&ne===Me&&(ae.leaveGuards.size||(ae.leaveGuards=Be.leaveGuards),ae.updateGuards.size||(ae.updateGuards=Be.updateGuards))),ne&&ae&&(!Be||!nh(ae,Be)||!Me)&&(ae.enterCallbacks[ue]||[]).forEach(Qe=>Qe(ne))},{flush:"post"}),()=>{const ne=P.value,ae=a.name,ue=H.value,Me=ue&&ue.components[ae];if(!Me)return tw(T.default,{Component:Me,route:ne});const Be=ue.props[ae],st=Be?Be===!0?ne.params:typeof Be=="function"?Be(ne):Be:null,Xe=r_(Me,Tr({},st,f,{onVnodeUnmounted:Ne=>{Ne.component.isUnmounted&&(ue.instances[ae]=null)},ref:n}));return tw(T.default,{Component:Xe,route:ne})||Xe}}});function tw(a,f){if(!a)return null;const T=a(f);return T.length===1?T[0]:T}const fR=dR;function pR(a){const f=eR(a.routes,a),T=a.parseQuery||sR,I=a.stringifyQuery||Yb,P=a.history,O=ef(),N=ef(),H=ef(),n=yT(fl);let ne=fl;Hu&&a.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const ae=py.bind(null,Tt=>""+Tt),ue=py.bind(null,IP),Me=py.bind(null,vf);function Be(Tt,Kt){let Zt,ni;return uE(Tt)?(Zt=f.getRecordMatcher(Tt),ni=Kt):ni=Tt,f.addRoute(ni,Zt)}function st(Tt){const Kt=f.getRecordMatcher(Tt);Kt&&f.removeRoute(Kt)}function Qe(){return f.getRoutes().map(Tt=>Tt.record)}function Xe(Tt){return!!f.getRecordMatcher(Tt)}function Ne(Tt,Kt){if(Kt=Tr({},Kt||n.value),typeof Tt=="string"){const ke=my(T,Tt,Kt.path),Se=f.resolve({path:ke.path},Kt),Ct=P.createHref(ke.fullPath);return Tr(ke,Se,{params:Me(Se.params),hash:vf(ke.hash),redirectedFrom:void 0,href:Ct})}let Zt;if(Tt.path!=null)Zt=Tr({},Tt,{path:my(T,Tt.path,Kt.path).path});else{const ke=Tr({},Tt.params);for(const Se in ke)ke[Se]==null&&delete ke[Se];Zt=Tr({},Tt,{params:ue(ke)}),Kt.params=ue(Kt.params)}const ni=f.resolve(Zt,Kt),ge=Tt.hash||"";ni.params=ae(Me(ni.params));const Ki=PP(I,Tr({},Tt,{hash:EP(ge),path:ni.path})),Ae=P.createHref(Ki);return Tr({fullPath:Ki,hash:ge,query:I===Yb?oR(Tt.query):Tt.query||{}},ni,{redirectedFrom:void 0,href:Ae})}function Ve(Tt){return typeof Tt=="string"?my(T,Tt,n.value.path):Tr({},Tt)}function ht(Tt,Kt){if(ne!==Tt)return sh(8,{from:Kt,to:Tt})}function nt(Tt){return Et(Tt)}function ft(Tt){return nt(Tr(Ve(Tt),{replace:!0}))}function Bt(Tt){const Kt=Tt.matched[Tt.matched.length-1];if(Kt&&Kt.redirect){const{redirect:Zt}=Kt;let ni=typeof Zt=="function"?Zt(Tt):Zt;return typeof ni=="string"&&(ni=ni.includes("?")||ni.includes("#")?ni=Ve(ni):{path:ni},ni.params={}),Tr({query:Tt.query,hash:Tt.hash,params:ni.path!=null?{}:Tt.params},ni)}}function Et(Tt,Kt){const Zt=ne=Ne(Tt),ni=n.value,ge=Tt.state,Ki=Tt.force,Ae=Tt.replace===!0,ke=Bt(Zt);if(ke)return Et(Tr(Ve(ke),{state:typeof ke=="object"?Tr({},ge,ke.state):ge,force:Ki,replace:Ae}),Kt||Zt);const Se=Zt;Se.redirectedFrom=Kt;let Ct;return!Ki&&RP(I,ni,Zt)&&(Ct=sh(16,{to:Se,from:ni}),Vr(ni,ni,!0,!1)),(Ct?Promise.resolve(Ct):or(Se,ni)).catch(_t=>ca(_t)?ca(_t,2)?_t:ei(_t):Oi(_t,Se,ni)).then(_t=>{if(_t){if(ca(_t,2))return Et(Tr({replace:Ae},Ve(_t.to),{state:typeof _t.to=="object"?Tr({},ge,_t.to.state):ge,force:Ki}),Kt||Se)}else _t=jt(Se,ni,!0,Ae,ge);return $t(Se,ni,_t),_t})}function zt(Tt,Kt){const Zt=ht(Tt,Kt);return Zt?Promise.reject(Zt):Promise.resolve()}function zi(Tt){const Kt=ti.values().next().value;return Kt&&typeof Kt.runWithContext=="function"?Kt.runWithContext(Tt):Tt()}function or(Tt,Kt){let Zt;const[ni,ge,Ki]=mR(Tt,Kt);Zt=_y(ni.reverse(),"beforeRouteLeave",Tt,Kt);for(const ke of ni)ke.leaveGuards.forEach(Se=>{Zt.push(yl(Se,Tt,Kt))});const Ae=zt.bind(null,Tt,Kt);return Zt.push(Ae),gr(Zt).then(()=>{Zt=[];for(const ke of O.list())Zt.push(yl(ke,Tt,Kt));return Zt.push(Ae),gr(Zt)}).then(()=>{Zt=_y(ge,"beforeRouteUpdate",Tt,Kt);for(const ke of ge)ke.updateGuards.forEach(Se=>{Zt.push(yl(Se,Tt,Kt))});return Zt.push(Ae),gr(Zt)}).then(()=>{Zt=[];for(const ke of Ki)if(ke.beforeEnter)if(go(ke.beforeEnter))for(const Se of ke.beforeEnter)Zt.push(yl(Se,Tt,Kt));else Zt.push(yl(ke.beforeEnter,Tt,Kt));return Zt.push(Ae),gr(Zt)}).then(()=>(Tt.matched.forEach(ke=>ke.enterCallbacks={}),Zt=_y(Ki,"beforeRouteEnter",Tt,Kt,zi),Zt.push(Ae),gr(Zt))).then(()=>{Zt=[];for(const ke of N.list())Zt.push(yl(ke,Tt,Kt));return Zt.push(Ae),gr(Zt)}).catch(ke=>ca(ke,8)?ke:Promise.reject(ke))}function $t(Tt,Kt,Zt){H.list().forEach(ni=>zi(()=>ni(Tt,Kt,Zt)))}function jt(Tt,Kt,Zt,ni,ge){const Ki=ht(Tt,Kt);if(Ki)return Ki;const Ae=Kt===fl,ke=Hu?history.state:{};Zt&&(ni||Ae?P.replace(Tt.fullPath,Tr({scroll:Ae&&ke&&ke.scroll},ge)):P.push(Tt.fullPath,ge)),n.value=Tt,Vr(Tt,Kt,Zt,Ae),ei()}let Pr;function un(){Pr||(Pr=P.listen((Tt,Kt,Zt)=>{if(!Yn.listening)return;const ni=Ne(Tt),ge=Bt(ni);if(ge){Et(Tr(ge,{replace:!0}),ni).catch(hf);return}ne=ni;const Ki=n.value;Hu&&NP(Vb(Ki.fullPath,Zt.delta),n_()),or(ni,Ki).catch(Ae=>ca(Ae,12)?Ae:ca(Ae,2)?(Et(Ae.to,ni).then(ke=>{ca(ke,20)&&!Zt.delta&&Zt.type===bf.pop&&P.go(-1,!1)}).catch(hf),Promise.reject()):(Zt.delta&&P.go(-Zt.delta,!1),Oi(Ae,ni,Ki))).then(Ae=>{Ae=Ae||jt(ni,Ki,!1),Ae&&(Zt.delta&&!ca(Ae,8)?P.go(-Zt.delta,!1):Zt.type===bf.pop&&ca(Ae,20)&&P.go(-1,!1)),$t(ni,Ki,Ae)}).catch(hf)}))}let Mn=ef(),Jt=ef(),Ii;function Oi(Tt,Kt,Zt){ei(Tt);const ni=Jt.list();return ni.length?ni.forEach(ge=>ge(Tt,Kt,Zt)):console.error(Tt),Promise.reject(Tt)}function Sr(){return Ii&&n.value!==fl?Promise.resolve():new Promise((Tt,Kt)=>{Mn.add([Tt,Kt])})}function ei(Tt){return Ii||(Ii=!Tt,un(),Mn.list().forEach(([Kt,Zt])=>Tt?Zt(Tt):Kt()),Mn.reset()),Tt}function Vr(Tt,Kt,Zt,ni){const{scrollBehavior:ge}=a;if(!Hu||!ge)return Promise.resolve();const Ki=!Zt&&UP(Vb(Tt.fullPath,0))||(ni||!Zt)&&history.state&&history.state.scroll||null;return g0().then(()=>ge(Tt,Kt,Ki)).then(Ae=>Ae&&BP(Ae)).catch(Ae=>Oi(Ae,Tt,Kt))}const Or=Tt=>P.go(Tt);let _n;const ti=new Set,Yn={currentRoute:n,listening:!0,addRoute:Be,removeRoute:st,clearRoutes:f.clearRoutes,hasRoute:Xe,getRoutes:Qe,resolve:Ne,options:a,push:nt,replace:ft,go:Or,back:()=>Or(-1),forward:()=>Or(1),beforeEach:O.add,beforeResolve:N.add,afterEach:H.add,onError:Jt.add,isReady:Sr,install(Tt){const Kt=this;Tt.component("RouterLink",cR),Tt.component("RouterView",fR),Tt.config.globalProperties.$router=Kt,Object.defineProperty(Tt.config.globalProperties,"$route",{enumerable:!0,get:()=>Ju(n)}),Hu&&!_n&&n.value===fl&&(_n=!0,nt(P.location).catch(ge=>{}));const Zt={};for(const ge in fl)Object.defineProperty(Zt,ge,{get:()=>n.value[ge],enumerable:!0});Tt.provide(A0,Kt),Tt.provide(pE,_T(Zt)),Tt.provide(Ny,n);const ni=Tt.unmount;ti.add(Tt),Tt.unmount=function(){ti.delete(Tt),ti.size<1&&(ne=fl,Pr&&Pr(),Pr=null,n.value=fl,_n=!1,Ii=!1),ni()}}};function gr(Tt){return Tt.reduce((Kt,Zt)=>Kt.then(()=>zi(Zt)),Promise.resolve())}return Yn}function mR(a,f){const T=[],I=[],P=[],O=Math.max(f.matched.length,a.matched.length);for(let N=0;N<O;N++){const H=f.matched[N];H&&(a.matched.find(ne=>nh(ne,H))?I.push(H):T.push(H));const n=a.matched[N];n&&(f.matched.find(ne=>nh(ne,n))||P.push(n))}return[T,I,P]}const _R={name:"BaseButton",props:{text:{type:String,default:"Button"},type:{type:String,default:"button"},disabled:{type:Boolean,default:!1},variant:{type:String,default:"primary"}},computed:{buttonClass(){return`btn btn-${this.variant}`}}},gR=["disabled"];function yR(a,f,T,I,P,O){return Qr(),pn("button",{class:Ym(O.buttonClass),disabled:T.disabled,onClick:f[0]||(f[0]=N=>a.$emit("click"))},[VM(a.$slots,"default",{},()=>[Zu(Xs(T.text),1)])],10,gR)}const xR=yo(_R,[["render",yR],["__scopeId","data-v-d5d7fad8"]]);function mE(a,f){return function(){return a.apply(f,arguments)}}const{toString:vR}=Object.prototype,{getPrototypeOf:I0}=Object,s_=(a=>f=>{const T=vR.call(f);return a[T]||(a[T]=T.slice(8,-1).toLowerCase())})(Object.create(null)),xo=a=>(a=a.toLowerCase(),f=>s_(f)===a),o_=a=>f=>typeof f===a,{isArray:uh}=Array,wf=o_("undefined");function bR(a){return a!==null&&!wf(a)&&a.constructor!==null&&!wf(a.constructor)&&Ds(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const _E=xo("ArrayBuffer");function wR(a){let f;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?f=ArrayBuffer.isView(a):f=a&&a.buffer&&_E(a.buffer),f}const TR=o_("string"),Ds=o_("function"),gE=o_("number"),a_=a=>a!==null&&typeof a=="object",ER=a=>a===!0||a===!1,Dm=a=>{if(s_(a)!=="object")return!1;const f=I0(a);return(f===null||f===Object.prototype||Object.getPrototypeOf(f)===null)&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)},SR=xo("Date"),AR=xo("File"),IR=xo("Blob"),MR=xo("FileList"),CR=a=>a_(a)&&Ds(a.pipe),PR=a=>{let f;return a&&(typeof FormData=="function"&&a instanceof FormData||Ds(a.append)&&((f=s_(a))==="formdata"||f==="object"&&Ds(a.toString)&&a.toString()==="[object FormData]"))},RR=xo("URLSearchParams"),[LR,DR,zR,OR]=["ReadableStream","Request","Response","Headers"].map(xo),kR=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Rf(a,f,{allOwnKeys:T=!1}={}){if(a===null||typeof a>"u")return;let I,P;if(typeof a!="object"&&(a=[a]),uh(a))for(I=0,P=a.length;I<P;I++)f.call(null,a[I],I,a);else{const O=T?Object.getOwnPropertyNames(a):Object.keys(a),N=O.length;let H;for(I=0;I<N;I++)H=O[I],f.call(null,a[H],H,a)}}function yE(a,f){f=f.toLowerCase();const T=Object.keys(a);let I=T.length,P;for(;I-- >0;)if(P=T[I],f===P.toLowerCase())return P;return null}const xc=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,xE=a=>!wf(a)&&a!==xc;function Uy(){const{caseless:a}=xE(this)&&this||{},f={},T=(I,P)=>{const O=a&&yE(f,P)||P;Dm(f[O])&&Dm(I)?f[O]=Uy(f[O],I):Dm(I)?f[O]=Uy({},I):uh(I)?f[O]=I.slice():f[O]=I};for(let I=0,P=arguments.length;I<P;I++)arguments[I]&&Rf(arguments[I],T);return f}const FR=(a,f,T,{allOwnKeys:I}={})=>(Rf(f,(P,O)=>{T&&Ds(P)?a[O]=mE(P,T):a[O]=P},{allOwnKeys:I}),a),BR=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),NR=(a,f,T,I)=>{a.prototype=Object.create(f.prototype,I),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:f.prototype}),T&&Object.assign(a.prototype,T)},UR=(a,f,T,I)=>{let P,O,N;const H={};if(f=f||{},a==null)return f;do{for(P=Object.getOwnPropertyNames(a),O=P.length;O-- >0;)N=P[O],(!I||I(N,a,f))&&!H[N]&&(f[N]=a[N],H[N]=!0);a=T!==!1&&I0(a)}while(a&&(!T||T(a,f))&&a!==Object.prototype);return f},VR=(a,f,T)=>{a=String(a),(T===void 0||T>a.length)&&(T=a.length),T-=f.length;const I=a.indexOf(f,T);return I!==-1&&I===T},jR=a=>{if(!a)return null;if(uh(a))return a;let f=a.length;if(!gE(f))return null;const T=new Array(f);for(;f-- >0;)T[f]=a[f];return T},GR=(a=>f=>a&&f instanceof a)(typeof Uint8Array<"u"&&I0(Uint8Array)),$R=(a,f)=>{const I=(a&&a[Symbol.iterator]).call(a);let P;for(;(P=I.next())&&!P.done;){const O=P.value;f.call(a,O[0],O[1])}},qR=(a,f)=>{let T;const I=[];for(;(T=a.exec(f))!==null;)I.push(T);return I},HR=xo("HTMLFormElement"),WR=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(T,I,P){return I.toUpperCase()+P}),iw=(({hasOwnProperty:a})=>(f,T)=>a.call(f,T))(Object.prototype),ZR=xo("RegExp"),vE=(a,f)=>{const T=Object.getOwnPropertyDescriptors(a),I={};Rf(T,(P,O)=>{let N;(N=f(P,O,a))!==!1&&(I[O]=N||P)}),Object.defineProperties(a,I)},XR=a=>{vE(a,(f,T)=>{if(Ds(a)&&["arguments","caller","callee"].indexOf(T)!==-1)return!1;const I=a[T];if(Ds(I)){if(f.enumerable=!1,"writable"in f){f.writable=!1;return}f.set||(f.set=()=>{throw Error("Can not rewrite read-only method '"+T+"'")})}})},YR=(a,f)=>{const T={},I=P=>{P.forEach(O=>{T[O]=!0})};return uh(a)?I(a):I(String(a).split(f)),T},KR=()=>{},JR=(a,f)=>a!=null&&Number.isFinite(a=+a)?a:f,gy="abcdefghijklmnopqrstuvwxyz",rw="0123456789",bE={DIGIT:rw,ALPHA:gy,ALPHA_DIGIT:gy+gy.toUpperCase()+rw},QR=(a=16,f=bE.ALPHA_DIGIT)=>{let T="";const{length:I}=f;for(;a--;)T+=f[Math.random()*I|0];return T};function eL(a){return!!(a&&Ds(a.append)&&a[Symbol.toStringTag]==="FormData"&&a[Symbol.iterator])}const tL=a=>{const f=new Array(10),T=(I,P)=>{if(a_(I)){if(f.indexOf(I)>=0)return;if(!("toJSON"in I)){f[P]=I;const O=uh(I)?[]:{};return Rf(I,(N,H)=>{const n=T(N,P+1);!wf(n)&&(O[H]=n)}),f[P]=void 0,O}}return I};return T(a,0)},iL=xo("AsyncFunction"),rL=a=>a&&(a_(a)||Ds(a))&&Ds(a.then)&&Ds(a.catch),wE=((a,f)=>a?setImmediate:f?((T,I)=>(xc.addEventListener("message",({source:P,data:O})=>{P===xc&&O===T&&I.length&&I.shift()()},!1),P=>{I.push(P),xc.postMessage(T,"*")}))(`axios@${Math.random()}`,[]):T=>setTimeout(T))(typeof setImmediate=="function",Ds(xc.postMessage)),nL=typeof queueMicrotask<"u"?queueMicrotask.bind(xc):typeof process<"u"&&process.nextTick||wE,wt={isArray:uh,isArrayBuffer:_E,isBuffer:bR,isFormData:PR,isArrayBufferView:wR,isString:TR,isNumber:gE,isBoolean:ER,isObject:a_,isPlainObject:Dm,isReadableStream:LR,isRequest:DR,isResponse:zR,isHeaders:OR,isUndefined:wf,isDate:SR,isFile:AR,isBlob:IR,isRegExp:ZR,isFunction:Ds,isStream:CR,isURLSearchParams:RR,isTypedArray:GR,isFileList:MR,forEach:Rf,merge:Uy,extend:FR,trim:kR,stripBOM:BR,inherits:NR,toFlatObject:UR,kindOf:s_,kindOfTest:xo,endsWith:VR,toArray:jR,forEachEntry:$R,matchAll:qR,isHTMLForm:HR,hasOwnProperty:iw,hasOwnProp:iw,reduceDescriptors:vE,freezeMethods:XR,toObjectSet:YR,toCamelCase:WR,noop:KR,toFiniteNumber:JR,findKey:yE,global:xc,isContextDefined:xE,ALPHABET:bE,generateString:QR,isSpecCompliantForm:eL,toJSONObject:tL,isAsyncFn:iL,isThenable:rL,setImmediate:wE,asap:nL};function $i(a,f,T,I,P){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",f&&(this.code=f),T&&(this.config=T),I&&(this.request=I),P&&(this.response=P,this.status=P.status?P.status:null)}wt.inherits($i,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:wt.toJSONObject(this.config),code:this.code,status:this.status}}});const TE=$i.prototype,EE={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{EE[a]={value:a}});Object.defineProperties($i,EE);Object.defineProperty(TE,"isAxiosError",{value:!0});$i.from=(a,f,T,I,P,O)=>{const N=Object.create(TE);return wt.toFlatObject(a,N,function(n){return n!==Error.prototype},H=>H!=="isAxiosError"),$i.call(N,a.message,f,T,I,P),N.cause=a,N.name=a.name,O&&Object.assign(N,O),N};const sL=null;function Vy(a){return wt.isPlainObject(a)||wt.isArray(a)}function SE(a){return wt.endsWith(a,"[]")?a.slice(0,-2):a}function nw(a,f,T){return a?a.concat(f).map(function(P,O){return P=SE(P),!T&&O?"["+P+"]":P}).join(T?".":""):f}function oL(a){return wt.isArray(a)&&!a.some(Vy)}const aL=wt.toFlatObject(wt,{},null,function(f){return/^is[A-Z]/.test(f)});function l_(a,f,T){if(!wt.isObject(a))throw new TypeError("target must be an object");f=f||new FormData,T=wt.toFlatObject(T,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Qe,Xe){return!wt.isUndefined(Xe[Qe])});const I=T.metaTokens,P=T.visitor||ae,O=T.dots,N=T.indexes,n=(T.Blob||typeof Blob<"u"&&Blob)&&wt.isSpecCompliantForm(f);if(!wt.isFunction(P))throw new TypeError("visitor must be a function");function ne(st){if(st===null)return"";if(wt.isDate(st))return st.toISOString();if(!n&&wt.isBlob(st))throw new $i("Blob is not supported. Use a Buffer instead.");return wt.isArrayBuffer(st)||wt.isTypedArray(st)?n&&typeof Blob=="function"?new Blob([st]):Buffer.from(st):st}function ae(st,Qe,Xe){let Ne=st;if(st&&!Xe&&typeof st=="object"){if(wt.endsWith(Qe,"{}"))Qe=I?Qe:Qe.slice(0,-2),st=JSON.stringify(st);else if(wt.isArray(st)&&oL(st)||(wt.isFileList(st)||wt.endsWith(Qe,"[]"))&&(Ne=wt.toArray(st)))return Qe=SE(Qe),Ne.forEach(function(ht,nt){!(wt.isUndefined(ht)||ht===null)&&f.append(N===!0?nw([Qe],nt,O):N===null?Qe:Qe+"[]",ne(ht))}),!1}return Vy(st)?!0:(f.append(nw(Xe,Qe,O),ne(st)),!1)}const ue=[],Me=Object.assign(aL,{defaultVisitor:ae,convertValue:ne,isVisitable:Vy});function Be(st,Qe){if(!wt.isUndefined(st)){if(ue.indexOf(st)!==-1)throw Error("Circular reference detected in "+Qe.join("."));ue.push(st),wt.forEach(st,function(Ne,Ve){(!(wt.isUndefined(Ne)||Ne===null)&&P.call(f,Ne,wt.isString(Ve)?Ve.trim():Ve,Qe,Me))===!0&&Be(Ne,Qe?Qe.concat(Ve):[Ve])}),ue.pop()}}if(!wt.isObject(a))throw new TypeError("data must be an object");return Be(a),f}function sw(a){const f={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(I){return f[I]})}function M0(a,f){this._pairs=[],a&&l_(a,this,f)}const AE=M0.prototype;AE.append=function(f,T){this._pairs.push([f,T])};AE.toString=function(f){const T=f?function(I){return f.call(this,I,sw)}:sw;return this._pairs.map(function(P){return T(P[0])+"="+T(P[1])},"").join("&")};function lL(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function IE(a,f,T){if(!f)return a;const I=T&&T.encode||lL,P=T&&T.serialize;let O;if(P?O=P(f,T):O=wt.isURLSearchParams(f)?f.toString():new M0(f,T).toString(I),O){const N=a.indexOf("#");N!==-1&&(a=a.slice(0,N)),a+=(a.indexOf("?")===-1?"?":"&")+O}return a}class ow{constructor(){this.handlers=[]}use(f,T,I){return this.handlers.push({fulfilled:f,rejected:T,synchronous:I?I.synchronous:!1,runWhen:I?I.runWhen:null}),this.handlers.length-1}eject(f){this.handlers[f]&&(this.handlers[f]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(f){wt.forEach(this.handlers,function(I){I!==null&&f(I)})}}const ME={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},cL=typeof URLSearchParams<"u"?URLSearchParams:M0,uL=typeof FormData<"u"?FormData:null,hL=typeof Blob<"u"?Blob:null,dL={isBrowser:!0,classes:{URLSearchParams:cL,FormData:uL,Blob:hL},protocols:["http","https","file","blob","url","data"]},C0=typeof window<"u"&&typeof document<"u",jy=typeof navigator=="object"&&navigator||void 0,fL=C0&&(!jy||["ReactNative","NativeScript","NS"].indexOf(jy.product)<0),pL=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",mL=C0&&window.location.href||"http://localhost",_L=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:C0,hasStandardBrowserEnv:fL,hasStandardBrowserWebWorkerEnv:pL,navigator:jy,origin:mL},Symbol.toStringTag,{value:"Module"})),_s={..._L,...dL};function gL(a,f){return l_(a,new _s.classes.URLSearchParams,Object.assign({visitor:function(T,I,P,O){return _s.isNode&&wt.isBuffer(T)?(this.append(I,T.toString("base64")),!1):O.defaultVisitor.apply(this,arguments)}},f))}function yL(a){return wt.matchAll(/\w+|\[(\w*)]/g,a).map(f=>f[0]==="[]"?"":f[1]||f[0])}function xL(a){const f={},T=Object.keys(a);let I;const P=T.length;let O;for(I=0;I<P;I++)O=T[I],f[O]=a[O];return f}function CE(a){function f(T,I,P,O){let N=T[O++];if(N==="__proto__")return!0;const H=Number.isFinite(+N),n=O>=T.length;return N=!N&&wt.isArray(P)?P.length:N,n?(wt.hasOwnProp(P,N)?P[N]=[P[N],I]:P[N]=I,!H):((!P[N]||!wt.isObject(P[N]))&&(P[N]=[]),f(T,I,P[N],O)&&wt.isArray(P[N])&&(P[N]=xL(P[N])),!H)}if(wt.isFormData(a)&&wt.isFunction(a.entries)){const T={};return wt.forEachEntry(a,(I,P)=>{f(yL(I),P,T,0)}),T}return null}function vL(a,f,T){if(wt.isString(a))try{return(f||JSON.parse)(a),wt.trim(a)}catch(I){if(I.name!=="SyntaxError")throw I}return(0,JSON.stringify)(a)}const Lf={transitional:ME,adapter:["xhr","http","fetch"],transformRequest:[function(f,T){const I=T.getContentType()||"",P=I.indexOf("application/json")>-1,O=wt.isObject(f);if(O&&wt.isHTMLForm(f)&&(f=new FormData(f)),wt.isFormData(f))return P?JSON.stringify(CE(f)):f;if(wt.isArrayBuffer(f)||wt.isBuffer(f)||wt.isStream(f)||wt.isFile(f)||wt.isBlob(f)||wt.isReadableStream(f))return f;if(wt.isArrayBufferView(f))return f.buffer;if(wt.isURLSearchParams(f))return T.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),f.toString();let H;if(O){if(I.indexOf("application/x-www-form-urlencoded")>-1)return gL(f,this.formSerializer).toString();if((H=wt.isFileList(f))||I.indexOf("multipart/form-data")>-1){const n=this.env&&this.env.FormData;return l_(H?{"files[]":f}:f,n&&new n,this.formSerializer)}}return O||P?(T.setContentType("application/json",!1),vL(f)):f}],transformResponse:[function(f){const T=this.transitional||Lf.transitional,I=T&&T.forcedJSONParsing,P=this.responseType==="json";if(wt.isResponse(f)||wt.isReadableStream(f))return f;if(f&&wt.isString(f)&&(I&&!this.responseType||P)){const N=!(T&&T.silentJSONParsing)&&P;try{return JSON.parse(f)}catch(H){if(N)throw H.name==="SyntaxError"?$i.from(H,$i.ERR_BAD_RESPONSE,this,null,this.response):H}}return f}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:_s.classes.FormData,Blob:_s.classes.Blob},validateStatus:function(f){return f>=200&&f<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};wt.forEach(["delete","get","head","post","put","patch"],a=>{Lf.headers[a]={}});const bL=wt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),wL=a=>{const f={};let T,I,P;return a&&a.split(`
`).forEach(function(N){P=N.indexOf(":"),T=N.substring(0,P).trim().toLowerCase(),I=N.substring(P+1).trim(),!(!T||f[T]&&bL[T])&&(T==="set-cookie"?f[T]?f[T].push(I):f[T]=[I]:f[T]=f[T]?f[T]+", "+I:I)}),f},aw=Symbol("internals");function tf(a){return a&&String(a).trim().toLowerCase()}function zm(a){return a===!1||a==null?a:wt.isArray(a)?a.map(zm):String(a)}function TL(a){const f=Object.create(null),T=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let I;for(;I=T.exec(a);)f[I[1]]=I[2];return f}const EL=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function yy(a,f,T,I,P){if(wt.isFunction(I))return I.call(this,f,T);if(P&&(f=T),!!wt.isString(f)){if(wt.isString(I))return f.indexOf(I)!==-1;if(wt.isRegExp(I))return I.test(f)}}function SL(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(f,T,I)=>T.toUpperCase()+I)}function AL(a,f){const T=wt.toCamelCase(" "+f);["get","set","has"].forEach(I=>{Object.defineProperty(a,I+T,{value:function(P,O,N){return this[I].call(this,f,P,O,N)},configurable:!0})})}class gs{constructor(f){f&&this.set(f)}set(f,T,I){const P=this;function O(H,n,ne){const ae=tf(n);if(!ae)throw new Error("header name must be a non-empty string");const ue=wt.findKey(P,ae);(!ue||P[ue]===void 0||ne===!0||ne===void 0&&P[ue]!==!1)&&(P[ue||n]=zm(H))}const N=(H,n)=>wt.forEach(H,(ne,ae)=>O(ne,ae,n));if(wt.isPlainObject(f)||f instanceof this.constructor)N(f,T);else if(wt.isString(f)&&(f=f.trim())&&!EL(f))N(wL(f),T);else if(wt.isHeaders(f))for(const[H,n]of f.entries())O(n,H,I);else f!=null&&O(T,f,I);return this}get(f,T){if(f=tf(f),f){const I=wt.findKey(this,f);if(I){const P=this[I];if(!T)return P;if(T===!0)return TL(P);if(wt.isFunction(T))return T.call(this,P,I);if(wt.isRegExp(T))return T.exec(P);throw new TypeError("parser must be boolean|regexp|function")}}}has(f,T){if(f=tf(f),f){const I=wt.findKey(this,f);return!!(I&&this[I]!==void 0&&(!T||yy(this,this[I],I,T)))}return!1}delete(f,T){const I=this;let P=!1;function O(N){if(N=tf(N),N){const H=wt.findKey(I,N);H&&(!T||yy(I,I[H],H,T))&&(delete I[H],P=!0)}}return wt.isArray(f)?f.forEach(O):O(f),P}clear(f){const T=Object.keys(this);let I=T.length,P=!1;for(;I--;){const O=T[I];(!f||yy(this,this[O],O,f,!0))&&(delete this[O],P=!0)}return P}normalize(f){const T=this,I={};return wt.forEach(this,(P,O)=>{const N=wt.findKey(I,O);if(N){T[N]=zm(P),delete T[O];return}const H=f?SL(O):String(O).trim();H!==O&&delete T[O],T[H]=zm(P),I[H]=!0}),this}concat(...f){return this.constructor.concat(this,...f)}toJSON(f){const T=Object.create(null);return wt.forEach(this,(I,P)=>{I!=null&&I!==!1&&(T[P]=f&&wt.isArray(I)?I.join(", "):I)}),T}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([f,T])=>f+": "+T).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(f){return f instanceof this?f:new this(f)}static concat(f,...T){const I=new this(f);return T.forEach(P=>I.set(P)),I}static accessor(f){const I=(this[aw]=this[aw]={accessors:{}}).accessors,P=this.prototype;function O(N){const H=tf(N);I[H]||(AL(P,N),I[H]=!0)}return wt.isArray(f)?f.forEach(O):O(f),this}}gs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);wt.reduceDescriptors(gs.prototype,({value:a},f)=>{let T=f[0].toUpperCase()+f.slice(1);return{get:()=>a,set(I){this[T]=I}}});wt.freezeMethods(gs);function xy(a,f){const T=this||Lf,I=f||T,P=gs.from(I.headers);let O=I.data;return wt.forEach(a,function(H){O=H.call(T,O,P.normalize(),f?f.status:void 0)}),P.normalize(),O}function PE(a){return!!(a&&a.__CANCEL__)}function hh(a,f,T){$i.call(this,a??"canceled",$i.ERR_CANCELED,f,T),this.name="CanceledError"}wt.inherits(hh,$i,{__CANCEL__:!0});function RE(a,f,T){const I=T.config.validateStatus;!T.status||!I||I(T.status)?a(T):f(new $i("Request failed with status code "+T.status,[$i.ERR_BAD_REQUEST,$i.ERR_BAD_RESPONSE][Math.floor(T.status/100)-4],T.config,T.request,T))}function IL(a){const f=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return f&&f[1]||""}function ML(a,f){a=a||10;const T=new Array(a),I=new Array(a);let P=0,O=0,N;return f=f!==void 0?f:1e3,function(n){const ne=Date.now(),ae=I[O];N||(N=ne),T[P]=n,I[P]=ne;let ue=O,Me=0;for(;ue!==P;)Me+=T[ue++],ue=ue%a;if(P=(P+1)%a,P===O&&(O=(O+1)%a),ne-N<f)return;const Be=ae&&ne-ae;return Be?Math.round(Me*1e3/Be):void 0}}function CL(a,f){let T=0,I=1e3/f,P,O;const N=(ne,ae=Date.now())=>{T=ae,P=null,O&&(clearTimeout(O),O=null),a.apply(null,ne)};return[(...ne)=>{const ae=Date.now(),ue=ae-T;ue>=I?N(ne,ae):(P=ne,O||(O=setTimeout(()=>{O=null,N(P)},I-ue)))},()=>P&&N(P)]}const jm=(a,f,T=3)=>{let I=0;const P=ML(50,250);return CL(O=>{const N=O.loaded,H=O.lengthComputable?O.total:void 0,n=N-I,ne=P(n),ae=N<=H;I=N;const ue={loaded:N,total:H,progress:H?N/H:void 0,bytes:n,rate:ne||void 0,estimated:ne&&H&&ae?(H-N)/ne:void 0,event:O,lengthComputable:H!=null,[f?"download":"upload"]:!0};a(ue)},T)},lw=(a,f)=>{const T=a!=null;return[I=>f[0]({lengthComputable:T,total:a,loaded:I}),f[1]]},cw=a=>(...f)=>wt.asap(()=>a(...f)),PL=_s.hasStandardBrowserEnv?function(){const f=_s.navigator&&/(msie|trident)/i.test(_s.navigator.userAgent),T=document.createElement("a");let I;function P(O){let N=O;return f&&(T.setAttribute("href",N),N=T.href),T.setAttribute("href",N),{href:T.href,protocol:T.protocol?T.protocol.replace(/:$/,""):"",host:T.host,search:T.search?T.search.replace(/^\?/,""):"",hash:T.hash?T.hash.replace(/^#/,""):"",hostname:T.hostname,port:T.port,pathname:T.pathname.charAt(0)==="/"?T.pathname:"/"+T.pathname}}return I=P(window.location.href),function(N){const H=wt.isString(N)?P(N):N;return H.protocol===I.protocol&&H.host===I.host}}():function(){return function(){return!0}}(),RL=_s.hasStandardBrowserEnv?{write(a,f,T,I,P,O){const N=[a+"="+encodeURIComponent(f)];wt.isNumber(T)&&N.push("expires="+new Date(T).toGMTString()),wt.isString(I)&&N.push("path="+I),wt.isString(P)&&N.push("domain="+P),O===!0&&N.push("secure"),document.cookie=N.join("; ")},read(a){const f=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return f?decodeURIComponent(f[3]):null},remove(a){this.write(a,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function LL(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function DL(a,f){return f?a.replace(/\/?\/$/,"")+"/"+f.replace(/^\/+/,""):a}function LE(a,f){return a&&!LL(f)?DL(a,f):f}const uw=a=>a instanceof gs?{...a}:a;function Ic(a,f){f=f||{};const T={};function I(ne,ae,ue){return wt.isPlainObject(ne)&&wt.isPlainObject(ae)?wt.merge.call({caseless:ue},ne,ae):wt.isPlainObject(ae)?wt.merge({},ae):wt.isArray(ae)?ae.slice():ae}function P(ne,ae,ue){if(wt.isUndefined(ae)){if(!wt.isUndefined(ne))return I(void 0,ne,ue)}else return I(ne,ae,ue)}function O(ne,ae){if(!wt.isUndefined(ae))return I(void 0,ae)}function N(ne,ae){if(wt.isUndefined(ae)){if(!wt.isUndefined(ne))return I(void 0,ne)}else return I(void 0,ae)}function H(ne,ae,ue){if(ue in f)return I(ne,ae);if(ue in a)return I(void 0,ne)}const n={url:O,method:O,data:O,baseURL:N,transformRequest:N,transformResponse:N,paramsSerializer:N,timeout:N,timeoutMessage:N,withCredentials:N,withXSRFToken:N,adapter:N,responseType:N,xsrfCookieName:N,xsrfHeaderName:N,onUploadProgress:N,onDownloadProgress:N,decompress:N,maxContentLength:N,maxBodyLength:N,beforeRedirect:N,transport:N,httpAgent:N,httpsAgent:N,cancelToken:N,socketPath:N,responseEncoding:N,validateStatus:H,headers:(ne,ae)=>P(uw(ne),uw(ae),!0)};return wt.forEach(Object.keys(Object.assign({},a,f)),function(ae){const ue=n[ae]||P,Me=ue(a[ae],f[ae],ae);wt.isUndefined(Me)&&ue!==H||(T[ae]=Me)}),T}const DE=a=>{const f=Ic({},a);let{data:T,withXSRFToken:I,xsrfHeaderName:P,xsrfCookieName:O,headers:N,auth:H}=f;f.headers=N=gs.from(N),f.url=IE(LE(f.baseURL,f.url),a.params,a.paramsSerializer),H&&N.set("Authorization","Basic "+btoa((H.username||"")+":"+(H.password?unescape(encodeURIComponent(H.password)):"")));let n;if(wt.isFormData(T)){if(_s.hasStandardBrowserEnv||_s.hasStandardBrowserWebWorkerEnv)N.setContentType(void 0);else if((n=N.getContentType())!==!1){const[ne,...ae]=n?n.split(";").map(ue=>ue.trim()).filter(Boolean):[];N.setContentType([ne||"multipart/form-data",...ae].join("; "))}}if(_s.hasStandardBrowserEnv&&(I&&wt.isFunction(I)&&(I=I(f)),I||I!==!1&&PL(f.url))){const ne=P&&O&&RL.read(O);ne&&N.set(P,ne)}return f},zL=typeof XMLHttpRequest<"u",OL=zL&&function(a){return new Promise(function(T,I){const P=DE(a);let O=P.data;const N=gs.from(P.headers).normalize();let{responseType:H,onUploadProgress:n,onDownloadProgress:ne}=P,ae,ue,Me,Be,st;function Qe(){Be&&Be(),st&&st(),P.cancelToken&&P.cancelToken.unsubscribe(ae),P.signal&&P.signal.removeEventListener("abort",ae)}let Xe=new XMLHttpRequest;Xe.open(P.method.toUpperCase(),P.url,!0),Xe.timeout=P.timeout;function Ne(){if(!Xe)return;const ht=gs.from("getAllResponseHeaders"in Xe&&Xe.getAllResponseHeaders()),ft={data:!H||H==="text"||H==="json"?Xe.responseText:Xe.response,status:Xe.status,statusText:Xe.statusText,headers:ht,config:a,request:Xe};RE(function(Et){T(Et),Qe()},function(Et){I(Et),Qe()},ft),Xe=null}"onloadend"in Xe?Xe.onloadend=Ne:Xe.onreadystatechange=function(){!Xe||Xe.readyState!==4||Xe.status===0&&!(Xe.responseURL&&Xe.responseURL.indexOf("file:")===0)||setTimeout(Ne)},Xe.onabort=function(){Xe&&(I(new $i("Request aborted",$i.ECONNABORTED,a,Xe)),Xe=null)},Xe.onerror=function(){I(new $i("Network Error",$i.ERR_NETWORK,a,Xe)),Xe=null},Xe.ontimeout=function(){let nt=P.timeout?"timeout of "+P.timeout+"ms exceeded":"timeout exceeded";const ft=P.transitional||ME;P.timeoutErrorMessage&&(nt=P.timeoutErrorMessage),I(new $i(nt,ft.clarifyTimeoutError?$i.ETIMEDOUT:$i.ECONNABORTED,a,Xe)),Xe=null},O===void 0&&N.setContentType(null),"setRequestHeader"in Xe&&wt.forEach(N.toJSON(),function(nt,ft){Xe.setRequestHeader(ft,nt)}),wt.isUndefined(P.withCredentials)||(Xe.withCredentials=!!P.withCredentials),H&&H!=="json"&&(Xe.responseType=P.responseType),ne&&([Me,st]=jm(ne,!0),Xe.addEventListener("progress",Me)),n&&Xe.upload&&([ue,Be]=jm(n),Xe.upload.addEventListener("progress",ue),Xe.upload.addEventListener("loadend",Be)),(P.cancelToken||P.signal)&&(ae=ht=>{Xe&&(I(!ht||ht.type?new hh(null,a,Xe):ht),Xe.abort(),Xe=null)},P.cancelToken&&P.cancelToken.subscribe(ae),P.signal&&(P.signal.aborted?ae():P.signal.addEventListener("abort",ae)));const Ve=IL(P.url);if(Ve&&_s.protocols.indexOf(Ve)===-1){I(new $i("Unsupported protocol "+Ve+":",$i.ERR_BAD_REQUEST,a));return}Xe.send(O||null)})},kL=(a,f)=>{const{length:T}=a=a?a.filter(Boolean):[];if(f||T){let I=new AbortController,P;const O=function(ne){if(!P){P=!0,H();const ae=ne instanceof Error?ne:this.reason;I.abort(ae instanceof $i?ae:new hh(ae instanceof Error?ae.message:ae))}};let N=f&&setTimeout(()=>{N=null,O(new $i(`timeout ${f} of ms exceeded`,$i.ETIMEDOUT))},f);const H=()=>{a&&(N&&clearTimeout(N),N=null,a.forEach(ne=>{ne.unsubscribe?ne.unsubscribe(O):ne.removeEventListener("abort",O)}),a=null)};a.forEach(ne=>ne.addEventListener("abort",O));const{signal:n}=I;return n.unsubscribe=()=>wt.asap(H),n}},FL=function*(a,f){let T=a.byteLength;if(T<f){yield a;return}let I=0,P;for(;I<T;)P=I+f,yield a.slice(I,P),I=P},BL=async function*(a,f){for await(const T of NL(a))yield*FL(T,f)},NL=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const f=a.getReader();try{for(;;){const{done:T,value:I}=await f.read();if(T)break;yield I}}finally{await f.cancel()}},hw=(a,f,T,I)=>{const P=BL(a,f);let O=0,N,H=n=>{N||(N=!0,I&&I(n))};return new ReadableStream({async pull(n){try{const{done:ne,value:ae}=await P.next();if(ne){H(),n.close();return}let ue=ae.byteLength;if(T){let Me=O+=ue;T(Me)}n.enqueue(new Uint8Array(ae))}catch(ne){throw H(ne),ne}},cancel(n){return H(n),P.return()}},{highWaterMark:2})},c_=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",zE=c_&&typeof ReadableStream=="function",UL=c_&&(typeof TextEncoder=="function"?(a=>f=>a.encode(f))(new TextEncoder):async a=>new Uint8Array(await new Response(a).arrayBuffer())),OE=(a,...f)=>{try{return!!a(...f)}catch{return!1}},VL=zE&&OE(()=>{let a=!1;const f=new Request(_s.origin,{body:new ReadableStream,method:"POST",get duplex(){return a=!0,"half"}}).headers.has("Content-Type");return a&&!f}),dw=64*1024,Gy=zE&&OE(()=>wt.isReadableStream(new Response("").body)),Gm={stream:Gy&&(a=>a.body)};c_&&(a=>{["text","arrayBuffer","blob","formData","stream"].forEach(f=>{!Gm[f]&&(Gm[f]=wt.isFunction(a[f])?T=>T[f]():(T,I)=>{throw new $i(`Response type '${f}' is not supported`,$i.ERR_NOT_SUPPORT,I)})})})(new Response);const jL=async a=>{if(a==null)return 0;if(wt.isBlob(a))return a.size;if(wt.isSpecCompliantForm(a))return(await new Request(_s.origin,{method:"POST",body:a}).arrayBuffer()).byteLength;if(wt.isArrayBufferView(a)||wt.isArrayBuffer(a))return a.byteLength;if(wt.isURLSearchParams(a)&&(a=a+""),wt.isString(a))return(await UL(a)).byteLength},GL=async(a,f)=>{const T=wt.toFiniteNumber(a.getContentLength());return T??jL(f)},$L=c_&&(async a=>{let{url:f,method:T,data:I,signal:P,cancelToken:O,timeout:N,onDownloadProgress:H,onUploadProgress:n,responseType:ne,headers:ae,withCredentials:ue="same-origin",fetchOptions:Me}=DE(a);ne=ne?(ne+"").toLowerCase():"text";let Be=kL([P,O&&O.toAbortSignal()],N),st;const Qe=Be&&Be.unsubscribe&&(()=>{Be.unsubscribe()});let Xe;try{if(n&&VL&&T!=="get"&&T!=="head"&&(Xe=await GL(ae,I))!==0){let ft=new Request(f,{method:"POST",body:I,duplex:"half"}),Bt;if(wt.isFormData(I)&&(Bt=ft.headers.get("content-type"))&&ae.setContentType(Bt),ft.body){const[Et,zt]=lw(Xe,jm(cw(n)));I=hw(ft.body,dw,Et,zt)}}wt.isString(ue)||(ue=ue?"include":"omit");const Ne="credentials"in Request.prototype;st=new Request(f,{...Me,signal:Be,method:T.toUpperCase(),headers:ae.normalize().toJSON(),body:I,duplex:"half",credentials:Ne?ue:void 0});let Ve=await fetch(st);const ht=Gy&&(ne==="stream"||ne==="response");if(Gy&&(H||ht&&Qe)){const ft={};["status","statusText","headers"].forEach(zi=>{ft[zi]=Ve[zi]});const Bt=wt.toFiniteNumber(Ve.headers.get("content-length")),[Et,zt]=H&&lw(Bt,jm(cw(H),!0))||[];Ve=new Response(hw(Ve.body,dw,Et,()=>{zt&&zt(),Qe&&Qe()}),ft)}ne=ne||"text";let nt=await Gm[wt.findKey(Gm,ne)||"text"](Ve,a);return!ht&&Qe&&Qe(),await new Promise((ft,Bt)=>{RE(ft,Bt,{data:nt,headers:gs.from(Ve.headers),status:Ve.status,statusText:Ve.statusText,config:a,request:st})})}catch(Ne){throw Qe&&Qe(),Ne&&Ne.name==="TypeError"&&/fetch/i.test(Ne.message)?Object.assign(new $i("Network Error",$i.ERR_NETWORK,a,st),{cause:Ne.cause||Ne}):$i.from(Ne,Ne&&Ne.code,a,st)}}),$y={http:sL,xhr:OL,fetch:$L};wt.forEach($y,(a,f)=>{if(a){try{Object.defineProperty(a,"name",{value:f})}catch{}Object.defineProperty(a,"adapterName",{value:f})}});const fw=a=>`- ${a}`,qL=a=>wt.isFunction(a)||a===null||a===!1,kE={getAdapter:a=>{a=wt.isArray(a)?a:[a];const{length:f}=a;let T,I;const P={};for(let O=0;O<f;O++){T=a[O];let N;if(I=T,!qL(T)&&(I=$y[(N=String(T)).toLowerCase()],I===void 0))throw new $i(`Unknown adapter '${N}'`);if(I)break;P[N||"#"+O]=I}if(!I){const O=Object.entries(P).map(([H,n])=>`adapter ${H} `+(n===!1?"is not supported by the environment":"is not available in the build"));let N=f?O.length>1?`since :
`+O.map(fw).join(`
`):" "+fw(O[0]):"as no adapter specified";throw new $i("There is no suitable adapter to dispatch the request "+N,"ERR_NOT_SUPPORT")}return I},adapters:$y};function vy(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new hh(null,a)}function pw(a){return vy(a),a.headers=gs.from(a.headers),a.data=xy.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),kE.getAdapter(a.adapter||Lf.adapter)(a).then(function(I){return vy(a),I.data=xy.call(a,a.transformResponse,I),I.headers=gs.from(I.headers),I},function(I){return PE(I)||(vy(a),I&&I.response&&(I.response.data=xy.call(a,a.transformResponse,I.response),I.response.headers=gs.from(I.response.headers))),Promise.reject(I)})}const FE="1.7.7",P0={};["object","boolean","number","function","string","symbol"].forEach((a,f)=>{P0[a]=function(I){return typeof I===a||"a"+(f<1?"n ":" ")+a}});const mw={};P0.transitional=function(f,T,I){function P(O,N){return"[Axios v"+FE+"] Transitional option '"+O+"'"+N+(I?". "+I:"")}return(O,N,H)=>{if(f===!1)throw new $i(P(N," has been removed"+(T?" in "+T:"")),$i.ERR_DEPRECATED);return T&&!mw[N]&&(mw[N]=!0,console.warn(P(N," has been deprecated since v"+T+" and will be removed in the near future"))),f?f(O,N,H):!0}};function HL(a,f,T){if(typeof a!="object")throw new $i("options must be an object",$i.ERR_BAD_OPTION_VALUE);const I=Object.keys(a);let P=I.length;for(;P-- >0;){const O=I[P],N=f[O];if(N){const H=a[O],n=H===void 0||N(H,O,a);if(n!==!0)throw new $i("option "+O+" must be "+n,$i.ERR_BAD_OPTION_VALUE);continue}if(T!==!0)throw new $i("Unknown option "+O,$i.ERR_BAD_OPTION)}}const qy={assertOptions:HL,validators:P0},pl=qy.validators;class Tc{constructor(f){this.defaults=f,this.interceptors={request:new ow,response:new ow}}async request(f,T){try{return await this._request(f,T)}catch(I){if(I instanceof Error){let P;Error.captureStackTrace?Error.captureStackTrace(P={}):P=new Error;const O=P.stack?P.stack.replace(/^.+\n/,""):"";try{I.stack?O&&!String(I.stack).endsWith(O.replace(/^.+\n.+\n/,""))&&(I.stack+=`
`+O):I.stack=O}catch{}}throw I}}_request(f,T){typeof f=="string"?(T=T||{},T.url=f):T=f||{},T=Ic(this.defaults,T);const{transitional:I,paramsSerializer:P,headers:O}=T;I!==void 0&&qy.assertOptions(I,{silentJSONParsing:pl.transitional(pl.boolean),forcedJSONParsing:pl.transitional(pl.boolean),clarifyTimeoutError:pl.transitional(pl.boolean)},!1),P!=null&&(wt.isFunction(P)?T.paramsSerializer={serialize:P}:qy.assertOptions(P,{encode:pl.function,serialize:pl.function},!0)),T.method=(T.method||this.defaults.method||"get").toLowerCase();let N=O&&wt.merge(O.common,O[T.method]);O&&wt.forEach(["delete","get","head","post","put","patch","common"],st=>{delete O[st]}),T.headers=gs.concat(N,O);const H=[];let n=!0;this.interceptors.request.forEach(function(Qe){typeof Qe.runWhen=="function"&&Qe.runWhen(T)===!1||(n=n&&Qe.synchronous,H.unshift(Qe.fulfilled,Qe.rejected))});const ne=[];this.interceptors.response.forEach(function(Qe){ne.push(Qe.fulfilled,Qe.rejected)});let ae,ue=0,Me;if(!n){const st=[pw.bind(this),void 0];for(st.unshift.apply(st,H),st.push.apply(st,ne),Me=st.length,ae=Promise.resolve(T);ue<Me;)ae=ae.then(st[ue++],st[ue++]);return ae}Me=H.length;let Be=T;for(ue=0;ue<Me;){const st=H[ue++],Qe=H[ue++];try{Be=st(Be)}catch(Xe){Qe.call(this,Xe);break}}try{ae=pw.call(this,Be)}catch(st){return Promise.reject(st)}for(ue=0,Me=ne.length;ue<Me;)ae=ae.then(ne[ue++],ne[ue++]);return ae}getUri(f){f=Ic(this.defaults,f);const T=LE(f.baseURL,f.url);return IE(T,f.params,f.paramsSerializer)}}wt.forEach(["delete","get","head","options"],function(f){Tc.prototype[f]=function(T,I){return this.request(Ic(I||{},{method:f,url:T,data:(I||{}).data}))}});wt.forEach(["post","put","patch"],function(f){function T(I){return function(O,N,H){return this.request(Ic(H||{},{method:f,headers:I?{"Content-Type":"multipart/form-data"}:{},url:O,data:N}))}}Tc.prototype[f]=T(),Tc.prototype[f+"Form"]=T(!0)});class R0{constructor(f){if(typeof f!="function")throw new TypeError("executor must be a function.");let T;this.promise=new Promise(function(O){T=O});const I=this;this.promise.then(P=>{if(!I._listeners)return;let O=I._listeners.length;for(;O-- >0;)I._listeners[O](P);I._listeners=null}),this.promise.then=P=>{let O;const N=new Promise(H=>{I.subscribe(H),O=H}).then(P);return N.cancel=function(){I.unsubscribe(O)},N},f(function(O,N,H){I.reason||(I.reason=new hh(O,N,H),T(I.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(f){if(this.reason){f(this.reason);return}this._listeners?this._listeners.push(f):this._listeners=[f]}unsubscribe(f){if(!this._listeners)return;const T=this._listeners.indexOf(f);T!==-1&&this._listeners.splice(T,1)}toAbortSignal(){const f=new AbortController,T=I=>{f.abort(I)};return this.subscribe(T),f.signal.unsubscribe=()=>this.unsubscribe(T),f.signal}static source(){let f;return{token:new R0(function(P){f=P}),cancel:f}}}function WL(a){return function(T){return a.apply(null,T)}}function ZL(a){return wt.isObject(a)&&a.isAxiosError===!0}const Hy={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Hy).forEach(([a,f])=>{Hy[f]=a});function BE(a){const f=new Tc(a),T=mE(Tc.prototype.request,f);return wt.extend(T,Tc.prototype,f,{allOwnKeys:!0}),wt.extend(T,f,null,{allOwnKeys:!0}),T.create=function(P){return BE(Ic(a,P))},T}const cn=BE(Lf);cn.Axios=Tc;cn.CanceledError=hh;cn.CancelToken=R0;cn.isCancel=PE;cn.VERSION=FE;cn.toFormData=l_;cn.AxiosError=$i;cn.Cancel=cn.CanceledError;cn.all=function(f){return Promise.all(f)};cn.spread=WL;cn.isAxiosError=ZL;cn.mergeConfig=Ic;cn.AxiosHeaders=gs;cn.formToJSON=a=>CE(wt.isHTMLForm(a)?new FormData(a):a);cn.getAdapter=kE.getAdapter;cn.HttpStatusCode=Hy;cn.default=cn;const XL="https://reqres.in/api/users",YL=async()=>{try{return(await cn.get(XL)).data.data}catch(a){throw console.error("Error fetching users:",a),a}},KL={data(){return{users:[],loading:!0,error:null}},mounted(){this.loadUsers()},methods:{async loadUsers(){this.loading=!0,this.error=null;try{this.users=await YL()}catch{this.error="Failed to load users."}finally{this.loading=!1}}}},JL=["src"],QL={key:0},eD={key:1};function tD(a,f,T,I,P,O){return Qr(),pn("div",null,[f[0]||(f[0]=sn("h1",null,"User List",-1)),sn("ul",null,[(Qr(!0),pn(Fn,null,b0(P.users,N=>(Qr(),pn("li",{key:N.id},[sn("img",{src:N.avatar,alt:"User Avatar",class:"avatar"},null,8,JL),sn("div",null,[sn("h3",null,Xs(N.first_name)+" "+Xs(N.last_name),1),sn("p",null,"Email: "+Xs(N.email),1)])]))),128))]),P.loading?(Qr(),pn("p",QL,"Loading users...")):zy("",!0),P.error?(Qr(),pn("p",eD,Xs(P.error),1)):zy("",!0)])}const iD=yo(KL,[["render",tD]]),rD={name:"Home",components:{BaseButton:xR,UserList:iD},methods:{handleClick(){alert("Button clicked!")},handleSubmit(){alert("Form submitted!")}}};function nD(a,f,T,I,P,O){const N=Ac("BaseButton"),H=Ac("UserList");return Qr(),pn("div",null,[f[0]||(f[0]=sn("h1",null,"Home Page",-1)),f[1]||(f[1]=sn("h1",null,"Reusable Button Example",-1)),Cr(N,{text:"Click Me",onClick:O.handleClick},null,8,["onClick"]),Cr(N,{text:"Submit",variant:"primary",onClick:O.handleSubmit},null,8,["onClick"]),Cr(N,{text:"Disabled",disabled:!0}),Cr(H)])}const sD=yo(rD,[["render",nD]]);/*!
  * shared v10.0.4
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */const $m=typeof window<"u",El=(a,f=!1)=>f?Symbol.for(a):Symbol(a),oD=(a,f,T)=>aD({l:a,k:f,s:T}),aD=a=>JSON.stringify(a).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\u0027/g,"\\u0027"),vn=a=>typeof a=="number"&&isFinite(a),lD=a=>L0(a)==="[object Date]",oh=a=>L0(a)==="[object RegExp]",u_=a=>er(a)&&Object.keys(a).length===0,bn=Object.assign;let _w;const vc=()=>_w||(_w=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function gw(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}const cD=Object.prototype.hasOwnProperty;function qm(a,f){return cD.call(a,f)}const on=Array.isArray,Hr=a=>typeof a=="function",si=a=>typeof a=="string",fr=a=>typeof a=="boolean",_r=a=>a!==null&&typeof a=="object",uD=a=>_r(a)&&Hr(a.then)&&Hr(a.catch),NE=Object.prototype.toString,L0=a=>NE.call(a),er=a=>L0(a)==="[object Object]",hD=a=>a==null?"":on(a)||er(a)&&a.toString===NE?JSON.stringify(a,null,2):String(a);function D0(a,f=""){return a.reduce((T,I,P)=>P===0?T+I:T+f+I,"")}function dD(a,f){typeof console<"u"&&(console.warn("[intlify] "+a),f&&console.warn(f.stack))}const Am=a=>!_r(a)||on(a);function Om(a,f){if(Am(a)||Am(f))throw new Error("Invalid value");const T=[{src:a,des:f}];for(;T.length;){const{src:I,des:P}=T.pop();Object.keys(I).forEach(O=>{_r(I[O])&&!_r(P[O])&&(P[O]=Array.isArray(I[O])?[]:{}),Am(P[O])||Am(I[O])?P[O]=I[O]:T.push({src:I[O],des:P[O]})})}}/*!
  * message-compiler v10.0.4
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */function fD(a,f,T){return{line:a,column:f,offset:T}}function Wy(a,f,T){return{start:a,end:f}}const Er={EXPECTED_TOKEN:1,INVALID_TOKEN_IN_PLACEHOLDER:2,UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER:3,UNKNOWN_ESCAPE_SEQUENCE:4,INVALID_UNICODE_ESCAPE_SEQUENCE:5,UNBALANCED_CLOSING_BRACE:6,UNTERMINATED_CLOSING_BRACE:7,EMPTY_PLACEHOLDER:8,NOT_ALLOW_NEST_PLACEHOLDER:9,INVALID_LINKED_FORMAT:10,MUST_HAVE_MESSAGES_IN_PLURAL:11,UNEXPECTED_EMPTY_LINKED_MODIFIER:12,UNEXPECTED_EMPTY_LINKED_KEY:13,UNEXPECTED_LEXICAL_ANALYSIS:14,UNHANDLED_CODEGEN_NODE_TYPE:15,UNHANDLED_MINIFIER_NODE_TYPE:16},pD=17;function h_(a,f,T={}){const{domain:I,messages:P,args:O}=T,N=a,H=new SyntaxError(String(N));return H.code=a,f&&(H.location=f),H.domain=I,H}function mD(a){throw a}const ua=" ",_D="\r",as=`
`,gD="\u2028",yD="\u2029";function xD(a){const f=a;let T=0,I=1,P=1,O=0;const N=Et=>f[Et]===_D&&f[Et+1]===as,H=Et=>f[Et]===as,n=Et=>f[Et]===yD,ne=Et=>f[Et]===gD,ae=Et=>N(Et)||H(Et)||n(Et)||ne(Et),ue=()=>T,Me=()=>I,Be=()=>P,st=()=>O,Qe=Et=>N(Et)||n(Et)||ne(Et)?as:f[Et],Xe=()=>Qe(T),Ne=()=>Qe(T+O);function Ve(){return O=0,ae(T)&&(I++,P=0),N(T)&&T++,T++,P++,f[T]}function ht(){return N(T+O)&&O++,O++,f[T+O]}function nt(){T=0,I=1,P=1,O=0}function ft(Et=0){O=Et}function Bt(){const Et=T+O;for(;Et!==T;)Ve();O=0}return{index:ue,line:Me,column:Be,peekOffset:st,charAt:Qe,currentChar:Xe,currentPeek:Ne,next:Ve,peek:ht,reset:nt,resetPeek:ft,skipToPeek:Bt}}const ml=void 0,vD=".",yw="'",bD="tokenizer";function wD(a,f={}){const T=f.location!==!1,I=xD(a),P=()=>I.index(),O=()=>fD(I.line(),I.column(),I.index()),N=O(),H=P(),n={currentType:13,offset:H,startLoc:N,endLoc:N,lastType:13,lastOffset:H,lastStartLoc:N,lastEndLoc:N,braceNest:0,inLinked:!1,text:""},ne=()=>n,{onError:ae}=f;function ue(ve,_e,Ze,...pt){const It=ne();if(_e.column+=Ze,_e.offset+=Ze,ae){const Ut=T?Wy(It.startLoc,_e):null,Ge=h_(ve,Ut,{domain:bD,args:pt});ae(Ge)}}function Me(ve,_e,Ze){ve.endLoc=O(),ve.currentType=_e;const pt={type:_e};return T&&(pt.loc=Wy(ve.startLoc,ve.endLoc)),Ze!=null&&(pt.value=Ze),pt}const Be=ve=>Me(ve,13);function st(ve,_e){return ve.currentChar()===_e?(ve.next(),_e):(ue(Er.EXPECTED_TOKEN,O(),0,_e),"")}function Qe(ve){let _e="";for(;ve.currentPeek()===ua||ve.currentPeek()===as;)_e+=ve.currentPeek(),ve.peek();return _e}function Xe(ve){const _e=Qe(ve);return ve.skipToPeek(),_e}function Ne(ve){if(ve===ml)return!1;const _e=ve.charCodeAt(0);return _e>=97&&_e<=122||_e>=65&&_e<=90||_e===95}function Ve(ve){if(ve===ml)return!1;const _e=ve.charCodeAt(0);return _e>=48&&_e<=57}function ht(ve,_e){const{currentType:Ze}=_e;if(Ze!==2)return!1;Qe(ve);const pt=Ne(ve.currentPeek());return ve.resetPeek(),pt}function nt(ve,_e){const{currentType:Ze}=_e;if(Ze!==2)return!1;Qe(ve);const pt=ve.currentPeek()==="-"?ve.peek():ve.currentPeek(),It=Ve(pt);return ve.resetPeek(),It}function ft(ve,_e){const{currentType:Ze}=_e;if(Ze!==2)return!1;Qe(ve);const pt=ve.currentPeek()===yw;return ve.resetPeek(),pt}function Bt(ve,_e){const{currentType:Ze}=_e;if(Ze!==7)return!1;Qe(ve);const pt=ve.currentPeek()===".";return ve.resetPeek(),pt}function Et(ve,_e){const{currentType:Ze}=_e;if(Ze!==8)return!1;Qe(ve);const pt=Ne(ve.currentPeek());return ve.resetPeek(),pt}function zt(ve,_e){const{currentType:Ze}=_e;if(!(Ze===7||Ze===11))return!1;Qe(ve);const pt=ve.currentPeek()===":";return ve.resetPeek(),pt}function zi(ve,_e){const{currentType:Ze}=_e;if(Ze!==9)return!1;const pt=()=>{const Ut=ve.currentPeek();return Ut==="{"?Ne(ve.peek()):Ut==="@"||Ut==="|"||Ut===":"||Ut==="."||Ut===ua||!Ut?!1:Ut===as?(ve.peek(),pt()):$t(ve,!1)},It=pt();return ve.resetPeek(),It}function or(ve){Qe(ve);const _e=ve.currentPeek()==="|";return ve.resetPeek(),_e}function $t(ve,_e=!0){const Ze=(It=!1,Ut="")=>{const Ge=ve.currentPeek();return Ge==="{"||Ge==="@"||!Ge?It:Ge==="|"?!(Ut===ua||Ut===as):Ge===ua?(ve.peek(),Ze(!0,ua)):Ge===as?(ve.peek(),Ze(!0,as)):!0},pt=Ze();return _e&&ve.resetPeek(),pt}function jt(ve,_e){const Ze=ve.currentChar();return Ze===ml?ml:_e(Ze)?(ve.next(),Ze):null}function Pr(ve){const _e=ve.charCodeAt(0);return _e>=97&&_e<=122||_e>=65&&_e<=90||_e>=48&&_e<=57||_e===95||_e===36}function un(ve){return jt(ve,Pr)}function Mn(ve){const _e=ve.charCodeAt(0);return _e>=97&&_e<=122||_e>=65&&_e<=90||_e>=48&&_e<=57||_e===95||_e===36||_e===45}function Jt(ve){return jt(ve,Mn)}function Ii(ve){const _e=ve.charCodeAt(0);return _e>=48&&_e<=57}function Oi(ve){return jt(ve,Ii)}function Sr(ve){const _e=ve.charCodeAt(0);return _e>=48&&_e<=57||_e>=65&&_e<=70||_e>=97&&_e<=102}function ei(ve){return jt(ve,Sr)}function Vr(ve){let _e="",Ze="";for(;_e=Oi(ve);)Ze+=_e;return Ze}function Or(ve){let _e="";for(;;){const Ze=ve.currentChar();if(Ze==="{"||Ze==="}"||Ze==="@"||Ze==="|"||!Ze)break;if(Ze===ua||Ze===as)if($t(ve))_e+=Ze,ve.next();else{if(or(ve))break;_e+=Ze,ve.next()}else _e+=Ze,ve.next()}return _e}function _n(ve){Xe(ve);let _e="",Ze="";for(;_e=Jt(ve);)Ze+=_e;return ve.currentChar()===ml&&ue(Er.UNTERMINATED_CLOSING_BRACE,O(),0),Ze}function ti(ve){Xe(ve);let _e="";return ve.currentChar()==="-"?(ve.next(),_e+=`-${Vr(ve)}`):_e+=Vr(ve),ve.currentChar()===ml&&ue(Er.UNTERMINATED_CLOSING_BRACE,O(),0),_e}function Yn(ve){return ve!==yw&&ve!==as}function gr(ve){Xe(ve),st(ve,"'");let _e="",Ze="";for(;_e=jt(ve,Yn);)_e==="\\"?Ze+=Tt(ve):Ze+=_e;const pt=ve.currentChar();return pt===as||pt===ml?(ue(Er.UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER,O(),0),pt===as&&(ve.next(),st(ve,"'")),Ze):(st(ve,"'"),Ze)}function Tt(ve){const _e=ve.currentChar();switch(_e){case"\\":case"'":return ve.next(),`\\${_e}`;case"u":return Kt(ve,_e,4);case"U":return Kt(ve,_e,6);default:return ue(Er.UNKNOWN_ESCAPE_SEQUENCE,O(),0,_e),""}}function Kt(ve,_e,Ze){st(ve,_e);let pt="";for(let It=0;It<Ze;It++){const Ut=ei(ve);if(!Ut){ue(Er.INVALID_UNICODE_ESCAPE_SEQUENCE,O(),0,`\\${_e}${pt}${ve.currentChar()}`);break}pt+=Ut}return`\\${_e}${pt}`}function Zt(ve){return ve!=="{"&&ve!=="}"&&ve!==ua&&ve!==as}function ni(ve){Xe(ve);let _e="",Ze="";for(;_e=jt(ve,Zt);)Ze+=_e;return Ze}function ge(ve){let _e="",Ze="";for(;_e=un(ve);)Ze+=_e;return Ze}function Ki(ve){const _e=Ze=>{const pt=ve.currentChar();return pt==="{"||pt==="@"||pt==="|"||pt==="("||pt===")"||!pt||pt===ua?Ze:(Ze+=pt,ve.next(),_e(Ze))};return _e("")}function Ae(ve){Xe(ve);const _e=st(ve,"|");return Xe(ve),_e}function ke(ve,_e){let Ze=null;switch(ve.currentChar()){case"{":return _e.braceNest>=1&&ue(Er.NOT_ALLOW_NEST_PLACEHOLDER,O(),0),ve.next(),Ze=Me(_e,2,"{"),Xe(ve),_e.braceNest++,Ze;case"}":return _e.braceNest>0&&_e.currentType===2&&ue(Er.EMPTY_PLACEHOLDER,O(),0),ve.next(),Ze=Me(_e,3,"}"),_e.braceNest--,_e.braceNest>0&&Xe(ve),_e.inLinked&&_e.braceNest===0&&(_e.inLinked=!1),Ze;case"@":return _e.braceNest>0&&ue(Er.UNTERMINATED_CLOSING_BRACE,O(),0),Ze=Se(ve,_e)||Be(_e),_e.braceNest=0,Ze;default:{let It=!0,Ut=!0,Ge=!0;if(or(ve))return _e.braceNest>0&&ue(Er.UNTERMINATED_CLOSING_BRACE,O(),0),Ze=Me(_e,1,Ae(ve)),_e.braceNest=0,_e.inLinked=!1,Ze;if(_e.braceNest>0&&(_e.currentType===4||_e.currentType===5||_e.currentType===6))return ue(Er.UNTERMINATED_CLOSING_BRACE,O(),0),_e.braceNest=0,Ct(ve,_e);if(It=ht(ve,_e))return Ze=Me(_e,4,_n(ve)),Xe(ve),Ze;if(Ut=nt(ve,_e))return Ze=Me(_e,5,ti(ve)),Xe(ve),Ze;if(Ge=ft(ve,_e))return Ze=Me(_e,6,gr(ve)),Xe(ve),Ze;if(!It&&!Ut&&!Ge)return Ze=Me(_e,12,ni(ve)),ue(Er.INVALID_TOKEN_IN_PLACEHOLDER,O(),0,Ze.value),Xe(ve),Ze;break}}return Ze}function Se(ve,_e){const{currentType:Ze}=_e;let pt=null;const It=ve.currentChar();switch((Ze===7||Ze===8||Ze===11||Ze===9)&&(It===as||It===ua)&&ue(Er.INVALID_LINKED_FORMAT,O(),0),It){case"@":return ve.next(),pt=Me(_e,7,"@"),_e.inLinked=!0,pt;case".":return Xe(ve),ve.next(),Me(_e,8,".");case":":return Xe(ve),ve.next(),Me(_e,9,":");default:return or(ve)?(pt=Me(_e,1,Ae(ve)),_e.braceNest=0,_e.inLinked=!1,pt):Bt(ve,_e)||zt(ve,_e)?(Xe(ve),Se(ve,_e)):Et(ve,_e)?(Xe(ve),Me(_e,11,ge(ve))):zi(ve,_e)?(Xe(ve),It==="{"?ke(ve,_e)||pt:Me(_e,10,Ki(ve))):(Ze===7&&ue(Er.INVALID_LINKED_FORMAT,O(),0),_e.braceNest=0,_e.inLinked=!1,Ct(ve,_e))}}function Ct(ve,_e){let Ze={type:13};if(_e.braceNest>0)return ke(ve,_e)||Be(_e);if(_e.inLinked)return Se(ve,_e)||Be(_e);switch(ve.currentChar()){case"{":return ke(ve,_e)||Be(_e);case"}":return ue(Er.UNBALANCED_CLOSING_BRACE,O(),0),ve.next(),Me(_e,3,"}");case"@":return Se(ve,_e)||Be(_e);default:{if(or(ve))return Ze=Me(_e,1,Ae(ve)),_e.braceNest=0,_e.inLinked=!1,Ze;if($t(ve))return Me(_e,0,Or(ve));break}}return Ze}function _t(){const{currentType:ve,offset:_e,startLoc:Ze,endLoc:pt}=n;return n.lastType=ve,n.lastOffset=_e,n.lastStartLoc=Ze,n.lastEndLoc=pt,n.offset=P(),n.startLoc=O(),I.currentChar()===ml?Me(n,13):Ct(I,n)}return{nextToken:_t,currentOffset:P,currentPosition:O,context:ne}}const TD="parser",ED=/(?:\\\\|\\'|\\u([0-9a-fA-F]{4})|\\U([0-9a-fA-F]{6}))/g;function SD(a,f,T){switch(a){case"\\\\":return"\\";case"\\'":return"'";default:{const I=parseInt(f||T,16);return I<=55295||I>=57344?String.fromCodePoint(I):""}}}function AD(a={}){const f=a.location!==!1,{onError:T}=a;function I(Ne,Ve,ht,nt,...ft){const Bt=Ne.currentPosition();if(Bt.offset+=nt,Bt.column+=nt,T){const Et=f?Wy(ht,Bt):null,zt=h_(Ve,Et,{domain:TD,args:ft});T(zt)}}function P(Ne,Ve,ht){const nt={type:Ne};return f&&(nt.start=Ve,nt.end=Ve,nt.loc={start:ht,end:ht}),nt}function O(Ne,Ve,ht,nt){f&&(Ne.end=Ve,Ne.loc&&(Ne.loc.end=ht))}function N(Ne,Ve){const ht=Ne.context(),nt=P(3,ht.offset,ht.startLoc);return nt.value=Ve,O(nt,Ne.currentOffset(),Ne.currentPosition()),nt}function H(Ne,Ve){const ht=Ne.context(),{lastOffset:nt,lastStartLoc:ft}=ht,Bt=P(5,nt,ft);return Bt.index=parseInt(Ve,10),Ne.nextToken(),O(Bt,Ne.currentOffset(),Ne.currentPosition()),Bt}function n(Ne,Ve){const ht=Ne.context(),{lastOffset:nt,lastStartLoc:ft}=ht,Bt=P(4,nt,ft);return Bt.key=Ve,Ne.nextToken(),O(Bt,Ne.currentOffset(),Ne.currentPosition()),Bt}function ne(Ne,Ve){const ht=Ne.context(),{lastOffset:nt,lastStartLoc:ft}=ht,Bt=P(9,nt,ft);return Bt.value=Ve.replace(ED,SD),Ne.nextToken(),O(Bt,Ne.currentOffset(),Ne.currentPosition()),Bt}function ae(Ne){const Ve=Ne.nextToken(),ht=Ne.context(),{lastOffset:nt,lastStartLoc:ft}=ht,Bt=P(8,nt,ft);return Ve.type!==11?(I(Ne,Er.UNEXPECTED_EMPTY_LINKED_MODIFIER,ht.lastStartLoc,0),Bt.value="",O(Bt,nt,ft),{nextConsumeToken:Ve,node:Bt}):(Ve.value==null&&I(Ne,Er.UNEXPECTED_LEXICAL_ANALYSIS,ht.lastStartLoc,0,Bo(Ve)),Bt.value=Ve.value||"",O(Bt,Ne.currentOffset(),Ne.currentPosition()),{node:Bt})}function ue(Ne,Ve){const ht=Ne.context(),nt=P(7,ht.offset,ht.startLoc);return nt.value=Ve,O(nt,Ne.currentOffset(),Ne.currentPosition()),nt}function Me(Ne){const Ve=Ne.context(),ht=P(6,Ve.offset,Ve.startLoc);let nt=Ne.nextToken();if(nt.type===8){const ft=ae(Ne);ht.modifier=ft.node,nt=ft.nextConsumeToken||Ne.nextToken()}switch(nt.type!==9&&I(Ne,Er.UNEXPECTED_LEXICAL_ANALYSIS,Ve.lastStartLoc,0,Bo(nt)),nt=Ne.nextToken(),nt.type===2&&(nt=Ne.nextToken()),nt.type){case 10:nt.value==null&&I(Ne,Er.UNEXPECTED_LEXICAL_ANALYSIS,Ve.lastStartLoc,0,Bo(nt)),ht.key=ue(Ne,nt.value||"");break;case 4:nt.value==null&&I(Ne,Er.UNEXPECTED_LEXICAL_ANALYSIS,Ve.lastStartLoc,0,Bo(nt)),ht.key=n(Ne,nt.value||"");break;case 5:nt.value==null&&I(Ne,Er.UNEXPECTED_LEXICAL_ANALYSIS,Ve.lastStartLoc,0,Bo(nt)),ht.key=H(Ne,nt.value||"");break;case 6:nt.value==null&&I(Ne,Er.UNEXPECTED_LEXICAL_ANALYSIS,Ve.lastStartLoc,0,Bo(nt)),ht.key=ne(Ne,nt.value||"");break;default:{I(Ne,Er.UNEXPECTED_EMPTY_LINKED_KEY,Ve.lastStartLoc,0);const ft=Ne.context(),Bt=P(7,ft.offset,ft.startLoc);return Bt.value="",O(Bt,ft.offset,ft.startLoc),ht.key=Bt,O(ht,ft.offset,ft.startLoc),{nextConsumeToken:nt,node:ht}}}return O(ht,Ne.currentOffset(),Ne.currentPosition()),{node:ht}}function Be(Ne){const Ve=Ne.context(),ht=Ve.currentType===1?Ne.currentOffset():Ve.offset,nt=Ve.currentType===1?Ve.endLoc:Ve.startLoc,ft=P(2,ht,nt);ft.items=[];let Bt=null;do{const zi=Bt||Ne.nextToken();switch(Bt=null,zi.type){case 0:zi.value==null&&I(Ne,Er.UNEXPECTED_LEXICAL_ANALYSIS,Ve.lastStartLoc,0,Bo(zi)),ft.items.push(N(Ne,zi.value||""));break;case 5:zi.value==null&&I(Ne,Er.UNEXPECTED_LEXICAL_ANALYSIS,Ve.lastStartLoc,0,Bo(zi)),ft.items.push(H(Ne,zi.value||""));break;case 4:zi.value==null&&I(Ne,Er.UNEXPECTED_LEXICAL_ANALYSIS,Ve.lastStartLoc,0,Bo(zi)),ft.items.push(n(Ne,zi.value||""));break;case 6:zi.value==null&&I(Ne,Er.UNEXPECTED_LEXICAL_ANALYSIS,Ve.lastStartLoc,0,Bo(zi)),ft.items.push(ne(Ne,zi.value||""));break;case 7:{const or=Me(Ne);ft.items.push(or.node),Bt=or.nextConsumeToken||null;break}}}while(Ve.currentType!==13&&Ve.currentType!==1);const Et=Ve.currentType===1?Ve.lastOffset:Ne.currentOffset(),zt=Ve.currentType===1?Ve.lastEndLoc:Ne.currentPosition();return O(ft,Et,zt),ft}function st(Ne,Ve,ht,nt){const ft=Ne.context();let Bt=nt.items.length===0;const Et=P(1,Ve,ht);Et.cases=[],Et.cases.push(nt);do{const zt=Be(Ne);Bt||(Bt=zt.items.length===0),Et.cases.push(zt)}while(ft.currentType!==13);return Bt&&I(Ne,Er.MUST_HAVE_MESSAGES_IN_PLURAL,ht,0),O(Et,Ne.currentOffset(),Ne.currentPosition()),Et}function Qe(Ne){const Ve=Ne.context(),{offset:ht,startLoc:nt}=Ve,ft=Be(Ne);return Ve.currentType===13?ft:st(Ne,ht,nt,ft)}function Xe(Ne){const Ve=wD(Ne,bn({},a)),ht=Ve.context(),nt=P(0,ht.offset,ht.startLoc);return f&&nt.loc&&(nt.loc.source=Ne),nt.body=Qe(Ve),a.onCacheKey&&(nt.cacheKey=a.onCacheKey(Ne)),ht.currentType!==13&&I(Ve,Er.UNEXPECTED_LEXICAL_ANALYSIS,ht.lastStartLoc,0,Ne[ht.offset]||""),O(nt,Ve.currentOffset(),Ve.currentPosition()),nt}return{parse:Xe}}function Bo(a){if(a.type===13)return"EOF";const f=(a.value||"").replace(/\r?\n/gu,"\\n");return f.length>10?f.slice(0,9)+"":f}function ID(a,f={}){const T={ast:a,helpers:new Set};return{context:()=>T,helper:O=>(T.helpers.add(O),O)}}function xw(a,f){for(let T=0;T<a.length;T++)z0(a[T],f)}function z0(a,f){switch(a.type){case 1:xw(a.cases,f),f.helper("plural");break;case 2:xw(a.items,f);break;case 6:{z0(a.key,f),f.helper("linked"),f.helper("type");break}case 5:f.helper("interpolate"),f.helper("list");break;case 4:f.helper("interpolate"),f.helper("named");break}}function MD(a,f={}){const T=ID(a);T.helper("normalize"),a.body&&z0(a.body,T);const I=T.context();a.helpers=Array.from(I.helpers)}function CD(a){const f=a.body;return f.type===2?vw(f):f.cases.forEach(T=>vw(T)),a}function vw(a){if(a.items.length===1){const f=a.items[0];(f.type===3||f.type===9)&&(a.static=f.value,delete f.value)}else{const f=[];for(let T=0;T<a.items.length;T++){const I=a.items[T];if(!(I.type===3||I.type===9)||I.value==null)break;f.push(I.value)}if(f.length===a.items.length){a.static=D0(f);for(let T=0;T<a.items.length;T++){const I=a.items[T];(I.type===3||I.type===9)&&delete I.value}}}}function Wu(a){switch(a.t=a.type,a.type){case 0:{const f=a;Wu(f.body),f.b=f.body,delete f.body;break}case 1:{const f=a,T=f.cases;for(let I=0;I<T.length;I++)Wu(T[I]);f.c=T,delete f.cases;break}case 2:{const f=a,T=f.items;for(let I=0;I<T.length;I++)Wu(T[I]);f.i=T,delete f.items,f.static&&(f.s=f.static,delete f.static);break}case 3:case 9:case 8:case 7:{const f=a;f.value&&(f.v=f.value,delete f.value);break}case 6:{const f=a;Wu(f.key),f.k=f.key,delete f.key,f.modifier&&(Wu(f.modifier),f.m=f.modifier,delete f.modifier);break}case 5:{const f=a;f.i=f.index,delete f.index;break}case 4:{const f=a;f.k=f.key,delete f.key;break}}delete a.type}function PD(a,f){const{sourceMap:T,filename:I,breakLineCode:P,needIndent:O}=f,N=f.location!==!1,H={filename:I,code:"",column:1,line:1,offset:0,map:void 0,breakLineCode:P,needIndent:O,indentLevel:0};N&&a.loc&&(H.source=a.loc.source);const n=()=>H;function ne(Xe,Ne){H.code+=Xe}function ae(Xe,Ne=!0){const Ve=Ne?P:"";ne(O?Ve+"  ".repeat(Xe):Ve)}function ue(Xe=!0){const Ne=++H.indentLevel;Xe&&ae(Ne)}function Me(Xe=!0){const Ne=--H.indentLevel;Xe&&ae(Ne)}function Be(){ae(H.indentLevel)}return{context:n,push:ne,indent:ue,deindent:Me,newline:Be,helper:Xe=>`_${Xe}`,needIndent:()=>H.needIndent}}function RD(a,f){const{helper:T}=a;a.push(`${T("linked")}(`),ah(a,f.key),f.modifier?(a.push(", "),ah(a,f.modifier),a.push(", _type")):a.push(", undefined, _type"),a.push(")")}function LD(a,f){const{helper:T,needIndent:I}=a;a.push(`${T("normalize")}([`),a.indent(I());const P=f.items.length;for(let O=0;O<P&&(ah(a,f.items[O]),O!==P-1);O++)a.push(", ");a.deindent(I()),a.push("])")}function DD(a,f){const{helper:T,needIndent:I}=a;if(f.cases.length>1){a.push(`${T("plural")}([`),a.indent(I());const P=f.cases.length;for(let O=0;O<P&&(ah(a,f.cases[O]),O!==P-1);O++)a.push(", ");a.deindent(I()),a.push("])")}}function zD(a,f){f.body?ah(a,f.body):a.push("null")}function ah(a,f){const{helper:T}=a;switch(f.type){case 0:zD(a,f);break;case 1:DD(a,f);break;case 2:LD(a,f);break;case 6:RD(a,f);break;case 8:a.push(JSON.stringify(f.value),f);break;case 7:a.push(JSON.stringify(f.value),f);break;case 5:a.push(`${T("interpolate")}(${T("list")}(${f.index}))`,f);break;case 4:a.push(`${T("interpolate")}(${T("named")}(${JSON.stringify(f.key)}))`,f);break;case 9:a.push(JSON.stringify(f.value),f);break;case 3:a.push(JSON.stringify(f.value),f);break}}const OD=(a,f={})=>{const T=si(f.mode)?f.mode:"normal",I=si(f.filename)?f.filename:"message.intl",P=!!f.sourceMap,O=f.breakLineCode!=null?f.breakLineCode:T==="arrow"?";":`
`,N=f.needIndent?f.needIndent:T!=="arrow",H=a.helpers||[],n=PD(a,{mode:T,filename:I,sourceMap:P,breakLineCode:O,needIndent:N});n.push(T==="normal"?"function __msg__ (ctx) {":"(ctx) => {"),n.indent(N),H.length>0&&(n.push(`const { ${D0(H.map(ue=>`${ue}: _${ue}`),", ")} } = ctx`),n.newline()),n.push("return "),ah(n,a),n.deindent(N),n.push("}"),delete a.helpers;const{code:ne,map:ae}=n.context();return{ast:a,code:ne,map:ae?ae.toJSON():void 0}};function kD(a,f={}){const T=bn({},f),I=!!T.jit,P=!!T.minify,O=T.optimize==null?!0:T.optimize,H=AD(T).parse(a);return I?(O&&CD(H),P&&Wu(H),{ast:H,code:""}):(MD(H,T),OD(H,T))}/*!
  * core-base v10.0.4
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */function FD(){typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(vc().__INTLIFY_PROD_DEVTOOLS__=!1),typeof __INTLIFY_DROP_MESSAGE_COMPILER__!="boolean"&&(vc().__INTLIFY_DROP_MESSAGE_COMPILER__=!1)}function by(a){return T=>BD(T,a)}function BD(a,f){const T=f.b||f.body;if((T.t||T.type)===1){const I=T,P=I.c||I.cases;return a.plural(P.reduce((O,N)=>[...O,bw(a,N)],[]))}else return bw(a,T)}function bw(a,f){const T=f.s||f.static;if(T!=null)return a.type==="text"?T:a.normalize([T]);{const I=(f.i||f.items).reduce((P,O)=>[...P,Zy(a,O)],[]);return a.normalize(I)}}function Zy(a,f){const T=f.t||f.type;switch(T){case 3:{const I=f;return I.v||I.value}case 9:{const I=f;return I.v||I.value}case 4:{const I=f;return a.interpolate(a.named(I.k||I.key))}case 5:{const I=f;return a.interpolate(a.list(I.i!=null?I.i:I.index))}case 6:{const I=f,P=I.m||I.modifier;return a.linked(Zy(a,I.k||I.key),P?Zy(a,P):void 0,a.type)}case 7:{const I=f;return I.v||I.value}case 8:{const I=f;return I.v||I.value}default:throw new Error(`unhandled node type on format message part: ${T}`)}}const ND=a=>a;let Im=Object.create(null);const lh=a=>_r(a)&&(a.t===0||a.type===0)&&("b"in a||"body"in a);function UD(a,f={}){let T=!1;const I=f.onError||mD;return f.onError=P=>{T=!0,I(P)},{...kD(a,f),detectError:T}}function VD(a,f){if(!__INTLIFY_DROP_MESSAGE_COMPILER__&&si(a)){fr(f.warnHtmlMessage)&&f.warnHtmlMessage;const I=(f.onCacheKey||ND)(a),P=Im[I];if(P)return P;const{ast:O,detectError:N}=UD(a,{...f,location:!1,jit:!0}),H=by(O);return N?H:Im[I]=H}else{const T=a.cacheKey;if(T){const I=Im[T];return I||(Im[T]=by(a))}else return by(a)}}let Tf=null;function jD(a){Tf=a}function GD(a,f,T){Tf&&Tf.emit("i18n:init",{timestamp:Date.now(),i18n:a,version:f,meta:T})}const $D=qD("function:translate");function qD(a){return f=>Tf&&Tf.emit(a,f)}const ma={INVALID_ARGUMENT:pD,INVALID_DATE_ARGUMENT:18,INVALID_ISO_DATE_ARGUMENT:19,NOT_SUPPORT_NON_STRING_MESSAGE:20,NOT_SUPPORT_LOCALE_PROMISE_VALUE:21,NOT_SUPPORT_LOCALE_ASYNC_FUNCTION:22,NOT_SUPPORT_LOCALE_TYPE:23},HD=24;function _a(a){return h_(a,null,void 0)}function O0(a,f){return f.locale!=null?ww(f.locale):ww(a.locale)}let wy;function ww(a){if(si(a))return a;if(Hr(a)){if(a.resolvedOnce&&wy!=null)return wy;if(a.constructor.name==="Function"){const f=a();if(uD(f))throw _a(ma.NOT_SUPPORT_LOCALE_PROMISE_VALUE);return wy=f}else throw _a(ma.NOT_SUPPORT_LOCALE_ASYNC_FUNCTION)}else throw _a(ma.NOT_SUPPORT_LOCALE_TYPE)}function WD(a,f,T){return[...new Set([T,...on(f)?f:_r(f)?Object.keys(f):si(f)?[f]:[T]])]}function UE(a,f,T){const I=si(T)?T:Ef,P=a;P.__localeChainCache||(P.__localeChainCache=new Map);let O=P.__localeChainCache.get(I);if(!O){O=[];let N=[T];for(;on(N);)N=Tw(O,N,f);const H=on(f)||!er(f)?f:f.default?f.default:null;N=si(H)?[H]:H,on(N)&&Tw(O,N,!1),P.__localeChainCache.set(I,O)}return O}function Tw(a,f,T){let I=!0;for(let P=0;P<f.length&&fr(I);P++){const O=f[P];si(O)&&(I=ZD(a,f[P],T))}return I}function ZD(a,f,T){let I;const P=f.split("-");do{const O=P.join("-");I=XD(a,O,T),P.splice(-1,1)}while(P.length&&I===!0);return I}function XD(a,f,T){let I=!1;if(!a.includes(f)&&(I=!0,f)){I=f[f.length-1]!=="!";const P=f.replace(/!/g,"");a.push(P),(on(T)||er(T))&&T[P]&&(I=T[P])}return I}const Sl=[];Sl[0]={w:[0],i:[3,0],"[":[4],o:[7]};Sl[1]={w:[1],".":[2],"[":[4],o:[7]};Sl[2]={w:[2],i:[3,0],0:[3,0]};Sl[3]={i:[3,0],0:[3,0],w:[1,1],".":[2,1],"[":[4,1],o:[7,1]};Sl[4]={"'":[5,0],'"':[6,0],"[":[4,2],"]":[1,3],o:8,l:[4,0]};Sl[5]={"'":[4,0],o:8,l:[5,0]};Sl[6]={'"':[4,0],o:8,l:[6,0]};const YD=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function KD(a){return YD.test(a)}function JD(a){const f=a.charCodeAt(0),T=a.charCodeAt(a.length-1);return f===T&&(f===34||f===39)?a.slice(1,-1):a}function QD(a){if(a==null)return"o";switch(a.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return a;case 95:case 36:case 45:return"i";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"w"}return"i"}function ez(a){const f=a.trim();return a.charAt(0)==="0"&&isNaN(parseInt(a))?!1:KD(f)?JD(f):"*"+f}function tz(a){const f=[];let T=-1,I=0,P=0,O,N,H,n,ne,ae,ue;const Me=[];Me[0]=()=>{N===void 0?N=H:N+=H},Me[1]=()=>{N!==void 0&&(f.push(N),N=void 0)},Me[2]=()=>{Me[0](),P++},Me[3]=()=>{if(P>0)P--,I=4,Me[0]();else{if(P=0,N===void 0||(N=ez(N),N===!1))return!1;Me[1]()}};function Be(){const st=a[T+1];if(I===5&&st==="'"||I===6&&st==='"')return T++,H="\\"+st,Me[0](),!0}for(;I!==null;)if(T++,O=a[T],!(O==="\\"&&Be())){if(n=QD(O),ue=Sl[I],ne=ue[n]||ue.l||8,ne===8||(I=ne[0],ne[1]!==void 0&&(ae=Me[ne[1]],ae&&(H=O,ae()===!1))))return;if(I===7)return f}}const Ew=new Map;function iz(a,f){return _r(a)?a[f]:null}function rz(a,f){if(!_r(a))return null;let T=Ew.get(f);if(T||(T=tz(f),T&&Ew.set(f,T)),!T)return null;const I=T.length;let P=a,O=0;for(;O<I;){const N=P[T[O]];if(N===void 0||Hr(P))return null;P=N,O++}return P}const nz="10.0.4",d_=-1,Ef="en-US",Sw="",Aw=a=>`${a.charAt(0).toLocaleUpperCase()}${a.substr(1)}`;function sz(){return{upper:(a,f)=>f==="text"&&si(a)?a.toUpperCase():f==="vnode"&&_r(a)&&"__v_isVNode"in a?a.children.toUpperCase():a,lower:(a,f)=>f==="text"&&si(a)?a.toLowerCase():f==="vnode"&&_r(a)&&"__v_isVNode"in a?a.children.toLowerCase():a,capitalize:(a,f)=>f==="text"&&si(a)?Aw(a):f==="vnode"&&_r(a)&&"__v_isVNode"in a?Aw(a.children):a}}let VE;function oz(a){VE=a}let jE;function az(a){jE=a}let GE;function lz(a){GE=a}let $E=null;const cz=a=>{$E=a},uz=()=>$E;let qE=null;const Iw=a=>{qE=a},hz=()=>qE;let Mw=0;function dz(a={}){const f=Hr(a.onWarn)?a.onWarn:dD,T=si(a.version)?a.version:nz,I=si(a.locale)||Hr(a.locale)?a.locale:Ef,P=Hr(I)?Ef:I,O=on(a.fallbackLocale)||er(a.fallbackLocale)||si(a.fallbackLocale)||a.fallbackLocale===!1?a.fallbackLocale:P,N=er(a.messages)?a.messages:{[P]:{}},H=er(a.datetimeFormats)?a.datetimeFormats:{[P]:{}},n=er(a.numberFormats)?a.numberFormats:{[P]:{}},ne=bn({},a.modifiers||{},sz()),ae=a.pluralRules||{},ue=Hr(a.missing)?a.missing:null,Me=fr(a.missingWarn)||oh(a.missingWarn)?a.missingWarn:!0,Be=fr(a.fallbackWarn)||oh(a.fallbackWarn)?a.fallbackWarn:!0,st=!!a.fallbackFormat,Qe=!!a.unresolving,Xe=Hr(a.postTranslation)?a.postTranslation:null,Ne=er(a.processor)?a.processor:null,Ve=fr(a.warnHtmlMessage)?a.warnHtmlMessage:!0,ht=!!a.escapeParameter,nt=Hr(a.messageCompiler)?a.messageCompiler:VE,ft=Hr(a.messageResolver)?a.messageResolver:jE||iz,Bt=Hr(a.localeFallbacker)?a.localeFallbacker:GE||WD,Et=_r(a.fallbackContext)?a.fallbackContext:void 0,zt=a,zi=_r(zt.__datetimeFormatters)?zt.__datetimeFormatters:new Map,or=_r(zt.__numberFormatters)?zt.__numberFormatters:new Map,$t=_r(zt.__meta)?zt.__meta:{};Mw++;const jt={version:T,cid:Mw,locale:I,fallbackLocale:O,messages:N,modifiers:ne,pluralRules:ae,missing:ue,missingWarn:Me,fallbackWarn:Be,fallbackFormat:st,unresolving:Qe,postTranslation:Xe,processor:Ne,warnHtmlMessage:Ve,escapeParameter:ht,messageCompiler:nt,messageResolver:ft,localeFallbacker:Bt,fallbackContext:Et,onWarn:f,__meta:$t};return jt.datetimeFormats=H,jt.numberFormats=n,jt.__datetimeFormatters=zi,jt.__numberFormatters=or,__INTLIFY_PROD_DEVTOOLS__&&GD(jt,T,$t),jt}function k0(a,f,T,I,P){const{missing:O,onWarn:N}=a;if(O!==null){const H=O(a,T,f,P);return si(H)?H:f}else return f}function rf(a,f,T){const I=a;I.__localeChainCache=new Map,a.localeFallbacker(a,T,f)}function fz(a,f){return a===f?!1:a.split("-")[0]===f.split("-")[0]}function pz(a,f){const T=f.indexOf(a);if(T===-1)return!1;for(let I=T+1;I<f.length;I++)if(fz(a,f[I]))return!0;return!1}function Cw(a,...f){const{datetimeFormats:T,unresolving:I,fallbackLocale:P,onWarn:O,localeFallbacker:N}=a,{__datetimeFormatters:H}=a,[n,ne,ae,ue]=Xy(...f),Me=fr(ae.missingWarn)?ae.missingWarn:a.missingWarn;fr(ae.fallbackWarn)?ae.fallbackWarn:a.fallbackWarn;const Be=!!ae.part,st=O0(a,ae),Qe=N(a,P,st);if(!si(n)||n==="")return new Intl.DateTimeFormat(st,ue).format(ne);let Xe={},Ne,Ve=null;const ht="datetime format";for(let Bt=0;Bt<Qe.length&&(Ne=Qe[Bt],Xe=T[Ne]||{},Ve=Xe[n],!er(Ve));Bt++)k0(a,n,Ne,Me,ht);if(!er(Ve)||!si(Ne))return I?d_:n;let nt=`${Ne}__${n}`;u_(ue)||(nt=`${nt}__${JSON.stringify(ue)}`);let ft=H.get(nt);return ft||(ft=new Intl.DateTimeFormat(Ne,bn({},Ve,ue)),H.set(nt,ft)),Be?ft.formatToParts(ne):ft.format(ne)}const HE=["localeMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName","formatMatcher","hour12","timeZone","dateStyle","timeStyle","calendar","dayPeriod","numberingSystem","hourCycle","fractionalSecondDigits"];function Xy(...a){const[f,T,I,P]=a,O={};let N={},H;if(si(f)){const n=f.match(/(\d{4}-\d{2}-\d{2})(T|\s)?(.*)/);if(!n)throw _a(ma.INVALID_ISO_DATE_ARGUMENT);const ne=n[3]?n[3].trim().startsWith("T")?`${n[1].trim()}${n[3].trim()}`:`${n[1].trim()}T${n[3].trim()}`:n[1].trim();H=new Date(ne);try{H.toISOString()}catch{throw _a(ma.INVALID_ISO_DATE_ARGUMENT)}}else if(lD(f)){if(isNaN(f.getTime()))throw _a(ma.INVALID_DATE_ARGUMENT);H=f}else if(vn(f))H=f;else throw _a(ma.INVALID_ARGUMENT);return si(T)?O.key=T:er(T)&&Object.keys(T).forEach(n=>{HE.includes(n)?N[n]=T[n]:O[n]=T[n]}),si(I)?O.locale=I:er(I)&&(N=I),er(P)&&(N=P),[O.key||"",H,O,N]}function Pw(a,f,T){const I=a;for(const P in T){const O=`${f}__${P}`;I.__datetimeFormatters.has(O)&&I.__datetimeFormatters.delete(O)}}function Rw(a,...f){const{numberFormats:T,unresolving:I,fallbackLocale:P,onWarn:O,localeFallbacker:N}=a,{__numberFormatters:H}=a,[n,ne,ae,ue]=Yy(...f),Me=fr(ae.missingWarn)?ae.missingWarn:a.missingWarn;fr(ae.fallbackWarn)?ae.fallbackWarn:a.fallbackWarn;const Be=!!ae.part,st=O0(a,ae),Qe=N(a,P,st);if(!si(n)||n==="")return new Intl.NumberFormat(st,ue).format(ne);let Xe={},Ne,Ve=null;const ht="number format";for(let Bt=0;Bt<Qe.length&&(Ne=Qe[Bt],Xe=T[Ne]||{},Ve=Xe[n],!er(Ve));Bt++)k0(a,n,Ne,Me,ht);if(!er(Ve)||!si(Ne))return I?d_:n;let nt=`${Ne}__${n}`;u_(ue)||(nt=`${nt}__${JSON.stringify(ue)}`);let ft=H.get(nt);return ft||(ft=new Intl.NumberFormat(Ne,bn({},Ve,ue)),H.set(nt,ft)),Be?ft.formatToParts(ne):ft.format(ne)}const WE=["localeMatcher","style","currency","currencyDisplay","currencySign","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits","compactDisplay","notation","signDisplay","unit","unitDisplay","roundingMode","roundingPriority","roundingIncrement","trailingZeroDisplay"];function Yy(...a){const[f,T,I,P]=a,O={};let N={};if(!vn(f))throw _a(ma.INVALID_ARGUMENT);const H=f;return si(T)?O.key=T:er(T)&&Object.keys(T).forEach(n=>{WE.includes(n)?N[n]=T[n]:O[n]=T[n]}),si(I)?O.locale=I:er(I)&&(N=I),er(P)&&(N=P),[O.key||"",H,O,N]}function Lw(a,f,T){const I=a;for(const P in T){const O=`${f}__${P}`;I.__numberFormatters.has(O)&&I.__numberFormatters.delete(O)}}const mz=a=>a,_z=a=>"",gz="text",yz=a=>a.length===0?"":D0(a),xz=hD;function Dw(a,f){return a=Math.abs(a),f===2?a?a>1?1:0:1:a?Math.min(a,2):0}function vz(a){const f=vn(a.pluralIndex)?a.pluralIndex:-1;return a.named&&(vn(a.named.count)||vn(a.named.n))?vn(a.named.count)?a.named.count:vn(a.named.n)?a.named.n:f:f}function bz(a,f){f.count||(f.count=a),f.n||(f.n=a)}function wz(a={}){const f=a.locale,T=vz(a),I=_r(a.pluralRules)&&si(f)&&Hr(a.pluralRules[f])?a.pluralRules[f]:Dw,P=_r(a.pluralRules)&&si(f)&&Hr(a.pluralRules[f])?Dw:void 0,O=Ne=>Ne[I(T,Ne.length,P)],N=a.list||[],H=Ne=>N[Ne],n=a.named||{};vn(a.pluralIndex)&&bz(T,n);const ne=Ne=>n[Ne];function ae(Ne,Ve){const ht=Hr(a.messages)?a.messages(Ne,!!Ve):_r(a.messages)?a.messages[Ne]:!1;return ht||(a.parent?a.parent.message(Ne):_z)}const ue=Ne=>a.modifiers?a.modifiers[Ne]:mz,Me=er(a.processor)&&Hr(a.processor.normalize)?a.processor.normalize:yz,Be=er(a.processor)&&Hr(a.processor.interpolate)?a.processor.interpolate:xz,st=er(a.processor)&&si(a.processor.type)?a.processor.type:gz,Xe={list:H,named:ne,plural:O,linked:(Ne,...Ve)=>{const[ht,nt]=Ve;let ft="text",Bt="";Ve.length===1?_r(ht)?(Bt=ht.modifier||Bt,ft=ht.type||ft):si(ht)&&(Bt=ht||Bt):Ve.length===2&&(si(ht)&&(Bt=ht||Bt),si(nt)&&(ft=nt||ft));const Et=ae(Ne,!0)(Xe),zt=ft==="vnode"&&on(Et)&&Bt?Et[0]:Et;return Bt?ue(Bt)(zt,ft):zt},message:ae,type:st,interpolate:Be,normalize:Me,values:bn({},N,n)};return Xe}const zw=()=>"",Zs=a=>Hr(a);function Ow(a,...f){const{fallbackFormat:T,postTranslation:I,unresolving:P,messageCompiler:O,fallbackLocale:N,messages:H}=a,[n,ne]=Ky(...f),ae=fr(ne.missingWarn)?ne.missingWarn:a.missingWarn,ue=fr(ne.fallbackWarn)?ne.fallbackWarn:a.fallbackWarn,Me=fr(ne.escapeParameter)?ne.escapeParameter:a.escapeParameter,Be=!!ne.resolvedMessage,st=si(ne.default)||fr(ne.default)?fr(ne.default)?O?n:()=>n:ne.default:T?O?n:()=>n:null,Qe=T||st!=null&&(si(st)||Hr(st)),Xe=O0(a,ne);Me&&Tz(ne);let[Ne,Ve,ht]=Be?[n,Xe,H[Xe]||{}]:ZE(a,n,Xe,N,ue,ae),nt=Ne,ft=n;if(!Be&&!(si(nt)||lh(nt)||Zs(nt))&&Qe&&(nt=st,ft=nt),!Be&&(!(si(nt)||lh(nt)||Zs(nt))||!si(Ve)))return P?d_:n;let Bt=!1;const Et=()=>{Bt=!0},zt=Zs(nt)?nt:XE(a,n,Ve,nt,ft,Et);if(Bt)return nt;const zi=Az(a,Ve,ht,ne),or=wz(zi),$t=Ez(a,zt,or),jt=I?I($t,n):$t;if(__INTLIFY_PROD_DEVTOOLS__){const Pr={timestamp:Date.now(),key:si(n)?n:Zs(nt)?nt.key:"",locale:Ve||(Zs(nt)?nt.locale:""),format:si(nt)?nt:Zs(nt)?nt.source:"",message:jt};Pr.meta=bn({},a.__meta,uz()||{}),$D(Pr)}return jt}function Tz(a){on(a.list)?a.list=a.list.map(f=>si(f)?gw(f):f):_r(a.named)&&Object.keys(a.named).forEach(f=>{si(a.named[f])&&(a.named[f]=gw(a.named[f]))})}function ZE(a,f,T,I,P,O){const{messages:N,onWarn:H,messageResolver:n,localeFallbacker:ne}=a,ae=ne(a,I,T);let ue={},Me,Be=null;const st="translate";for(let Qe=0;Qe<ae.length&&(Me=ae[Qe],ue=N[Me]||{},(Be=n(ue,f))===null&&(Be=ue[f]),!(si(Be)||lh(Be)||Zs(Be)));Qe++)if(!pz(Me,ae)){const Xe=k0(a,f,Me,O,st);Xe!==f&&(Be=Xe)}return[Be,Me,ue]}function XE(a,f,T,I,P,O){const{messageCompiler:N,warnHtmlMessage:H}=a;if(Zs(I)){const ne=I;return ne.locale=ne.locale||T,ne.key=ne.key||f,ne}if(N==null){const ne=()=>I;return ne.locale=T,ne.key=f,ne}const n=N(I,Sz(a,T,P,I,H,O));return n.locale=T,n.key=f,n.source=I,n}function Ez(a,f,T){return f(T)}function Ky(...a){const[f,T,I]=a,P={};if(!si(f)&&!vn(f)&&!Zs(f)&&!lh(f))throw _a(ma.INVALID_ARGUMENT);const O=vn(f)?String(f):(Zs(f),f);return vn(T)?P.plural=T:si(T)?P.default=T:er(T)&&!u_(T)?P.named=T:on(T)&&(P.list=T),vn(I)?P.plural=I:si(I)?P.default=I:er(I)&&bn(P,I),[O,P]}function Sz(a,f,T,I,P,O){return{locale:f,key:T,warnHtmlMessage:P,onError:N=>{throw O&&O(N),N},onCacheKey:N=>oD(f,T,N)}}function Az(a,f,T,I){const{modifiers:P,pluralRules:O,messageResolver:N,fallbackLocale:H,fallbackWarn:n,missingWarn:ne,fallbackContext:ae}=a,Me={locale:f,modifiers:P,pluralRules:O,messages:(Be,st)=>{let Qe=N(T,Be);if(Qe==null&&(ae||st)){const[,,Xe]=ZE(ae||a,Be,f,H,n,ne);Qe=N(Xe,Be)}if(si(Qe)||lh(Qe)){let Xe=!1;const Ve=XE(a,Be,f,Qe,Be,()=>{Xe=!0});return Xe?zw:Ve}else return Zs(Qe)?Qe:zw}};return a.processor&&(Me.processor=a.processor),I.list&&(Me.list=I.list),I.named&&(Me.named=I.named),vn(I.plural)&&(Me.pluralIndex=I.plural),Me}FD();/*!
  * vue-i18n v10.0.4
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */const Iz="10.0.4";function Mz(){typeof __VUE_I18N_FULL_INSTALL__!="boolean"&&(vc().__VUE_I18N_FULL_INSTALL__=!0),typeof __VUE_I18N_LEGACY_API__!="boolean"&&(vc().__VUE_I18N_LEGACY_API__=!0),typeof __INTLIFY_DROP_MESSAGE_COMPILER__!="boolean"&&(vc().__INTLIFY_DROP_MESSAGE_COMPILER__=!1),typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(vc().__INTLIFY_PROD_DEVTOOLS__=!1)}const cs={UNEXPECTED_RETURN_TYPE:HD,INVALID_ARGUMENT:25,MUST_BE_CALL_SETUP_TOP:26,NOT_INSTALLED:27,REQUIRED_VALUE:28,INVALID_VALUE:29,CANNOT_SETUP_VUE_DEVTOOLS_PLUGIN:30,NOT_INSTALLED_WITH_PROVIDE:31,UNEXPECTED_ERROR:32,NOT_COMPATIBLE_LEGACY_VUE_I18N:33,NOT_AVAILABLE_COMPOSITION_IN_LEGACY:34};function ys(a,...f){return h_(a,null,void 0)}const Jy=El("__translateVNode"),Qy=El("__datetimeParts"),e0=El("__numberParts"),YE=El("__setPluralRules"),KE=El("__injectWithOption"),t0=El("__dispose");function Sf(a){if(!_r(a))return a;for(const f in a)if(qm(a,f))if(!f.includes("."))_r(a[f])&&Sf(a[f]);else{const T=f.split("."),I=T.length-1;let P=a,O=!1;for(let N=0;N<I;N++){if(T[N]in P||(P[T[N]]={}),!_r(P[T[N]])){O=!0;break}P=P[T[N]]}O||(P[T[I]]=a[f],delete a[f]),_r(P[T[I]])&&Sf(P[T[I]])}return a}function F0(a,f){const{messages:T,__i18n:I,messageResolver:P,flatJson:O}=f,N=er(T)?T:on(I)?{}:{[a]:{}};if(on(I)&&I.forEach(H=>{if("locale"in H&&"resource"in H){const{locale:n,resource:ne}=H;n?(N[n]=N[n]||{},Om(ne,N[n])):Om(ne,N)}else si(H)&&Om(JSON.parse(H),N)}),P==null&&O)for(const H in N)qm(N,H)&&Sf(N[H]);return N}function JE(a){return a.type}function QE(a,f,T){let I=_r(f.messages)?f.messages:{};"__i18nGlobal"in T&&(I=F0(a.locale.value,{messages:I,__i18n:T.__i18nGlobal}));const P=Object.keys(I);P.length&&P.forEach(O=>{a.mergeLocaleMessage(O,I[O])});{if(_r(f.datetimeFormats)){const O=Object.keys(f.datetimeFormats);O.length&&O.forEach(N=>{a.mergeDateTimeFormat(N,f.datetimeFormats[N])})}if(_r(f.numberFormats)){const O=Object.keys(f.numberFormats);O.length&&O.forEach(N=>{a.mergeNumberFormat(N,f.numberFormats[N])})}}}function kw(a){return Cr(Cf,null,a,0)}const Fw="__INTLIFY_META__",Bw=()=>[],Cz=()=>!1;let Nw=0;function Uw(a){return(f,T,I,P)=>a(T,I,yf()||void 0,P)}const Pz=()=>{const a=yf();let f=null;return a&&(f=JE(a)[Fw])?{[Fw]:f}:null};function B0(a={}){const{__root:f,__injectWithOption:T}=a,I=f===void 0,P=a.flatJson,O=$m?_0:yT;let N=fr(a.inheritLocale)?a.inheritLocale:!0;const H=O(f&&N?f.locale.value:si(a.locale)?a.locale:Ef),n=O(f&&N?f.fallbackLocale.value:si(a.fallbackLocale)||on(a.fallbackLocale)||er(a.fallbackLocale)||a.fallbackLocale===!1?a.fallbackLocale:H.value),ne=O(F0(H.value,a)),ae=O(er(a.datetimeFormats)?a.datetimeFormats:{[H.value]:{}}),ue=O(er(a.numberFormats)?a.numberFormats:{[H.value]:{}});let Me=f?f.missingWarn:fr(a.missingWarn)||oh(a.missingWarn)?a.missingWarn:!0,Be=f?f.fallbackWarn:fr(a.fallbackWarn)||oh(a.fallbackWarn)?a.fallbackWarn:!0,st=f?f.fallbackRoot:fr(a.fallbackRoot)?a.fallbackRoot:!0,Qe=!!a.fallbackFormat,Xe=Hr(a.missing)?a.missing:null,Ne=Hr(a.missing)?Uw(a.missing):null,Ve=Hr(a.postTranslation)?a.postTranslation:null,ht=f?f.warnHtmlMessage:fr(a.warnHtmlMessage)?a.warnHtmlMessage:!0,nt=!!a.escapeParameter;const ft=f?f.modifiers:er(a.modifiers)?a.modifiers:{};let Bt=a.pluralRules||f&&f.pluralRules,Et;Et=(()=>{I&&Iw(null);const Ge={version:Iz,locale:H.value,fallbackLocale:n.value,messages:ne.value,modifiers:ft,pluralRules:Bt,missing:Ne===null?void 0:Ne,missingWarn:Me,fallbackWarn:Be,fallbackFormat:Qe,unresolving:!0,postTranslation:Ve===null?void 0:Ve,warnHtmlMessage:ht,escapeParameter:nt,messageResolver:a.messageResolver,messageCompiler:a.messageCompiler,__meta:{framework:"vue"}};Ge.datetimeFormats=ae.value,Ge.numberFormats=ue.value,Ge.__datetimeFormatters=er(Et)?Et.__datetimeFormatters:void 0,Ge.__numberFormatters=er(Et)?Et.__numberFormatters:void 0;const $e=dz(Ge);return I&&Iw($e),$e})(),rf(Et,H.value,n.value);function zi(){return[H.value,n.value,ne.value,ae.value,ue.value]}const or=Xn({get:()=>H.value,set:Ge=>{H.value=Ge,Et.locale=H.value}}),$t=Xn({get:()=>n.value,set:Ge=>{n.value=Ge,Et.fallbackLocale=n.value,rf(Et,H.value,Ge)}}),jt=Xn(()=>ne.value),Pr=Xn(()=>ae.value),un=Xn(()=>ue.value);function Mn(){return Hr(Ve)?Ve:null}function Jt(Ge){Ve=Ge,Et.postTranslation=Ge}function Ii(){return Xe}function Oi(Ge){Ge!==null&&(Ne=Uw(Ge)),Xe=Ge,Et.missing=Ne}const Sr=(Ge,$e,Xt,li,Ui,Si)=>{zi();let sr;try{__INTLIFY_PROD_DEVTOOLS__,I||(Et.fallbackContext=f?hz():void 0),sr=Ge(Et)}finally{__INTLIFY_PROD_DEVTOOLS__,I||(Et.fallbackContext=void 0)}if(Xt!=="translate exists"&&vn(sr)&&sr===d_||Xt==="translate exists"&&!sr){const[kr,hn]=$e();return f&&st?li(f):Ui(kr)}else{if(Si(sr))return sr;throw ys(cs.UNEXPECTED_RETURN_TYPE)}};function ei(...Ge){return Sr($e=>Reflect.apply(Ow,null,[$e,...Ge]),()=>Ky(...Ge),"translate",$e=>Reflect.apply($e.t,$e,[...Ge]),$e=>$e,$e=>si($e))}function Vr(...Ge){const[$e,Xt,li]=Ge;if(li&&!_r(li))throw ys(cs.INVALID_ARGUMENT);return ei($e,Xt,bn({resolvedMessage:!0},li||{}))}function Or(...Ge){return Sr($e=>Reflect.apply(Cw,null,[$e,...Ge]),()=>Xy(...Ge),"datetime format",$e=>Reflect.apply($e.d,$e,[...Ge]),()=>Sw,$e=>si($e))}function _n(...Ge){return Sr($e=>Reflect.apply(Rw,null,[$e,...Ge]),()=>Yy(...Ge),"number format",$e=>Reflect.apply($e.n,$e,[...Ge]),()=>Sw,$e=>si($e))}function ti(Ge){return Ge.map($e=>si($e)||vn($e)||fr($e)?kw(String($e)):$e)}const gr={normalize:ti,interpolate:Ge=>Ge,type:"vnode"};function Tt(...Ge){return Sr($e=>{let Xt;const li=$e;try{li.processor=gr,Xt=Reflect.apply(Ow,null,[li,...Ge])}finally{li.processor=null}return Xt},()=>Ky(...Ge),"translate",$e=>$e[Jy](...Ge),$e=>[kw($e)],$e=>on($e))}function Kt(...Ge){return Sr($e=>Reflect.apply(Rw,null,[$e,...Ge]),()=>Yy(...Ge),"number format",$e=>$e[e0](...Ge),Bw,$e=>si($e)||on($e))}function Zt(...Ge){return Sr($e=>Reflect.apply(Cw,null,[$e,...Ge]),()=>Xy(...Ge),"datetime format",$e=>$e[Qy](...Ge),Bw,$e=>si($e)||on($e))}function ni(Ge){Bt=Ge,Et.pluralRules=Bt}function ge(Ge,$e){return Sr(()=>{if(!Ge)return!1;const Xt=si($e)?$e:H.value,li=ke(Xt),Ui=Et.messageResolver(li,Ge);return lh(Ui)||Zs(Ui)||si(Ui)},()=>[Ge],"translate exists",Xt=>Reflect.apply(Xt.te,Xt,[Ge,$e]),Cz,Xt=>fr(Xt))}function Ki(Ge){let $e=null;const Xt=UE(Et,n.value,H.value);for(let li=0;li<Xt.length;li++){const Ui=ne.value[Xt[li]]||{},Si=Et.messageResolver(Ui,Ge);if(Si!=null){$e=Si;break}}return $e}function Ae(Ge){const $e=Ki(Ge);return $e??(f?f.tm(Ge)||{}:{})}function ke(Ge){return ne.value[Ge]||{}}function Se(Ge,$e){if(P){const Xt={[Ge]:$e};for(const li in Xt)qm(Xt,li)&&Sf(Xt[li]);$e=Xt[Ge]}ne.value[Ge]=$e,Et.messages=ne.value}function Ct(Ge,$e){ne.value[Ge]=ne.value[Ge]||{};const Xt={[Ge]:$e};if(P)for(const li in Xt)qm(Xt,li)&&Sf(Xt[li]);$e=Xt[Ge],Om($e,ne.value[Ge]),Et.messages=ne.value}function _t(Ge){return ae.value[Ge]||{}}function ve(Ge,$e){ae.value[Ge]=$e,Et.datetimeFormats=ae.value,Pw(Et,Ge,$e)}function _e(Ge,$e){ae.value[Ge]=bn(ae.value[Ge]||{},$e),Et.datetimeFormats=ae.value,Pw(Et,Ge,$e)}function Ze(Ge){return ue.value[Ge]||{}}function pt(Ge,$e){ue.value[Ge]=$e,Et.numberFormats=ue.value,Lw(Et,Ge,$e)}function It(Ge,$e){ue.value[Ge]=bn(ue.value[Ge]||{},$e),Et.numberFormats=ue.value,Lw(Et,Ge,$e)}Nw++,f&&$m&&(wc(f.locale,Ge=>{N&&(H.value=Ge,Et.locale=Ge,rf(Et,H.value,n.value))}),wc(f.fallbackLocale,Ge=>{N&&(n.value=Ge,Et.fallbackLocale=Ge,rf(Et,H.value,n.value))}));const Ut={id:Nw,locale:or,fallbackLocale:$t,get inheritLocale(){return N},set inheritLocale(Ge){N=Ge,Ge&&f&&(H.value=f.locale.value,n.value=f.fallbackLocale.value,rf(Et,H.value,n.value))},get availableLocales(){return Object.keys(ne.value).sort()},messages:jt,get modifiers(){return ft},get pluralRules(){return Bt||{}},get isGlobal(){return I},get missingWarn(){return Me},set missingWarn(Ge){Me=Ge,Et.missingWarn=Me},get fallbackWarn(){return Be},set fallbackWarn(Ge){Be=Ge,Et.fallbackWarn=Be},get fallbackRoot(){return st},set fallbackRoot(Ge){st=Ge},get fallbackFormat(){return Qe},set fallbackFormat(Ge){Qe=Ge,Et.fallbackFormat=Qe},get warnHtmlMessage(){return ht},set warnHtmlMessage(Ge){ht=Ge,Et.warnHtmlMessage=Ge},get escapeParameter(){return nt},set escapeParameter(Ge){nt=Ge,Et.escapeParameter=Ge},t:ei,getLocaleMessage:ke,setLocaleMessage:Se,mergeLocaleMessage:Ct,getPostTranslationHandler:Mn,setPostTranslationHandler:Jt,getMissingHandler:Ii,setMissingHandler:Oi,[YE]:ni};return Ut.datetimeFormats=Pr,Ut.numberFormats=un,Ut.rt=Vr,Ut.te=ge,Ut.tm=Ae,Ut.d=Or,Ut.n=_n,Ut.getDateTimeFormat=_t,Ut.setDateTimeFormat=ve,Ut.mergeDateTimeFormat=_e,Ut.getNumberFormat=Ze,Ut.setNumberFormat=pt,Ut.mergeNumberFormat=It,Ut[KE]=T,Ut[Jy]=Tt,Ut[Qy]=Zt,Ut[e0]=Kt,Ut}function Rz(a){const f=si(a.locale)?a.locale:Ef,T=si(a.fallbackLocale)||on(a.fallbackLocale)||er(a.fallbackLocale)||a.fallbackLocale===!1?a.fallbackLocale:f,I=Hr(a.missing)?a.missing:void 0,P=fr(a.silentTranslationWarn)||oh(a.silentTranslationWarn)?!a.silentTranslationWarn:!0,O=fr(a.silentFallbackWarn)||oh(a.silentFallbackWarn)?!a.silentFallbackWarn:!0,N=fr(a.fallbackRoot)?a.fallbackRoot:!0,H=!!a.formatFallbackMessages,n=er(a.modifiers)?a.modifiers:{},ne=a.pluralizationRules,ae=Hr(a.postTranslation)?a.postTranslation:void 0,ue=si(a.warnHtmlInMessage)?a.warnHtmlInMessage!=="off":!0,Me=!!a.escapeParameterHtml,Be=fr(a.sync)?a.sync:!0;let st=a.messages;if(er(a.sharedMessages)){const ft=a.sharedMessages;st=Object.keys(ft).reduce((Et,zt)=>{const zi=Et[zt]||(Et[zt]={});return bn(zi,ft[zt]),Et},st||{})}const{__i18n:Qe,__root:Xe,__injectWithOption:Ne}=a,Ve=a.datetimeFormats,ht=a.numberFormats,nt=a.flatJson;return{locale:f,fallbackLocale:T,messages:st,flatJson:nt,datetimeFormats:Ve,numberFormats:ht,missing:I,missingWarn:P,fallbackWarn:O,fallbackRoot:N,fallbackFormat:H,modifiers:n,pluralRules:ne,postTranslation:ae,warnHtmlMessage:ue,escapeParameter:Me,messageResolver:a.messageResolver,inheritLocale:Be,__i18n:Qe,__root:Xe,__injectWithOption:Ne}}function i0(a={}){const f=B0(Rz(a)),{__extender:T}=a,I={id:f.id,get locale(){return f.locale.value},set locale(P){f.locale.value=P},get fallbackLocale(){return f.fallbackLocale.value},set fallbackLocale(P){f.fallbackLocale.value=P},get messages(){return f.messages.value},get datetimeFormats(){return f.datetimeFormats.value},get numberFormats(){return f.numberFormats.value},get availableLocales(){return f.availableLocales},get missing(){return f.getMissingHandler()},set missing(P){f.setMissingHandler(P)},get silentTranslationWarn(){return fr(f.missingWarn)?!f.missingWarn:f.missingWarn},set silentTranslationWarn(P){f.missingWarn=fr(P)?!P:P},get silentFallbackWarn(){return fr(f.fallbackWarn)?!f.fallbackWarn:f.fallbackWarn},set silentFallbackWarn(P){f.fallbackWarn=fr(P)?!P:P},get modifiers(){return f.modifiers},get formatFallbackMessages(){return f.fallbackFormat},set formatFallbackMessages(P){f.fallbackFormat=P},get postTranslation(){return f.getPostTranslationHandler()},set postTranslation(P){f.setPostTranslationHandler(P)},get sync(){return f.inheritLocale},set sync(P){f.inheritLocale=P},get warnHtmlInMessage(){return f.warnHtmlMessage?"warn":"off"},set warnHtmlInMessage(P){f.warnHtmlMessage=P!=="off"},get escapeParameterHtml(){return f.escapeParameter},set escapeParameterHtml(P){f.escapeParameter=P},get pluralizationRules(){return f.pluralRules||{}},__composer:f,t(...P){return Reflect.apply(f.t,f,[...P])},rt(...P){return Reflect.apply(f.rt,f,[...P])},tc(...P){const[O,N,H]=P,n={plural:1};let ne=null,ae=null;if(!si(O))throw ys(cs.INVALID_ARGUMENT);const ue=O;return si(N)?n.locale=N:vn(N)?n.plural=N:on(N)?ne=N:er(N)&&(ae=N),si(H)?n.locale=H:on(H)?ne=H:er(H)&&(ae=H),Reflect.apply(f.t,f,[ue,ne||ae||{},n])},te(P,O){return f.te(P,O)},tm(P){return f.tm(P)},getLocaleMessage(P){return f.getLocaleMessage(P)},setLocaleMessage(P,O){f.setLocaleMessage(P,O)},mergeLocaleMessage(P,O){f.mergeLocaleMessage(P,O)},d(...P){return Reflect.apply(f.d,f,[...P])},getDateTimeFormat(P){return f.getDateTimeFormat(P)},setDateTimeFormat(P,O){f.setDateTimeFormat(P,O)},mergeDateTimeFormat(P,O){f.mergeDateTimeFormat(P,O)},n(...P){return Reflect.apply(f.n,f,[...P])},getNumberFormat(P){return f.getNumberFormat(P)},setNumberFormat(P,O){f.setNumberFormat(P,O)},mergeNumberFormat(P,O){f.mergeNumberFormat(P,O)}};return I.__extender=T,I}function Lz(a,f,T){return{beforeCreate(){const I=yf();if(!I)throw ys(cs.UNEXPECTED_ERROR);const P=this.$options;if(P.i18n){const O=P.i18n;if(P.__i18n&&(O.__i18n=P.__i18n),O.__root=f,this===this.$root)this.$i18n=Vw(a,O);else{O.__injectWithOption=!0,O.__extender=T.__vueI18nExtend,this.$i18n=i0(O);const N=this.$i18n;N.__extender&&(N.__disposer=N.__extender(this.$i18n))}}else if(P.__i18n)if(this===this.$root)this.$i18n=Vw(a,P);else{this.$i18n=i0({__i18n:P.__i18n,__injectWithOption:!0,__extender:T.__vueI18nExtend,__root:f});const O=this.$i18n;O.__extender&&(O.__disposer=O.__extender(this.$i18n))}else this.$i18n=a;P.__i18nGlobal&&QE(f,P,P),this.$t=(...O)=>this.$i18n.t(...O),this.$rt=(...O)=>this.$i18n.rt(...O),this.$tc=(...O)=>this.$i18n.tc(...O),this.$te=(O,N)=>this.$i18n.te(O,N),this.$d=(...O)=>this.$i18n.d(...O),this.$n=(...O)=>this.$i18n.n(...O),this.$tm=O=>this.$i18n.tm(O),T.__setInstance(I,this.$i18n)},mounted(){},unmounted(){const I=yf();if(!I)throw ys(cs.UNEXPECTED_ERROR);const P=this.$i18n;delete this.$t,delete this.$rt,delete this.$tc,delete this.$te,delete this.$d,delete this.$n,delete this.$tm,P.__disposer&&(P.__disposer(),delete P.__disposer,delete P.__extender),T.__deleteInstance(I),delete this.$i18n}}}function Vw(a,f){a.locale=f.locale||a.locale,a.fallbackLocale=f.fallbackLocale||a.fallbackLocale,a.missing=f.missing||a.missing,a.silentTranslationWarn=f.silentTranslationWarn||a.silentFallbackWarn,a.silentFallbackWarn=f.silentFallbackWarn||a.silentFallbackWarn,a.formatFallbackMessages=f.formatFallbackMessages||a.formatFallbackMessages,a.postTranslation=f.postTranslation||a.postTranslation,a.warnHtmlInMessage=f.warnHtmlInMessage||a.warnHtmlInMessage,a.escapeParameterHtml=f.escapeParameterHtml||a.escapeParameterHtml,a.sync=f.sync||a.sync,a.__composer[YE](f.pluralizationRules||a.pluralizationRules);const T=F0(a.locale,{messages:f.messages,__i18n:f.__i18n});return Object.keys(T).forEach(I=>a.mergeLocaleMessage(I,T[I])),f.datetimeFormats&&Object.keys(f.datetimeFormats).forEach(I=>a.mergeDateTimeFormat(I,f.datetimeFormats[I])),f.numberFormats&&Object.keys(f.numberFormats).forEach(I=>a.mergeNumberFormat(I,f.numberFormats[I])),a}const N0={tag:{type:[String,Object]},locale:{type:String},scope:{type:String,validator:a=>a==="parent"||a==="global",default:"parent"},i18n:{type:Object}};function Dz({slots:a},f){return f.length===1&&f[0]==="default"?(a.default?a.default():[]).reduce((I,P)=>[...I,...P.type===Fn?P.children:[P]],[]):f.reduce((T,I)=>{const P=a[I];return P&&(T[I]=P()),T},{})}function eS(){return Fn}const zz=Mf({name:"i18n-t",props:bn({keypath:{type:String,required:!0},plural:{type:[Number,String],validator:a=>vn(a)||!isNaN(a)}},N0),setup(a,f){const{slots:T,attrs:I}=f,P=a.i18n||f_({useScope:a.scope,__useComponent:!0});return()=>{const O=Object.keys(T).filter(ue=>ue!=="_"),N={};a.locale&&(N.locale=a.locale),a.plural!==void 0&&(N.plural=si(a.plural)?+a.plural:a.plural);const H=Dz(f,O),n=P[Jy](a.keypath,H,N),ne=bn({},I),ae=si(a.tag)||_r(a.tag)?a.tag:eS();return r_(ae,ne,n)}}}),jw=zz;function Oz(a){return on(a)&&!si(a[0])}function tS(a,f,T,I){const{slots:P,attrs:O}=f;return()=>{const N={part:!0};let H={};a.locale&&(N.locale=a.locale),si(a.format)?N.key=a.format:_r(a.format)&&(si(a.format.key)&&(N.key=a.format.key),H=Object.keys(a.format).reduce((Me,Be)=>T.includes(Be)?bn({},Me,{[Be]:a.format[Be]}):Me,{}));const n=I(a.value,N,H);let ne=[N.key];on(n)?ne=n.map((Me,Be)=>{const st=P[Me.type],Qe=st?st({[Me.type]:Me.value,index:Be,parts:n}):[Me.value];return Oz(Qe)&&(Qe[0].key=`${Me.type}-${Be}`),Qe}):si(n)&&(ne=[n]);const ae=bn({},O),ue=si(a.tag)||_r(a.tag)?a.tag:eS();return r_(ue,ae,ne)}}const kz=Mf({name:"i18n-n",props:bn({value:{type:Number,required:!0},format:{type:[String,Object]}},N0),setup(a,f){const T=a.i18n||f_({useScope:a.scope,__useComponent:!0});return tS(a,f,WE,(...I)=>T[e0](...I))}}),Gw=kz,Fz=Mf({name:"i18n-d",props:bn({value:{type:[Number,Date],required:!0},format:{type:[String,Object]}},N0),setup(a,f){const T=a.i18n||f_({useScope:a.scope,__useComponent:!0});return tS(a,f,HE,(...I)=>T[Qy](...I))}}),$w=Fz;function Bz(a,f){const T=a;if(a.mode==="composition")return T.__getInstance(f)||a.global;{const I=T.__getInstance(f);return I!=null?I.__composer:a.global.__composer}}function Nz(a){const f=N=>{const{instance:H,value:n}=N;if(!H||!H.$)throw ys(cs.UNEXPECTED_ERROR);const ne=Bz(a,H.$),ae=qw(n);return[Reflect.apply(ne.t,ne,[...Hw(ae)]),ne]};return{created:(N,H)=>{const[n,ne]=f(H);$m&&a.global===ne&&(N.__i18nWatcher=wc(ne.locale,()=>{H.instance&&H.instance.$forceUpdate()})),N.__composer=ne,N.textContent=n},unmounted:N=>{$m&&N.__i18nWatcher&&(N.__i18nWatcher(),N.__i18nWatcher=void 0,delete N.__i18nWatcher),N.__composer&&(N.__composer=void 0,delete N.__composer)},beforeUpdate:(N,{value:H})=>{if(N.__composer){const n=N.__composer,ne=qw(H);N.textContent=Reflect.apply(n.t,n,[...Hw(ne)])}},getSSRProps:N=>{const[H]=f(N);return{textContent:H}}}}function qw(a){if(si(a))return{path:a};if(er(a)){if(!("path"in a))throw ys(cs.REQUIRED_VALUE,"path");return a}else throw ys(cs.INVALID_VALUE)}function Hw(a){const{path:f,locale:T,args:I,choice:P,plural:O}=a,N={},H=I||{};return si(T)&&(N.locale=T),vn(P)&&(N.plural=P),vn(O)&&(N.plural=O),[f,H,N]}function Uz(a,f,...T){const I=er(T[0])?T[0]:{};(fr(I.globalInstall)?I.globalInstall:!0)&&([jw.name,"I18nT"].forEach(O=>a.component(O,jw)),[Gw.name,"I18nN"].forEach(O=>a.component(O,Gw)),[$w.name,"I18nD"].forEach(O=>a.component(O,$w))),a.directive("t",Nz(f))}const Vz=El("global-vue-i18n");function jz(a={},f){const T=__VUE_I18N_LEGACY_API__&&fr(a.legacy)?a.legacy:__VUE_I18N_LEGACY_API__,I=fr(a.globalInjection)?a.globalInjection:!0,P=new Map,[O,N]=Gz(a,T),H=El("");function n(Me){return P.get(Me)||null}function ne(Me,Be){P.set(Me,Be)}function ae(Me){P.delete(Me)}const ue={get mode(){return __VUE_I18N_LEGACY_API__&&T?"legacy":"composition"},async install(Me,...Be){if(Me.__VUE_I18N_SYMBOL__=H,Me.provide(Me.__VUE_I18N_SYMBOL__,ue),er(Be[0])){const Xe=Be[0];ue.__composerExtend=Xe.__composerExtend,ue.__vueI18nExtend=Xe.__vueI18nExtend}let st=null;!T&&I&&(st=Kz(Me,ue.global)),__VUE_I18N_FULL_INSTALL__&&Uz(Me,ue,...Be),__VUE_I18N_LEGACY_API__&&T&&Me.mixin(Lz(N,N.__composer,ue));const Qe=Me.unmount;Me.unmount=()=>{st&&st(),ue.dispose(),Qe()}},get global(){return N},dispose(){O.stop()},__instances:P,__getInstance:n,__setInstance:ne,__deleteInstance:ae};return ue}function f_(a={}){const f=yf();if(f==null)throw ys(cs.MUST_BE_CALL_SETUP_TOP);if(!f.isCE&&f.appContext.app!=null&&!f.appContext.app.__VUE_I18N_SYMBOL__)throw ys(cs.NOT_INSTALLED);const T=$z(f),I=Hz(T),P=JE(f),O=qz(a,P);if(O==="global")return QE(I,a,P),I;if(O==="parent"){let n=Wz(T,f,a.__useComponent);return n==null&&(n=I),n}const N=T;let H=N.__getInstance(f);if(H==null){const n=bn({},a);"__i18n"in P&&(n.__i18n=P.__i18n),I&&(n.__root=I),H=B0(n),N.__composerExtend&&(H[t0]=N.__composerExtend(H)),Xz(N,f,H),N.__setInstance(f,H)}return H}function Gz(a,f,T){const I=XI(),P=__VUE_I18N_LEGACY_API__&&f?I.run(()=>i0(a)):I.run(()=>B0(a));if(P==null)throw ys(cs.UNEXPECTED_ERROR);return[I,P]}function $z(a){const f=jo(a.isCE?Vz:a.appContext.app.__VUE_I18N_SYMBOL__);if(!f)throw ys(a.isCE?cs.NOT_INSTALLED_WITH_PROVIDE:cs.UNEXPECTED_ERROR);return f}function qz(a,f){return u_(a)?"__i18n"in f?"local":"global":a.useScope?a.useScope:"local"}function Hz(a){return a.mode==="composition"?a.global:a.global.__composer}function Wz(a,f,T=!1){let I=null;const P=f.root;let O=Zz(f,T);for(;O!=null;){const N=a;if(a.mode==="composition")I=N.__getInstance(O);else if(__VUE_I18N_LEGACY_API__){const H=N.__getInstance(O);H!=null&&(I=H.__composer,T&&I&&!I[KE]&&(I=null))}if(I!=null||P===O)break;O=O.parent}return I}function Zz(a,f=!1){return a==null?null:f&&a.vnode.ctx||a.parent}function Xz(a,f,T){PT(()=>{},f),v0(()=>{const I=T;a.__deleteInstance(f);const P=I[t0];P&&(P(),delete I[t0])},f)}const Yz=["locale","fallbackLocale","availableLocales"],Ww=["t","rt","d","n","tm","te"];function Kz(a,f){const T=Object.create(null);return Yz.forEach(P=>{const O=Object.getOwnPropertyDescriptor(f,P);if(!O)throw ys(cs.UNEXPECTED_ERROR);const N=Nn(O.value)?{get(){return O.value.value},set(H){O.value.value=H}}:{get(){return O.get&&O.get()}};Object.defineProperty(T,P,N)}),a.config.globalProperties.$i18n=T,Ww.forEach(P=>{const O=Object.getOwnPropertyDescriptor(f,P);if(!O||!O.value)throw ys(cs.UNEXPECTED_ERROR);Object.defineProperty(a.config.globalProperties,`$${P}`,O)}),()=>{delete a.config.globalProperties.$i18n,Ww.forEach(P=>{delete a.config.globalProperties[`$${P}`]})}}Mz();oz(VD);az(rz);lz(UE);if(__INTLIFY_PROD_DEVTOOLS__){const a=vc();a.__INTLIFY__=!0,jD(a.__INTLIFY_DEVTOOLS_GLOBAL_HOOK__)}const Jz={setup(){const{locale:a}=f_(),f=["en","hi","mr"],T=_0(a.value);return{languages:f,selectedLanguage:T,changeLanguage:()=>{a.value=T.value}}}},Qz=["value"];function eO(a,f,T,I,P,O){return Qr(),pn("div",null,[AT(sn("select",{"onUpdate:modelValue":f[0]||(f[0]=N=>I.selectedLanguage=N),onChange:f[1]||(f[1]=(...N)=>I.changeLanguage&&I.changeLanguage(...N))},[(Qr(!0),pn(Fn,null,b0(I.languages,N=>(Qr(),pn("option",{key:N,value:N},Xs(N),9,Qz))),128))],544),[[eE,I.selectedLanguage]])])}const tO=yo(Jz,[["render",eO]]),iO={data(){return{currentTime:""}},mounted(){this.updateTime(),setInterval(this.updateTime,1e3)},beforeDestroy(){clearInterval(this.interval)},methods:{updateTime(){const a=new Date;this.currentTime=a.toLocaleTimeString()}}};function rO(a,f,T,I,P,O){return Qr(),pn("div",null,[f[0]||(f[0]=sn("h1",null,"Current Time",-1)),sn("p",null,Xs(P.currentTime),1)])}const nO=yo(iO,[["render",rO]]),sO={name:"About",components:{LanguageSelector:tO,CurrentTime:nO}};function oO(a,f,T,I,P,O){const N=Ac("CurrentTime"),H=Ac("LanguageSelector");return Qr(),pn("div",null,[f[0]||(f[0]=sn("h1",null,"About Page",-1)),f[1]||(f[1]=sn("p",null,"This is the About page!",-1)),Cr(N),Cr(H),sn("h1",null,Xs(a.$t("welcome")),1)])}const aO=yo(sO,[["render",oO]]),lO={props:{fields:{type:Array,required:!0},submitText:{type:String,default:"Submit"}},data(){return{formData:{},errors:{}}},methods:{validate(){this.errors={};for(const a of this.fields)a.required&&!this.formData[a.name]&&(this.errors[a.name]=`${a.label} is required.`);return Object.keys(this.errors).length===0},handleSubmit(){this.validate()&&(this.$emit("submit",this.formData),this.formData={})}}},cO=["for"],uO=["onUpdate:modelValue","type","name","required"],hO={key:0,class:"error"},dO={type:"submit"};function fO(a,f,T,I,P,O){return Qr(),pn("form",{onSubmit:f[0]||(f[0]=iP((...N)=>O.handleSubmit&&O.handleSubmit(...N),["prevent"]))},[(Qr(!0),pn(Fn,null,b0(T.fields,(N,H)=>(Qr(),pn("div",{key:H},[sn("label",{for:N.name},Xs(N.label),9,cO),AT(sn("input",{"onUpdate:modelValue":n=>P.formData[N.name]=n,type:N.type,name:N.name,required:N.required},null,8,uO),[[JC,P.formData[N.name]]]),P.errors[N.name]?(Qr(),pn("span",hO,Xs(P.errors[N.name]),1)):zy("",!0)]))),128)),sn("button",dO,Xs(T.submitText),1)],32)}const pO=yo(lO,[["render",fO],["__scopeId","data-v-f6907f24"]]),mO={name:"Contact",components:{ReusableForm:pO},data(){return{users:[],formFields:[{name:"name",label:"Name",type:"text",required:!0},{name:"email",label:"Email",type:"email",required:!0},{name:"number",label:"Number",type:"number",required:!0},{name:"message",label:"Message",type:"textarea",required:!1}]}},mounted(){},methods:{handleFormSubmit(a){console.log("Form submitted:",a)}}};function _O(a,f,T,I,P,O){const N=Ac("ReusableForm");return Qr(),pn("div",null,[f[0]||(f[0]=sn("h1",null,"Reusable Contact Form",-1)),Cr(N,{fields:P.formFields,submitText:"Send",onSubmit:O.handleFormSubmit},null,8,["fields","onSubmit"])])}const gO=yo(mO,[["render",_O]]);var yO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xO(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var iS={exports:{}};(function(a,f){var T={};(function(I,P){a.exports=P()})(yO,function(){var I,P,O;function N(n,ne){if(!I)I=ne;else if(!P)P=ne;else{var ae="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+I+")(sharedChunk); ("+P+")(sharedChunk); self.onerror = null;",ue={};I(ue),O=ne(ue),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(O.workerUrl=window.URL.createObjectURL(new Blob([ae],{type:"text/javascript"})))}}N(["exports"],function(n){function ne(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ae,ue={},Me={};function Be(){if(ae)return Me;ae=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.setMatrixArrayType=function(h){Me.ARRAY_TYPE=e=h},Me.toRadian=function(h){return h*o},Me.equals=function(h,l){return Math.abs(h-l)<=s*Math.max(1,Math.abs(h),Math.abs(l))},Me.RANDOM=Me.ARRAY_TYPE=Me.EPSILON=void 0;var s=1e-6;Me.EPSILON=s;var e=typeof Float32Array<"u"?Float32Array:Array;Me.ARRAY_TYPE=e;var i=Math.random;Me.RANDOM=i;var o=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var h=0,l=arguments.length;l--;)h+=arguments[l]*arguments[l];return Math.sqrt(h)}),Me}var st,Qe={};function Xe(){if(st)return Qe;function s(l){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},s(l)}st=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.create=function(){var l=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},Qe.clone=function(l){var d=new e.ARRAY_TYPE(4);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d},Qe.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l},Qe.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l},Qe.fromValues=function(l,d,g,b){var S=new e.ARRAY_TYPE(4);return S[0]=l,S[1]=d,S[2]=g,S[3]=b,S},Qe.set=function(l,d,g,b,S){return l[0]=d,l[1]=g,l[2]=b,l[3]=S,l},Qe.transpose=function(l,d){if(l===d){var g=d[1];l[1]=d[2],l[2]=g}else l[0]=d[0],l[1]=d[2],l[2]=d[1],l[3]=d[3];return l},Qe.invert=function(l,d){var g=d[0],b=d[1],S=d[2],m=d[3],x=g*m-S*b;return x?(l[0]=m*(x=1/x),l[1]=-b*x,l[2]=-S*x,l[3]=g*x,l):null},Qe.adjoint=function(l,d){var g=d[0];return l[0]=d[3],l[1]=-d[1],l[2]=-d[2],l[3]=g,l},Qe.determinant=function(l){return l[0]*l[3]-l[2]*l[1]},Qe.multiply=o,Qe.rotate=function(l,d,g){var b=d[0],S=d[1],m=d[2],x=d[3],E=Math.sin(g),v=Math.cos(g);return l[0]=b*v+m*E,l[1]=S*v+x*E,l[2]=b*-E+m*v,l[3]=S*-E+x*v,l},Qe.scale=function(l,d,g){var b=d[1],S=d[2],m=d[3],x=g[0],E=g[1];return l[0]=d[0]*x,l[1]=b*x,l[2]=S*E,l[3]=m*E,l},Qe.fromRotation=function(l,d){var g=Math.sin(d),b=Math.cos(d);return l[0]=b,l[1]=g,l[2]=-g,l[3]=b,l},Qe.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=d[1],l},Qe.str=function(l){return"mat2("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")"},Qe.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},Qe.LDU=function(l,d,g,b){return l[2]=b[2]/b[0],g[0]=b[0],g[1]=b[1],g[3]=b[3]-l[2]*g[1],[l,d,g]},Qe.add=function(l,d,g){return l[0]=d[0]+g[0],l[1]=d[1]+g[1],l[2]=d[2]+g[2],l[3]=d[3]+g[3],l},Qe.subtract=h,Qe.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]},Qe.equals=function(l,d){var g=l[0],b=l[1],S=l[2],m=l[3],x=d[0],E=d[1],v=d[2],w=d[3];return Math.abs(g-x)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(x))&&Math.abs(b-E)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(S-v)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(v))&&Math.abs(m-w)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))},Qe.multiplyScalar=function(l,d,g){return l[0]=d[0]*g,l[1]=d[1]*g,l[2]=d[2]*g,l[3]=d[3]*g,l},Qe.multiplyScalarAndAdd=function(l,d,g,b){return l[0]=d[0]+g[0]*b,l[1]=d[1]+g[1]*b,l[2]=d[2]+g[2]*b,l[3]=d[3]+g[3]*b,l},Qe.sub=Qe.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||s(l)!=="object"&&typeof l!="function")return{default:l};var g=i(void 0);if(g&&g.has(l))return g.get(l);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in l)if(m!=="default"&&Object.prototype.hasOwnProperty.call(l,m)){var x=S?Object.getOwnPropertyDescriptor(l,m):null;x&&(x.get||x.set)?Object.defineProperty(b,m,x):b[m]=l[m]}return b.default=l,g&&g.set(l,b),b}(Be());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,g=new WeakMap;return(i=function(b){return b?g:d})(l)}function o(l,d,g){var b=d[0],S=d[1],m=d[2],x=d[3],E=g[0],v=g[1],w=g[2],M=g[3];return l[0]=b*E+m*v,l[1]=S*E+x*v,l[2]=b*w+m*M,l[3]=S*w+x*M,l}function h(l,d,g){return l[0]=d[0]-g[0],l[1]=d[1]-g[1],l[2]=d[2]-g[2],l[3]=d[3]-g[3],l}return Qe.mul=o,Qe.sub=h,Qe}var Ne,Ve={};function ht(){if(Ne)return Ve;function s(l){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},s(l)}Ne=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.create=function(){var l=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[4]=0,l[5]=0),l[0]=1,l[3]=1,l},Ve.clone=function(l){var d=new e.ARRAY_TYPE(6);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[4]=l[4],d[5]=l[5],d},Ve.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l},Ve.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l},Ve.fromValues=function(l,d,g,b,S,m){var x=new e.ARRAY_TYPE(6);return x[0]=l,x[1]=d,x[2]=g,x[3]=b,x[4]=S,x[5]=m,x},Ve.set=function(l,d,g,b,S,m,x){return l[0]=d,l[1]=g,l[2]=b,l[3]=S,l[4]=m,l[5]=x,l},Ve.invert=function(l,d){var g=d[0],b=d[1],S=d[2],m=d[3],x=d[4],E=d[5],v=g*m-b*S;return v?(l[0]=m*(v=1/v),l[1]=-b*v,l[2]=-S*v,l[3]=g*v,l[4]=(S*E-m*x)*v,l[5]=(b*x-g*E)*v,l):null},Ve.determinant=function(l){return l[0]*l[3]-l[1]*l[2]},Ve.multiply=o,Ve.rotate=function(l,d,g){var b=d[0],S=d[1],m=d[2],x=d[3],E=d[4],v=d[5],w=Math.sin(g),M=Math.cos(g);return l[0]=b*M+m*w,l[1]=S*M+x*w,l[2]=b*-w+m*M,l[3]=S*-w+x*M,l[4]=E,l[5]=v,l},Ve.scale=function(l,d,g){var b=d[1],S=d[2],m=d[3],x=d[4],E=d[5],v=g[0],w=g[1];return l[0]=d[0]*v,l[1]=b*v,l[2]=S*w,l[3]=m*w,l[4]=x,l[5]=E,l},Ve.translate=function(l,d,g){var b=d[0],S=d[1],m=d[2],x=d[3],E=d[4],v=d[5],w=g[0],M=g[1];return l[0]=b,l[1]=S,l[2]=m,l[3]=x,l[4]=b*w+m*M+E,l[5]=S*w+x*M+v,l},Ve.fromRotation=function(l,d){var g=Math.sin(d),b=Math.cos(d);return l[0]=b,l[1]=g,l[2]=-g,l[3]=b,l[4]=0,l[5]=0,l},Ve.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=d[1],l[4]=0,l[5]=0,l},Ve.fromTranslation=function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=d[0],l[5]=d[1],l},Ve.str=function(l){return"mat2d("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+")"},Ve.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],1)},Ve.add=function(l,d,g){return l[0]=d[0]+g[0],l[1]=d[1]+g[1],l[2]=d[2]+g[2],l[3]=d[3]+g[3],l[4]=d[4]+g[4],l[5]=d[5]+g[5],l},Ve.subtract=h,Ve.multiplyScalar=function(l,d,g){return l[0]=d[0]*g,l[1]=d[1]*g,l[2]=d[2]*g,l[3]=d[3]*g,l[4]=d[4]*g,l[5]=d[5]*g,l},Ve.multiplyScalarAndAdd=function(l,d,g,b){return l[0]=d[0]+g[0]*b,l[1]=d[1]+g[1]*b,l[2]=d[2]+g[2]*b,l[3]=d[3]+g[3]*b,l[4]=d[4]+g[4]*b,l[5]=d[5]+g[5]*b,l},Ve.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]&&l[4]===d[4]&&l[5]===d[5]},Ve.equals=function(l,d){var g=l[0],b=l[1],S=l[2],m=l[3],x=l[4],E=l[5],v=d[0],w=d[1],M=d[2],R=d[3],z=d[4],U=d[5];return Math.abs(g-v)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(v))&&Math.abs(b-w)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(w))&&Math.abs(S-M)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(M))&&Math.abs(m-R)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(x-z)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(z))&&Math.abs(E-U)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(U))},Ve.sub=Ve.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||s(l)!=="object"&&typeof l!="function")return{default:l};var g=i(void 0);if(g&&g.has(l))return g.get(l);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in l)if(m!=="default"&&Object.prototype.hasOwnProperty.call(l,m)){var x=S?Object.getOwnPropertyDescriptor(l,m):null;x&&(x.get||x.set)?Object.defineProperty(b,m,x):b[m]=l[m]}return b.default=l,g&&g.set(l,b),b}(Be());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,g=new WeakMap;return(i=function(b){return b?g:d})(l)}function o(l,d,g){var b=d[0],S=d[1],m=d[2],x=d[3],E=d[4],v=d[5],w=g[0],M=g[1],R=g[2],z=g[3],U=g[4],j=g[5];return l[0]=b*w+m*M,l[1]=S*w+x*M,l[2]=b*R+m*z,l[3]=S*R+x*z,l[4]=b*U+m*j+E,l[5]=S*U+x*j+v,l}function h(l,d,g){return l[0]=d[0]-g[0],l[1]=d[1]-g[1],l[2]=d[2]-g[2],l[3]=d[3]-g[3],l[4]=d[4]-g[4],l[5]=d[5]-g[5],l}return Ve.mul=o,Ve.sub=h,Ve}var nt,ft={};function Bt(){if(nt)return ft;function s(l){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},s(l)}nt=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.create=function(){var l=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l},ft.fromMat4=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[4],l[4]=d[5],l[5]=d[6],l[6]=d[8],l[7]=d[9],l[8]=d[10],l},ft.clone=function(l){var d=new e.ARRAY_TYPE(9);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[4]=l[4],d[5]=l[5],d[6]=l[6],d[7]=l[7],d[8]=l[8],d},ft.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l},ft.fromValues=function(l,d,g,b,S,m,x,E,v){var w=new e.ARRAY_TYPE(9);return w[0]=l,w[1]=d,w[2]=g,w[3]=b,w[4]=S,w[5]=m,w[6]=x,w[7]=E,w[8]=v,w},ft.set=function(l,d,g,b,S,m,x,E,v,w){return l[0]=d,l[1]=g,l[2]=b,l[3]=S,l[4]=m,l[5]=x,l[6]=E,l[7]=v,l[8]=w,l},ft.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},ft.transpose=function(l,d){if(l===d){var g=d[1],b=d[2],S=d[5];l[1]=d[3],l[2]=d[6],l[3]=g,l[5]=d[7],l[6]=b,l[7]=S}else l[0]=d[0],l[1]=d[3],l[2]=d[6],l[3]=d[1],l[4]=d[4],l[5]=d[7],l[6]=d[2],l[7]=d[5],l[8]=d[8];return l},ft.invert=function(l,d){var g=d[0],b=d[1],S=d[2],m=d[3],x=d[4],E=d[5],v=d[6],w=d[7],M=d[8],R=M*x-E*w,z=-M*m+E*v,U=w*m-x*v,j=g*R+b*z+S*U;return j?(l[0]=R*(j=1/j),l[1]=(-M*b+S*w)*j,l[2]=(E*b-S*x)*j,l[3]=z*j,l[4]=(M*g-S*v)*j,l[5]=(-E*g+S*m)*j,l[6]=U*j,l[7]=(-w*g+b*v)*j,l[8]=(x*g-b*m)*j,l):null},ft.adjoint=function(l,d){var g=d[0],b=d[1],S=d[2],m=d[3],x=d[4],E=d[5],v=d[6],w=d[7],M=d[8];return l[0]=x*M-E*w,l[1]=S*w-b*M,l[2]=b*E-S*x,l[3]=E*v-m*M,l[4]=g*M-S*v,l[5]=S*m-g*E,l[6]=m*w-x*v,l[7]=b*v-g*w,l[8]=g*x-b*m,l},ft.determinant=function(l){var d=l[3],g=l[4],b=l[5],S=l[6],m=l[7],x=l[8];return l[0]*(x*g-b*m)+l[1]*(-x*d+b*S)+l[2]*(m*d-g*S)},ft.multiply=o,ft.translate=function(l,d,g){var b=d[0],S=d[1],m=d[2],x=d[3],E=d[4],v=d[5],w=d[6],M=d[7],R=d[8],z=g[0],U=g[1];return l[0]=b,l[1]=S,l[2]=m,l[3]=x,l[4]=E,l[5]=v,l[6]=z*b+U*x+w,l[7]=z*S+U*E+M,l[8]=z*m+U*v+R,l},ft.rotate=function(l,d,g){var b=d[0],S=d[1],m=d[2],x=d[3],E=d[4],v=d[5],w=d[6],M=d[7],R=d[8],z=Math.sin(g),U=Math.cos(g);return l[0]=U*b+z*x,l[1]=U*S+z*E,l[2]=U*m+z*v,l[3]=U*x-z*b,l[4]=U*E-z*S,l[5]=U*v-z*m,l[6]=w,l[7]=M,l[8]=R,l},ft.scale=function(l,d,g){var b=g[0],S=g[1];return l[0]=b*d[0],l[1]=b*d[1],l[2]=b*d[2],l[3]=S*d[3],l[4]=S*d[4],l[5]=S*d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l},ft.fromTranslation=function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=d[0],l[7]=d[1],l[8]=1,l},ft.fromRotation=function(l,d){var g=Math.sin(d),b=Math.cos(d);return l[0]=b,l[1]=g,l[2]=0,l[3]=-g,l[4]=b,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},ft.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=0,l[4]=d[1],l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},ft.fromMat2d=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=0,l[3]=d[2],l[4]=d[3],l[5]=0,l[6]=d[4],l[7]=d[5],l[8]=1,l},ft.fromQuat=function(l,d){var g=d[0],b=d[1],S=d[2],m=d[3],x=g+g,E=b+b,v=S+S,w=g*x,M=b*x,R=b*E,z=S*x,U=S*E,j=S*v,k=m*x,G=m*E,$=m*v;return l[0]=1-R-j,l[3]=M-$,l[6]=z+G,l[1]=M+$,l[4]=1-w-j,l[7]=U-k,l[2]=z-G,l[5]=U+k,l[8]=1-w-R,l},ft.normalFromMat4=function(l,d){var g=d[0],b=d[1],S=d[2],m=d[3],x=d[4],E=d[5],v=d[6],w=d[7],M=d[8],R=d[9],z=d[10],U=d[11],j=d[12],k=d[13],G=d[14],$=d[15],K=g*E-b*x,te=g*v-S*x,re=g*w-m*x,Q=b*v-S*E,de=b*w-m*E,oe=S*w-m*v,pe=M*k-R*j,Ee=M*G-z*j,Ce=M*$-U*j,Pe=R*G-z*k,Re=R*$-U*k,je=z*$-U*G,De=K*je-te*Re+re*Pe+Q*Ce-de*Ee+oe*pe;return De?(l[0]=(E*je-v*Re+w*Pe)*(De=1/De),l[1]=(v*Ce-x*je-w*Ee)*De,l[2]=(x*Re-E*Ce+w*pe)*De,l[3]=(S*Re-b*je-m*Pe)*De,l[4]=(g*je-S*Ce+m*Ee)*De,l[5]=(b*Ce-g*Re-m*pe)*De,l[6]=(k*oe-G*de+$*Q)*De,l[7]=(G*re-j*oe-$*te)*De,l[8]=(j*de-k*re+$*K)*De,l):null},ft.projection=function(l,d,g){return l[0]=2/d,l[1]=0,l[2]=0,l[3]=0,l[4]=-2/g,l[5]=0,l[6]=-1,l[7]=1,l[8]=1,l},ft.str=function(l){return"mat3("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+", "+l[6]+", "+l[7]+", "+l[8]+")"},ft.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8])},ft.add=function(l,d,g){return l[0]=d[0]+g[0],l[1]=d[1]+g[1],l[2]=d[2]+g[2],l[3]=d[3]+g[3],l[4]=d[4]+g[4],l[5]=d[5]+g[5],l[6]=d[6]+g[6],l[7]=d[7]+g[7],l[8]=d[8]+g[8],l},ft.subtract=h,ft.multiplyScalar=function(l,d,g){return l[0]=d[0]*g,l[1]=d[1]*g,l[2]=d[2]*g,l[3]=d[3]*g,l[4]=d[4]*g,l[5]=d[5]*g,l[6]=d[6]*g,l[7]=d[7]*g,l[8]=d[8]*g,l},ft.multiplyScalarAndAdd=function(l,d,g,b){return l[0]=d[0]+g[0]*b,l[1]=d[1]+g[1]*b,l[2]=d[2]+g[2]*b,l[3]=d[3]+g[3]*b,l[4]=d[4]+g[4]*b,l[5]=d[5]+g[5]*b,l[6]=d[6]+g[6]*b,l[7]=d[7]+g[7]*b,l[8]=d[8]+g[8]*b,l},ft.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]&&l[4]===d[4]&&l[5]===d[5]&&l[6]===d[6]&&l[7]===d[7]&&l[8]===d[8]},ft.equals=function(l,d){var g=l[0],b=l[1],S=l[2],m=l[3],x=l[4],E=l[5],v=l[6],w=l[7],M=l[8],R=d[0],z=d[1],U=d[2],j=d[3],k=d[4],G=d[5],$=d[6],K=d[7],te=d[8];return Math.abs(g-R)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(b-z)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(z))&&Math.abs(S-U)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(U))&&Math.abs(m-j)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(x-k)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(k))&&Math.abs(E-G)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(G))&&Math.abs(v-$)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs($))&&Math.abs(w-K)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(K))&&Math.abs(M-te)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(te))},ft.sub=ft.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||s(l)!=="object"&&typeof l!="function")return{default:l};var g=i(void 0);if(g&&g.has(l))return g.get(l);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in l)if(m!=="default"&&Object.prototype.hasOwnProperty.call(l,m)){var x=S?Object.getOwnPropertyDescriptor(l,m):null;x&&(x.get||x.set)?Object.defineProperty(b,m,x):b[m]=l[m]}return b.default=l,g&&g.set(l,b),b}(Be());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,g=new WeakMap;return(i=function(b){return b?g:d})(l)}function o(l,d,g){var b=d[0],S=d[1],m=d[2],x=d[3],E=d[4],v=d[5],w=d[6],M=d[7],R=d[8],z=g[0],U=g[1],j=g[2],k=g[3],G=g[4],$=g[5],K=g[6],te=g[7],re=g[8];return l[0]=z*b+U*x+j*w,l[1]=z*S+U*E+j*M,l[2]=z*m+U*v+j*R,l[3]=k*b+G*x+$*w,l[4]=k*S+G*E+$*M,l[5]=k*m+G*v+$*R,l[6]=K*b+te*x+re*w,l[7]=K*S+te*E+re*M,l[8]=K*m+te*v+re*R,l}function h(l,d,g){return l[0]=d[0]-g[0],l[1]=d[1]-g[1],l[2]=d[2]-g[2],l[3]=d[3]-g[3],l[4]=d[4]-g[4],l[5]=d[5]-g[5],l[6]=d[6]-g[6],l[7]=d[7]-g[7],l[8]=d[8]-g[8],l}return ft.mul=o,ft.sub=h,ft}var Et,zt={};function zi(){if(Et)return zt;function s(m){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},s(m)}Et=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.create=function(){var m=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=0,m[12]=0,m[13]=0,m[14]=0),m[0]=1,m[5]=1,m[10]=1,m[15]=1,m},zt.clone=function(m){var x=new e.ARRAY_TYPE(16);return x[0]=m[0],x[1]=m[1],x[2]=m[2],x[3]=m[3],x[4]=m[4],x[5]=m[5],x[6]=m[6],x[7]=m[7],x[8]=m[8],x[9]=m[9],x[10]=m[10],x[11]=m[11],x[12]=m[12],x[13]=m[13],x[14]=m[14],x[15]=m[15],x},zt.copy=function(m,x){return m[0]=x[0],m[1]=x[1],m[2]=x[2],m[3]=x[3],m[4]=x[4],m[5]=x[5],m[6]=x[6],m[7]=x[7],m[8]=x[8],m[9]=x[9],m[10]=x[10],m[11]=x[11],m[12]=x[12],m[13]=x[13],m[14]=x[14],m[15]=x[15],m},zt.fromValues=function(m,x,E,v,w,M,R,z,U,j,k,G,$,K,te,re){var Q=new e.ARRAY_TYPE(16);return Q[0]=m,Q[1]=x,Q[2]=E,Q[3]=v,Q[4]=w,Q[5]=M,Q[6]=R,Q[7]=z,Q[8]=U,Q[9]=j,Q[10]=k,Q[11]=G,Q[12]=$,Q[13]=K,Q[14]=te,Q[15]=re,Q},zt.set=function(m,x,E,v,w,M,R,z,U,j,k,G,$,K,te,re,Q){return m[0]=x,m[1]=E,m[2]=v,m[3]=w,m[4]=M,m[5]=R,m[6]=z,m[7]=U,m[8]=j,m[9]=k,m[10]=G,m[11]=$,m[12]=K,m[13]=te,m[14]=re,m[15]=Q,m},zt.identity=o,zt.transpose=function(m,x){if(m===x){var E=x[1],v=x[2],w=x[3],M=x[6],R=x[7],z=x[11];m[1]=x[4],m[2]=x[8],m[3]=x[12],m[4]=E,m[6]=x[9],m[7]=x[13],m[8]=v,m[9]=M,m[11]=x[14],m[12]=w,m[13]=R,m[14]=z}else m[0]=x[0],m[1]=x[4],m[2]=x[8],m[3]=x[12],m[4]=x[1],m[5]=x[5],m[6]=x[9],m[7]=x[13],m[8]=x[2],m[9]=x[6],m[10]=x[10],m[11]=x[14],m[12]=x[3],m[13]=x[7],m[14]=x[11],m[15]=x[15];return m},zt.invert=function(m,x){var E=x[0],v=x[1],w=x[2],M=x[3],R=x[4],z=x[5],U=x[6],j=x[7],k=x[8],G=x[9],$=x[10],K=x[11],te=x[12],re=x[13],Q=x[14],de=x[15],oe=E*z-v*R,pe=E*U-w*R,Ee=E*j-M*R,Ce=v*U-w*z,Pe=v*j-M*z,Re=w*j-M*U,je=k*re-G*te,De=k*Q-$*te,tt=k*de-K*te,ct=G*Q-$*re,Ye=G*de-K*re,Rt=$*de-K*Q,At=oe*Rt-pe*Ye+Ee*ct+Ce*tt-Pe*De+Re*je;return At?(m[0]=(z*Rt-U*Ye+j*ct)*(At=1/At),m[1]=(w*Ye-v*Rt-M*ct)*At,m[2]=(re*Re-Q*Pe+de*Ce)*At,m[3]=($*Pe-G*Re-K*Ce)*At,m[4]=(U*tt-R*Rt-j*De)*At,m[5]=(E*Rt-w*tt+M*De)*At,m[6]=(Q*Ee-te*Re-de*pe)*At,m[7]=(k*Re-$*Ee+K*pe)*At,m[8]=(R*Ye-z*tt+j*je)*At,m[9]=(v*tt-E*Ye-M*je)*At,m[10]=(te*Pe-re*Ee+de*oe)*At,m[11]=(G*Ee-k*Pe-K*oe)*At,m[12]=(z*De-R*ct-U*je)*At,m[13]=(E*ct-v*De+w*je)*At,m[14]=(re*pe-te*Ce-Q*oe)*At,m[15]=(k*Ce-G*pe+$*oe)*At,m):null},zt.adjoint=function(m,x){var E=x[0],v=x[1],w=x[2],M=x[3],R=x[4],z=x[5],U=x[6],j=x[7],k=x[8],G=x[9],$=x[10],K=x[11],te=x[12],re=x[13],Q=x[14],de=x[15];return m[0]=z*($*de-K*Q)-G*(U*de-j*Q)+re*(U*K-j*$),m[1]=-(v*($*de-K*Q)-G*(w*de-M*Q)+re*(w*K-M*$)),m[2]=v*(U*de-j*Q)-z*(w*de-M*Q)+re*(w*j-M*U),m[3]=-(v*(U*K-j*$)-z*(w*K-M*$)+G*(w*j-M*U)),m[4]=-(R*($*de-K*Q)-k*(U*de-j*Q)+te*(U*K-j*$)),m[5]=E*($*de-K*Q)-k*(w*de-M*Q)+te*(w*K-M*$),m[6]=-(E*(U*de-j*Q)-R*(w*de-M*Q)+te*(w*j-M*U)),m[7]=E*(U*K-j*$)-R*(w*K-M*$)+k*(w*j-M*U),m[8]=R*(G*de-K*re)-k*(z*de-j*re)+te*(z*K-j*G),m[9]=-(E*(G*de-K*re)-k*(v*de-M*re)+te*(v*K-M*G)),m[10]=E*(z*de-j*re)-R*(v*de-M*re)+te*(v*j-M*z),m[11]=-(E*(z*K-j*G)-R*(v*K-M*G)+k*(v*j-M*z)),m[12]=-(R*(G*Q-$*re)-k*(z*Q-U*re)+te*(z*$-U*G)),m[13]=E*(G*Q-$*re)-k*(v*Q-w*re)+te*(v*$-w*G),m[14]=-(E*(z*Q-U*re)-R*(v*Q-w*re)+te*(v*U-w*z)),m[15]=E*(z*$-U*G)-R*(v*$-w*G)+k*(v*U-w*z),m},zt.determinant=function(m){var x=m[0],E=m[1],v=m[2],w=m[3],M=m[4],R=m[5],z=m[6],U=m[7],j=m[8],k=m[9],G=m[10],$=m[11],K=m[12],te=m[13],re=m[14],Q=m[15];return(x*R-E*M)*(G*Q-$*re)-(x*z-v*M)*(k*Q-$*te)+(x*U-w*M)*(k*re-G*te)+(E*z-v*R)*(j*Q-$*K)-(E*U-w*R)*(j*re-G*K)+(v*U-w*z)*(j*te-k*K)},zt.multiply=h,zt.translate=function(m,x,E){var v,w,M,R,z,U,j,k,G,$,K,te,re=E[0],Q=E[1],de=E[2];return x===m?(m[12]=x[0]*re+x[4]*Q+x[8]*de+x[12],m[13]=x[1]*re+x[5]*Q+x[9]*de+x[13],m[14]=x[2]*re+x[6]*Q+x[10]*de+x[14],m[15]=x[3]*re+x[7]*Q+x[11]*de+x[15]):(w=x[1],M=x[2],R=x[3],z=x[4],U=x[5],j=x[6],k=x[7],G=x[8],$=x[9],K=x[10],te=x[11],m[0]=v=x[0],m[1]=w,m[2]=M,m[3]=R,m[4]=z,m[5]=U,m[6]=j,m[7]=k,m[8]=G,m[9]=$,m[10]=K,m[11]=te,m[12]=v*re+z*Q+G*de+x[12],m[13]=w*re+U*Q+$*de+x[13],m[14]=M*re+j*Q+K*de+x[14],m[15]=R*re+k*Q+te*de+x[15]),m},zt.scale=function(m,x,E){var v=E[0],w=E[1],M=E[2];return m[0]=x[0]*v,m[1]=x[1]*v,m[2]=x[2]*v,m[3]=x[3]*v,m[4]=x[4]*w,m[5]=x[5]*w,m[6]=x[6]*w,m[7]=x[7]*w,m[8]=x[8]*M,m[9]=x[9]*M,m[10]=x[10]*M,m[11]=x[11]*M,m[12]=x[12],m[13]=x[13],m[14]=x[14],m[15]=x[15],m},zt.rotate=function(m,x,E,v){var w,M,R,z,U,j,k,G,$,K,te,re,Q,de,oe,pe,Ee,Ce,Pe,Re,je,De,tt,ct,Ye=v[0],Rt=v[1],At=v[2],xt=Math.hypot(Ye,Rt,At);return xt<e.EPSILON?null:(Ye*=xt=1/xt,Rt*=xt,At*=xt,w=Math.sin(E),M=Math.cos(E),U=x[1],j=x[2],k=x[3],$=x[5],K=x[6],te=x[7],Q=x[9],de=x[10],oe=x[11],pe=Ye*Ye*(R=1-M)+M,Pe=Ye*Rt*R-At*w,Re=Rt*Rt*R+M,je=At*Rt*R+Ye*w,De=Ye*At*R+Rt*w,tt=Rt*At*R-Ye*w,ct=At*At*R+M,m[0]=(z=x[0])*pe+(G=x[4])*(Ee=Rt*Ye*R+At*w)+(re=x[8])*(Ce=At*Ye*R-Rt*w),m[1]=U*pe+$*Ee+Q*Ce,m[2]=j*pe+K*Ee+de*Ce,m[3]=k*pe+te*Ee+oe*Ce,m[4]=z*Pe+G*Re+re*je,m[5]=U*Pe+$*Re+Q*je,m[6]=j*Pe+K*Re+de*je,m[7]=k*Pe+te*Re+oe*je,m[8]=z*De+G*tt+re*ct,m[9]=U*De+$*tt+Q*ct,m[10]=j*De+K*tt+de*ct,m[11]=k*De+te*tt+oe*ct,x!==m&&(m[12]=x[12],m[13]=x[13],m[14]=x[14],m[15]=x[15]),m)},zt.rotateX=function(m,x,E){var v=Math.sin(E),w=Math.cos(E),M=x[4],R=x[5],z=x[6],U=x[7],j=x[8],k=x[9],G=x[10],$=x[11];return x!==m&&(m[0]=x[0],m[1]=x[1],m[2]=x[2],m[3]=x[3],m[12]=x[12],m[13]=x[13],m[14]=x[14],m[15]=x[15]),m[4]=M*w+j*v,m[5]=R*w+k*v,m[6]=z*w+G*v,m[7]=U*w+$*v,m[8]=j*w-M*v,m[9]=k*w-R*v,m[10]=G*w-z*v,m[11]=$*w-U*v,m},zt.rotateY=function(m,x,E){var v=Math.sin(E),w=Math.cos(E),M=x[0],R=x[1],z=x[2],U=x[3],j=x[8],k=x[9],G=x[10],$=x[11];return x!==m&&(m[4]=x[4],m[5]=x[5],m[6]=x[6],m[7]=x[7],m[12]=x[12],m[13]=x[13],m[14]=x[14],m[15]=x[15]),m[0]=M*w-j*v,m[1]=R*w-k*v,m[2]=z*w-G*v,m[3]=U*w-$*v,m[8]=M*v+j*w,m[9]=R*v+k*w,m[10]=z*v+G*w,m[11]=U*v+$*w,m},zt.rotateZ=function(m,x,E){var v=Math.sin(E),w=Math.cos(E),M=x[0],R=x[1],z=x[2],U=x[3],j=x[4],k=x[5],G=x[6],$=x[7];return x!==m&&(m[8]=x[8],m[9]=x[9],m[10]=x[10],m[11]=x[11],m[12]=x[12],m[13]=x[13],m[14]=x[14],m[15]=x[15]),m[0]=M*w+j*v,m[1]=R*w+k*v,m[2]=z*w+G*v,m[3]=U*w+$*v,m[4]=j*w-M*v,m[5]=k*w-R*v,m[6]=G*w-z*v,m[7]=$*w-U*v,m},zt.fromTranslation=function(m,x){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=x[0],m[13]=x[1],m[14]=x[2],m[15]=1,m},zt.fromScaling=function(m,x){return m[0]=x[0],m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=x[1],m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=x[2],m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},zt.fromRotation=function(m,x,E){var v,w,M,R=E[0],z=E[1],U=E[2],j=Math.hypot(R,z,U);return j<e.EPSILON?null:(R*=j=1/j,z*=j,U*=j,v=Math.sin(x),w=Math.cos(x),m[0]=R*R*(M=1-w)+w,m[1]=z*R*M+U*v,m[2]=U*R*M-z*v,m[3]=0,m[4]=R*z*M-U*v,m[5]=z*z*M+w,m[6]=U*z*M+R*v,m[7]=0,m[8]=R*U*M+z*v,m[9]=z*U*M-R*v,m[10]=U*U*M+w,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m)},zt.fromXRotation=function(m,x){var E=Math.sin(x),v=Math.cos(x);return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=v,m[6]=E,m[7]=0,m[8]=0,m[9]=-E,m[10]=v,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},zt.fromYRotation=function(m,x){var E=Math.sin(x),v=Math.cos(x);return m[0]=v,m[1]=0,m[2]=-E,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=E,m[9]=0,m[10]=v,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},zt.fromZRotation=function(m,x){var E=Math.sin(x),v=Math.cos(x);return m[0]=v,m[1]=E,m[2]=0,m[3]=0,m[4]=-E,m[5]=v,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},zt.fromRotationTranslation=l,zt.fromQuat2=function(m,x){var E=new e.ARRAY_TYPE(3),v=-x[0],w=-x[1],M=-x[2],R=x[3],z=x[4],U=x[5],j=x[6],k=x[7],G=v*v+w*w+M*M+R*R;return G>0?(E[0]=2*(z*R+k*v+U*M-j*w)/G,E[1]=2*(U*R+k*w+j*v-z*M)/G,E[2]=2*(j*R+k*M+z*w-U*v)/G):(E[0]=2*(z*R+k*v+U*M-j*w),E[1]=2*(U*R+k*w+j*v-z*M),E[2]=2*(j*R+k*M+z*w-U*v)),l(m,x,E),m},zt.getTranslation=function(m,x){return m[0]=x[12],m[1]=x[13],m[2]=x[14],m},zt.getScaling=d,zt.getRotation=function(m,x){var E=new e.ARRAY_TYPE(3);d(E,x);var v=1/E[0],w=1/E[1],M=1/E[2],R=x[0]*v,z=x[1]*w,U=x[2]*M,j=x[4]*v,k=x[5]*w,G=x[6]*M,$=x[8]*v,K=x[9]*w,te=x[10]*M,re=R+k+te,Q=0;return re>0?(Q=2*Math.sqrt(re+1),m[3]=.25*Q,m[0]=(G-K)/Q,m[1]=($-U)/Q,m[2]=(z-j)/Q):R>k&&R>te?(Q=2*Math.sqrt(1+R-k-te),m[3]=(G-K)/Q,m[0]=.25*Q,m[1]=(z+j)/Q,m[2]=($+U)/Q):k>te?(Q=2*Math.sqrt(1+k-R-te),m[3]=($-U)/Q,m[0]=(z+j)/Q,m[1]=.25*Q,m[2]=(G+K)/Q):(Q=2*Math.sqrt(1+te-R-k),m[3]=(z-j)/Q,m[0]=($+U)/Q,m[1]=(G+K)/Q,m[2]=.25*Q),m},zt.fromRotationTranslationScale=function(m,x,E,v){var w=x[0],M=x[1],R=x[2],z=x[3],U=w+w,j=M+M,k=R+R,G=w*U,$=w*j,K=w*k,te=M*j,re=M*k,Q=R*k,de=z*U,oe=z*j,pe=z*k,Ee=v[0],Ce=v[1],Pe=v[2];return m[0]=(1-(te+Q))*Ee,m[1]=($+pe)*Ee,m[2]=(K-oe)*Ee,m[3]=0,m[4]=($-pe)*Ce,m[5]=(1-(G+Q))*Ce,m[6]=(re+de)*Ce,m[7]=0,m[8]=(K+oe)*Pe,m[9]=(re-de)*Pe,m[10]=(1-(G+te))*Pe,m[11]=0,m[12]=E[0],m[13]=E[1],m[14]=E[2],m[15]=1,m},zt.fromRotationTranslationScaleOrigin=function(m,x,E,v,w){var M=x[0],R=x[1],z=x[2],U=x[3],j=M+M,k=R+R,G=z+z,$=M*j,K=M*k,te=M*G,re=R*k,Q=R*G,de=z*G,oe=U*j,pe=U*k,Ee=U*G,Ce=v[0],Pe=v[1],Re=v[2],je=w[0],De=w[1],tt=w[2],ct=(1-(re+de))*Ce,Ye=(K+Ee)*Ce,Rt=(te-pe)*Ce,At=(K-Ee)*Pe,xt=(1-($+de))*Pe,dt=(Q+oe)*Pe,Wt=(te+pe)*Re,Pt=(Q-oe)*Re,kt=(1-($+re))*Re;return m[0]=ct,m[1]=Ye,m[2]=Rt,m[3]=0,m[4]=At,m[5]=xt,m[6]=dt,m[7]=0,m[8]=Wt,m[9]=Pt,m[10]=kt,m[11]=0,m[12]=E[0]+je-(ct*je+At*De+Wt*tt),m[13]=E[1]+De-(Ye*je+xt*De+Pt*tt),m[14]=E[2]+tt-(Rt*je+dt*De+kt*tt),m[15]=1,m},zt.fromQuat=function(m,x){var E=x[0],v=x[1],w=x[2],M=x[3],R=E+E,z=v+v,U=w+w,j=E*R,k=v*R,G=v*z,$=w*R,K=w*z,te=w*U,re=M*R,Q=M*z,de=M*U;return m[0]=1-G-te,m[1]=k+de,m[2]=$-Q,m[3]=0,m[4]=k-de,m[5]=1-j-te,m[6]=K+re,m[7]=0,m[8]=$+Q,m[9]=K-re,m[10]=1-j-G,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},zt.frustum=function(m,x,E,v,w,M,R){var z=1/(E-x),U=1/(w-v),j=1/(M-R);return m[0]=2*M*z,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=2*M*U,m[6]=0,m[7]=0,m[8]=(E+x)*z,m[9]=(w+v)*U,m[10]=(R+M)*j,m[11]=-1,m[12]=0,m[13]=0,m[14]=R*M*2*j,m[15]=0,m},zt.perspectiveNO=g,zt.perspectiveZO=function(m,x,E,v,w){var M,R=1/Math.tan(x/2);return m[0]=R/E,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=R,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=-1,m[12]=0,m[13]=0,m[15]=0,w!=null&&w!==1/0?(m[10]=w*(M=1/(v-w)),m[14]=w*v*M):(m[10]=-1,m[14]=-v),m},zt.perspectiveFromFieldOfView=function(m,x,E,v){var w=Math.tan(x.upDegrees*Math.PI/180),M=Math.tan(x.downDegrees*Math.PI/180),R=Math.tan(x.leftDegrees*Math.PI/180),z=Math.tan(x.rightDegrees*Math.PI/180),U=2/(R+z),j=2/(w+M);return m[0]=U,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=j,m[6]=0,m[7]=0,m[8]=-(R-z)*U*.5,m[9]=(w-M)*j*.5,m[10]=v/(E-v),m[11]=-1,m[12]=0,m[13]=0,m[14]=v*E/(E-v),m[15]=0,m},zt.orthoNO=b,zt.orthoZO=function(m,x,E,v,w,M,R){var z=1/(x-E),U=1/(v-w),j=1/(M-R);return m[0]=-2*z,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=-2*U,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=j,m[11]=0,m[12]=(x+E)*z,m[13]=(w+v)*U,m[14]=M*j,m[15]=1,m},zt.lookAt=function(m,x,E,v){var w,M,R,z,U,j,k,G,$,K,te=x[0],re=x[1],Q=x[2],de=v[0],oe=v[1],pe=v[2],Ee=E[0],Ce=E[1],Pe=E[2];return Math.abs(te-Ee)<e.EPSILON&&Math.abs(re-Ce)<e.EPSILON&&Math.abs(Q-Pe)<e.EPSILON?o(m):(k=te-Ee,G=re-Ce,$=Q-Pe,w=oe*($*=K=1/Math.hypot(k,G,$))-pe*(G*=K),M=pe*(k*=K)-de*$,R=de*G-oe*k,(K=Math.hypot(w,M,R))?(w*=K=1/K,M*=K,R*=K):(w=0,M=0,R=0),z=G*R-$*M,U=$*w-k*R,j=k*M-G*w,(K=Math.hypot(z,U,j))?(z*=K=1/K,U*=K,j*=K):(z=0,U=0,j=0),m[0]=w,m[1]=z,m[2]=k,m[3]=0,m[4]=M,m[5]=U,m[6]=G,m[7]=0,m[8]=R,m[9]=j,m[10]=$,m[11]=0,m[12]=-(w*te+M*re+R*Q),m[13]=-(z*te+U*re+j*Q),m[14]=-(k*te+G*re+$*Q),m[15]=1,m)},zt.targetTo=function(m,x,E,v){var w=x[0],M=x[1],R=x[2],z=v[0],U=v[1],j=v[2],k=w-E[0],G=M-E[1],$=R-E[2],K=k*k+G*G+$*$;K>0&&(k*=K=1/Math.sqrt(K),G*=K,$*=K);var te=U*$-j*G,re=j*k-z*$,Q=z*G-U*k;return(K=te*te+re*re+Q*Q)>0&&(te*=K=1/Math.sqrt(K),re*=K,Q*=K),m[0]=te,m[1]=re,m[2]=Q,m[3]=0,m[4]=G*Q-$*re,m[5]=$*te-k*Q,m[6]=k*re-G*te,m[7]=0,m[8]=k,m[9]=G,m[10]=$,m[11]=0,m[12]=w,m[13]=M,m[14]=R,m[15]=1,m},zt.str=function(m){return"mat4("+m[0]+", "+m[1]+", "+m[2]+", "+m[3]+", "+m[4]+", "+m[5]+", "+m[6]+", "+m[7]+", "+m[8]+", "+m[9]+", "+m[10]+", "+m[11]+", "+m[12]+", "+m[13]+", "+m[14]+", "+m[15]+")"},zt.frob=function(m){return Math.hypot(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15])},zt.add=function(m,x,E){return m[0]=x[0]+E[0],m[1]=x[1]+E[1],m[2]=x[2]+E[2],m[3]=x[3]+E[3],m[4]=x[4]+E[4],m[5]=x[5]+E[5],m[6]=x[6]+E[6],m[7]=x[7]+E[7],m[8]=x[8]+E[8],m[9]=x[9]+E[9],m[10]=x[10]+E[10],m[11]=x[11]+E[11],m[12]=x[12]+E[12],m[13]=x[13]+E[13],m[14]=x[14]+E[14],m[15]=x[15]+E[15],m},zt.subtract=S,zt.multiplyScalar=function(m,x,E){return m[0]=x[0]*E,m[1]=x[1]*E,m[2]=x[2]*E,m[3]=x[3]*E,m[4]=x[4]*E,m[5]=x[5]*E,m[6]=x[6]*E,m[7]=x[7]*E,m[8]=x[8]*E,m[9]=x[9]*E,m[10]=x[10]*E,m[11]=x[11]*E,m[12]=x[12]*E,m[13]=x[13]*E,m[14]=x[14]*E,m[15]=x[15]*E,m},zt.multiplyScalarAndAdd=function(m,x,E,v){return m[0]=x[0]+E[0]*v,m[1]=x[1]+E[1]*v,m[2]=x[2]+E[2]*v,m[3]=x[3]+E[3]*v,m[4]=x[4]+E[4]*v,m[5]=x[5]+E[5]*v,m[6]=x[6]+E[6]*v,m[7]=x[7]+E[7]*v,m[8]=x[8]+E[8]*v,m[9]=x[9]+E[9]*v,m[10]=x[10]+E[10]*v,m[11]=x[11]+E[11]*v,m[12]=x[12]+E[12]*v,m[13]=x[13]+E[13]*v,m[14]=x[14]+E[14]*v,m[15]=x[15]+E[15]*v,m},zt.exactEquals=function(m,x){return m[0]===x[0]&&m[1]===x[1]&&m[2]===x[2]&&m[3]===x[3]&&m[4]===x[4]&&m[5]===x[5]&&m[6]===x[6]&&m[7]===x[7]&&m[8]===x[8]&&m[9]===x[9]&&m[10]===x[10]&&m[11]===x[11]&&m[12]===x[12]&&m[13]===x[13]&&m[14]===x[14]&&m[15]===x[15]},zt.equals=function(m,x){var E=m[0],v=m[1],w=m[2],M=m[3],R=m[4],z=m[5],U=m[6],j=m[7],k=m[8],G=m[9],$=m[10],K=m[11],te=m[12],re=m[13],Q=m[14],de=m[15],oe=x[0],pe=x[1],Ee=x[2],Ce=x[3],Pe=x[4],Re=x[5],je=x[6],De=x[7],tt=x[8],ct=x[9],Ye=x[10],Rt=x[11],At=x[12],xt=x[13],dt=x[14],Wt=x[15];return Math.abs(E-oe)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(oe))&&Math.abs(v-pe)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(pe))&&Math.abs(w-Ee)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(Ee))&&Math.abs(M-Ce)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ce))&&Math.abs(R-Pe)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(Pe))&&Math.abs(z-Re)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(Re))&&Math.abs(U-je)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(je))&&Math.abs(j-De)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(De))&&Math.abs(k-tt)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(tt))&&Math.abs(G-ct)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(ct))&&Math.abs($-Ye)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(Ye))&&Math.abs(K-Rt)<=e.EPSILON*Math.max(1,Math.abs(K),Math.abs(Rt))&&Math.abs(te-At)<=e.EPSILON*Math.max(1,Math.abs(te),Math.abs(At))&&Math.abs(re-xt)<=e.EPSILON*Math.max(1,Math.abs(re),Math.abs(xt))&&Math.abs(Q-dt)<=e.EPSILON*Math.max(1,Math.abs(Q),Math.abs(dt))&&Math.abs(de-Wt)<=e.EPSILON*Math.max(1,Math.abs(de),Math.abs(Wt))},zt.sub=zt.mul=zt.ortho=zt.perspective=void 0;var e=function(m,x){if(m&&m.__esModule)return m;if(m===null||s(m)!=="object"&&typeof m!="function")return{default:m};var E=i(void 0);if(E&&E.has(m))return E.get(m);var v={},w=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var M in m)if(M!=="default"&&Object.prototype.hasOwnProperty.call(m,M)){var R=w?Object.getOwnPropertyDescriptor(m,M):null;R&&(R.get||R.set)?Object.defineProperty(v,M,R):v[M]=m[M]}return v.default=m,E&&E.set(m,v),v}(Be());function i(m){if(typeof WeakMap!="function")return null;var x=new WeakMap,E=new WeakMap;return(i=function(v){return v?E:x})(m)}function o(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function h(m,x,E){var v=x[0],w=x[1],M=x[2],R=x[3],z=x[4],U=x[5],j=x[6],k=x[7],G=x[8],$=x[9],K=x[10],te=x[11],re=x[12],Q=x[13],de=x[14],oe=x[15],pe=E[0],Ee=E[1],Ce=E[2],Pe=E[3];return m[0]=pe*v+Ee*z+Ce*G+Pe*re,m[1]=pe*w+Ee*U+Ce*$+Pe*Q,m[2]=pe*M+Ee*j+Ce*K+Pe*de,m[3]=pe*R+Ee*k+Ce*te+Pe*oe,m[4]=(pe=E[4])*v+(Ee=E[5])*z+(Ce=E[6])*G+(Pe=E[7])*re,m[5]=pe*w+Ee*U+Ce*$+Pe*Q,m[6]=pe*M+Ee*j+Ce*K+Pe*de,m[7]=pe*R+Ee*k+Ce*te+Pe*oe,m[8]=(pe=E[8])*v+(Ee=E[9])*z+(Ce=E[10])*G+(Pe=E[11])*re,m[9]=pe*w+Ee*U+Ce*$+Pe*Q,m[10]=pe*M+Ee*j+Ce*K+Pe*de,m[11]=pe*R+Ee*k+Ce*te+Pe*oe,m[12]=(pe=E[12])*v+(Ee=E[13])*z+(Ce=E[14])*G+(Pe=E[15])*re,m[13]=pe*w+Ee*U+Ce*$+Pe*Q,m[14]=pe*M+Ee*j+Ce*K+Pe*de,m[15]=pe*R+Ee*k+Ce*te+Pe*oe,m}function l(m,x,E){var v=x[0],w=x[1],M=x[2],R=x[3],z=v+v,U=w+w,j=M+M,k=v*z,G=v*U,$=v*j,K=w*U,te=w*j,re=M*j,Q=R*z,de=R*U,oe=R*j;return m[0]=1-(K+re),m[1]=G+oe,m[2]=$-de,m[3]=0,m[4]=G-oe,m[5]=1-(k+re),m[6]=te+Q,m[7]=0,m[8]=$+de,m[9]=te-Q,m[10]=1-(k+K),m[11]=0,m[12]=E[0],m[13]=E[1],m[14]=E[2],m[15]=1,m}function d(m,x){var E=x[4],v=x[5],w=x[6],M=x[8],R=x[9],z=x[10];return m[0]=Math.hypot(x[0],x[1],x[2]),m[1]=Math.hypot(E,v,w),m[2]=Math.hypot(M,R,z),m}function g(m,x,E,v,w){var M,R=1/Math.tan(x/2);return m[0]=R/E,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=R,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=-1,m[12]=0,m[13]=0,m[15]=0,w!=null&&w!==1/0?(m[10]=(w+v)*(M=1/(v-w)),m[14]=2*w*v*M):(m[10]=-1,m[14]=-2*v),m}function b(m,x,E,v,w,M,R){var z=1/(x-E),U=1/(v-w),j=1/(M-R);return m[0]=-2*z,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=-2*U,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=2*j,m[11]=0,m[12]=(x+E)*z,m[13]=(w+v)*U,m[14]=(R+M)*j,m[15]=1,m}function S(m,x,E){return m[0]=x[0]-E[0],m[1]=x[1]-E[1],m[2]=x[2]-E[2],m[3]=x[3]-E[3],m[4]=x[4]-E[4],m[5]=x[5]-E[5],m[6]=x[6]-E[6],m[7]=x[7]-E[7],m[8]=x[8]-E[8],m[9]=x[9]-E[9],m[10]=x[10]-E[10],m[11]=x[11]-E[11],m[12]=x[12]-E[12],m[13]=x[13]-E[13],m[14]=x[14]-E[14],m[15]=x[15]-E[15],m}return zt.perspective=g,zt.ortho=b,zt.mul=h,zt.sub=S,zt}var or,$t={},jt={};function Pr(){if(or)return jt;function s(w){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},s(w)}or=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.create=o,jt.clone=function(w){var M=new e.ARRAY_TYPE(3);return M[0]=w[0],M[1]=w[1],M[2]=w[2],M},jt.length=h,jt.fromValues=function(w,M,R){var z=new e.ARRAY_TYPE(3);return z[0]=w,z[1]=M,z[2]=R,z},jt.copy=function(w,M){return w[0]=M[0],w[1]=M[1],w[2]=M[2],w},jt.set=function(w,M,R,z){return w[0]=M,w[1]=R,w[2]=z,w},jt.add=function(w,M,R){return w[0]=M[0]+R[0],w[1]=M[1]+R[1],w[2]=M[2]+R[2],w},jt.subtract=l,jt.multiply=d,jt.divide=g,jt.ceil=function(w,M){return w[0]=Math.ceil(M[0]),w[1]=Math.ceil(M[1]),w[2]=Math.ceil(M[2]),w},jt.floor=function(w,M){return w[0]=Math.floor(M[0]),w[1]=Math.floor(M[1]),w[2]=Math.floor(M[2]),w},jt.min=function(w,M,R){return w[0]=Math.min(M[0],R[0]),w[1]=Math.min(M[1],R[1]),w[2]=Math.min(M[2],R[2]),w},jt.max=function(w,M,R){return w[0]=Math.max(M[0],R[0]),w[1]=Math.max(M[1],R[1]),w[2]=Math.max(M[2],R[2]),w},jt.round=function(w,M){return w[0]=Math.round(M[0]),w[1]=Math.round(M[1]),w[2]=Math.round(M[2]),w},jt.scale=function(w,M,R){return w[0]=M[0]*R,w[1]=M[1]*R,w[2]=M[2]*R,w},jt.scaleAndAdd=function(w,M,R,z){return w[0]=M[0]+R[0]*z,w[1]=M[1]+R[1]*z,w[2]=M[2]+R[2]*z,w},jt.distance=b,jt.squaredDistance=S,jt.squaredLength=m,jt.negate=function(w,M){return w[0]=-M[0],w[1]=-M[1],w[2]=-M[2],w},jt.inverse=function(w,M){return w[0]=1/M[0],w[1]=1/M[1],w[2]=1/M[2],w},jt.normalize=function(w,M){var R=M[0],z=M[1],U=M[2],j=R*R+z*z+U*U;return j>0&&(j=1/Math.sqrt(j)),w[0]=M[0]*j,w[1]=M[1]*j,w[2]=M[2]*j,w},jt.dot=x,jt.cross=function(w,M,R){var z=M[0],U=M[1],j=M[2],k=R[0],G=R[1],$=R[2];return w[0]=U*$-j*G,w[1]=j*k-z*$,w[2]=z*G-U*k,w},jt.lerp=function(w,M,R,z){var U=M[0],j=M[1],k=M[2];return w[0]=U+z*(R[0]-U),w[1]=j+z*(R[1]-j),w[2]=k+z*(R[2]-k),w},jt.hermite=function(w,M,R,z,U,j){var k=j*j,G=k*(2*j-3)+1,$=k*(j-2)+j,K=k*(j-1),te=k*(3-2*j);return w[0]=M[0]*G+R[0]*$+z[0]*K+U[0]*te,w[1]=M[1]*G+R[1]*$+z[1]*K+U[1]*te,w[2]=M[2]*G+R[2]*$+z[2]*K+U[2]*te,w},jt.bezier=function(w,M,R,z,U,j){var k=1-j,G=k*k,$=j*j,K=G*k,te=3*j*G,re=3*$*k,Q=$*j;return w[0]=M[0]*K+R[0]*te+z[0]*re+U[0]*Q,w[1]=M[1]*K+R[1]*te+z[1]*re+U[1]*Q,w[2]=M[2]*K+R[2]*te+z[2]*re+U[2]*Q,w},jt.random=function(w,M){M=M||1;var R=2*e.RANDOM()*Math.PI,z=2*e.RANDOM()-1,U=Math.sqrt(1-z*z)*M;return w[0]=Math.cos(R)*U,w[1]=Math.sin(R)*U,w[2]=z*M,w},jt.transformMat4=function(w,M,R){var z=M[0],U=M[1],j=M[2],k=R[3]*z+R[7]*U+R[11]*j+R[15];return w[0]=(R[0]*z+R[4]*U+R[8]*j+R[12])/(k=k||1),w[1]=(R[1]*z+R[5]*U+R[9]*j+R[13])/k,w[2]=(R[2]*z+R[6]*U+R[10]*j+R[14])/k,w},jt.transformMat3=function(w,M,R){var z=M[0],U=M[1],j=M[2];return w[0]=z*R[0]+U*R[3]+j*R[6],w[1]=z*R[1]+U*R[4]+j*R[7],w[2]=z*R[2]+U*R[5]+j*R[8],w},jt.transformQuat=function(w,M,R){var z=R[0],U=R[1],j=R[2],k=M[0],G=M[1],$=M[2],K=U*$-j*G,te=j*k-z*$,re=z*G-U*k,Q=U*re-j*te,de=j*K-z*re,oe=z*te-U*K,pe=2*R[3];return te*=pe,re*=pe,de*=2,oe*=2,w[0]=k+(K*=pe)+(Q*=2),w[1]=G+te+de,w[2]=$+re+oe,w},jt.rotateX=function(w,M,R,z){var U=[],j=[];return U[0]=M[0]-R[0],U[1]=M[1]-R[1],U[2]=M[2]-R[2],j[0]=U[0],j[1]=U[1]*Math.cos(z)-U[2]*Math.sin(z),j[2]=U[1]*Math.sin(z)+U[2]*Math.cos(z),w[0]=j[0]+R[0],w[1]=j[1]+R[1],w[2]=j[2]+R[2],w},jt.rotateY=function(w,M,R,z){var U=[],j=[];return U[0]=M[0]-R[0],U[1]=M[1]-R[1],U[2]=M[2]-R[2],j[0]=U[2]*Math.sin(z)+U[0]*Math.cos(z),j[1]=U[1],j[2]=U[2]*Math.cos(z)-U[0]*Math.sin(z),w[0]=j[0]+R[0],w[1]=j[1]+R[1],w[2]=j[2]+R[2],w},jt.rotateZ=function(w,M,R,z){var U=[],j=[];return U[0]=M[0]-R[0],U[1]=M[1]-R[1],U[2]=M[2]-R[2],j[0]=U[0]*Math.cos(z)-U[1]*Math.sin(z),j[1]=U[0]*Math.sin(z)+U[1]*Math.cos(z),j[2]=U[2],w[0]=j[0]+R[0],w[1]=j[1]+R[1],w[2]=j[2]+R[2],w},jt.angle=function(w,M){var R=w[0],z=w[1],U=w[2],j=M[0],k=M[1],G=M[2],$=Math.sqrt(R*R+z*z+U*U)*Math.sqrt(j*j+k*k+G*G),K=$&&x(w,M)/$;return Math.acos(Math.min(Math.max(K,-1),1))},jt.zero=function(w){return w[0]=0,w[1]=0,w[2]=0,w},jt.str=function(w){return"vec3("+w[0]+", "+w[1]+", "+w[2]+")"},jt.exactEquals=function(w,M){return w[0]===M[0]&&w[1]===M[1]&&w[2]===M[2]},jt.equals=function(w,M){var R=w[0],z=w[1],U=w[2],j=M[0],k=M[1],G=M[2];return Math.abs(R-j)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(j))&&Math.abs(z-k)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(k))&&Math.abs(U-G)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(G))},jt.forEach=jt.sqrLen=jt.len=jt.sqrDist=jt.dist=jt.div=jt.mul=jt.sub=void 0;var e=function(w,M){if(w&&w.__esModule)return w;if(w===null||s(w)!=="object"&&typeof w!="function")return{default:w};var R=i(void 0);if(R&&R.has(w))return R.get(w);var z={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in w)if(j!=="default"&&Object.prototype.hasOwnProperty.call(w,j)){var k=U?Object.getOwnPropertyDescriptor(w,j):null;k&&(k.get||k.set)?Object.defineProperty(z,j,k):z[j]=w[j]}return z.default=w,R&&R.set(w,z),z}(Be());function i(w){if(typeof WeakMap!="function")return null;var M=new WeakMap,R=new WeakMap;return(i=function(z){return z?R:M})(w)}function o(){var w=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0),w}function h(w){return Math.hypot(w[0],w[1],w[2])}function l(w,M,R){return w[0]=M[0]-R[0],w[1]=M[1]-R[1],w[2]=M[2]-R[2],w}function d(w,M,R){return w[0]=M[0]*R[0],w[1]=M[1]*R[1],w[2]=M[2]*R[2],w}function g(w,M,R){return w[0]=M[0]/R[0],w[1]=M[1]/R[1],w[2]=M[2]/R[2],w}function b(w,M){return Math.hypot(M[0]-w[0],M[1]-w[1],M[2]-w[2])}function S(w,M){var R=M[0]-w[0],z=M[1]-w[1],U=M[2]-w[2];return R*R+z*z+U*U}function m(w){var M=w[0],R=w[1],z=w[2];return M*M+R*R+z*z}function x(w,M){return w[0]*M[0]+w[1]*M[1]+w[2]*M[2]}jt.sub=l,jt.mul=d,jt.div=g,jt.dist=b,jt.sqrDist=S,jt.len=h,jt.sqrLen=m;var E,v=(E=o(),function(w,M,R,z,U,j){var k,G;for(M||(M=3),R||(R=0),G=z?Math.min(z*M+R,w.length):w.length,k=R;k<G;k+=M)E[0]=w[k],E[1]=w[k+1],E[2]=w[k+2],U(E,E,j),w[k]=E[0],w[k+1]=E[1],w[k+2]=E[2];return w});return jt.forEach=v,jt}var un,Mn,Jt={};function Ii(){if(un)return Jt;function s(v){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},s(v)}un=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.create=o,Jt.clone=function(v){var w=new e.ARRAY_TYPE(4);return w[0]=v[0],w[1]=v[1],w[2]=v[2],w[3]=v[3],w},Jt.fromValues=function(v,w,M,R){var z=new e.ARRAY_TYPE(4);return z[0]=v,z[1]=w,z[2]=M,z[3]=R,z},Jt.copy=function(v,w){return v[0]=w[0],v[1]=w[1],v[2]=w[2],v[3]=w[3],v},Jt.set=function(v,w,M,R,z){return v[0]=w,v[1]=M,v[2]=R,v[3]=z,v},Jt.add=function(v,w,M){return v[0]=w[0]+M[0],v[1]=w[1]+M[1],v[2]=w[2]+M[2],v[3]=w[3]+M[3],v},Jt.subtract=h,Jt.multiply=l,Jt.divide=d,Jt.ceil=function(v,w){return v[0]=Math.ceil(w[0]),v[1]=Math.ceil(w[1]),v[2]=Math.ceil(w[2]),v[3]=Math.ceil(w[3]),v},Jt.floor=function(v,w){return v[0]=Math.floor(w[0]),v[1]=Math.floor(w[1]),v[2]=Math.floor(w[2]),v[3]=Math.floor(w[3]),v},Jt.min=function(v,w,M){return v[0]=Math.min(w[0],M[0]),v[1]=Math.min(w[1],M[1]),v[2]=Math.min(w[2],M[2]),v[3]=Math.min(w[3],M[3]),v},Jt.max=function(v,w,M){return v[0]=Math.max(w[0],M[0]),v[1]=Math.max(w[1],M[1]),v[2]=Math.max(w[2],M[2]),v[3]=Math.max(w[3],M[3]),v},Jt.round=function(v,w){return v[0]=Math.round(w[0]),v[1]=Math.round(w[1]),v[2]=Math.round(w[2]),v[3]=Math.round(w[3]),v},Jt.scale=function(v,w,M){return v[0]=w[0]*M,v[1]=w[1]*M,v[2]=w[2]*M,v[3]=w[3]*M,v},Jt.scaleAndAdd=function(v,w,M,R){return v[0]=w[0]+M[0]*R,v[1]=w[1]+M[1]*R,v[2]=w[2]+M[2]*R,v[3]=w[3]+M[3]*R,v},Jt.distance=g,Jt.squaredDistance=b,Jt.length=S,Jt.squaredLength=m,Jt.negate=function(v,w){return v[0]=-w[0],v[1]=-w[1],v[2]=-w[2],v[3]=-w[3],v},Jt.inverse=function(v,w){return v[0]=1/w[0],v[1]=1/w[1],v[2]=1/w[2],v[3]=1/w[3],v},Jt.normalize=function(v,w){var M=w[0],R=w[1],z=w[2],U=w[3],j=M*M+R*R+z*z+U*U;return j>0&&(j=1/Math.sqrt(j)),v[0]=M*j,v[1]=R*j,v[2]=z*j,v[3]=U*j,v},Jt.dot=function(v,w){return v[0]*w[0]+v[1]*w[1]+v[2]*w[2]+v[3]*w[3]},Jt.cross=function(v,w,M,R){var z=M[0]*R[1]-M[1]*R[0],U=M[0]*R[2]-M[2]*R[0],j=M[0]*R[3]-M[3]*R[0],k=M[1]*R[2]-M[2]*R[1],G=M[1]*R[3]-M[3]*R[1],$=M[2]*R[3]-M[3]*R[2],K=w[0],te=w[1],re=w[2],Q=w[3];return v[0]=te*$-re*G+Q*k,v[1]=-K*$+re*j-Q*U,v[2]=K*G-te*j+Q*z,v[3]=-K*k+te*U-re*z,v},Jt.lerp=function(v,w,M,R){var z=w[0],U=w[1],j=w[2],k=w[3];return v[0]=z+R*(M[0]-z),v[1]=U+R*(M[1]-U),v[2]=j+R*(M[2]-j),v[3]=k+R*(M[3]-k),v},Jt.random=function(v,w){var M,R,z,U,j,k;w=w||1;do j=(M=2*e.RANDOM()-1)*M+(R=2*e.RANDOM()-1)*R;while(j>=1);do k=(z=2*e.RANDOM()-1)*z+(U=2*e.RANDOM()-1)*U;while(k>=1);var G=Math.sqrt((1-j)/k);return v[0]=w*M,v[1]=w*R,v[2]=w*z*G,v[3]=w*U*G,v},Jt.transformMat4=function(v,w,M){var R=w[0],z=w[1],U=w[2],j=w[3];return v[0]=M[0]*R+M[4]*z+M[8]*U+M[12]*j,v[1]=M[1]*R+M[5]*z+M[9]*U+M[13]*j,v[2]=M[2]*R+M[6]*z+M[10]*U+M[14]*j,v[3]=M[3]*R+M[7]*z+M[11]*U+M[15]*j,v},Jt.transformQuat=function(v,w,M){var R=w[0],z=w[1],U=w[2],j=M[0],k=M[1],G=M[2],$=M[3],K=$*R+k*U-G*z,te=$*z+G*R-j*U,re=$*U+j*z-k*R,Q=-j*R-k*z-G*U;return v[0]=K*$+Q*-j+te*-G-re*-k,v[1]=te*$+Q*-k+re*-j-K*-G,v[2]=re*$+Q*-G+K*-k-te*-j,v[3]=w[3],v},Jt.zero=function(v){return v[0]=0,v[1]=0,v[2]=0,v[3]=0,v},Jt.str=function(v){return"vec4("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+")"},Jt.exactEquals=function(v,w){return v[0]===w[0]&&v[1]===w[1]&&v[2]===w[2]&&v[3]===w[3]},Jt.equals=function(v,w){var M=v[0],R=v[1],z=v[2],U=v[3],j=w[0],k=w[1],G=w[2],$=w[3];return Math.abs(M-j)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(j))&&Math.abs(R-k)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(k))&&Math.abs(z-G)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(G))&&Math.abs(U-$)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs($))},Jt.forEach=Jt.sqrLen=Jt.len=Jt.sqrDist=Jt.dist=Jt.div=Jt.mul=Jt.sub=void 0;var e=function(v,w){if(v&&v.__esModule)return v;if(v===null||s(v)!=="object"&&typeof v!="function")return{default:v};var M=i(void 0);if(M&&M.has(v))return M.get(v);var R={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in v)if(U!=="default"&&Object.prototype.hasOwnProperty.call(v,U)){var j=z?Object.getOwnPropertyDescriptor(v,U):null;j&&(j.get||j.set)?Object.defineProperty(R,U,j):R[U]=v[U]}return R.default=v,M&&M.set(v,R),R}(Be());function i(v){if(typeof WeakMap!="function")return null;var w=new WeakMap,M=new WeakMap;return(i=function(R){return R?M:w})(v)}function o(){var v=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(v[0]=0,v[1]=0,v[2]=0,v[3]=0),v}function h(v,w,M){return v[0]=w[0]-M[0],v[1]=w[1]-M[1],v[2]=w[2]-M[2],v[3]=w[3]-M[3],v}function l(v,w,M){return v[0]=w[0]*M[0],v[1]=w[1]*M[1],v[2]=w[2]*M[2],v[3]=w[3]*M[3],v}function d(v,w,M){return v[0]=w[0]/M[0],v[1]=w[1]/M[1],v[2]=w[2]/M[2],v[3]=w[3]/M[3],v}function g(v,w){return Math.hypot(w[0]-v[0],w[1]-v[1],w[2]-v[2],w[3]-v[3])}function b(v,w){var M=w[0]-v[0],R=w[1]-v[1],z=w[2]-v[2],U=w[3]-v[3];return M*M+R*R+z*z+U*U}function S(v){return Math.hypot(v[0],v[1],v[2],v[3])}function m(v){var w=v[0],M=v[1],R=v[2],z=v[3];return w*w+M*M+R*R+z*z}Jt.sub=h,Jt.mul=l,Jt.div=d,Jt.dist=g,Jt.sqrDist=b,Jt.len=S,Jt.sqrLen=m;var x,E=(x=o(),function(v,w,M,R,z,U){var j,k;for(w||(w=4),M||(M=0),k=R?Math.min(R*w+M,v.length):v.length,j=M;j<k;j+=w)x[0]=v[j],x[1]=v[j+1],x[2]=v[j+2],x[3]=v[j+3],z(x,x,U),v[j]=x[0],v[j+1]=x[1],v[j+2]=x[2],v[j+3]=x[3];return v});return Jt.forEach=E,Jt}function Oi(){if(Mn)return $t;function s(oe){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(pe){return typeof pe}:function(pe){return pe&&typeof Symbol=="function"&&pe.constructor===Symbol&&pe!==Symbol.prototype?"symbol":typeof pe},s(oe)}Mn=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.create=g,$t.identity=function(oe){return oe[0]=0,oe[1]=0,oe[2]=0,oe[3]=1,oe},$t.setAxisAngle=b,$t.getAxisAngle=function(oe,pe){var Ee=2*Math.acos(pe[3]),Ce=Math.sin(Ee/2);return Ce>e.EPSILON?(oe[0]=pe[0]/Ce,oe[1]=pe[1]/Ce,oe[2]=pe[2]/Ce):(oe[0]=1,oe[1]=0,oe[2]=0),Ee},$t.getAngle=function(oe,pe){var Ee=M(oe,pe);return Math.acos(2*Ee*Ee-1)},$t.multiply=S,$t.rotateX=function(oe,pe,Ee){Ee*=.5;var Ce=pe[0],Pe=pe[1],Re=pe[2],je=pe[3],De=Math.sin(Ee),tt=Math.cos(Ee);return oe[0]=Ce*tt+je*De,oe[1]=Pe*tt+Re*De,oe[2]=Re*tt-Pe*De,oe[3]=je*tt-Ce*De,oe},$t.rotateY=function(oe,pe,Ee){Ee*=.5;var Ce=pe[0],Pe=pe[1],Re=pe[2],je=pe[3],De=Math.sin(Ee),tt=Math.cos(Ee);return oe[0]=Ce*tt-Re*De,oe[1]=Pe*tt+je*De,oe[2]=Re*tt+Ce*De,oe[3]=je*tt-Pe*De,oe},$t.rotateZ=function(oe,pe,Ee){Ee*=.5;var Ce=pe[0],Pe=pe[1],Re=pe[2],je=pe[3],De=Math.sin(Ee),tt=Math.cos(Ee);return oe[0]=Ce*tt+Pe*De,oe[1]=Pe*tt-Ce*De,oe[2]=Re*tt+je*De,oe[3]=je*tt-Re*De,oe},$t.calculateW=function(oe,pe){var Ee=pe[0],Ce=pe[1],Pe=pe[2];return oe[0]=Ee,oe[1]=Ce,oe[2]=Pe,oe[3]=Math.sqrt(Math.abs(1-Ee*Ee-Ce*Ce-Pe*Pe)),oe},$t.exp=m,$t.ln=x,$t.pow=function(oe,pe,Ee){return x(oe,pe),w(oe,oe,Ee),m(oe,oe),oe},$t.slerp=E,$t.random=function(oe){var pe=e.RANDOM(),Ee=e.RANDOM(),Ce=e.RANDOM(),Pe=Math.sqrt(1-pe),Re=Math.sqrt(pe);return oe[0]=Pe*Math.sin(2*Math.PI*Ee),oe[1]=Pe*Math.cos(2*Math.PI*Ee),oe[2]=Re*Math.sin(2*Math.PI*Ce),oe[3]=Re*Math.cos(2*Math.PI*Ce),oe},$t.invert=function(oe,pe){var Ee=pe[0],Ce=pe[1],Pe=pe[2],Re=pe[3],je=Ee*Ee+Ce*Ce+Pe*Pe+Re*Re,De=je?1/je:0;return oe[0]=-Ee*De,oe[1]=-Ce*De,oe[2]=-Pe*De,oe[3]=Re*De,oe},$t.conjugate=function(oe,pe){return oe[0]=-pe[0],oe[1]=-pe[1],oe[2]=-pe[2],oe[3]=pe[3],oe},$t.fromMat3=v,$t.fromEuler=function(oe,pe,Ee,Ce){var Pe=.5*Math.PI/180;pe*=Pe,Ee*=Pe,Ce*=Pe;var Re=Math.sin(pe),je=Math.cos(pe),De=Math.sin(Ee),tt=Math.cos(Ee),ct=Math.sin(Ce),Ye=Math.cos(Ce);return oe[0]=Re*tt*Ye-je*De*ct,oe[1]=je*De*Ye+Re*tt*ct,oe[2]=je*tt*ct-Re*De*Ye,oe[3]=je*tt*Ye+Re*De*ct,oe},$t.str=function(oe){return"quat("+oe[0]+", "+oe[1]+", "+oe[2]+", "+oe[3]+")"},$t.setAxes=$t.sqlerp=$t.rotationTo=$t.equals=$t.exactEquals=$t.normalize=$t.sqrLen=$t.squaredLength=$t.len=$t.length=$t.lerp=$t.dot=$t.scale=$t.mul=$t.add=$t.set=$t.copy=$t.fromValues=$t.clone=void 0;var e=d(Be()),i=d(Bt()),o=d(Pr()),h=d(Ii());function l(oe){if(typeof WeakMap!="function")return null;var pe=new WeakMap,Ee=new WeakMap;return(l=function(Ce){return Ce?Ee:pe})(oe)}function d(oe,pe){if(oe&&oe.__esModule)return oe;if(oe===null||s(oe)!=="object"&&typeof oe!="function")return{default:oe};var Ee=l(pe);if(Ee&&Ee.has(oe))return Ee.get(oe);var Ce={},Pe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Re in oe)if(Re!=="default"&&Object.prototype.hasOwnProperty.call(oe,Re)){var je=Pe?Object.getOwnPropertyDescriptor(oe,Re):null;je&&(je.get||je.set)?Object.defineProperty(Ce,Re,je):Ce[Re]=oe[Re]}return Ce.default=oe,Ee&&Ee.set(oe,Ce),Ce}function g(){var oe=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(oe[0]=0,oe[1]=0,oe[2]=0),oe[3]=1,oe}function b(oe,pe,Ee){Ee*=.5;var Ce=Math.sin(Ee);return oe[0]=Ce*pe[0],oe[1]=Ce*pe[1],oe[2]=Ce*pe[2],oe[3]=Math.cos(Ee),oe}function S(oe,pe,Ee){var Ce=pe[0],Pe=pe[1],Re=pe[2],je=pe[3],De=Ee[0],tt=Ee[1],ct=Ee[2],Ye=Ee[3];return oe[0]=Ce*Ye+je*De+Pe*ct-Re*tt,oe[1]=Pe*Ye+je*tt+Re*De-Ce*ct,oe[2]=Re*Ye+je*ct+Ce*tt-Pe*De,oe[3]=je*Ye-Ce*De-Pe*tt-Re*ct,oe}function m(oe,pe){var Ee=pe[0],Ce=pe[1],Pe=pe[2],Re=pe[3],je=Math.sqrt(Ee*Ee+Ce*Ce+Pe*Pe),De=Math.exp(Re),tt=je>0?De*Math.sin(je)/je:0;return oe[0]=Ee*tt,oe[1]=Ce*tt,oe[2]=Pe*tt,oe[3]=De*Math.cos(je),oe}function x(oe,pe){var Ee=pe[0],Ce=pe[1],Pe=pe[2],Re=pe[3],je=Math.sqrt(Ee*Ee+Ce*Ce+Pe*Pe),De=je>0?Math.atan2(je,Re)/je:0;return oe[0]=Ee*De,oe[1]=Ce*De,oe[2]=Pe*De,oe[3]=.5*Math.log(Ee*Ee+Ce*Ce+Pe*Pe+Re*Re),oe}function E(oe,pe,Ee,Ce){var Pe,Re,je,De,tt,ct=pe[0],Ye=pe[1],Rt=pe[2],At=pe[3],xt=Ee[0],dt=Ee[1],Wt=Ee[2],Pt=Ee[3];return(Re=ct*xt+Ye*dt+Rt*Wt+At*Pt)<0&&(Re=-Re,xt=-xt,dt=-dt,Wt=-Wt,Pt=-Pt),1-Re>e.EPSILON?(Pe=Math.acos(Re),je=Math.sin(Pe),De=Math.sin((1-Ce)*Pe)/je,tt=Math.sin(Ce*Pe)/je):(De=1-Ce,tt=Ce),oe[0]=De*ct+tt*xt,oe[1]=De*Ye+tt*dt,oe[2]=De*Rt+tt*Wt,oe[3]=De*At+tt*Pt,oe}function v(oe,pe){var Ee,Ce=pe[0]+pe[4]+pe[8];if(Ce>0)Ee=Math.sqrt(Ce+1),oe[3]=.5*Ee,oe[0]=(pe[5]-pe[7])*(Ee=.5/Ee),oe[1]=(pe[6]-pe[2])*Ee,oe[2]=(pe[1]-pe[3])*Ee;else{var Pe=0;pe[4]>pe[0]&&(Pe=1),pe[8]>pe[3*Pe+Pe]&&(Pe=2);var Re=(Pe+1)%3,je=(Pe+2)%3;Ee=Math.sqrt(pe[3*Pe+Pe]-pe[3*Re+Re]-pe[3*je+je]+1),oe[Pe]=.5*Ee,oe[3]=(pe[3*Re+je]-pe[3*je+Re])*(Ee=.5/Ee),oe[Re]=(pe[3*Re+Pe]+pe[3*Pe+Re])*Ee,oe[je]=(pe[3*je+Pe]+pe[3*Pe+je])*Ee}return oe}$t.clone=h.clone,$t.fromValues=h.fromValues,$t.copy=h.copy,$t.set=h.set,$t.add=h.add,$t.mul=S;var w=h.scale;$t.scale=w;var M=h.dot;$t.dot=M,$t.lerp=h.lerp;var R=h.length;$t.length=R,$t.len=R;var z=h.squaredLength;$t.squaredLength=z,$t.sqrLen=z;var U=h.normalize;$t.normalize=U,$t.exactEquals=h.exactEquals,$t.equals=h.equals;var j,k,G,$=(j=o.create(),k=o.fromValues(1,0,0),G=o.fromValues(0,1,0),function(oe,pe,Ee){var Ce=o.dot(pe,Ee);return Ce<-.999999?(o.cross(j,k,pe),o.len(j)<1e-6&&o.cross(j,G,pe),o.normalize(j,j),b(oe,j,Math.PI),oe):Ce>.999999?(oe[0]=0,oe[1]=0,oe[2]=0,oe[3]=1,oe):(o.cross(j,pe,Ee),oe[0]=j[0],oe[1]=j[1],oe[2]=j[2],oe[3]=1+Ce,U(oe,oe))});$t.rotationTo=$;var K,te,re=(K=g(),te=g(),function(oe,pe,Ee,Ce,Pe,Re){return E(K,pe,Pe,Re),E(te,Ee,Ce,Re),E(oe,K,te,2*Re*(1-Re)),oe});$t.sqlerp=re;var Q,de=(Q=i.create(),function(oe,pe,Ee,Ce){return Q[0]=Ee[0],Q[3]=Ee[1],Q[6]=Ee[2],Q[1]=Ce[0],Q[4]=Ce[1],Q[7]=Ce[2],Q[2]=-pe[0],Q[5]=-pe[1],Q[8]=-pe[2],U(oe,v(oe,Q))});return $t.setAxes=de,$t}var Sr,ei={};function Vr(){if(Sr)return ei;function s(E){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},s(E)}Sr=1,Object.defineProperty(ei,"__esModule",{value:!0}),ei.create=function(){var E=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0,E[4]=0,E[5]=0,E[6]=0,E[7]=0),E[3]=1,E},ei.clone=function(E){var v=new e.ARRAY_TYPE(8);return v[0]=E[0],v[1]=E[1],v[2]=E[2],v[3]=E[3],v[4]=E[4],v[5]=E[5],v[6]=E[6],v[7]=E[7],v},ei.fromValues=function(E,v,w,M,R,z,U,j){var k=new e.ARRAY_TYPE(8);return k[0]=E,k[1]=v,k[2]=w,k[3]=M,k[4]=R,k[5]=z,k[6]=U,k[7]=j,k},ei.fromRotationTranslationValues=function(E,v,w,M,R,z,U){var j=new e.ARRAY_TYPE(8);j[0]=E,j[1]=v,j[2]=w,j[3]=M;var k=.5*R,G=.5*z,$=.5*U;return j[4]=k*M+G*w-$*v,j[5]=G*M+$*E-k*w,j[6]=$*M+k*v-G*E,j[7]=-k*E-G*v-$*w,j},ei.fromRotationTranslation=d,ei.fromTranslation=function(E,v){return E[0]=0,E[1]=0,E[2]=0,E[3]=1,E[4]=.5*v[0],E[5]=.5*v[1],E[6]=.5*v[2],E[7]=0,E},ei.fromRotation=function(E,v){return E[0]=v[0],E[1]=v[1],E[2]=v[2],E[3]=v[3],E[4]=0,E[5]=0,E[6]=0,E[7]=0,E},ei.fromMat4=function(E,v){var w=i.create();o.getRotation(w,v);var M=new e.ARRAY_TYPE(3);return o.getTranslation(M,v),d(E,w,M),E},ei.copy=g,ei.identity=function(E){return E[0]=0,E[1]=0,E[2]=0,E[3]=1,E[4]=0,E[5]=0,E[6]=0,E[7]=0,E},ei.set=function(E,v,w,M,R,z,U,j,k){return E[0]=v,E[1]=w,E[2]=M,E[3]=R,E[4]=z,E[5]=U,E[6]=j,E[7]=k,E},ei.getDual=function(E,v){return E[0]=v[4],E[1]=v[5],E[2]=v[6],E[3]=v[7],E},ei.setDual=function(E,v){return E[4]=v[0],E[5]=v[1],E[6]=v[2],E[7]=v[3],E},ei.getTranslation=function(E,v){var w=v[4],M=v[5],R=v[6],z=v[7],U=-v[0],j=-v[1],k=-v[2],G=v[3];return E[0]=2*(w*G+z*U+M*k-R*j),E[1]=2*(M*G+z*j+R*U-w*k),E[2]=2*(R*G+z*k+w*j-M*U),E},ei.translate=function(E,v,w){var M=v[0],R=v[1],z=v[2],U=v[3],j=.5*w[0],k=.5*w[1],G=.5*w[2],$=v[4],K=v[5],te=v[6],re=v[7];return E[0]=M,E[1]=R,E[2]=z,E[3]=U,E[4]=U*j+R*G-z*k+$,E[5]=U*k+z*j-M*G+K,E[6]=U*G+M*k-R*j+te,E[7]=-M*j-R*k-z*G+re,E},ei.rotateX=function(E,v,w){var M=-v[0],R=-v[1],z=-v[2],U=v[3],j=v[4],k=v[5],G=v[6],$=v[7],K=j*U+$*M+k*z-G*R,te=k*U+$*R+G*M-j*z,re=G*U+$*z+j*R-k*M,Q=$*U-j*M-k*R-G*z;return i.rotateX(E,v,w),E[4]=K*(U=E[3])+Q*(M=E[0])+te*(z=E[2])-re*(R=E[1]),E[5]=te*U+Q*R+re*M-K*z,E[6]=re*U+Q*z+K*R-te*M,E[7]=Q*U-K*M-te*R-re*z,E},ei.rotateY=function(E,v,w){var M=-v[0],R=-v[1],z=-v[2],U=v[3],j=v[4],k=v[5],G=v[6],$=v[7],K=j*U+$*M+k*z-G*R,te=k*U+$*R+G*M-j*z,re=G*U+$*z+j*R-k*M,Q=$*U-j*M-k*R-G*z;return i.rotateY(E,v,w),E[4]=K*(U=E[3])+Q*(M=E[0])+te*(z=E[2])-re*(R=E[1]),E[5]=te*U+Q*R+re*M-K*z,E[6]=re*U+Q*z+K*R-te*M,E[7]=Q*U-K*M-te*R-re*z,E},ei.rotateZ=function(E,v,w){var M=-v[0],R=-v[1],z=-v[2],U=v[3],j=v[4],k=v[5],G=v[6],$=v[7],K=j*U+$*M+k*z-G*R,te=k*U+$*R+G*M-j*z,re=G*U+$*z+j*R-k*M,Q=$*U-j*M-k*R-G*z;return i.rotateZ(E,v,w),E[4]=K*(U=E[3])+Q*(M=E[0])+te*(z=E[2])-re*(R=E[1]),E[5]=te*U+Q*R+re*M-K*z,E[6]=re*U+Q*z+K*R-te*M,E[7]=Q*U-K*M-te*R-re*z,E},ei.rotateByQuatAppend=function(E,v,w){var M=w[0],R=w[1],z=w[2],U=w[3],j=v[0],k=v[1],G=v[2],$=v[3];return E[0]=j*U+$*M+k*z-G*R,E[1]=k*U+$*R+G*M-j*z,E[2]=G*U+$*z+j*R-k*M,E[3]=$*U-j*M-k*R-G*z,E[4]=(j=v[4])*U+($=v[7])*M+(k=v[5])*z-(G=v[6])*R,E[5]=k*U+$*R+G*M-j*z,E[6]=G*U+$*z+j*R-k*M,E[7]=$*U-j*M-k*R-G*z,E},ei.rotateByQuatPrepend=function(E,v,w){var M=v[0],R=v[1],z=v[2],U=v[3],j=w[0],k=w[1],G=w[2],$=w[3];return E[0]=M*$+U*j+R*G-z*k,E[1]=R*$+U*k+z*j-M*G,E[2]=z*$+U*G+M*k-R*j,E[3]=U*$-M*j-R*k-z*G,E[4]=M*($=w[7])+U*(j=w[4])+R*(G=w[6])-z*(k=w[5]),E[5]=R*$+U*k+z*j-M*G,E[6]=z*$+U*G+M*k-R*j,E[7]=U*$-M*j-R*k-z*G,E},ei.rotateAroundAxis=function(E,v,w,M){if(Math.abs(M)<e.EPSILON)return g(E,v);var R=Math.hypot(w[0],w[1],w[2]);M*=.5;var z=Math.sin(M),U=z*w[0]/R,j=z*w[1]/R,k=z*w[2]/R,G=Math.cos(M),$=v[0],K=v[1],te=v[2],re=v[3];E[0]=$*G+re*U+K*k-te*j,E[1]=K*G+re*j+te*U-$*k,E[2]=te*G+re*k+$*j-K*U,E[3]=re*G-$*U-K*j-te*k;var Q=v[4],de=v[5],oe=v[6],pe=v[7];return E[4]=Q*G+pe*U+de*k-oe*j,E[5]=de*G+pe*j+oe*U-Q*k,E[6]=oe*G+pe*k+Q*j-de*U,E[7]=pe*G-Q*U-de*j-oe*k,E},ei.add=function(E,v,w){return E[0]=v[0]+w[0],E[1]=v[1]+w[1],E[2]=v[2]+w[2],E[3]=v[3]+w[3],E[4]=v[4]+w[4],E[5]=v[5]+w[5],E[6]=v[6]+w[6],E[7]=v[7]+w[7],E},ei.multiply=b,ei.scale=function(E,v,w){return E[0]=v[0]*w,E[1]=v[1]*w,E[2]=v[2]*w,E[3]=v[3]*w,E[4]=v[4]*w,E[5]=v[5]*w,E[6]=v[6]*w,E[7]=v[7]*w,E},ei.lerp=function(E,v,w,M){var R=1-M;return S(v,w)<0&&(M=-M),E[0]=v[0]*R+w[0]*M,E[1]=v[1]*R+w[1]*M,E[2]=v[2]*R+w[2]*M,E[3]=v[3]*R+w[3]*M,E[4]=v[4]*R+w[4]*M,E[5]=v[5]*R+w[5]*M,E[6]=v[6]*R+w[6]*M,E[7]=v[7]*R+w[7]*M,E},ei.invert=function(E,v){var w=x(v);return E[0]=-v[0]/w,E[1]=-v[1]/w,E[2]=-v[2]/w,E[3]=v[3]/w,E[4]=-v[4]/w,E[5]=-v[5]/w,E[6]=-v[6]/w,E[7]=v[7]/w,E},ei.conjugate=function(E,v){return E[0]=-v[0],E[1]=-v[1],E[2]=-v[2],E[3]=v[3],E[4]=-v[4],E[5]=-v[5],E[6]=-v[6],E[7]=v[7],E},ei.normalize=function(E,v){var w=x(v);if(w>0){w=Math.sqrt(w);var M=v[0]/w,R=v[1]/w,z=v[2]/w,U=v[3]/w,j=v[4],k=v[5],G=v[6],$=v[7],K=M*j+R*k+z*G+U*$;E[0]=M,E[1]=R,E[2]=z,E[3]=U,E[4]=(j-M*K)/w,E[5]=(k-R*K)/w,E[6]=(G-z*K)/w,E[7]=($-U*K)/w}return E},ei.str=function(E){return"quat2("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+", "+E[4]+", "+E[5]+", "+E[6]+", "+E[7]+")"},ei.exactEquals=function(E,v){return E[0]===v[0]&&E[1]===v[1]&&E[2]===v[2]&&E[3]===v[3]&&E[4]===v[4]&&E[5]===v[5]&&E[6]===v[6]&&E[7]===v[7]},ei.equals=function(E,v){var w=E[0],M=E[1],R=E[2],z=E[3],U=E[4],j=E[5],k=E[6],G=E[7],$=v[0],K=v[1],te=v[2],re=v[3],Q=v[4],de=v[5],oe=v[6],pe=v[7];return Math.abs(w-$)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs($))&&Math.abs(M-K)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(K))&&Math.abs(R-te)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(te))&&Math.abs(z-re)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(re))&&Math.abs(U-Q)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(Q))&&Math.abs(j-de)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(de))&&Math.abs(k-oe)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(oe))&&Math.abs(G-pe)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(pe))},ei.sqrLen=ei.squaredLength=ei.len=ei.length=ei.dot=ei.mul=ei.setReal=ei.getReal=void 0;var e=l(Be()),i=l(Oi()),o=l(zi());function h(E){if(typeof WeakMap!="function")return null;var v=new WeakMap,w=new WeakMap;return(h=function(M){return M?w:v})(E)}function l(E,v){if(E&&E.__esModule)return E;if(E===null||s(E)!=="object"&&typeof E!="function")return{default:E};var w=h(v);if(w&&w.has(E))return w.get(E);var M={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var z in E)if(z!=="default"&&Object.prototype.hasOwnProperty.call(E,z)){var U=R?Object.getOwnPropertyDescriptor(E,z):null;U&&(U.get||U.set)?Object.defineProperty(M,z,U):M[z]=E[z]}return M.default=E,w&&w.set(E,M),M}function d(E,v,w){var M=.5*w[0],R=.5*w[1],z=.5*w[2],U=v[0],j=v[1],k=v[2],G=v[3];return E[0]=U,E[1]=j,E[2]=k,E[3]=G,E[4]=M*G+R*k-z*j,E[5]=R*G+z*U-M*k,E[6]=z*G+M*j-R*U,E[7]=-M*U-R*j-z*k,E}function g(E,v){return E[0]=v[0],E[1]=v[1],E[2]=v[2],E[3]=v[3],E[4]=v[4],E[5]=v[5],E[6]=v[6],E[7]=v[7],E}function b(E,v,w){var M=v[0],R=v[1],z=v[2],U=v[3],j=w[4],k=w[5],G=w[6],$=w[7],K=v[4],te=v[5],re=v[6],Q=v[7],de=w[0],oe=w[1],pe=w[2],Ee=w[3];return E[0]=M*Ee+U*de+R*pe-z*oe,E[1]=R*Ee+U*oe+z*de-M*pe,E[2]=z*Ee+U*pe+M*oe-R*de,E[3]=U*Ee-M*de-R*oe-z*pe,E[4]=M*$+U*j+R*G-z*k+K*Ee+Q*de+te*pe-re*oe,E[5]=R*$+U*k+z*j-M*G+te*Ee+Q*oe+re*de-K*pe,E[6]=z*$+U*G+M*k-R*j+re*Ee+Q*pe+K*oe-te*de,E[7]=U*$-M*j-R*k-z*G+Q*Ee-K*de-te*oe-re*pe,E}ei.getReal=i.copy,ei.setReal=i.copy,ei.mul=b;var S=i.dot;ei.dot=S;var m=i.length;ei.length=m,ei.len=m;var x=i.squaredLength;return ei.squaredLength=x,ei.sqrLen=x,ei}var Or,_n,ti={};function Yn(){if(Or)return ti;function s(v){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},s(v)}Or=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.create=o,ti.clone=function(v){var w=new e.ARRAY_TYPE(2);return w[0]=v[0],w[1]=v[1],w},ti.fromValues=function(v,w){var M=new e.ARRAY_TYPE(2);return M[0]=v,M[1]=w,M},ti.copy=function(v,w){return v[0]=w[0],v[1]=w[1],v},ti.set=function(v,w,M){return v[0]=w,v[1]=M,v},ti.add=function(v,w,M){return v[0]=w[0]+M[0],v[1]=w[1]+M[1],v},ti.subtract=h,ti.multiply=l,ti.divide=d,ti.ceil=function(v,w){return v[0]=Math.ceil(w[0]),v[1]=Math.ceil(w[1]),v},ti.floor=function(v,w){return v[0]=Math.floor(w[0]),v[1]=Math.floor(w[1]),v},ti.min=function(v,w,M){return v[0]=Math.min(w[0],M[0]),v[1]=Math.min(w[1],M[1]),v},ti.max=function(v,w,M){return v[0]=Math.max(w[0],M[0]),v[1]=Math.max(w[1],M[1]),v},ti.round=function(v,w){return v[0]=Math.round(w[0]),v[1]=Math.round(w[1]),v},ti.scale=function(v,w,M){return v[0]=w[0]*M,v[1]=w[1]*M,v},ti.scaleAndAdd=function(v,w,M,R){return v[0]=w[0]+M[0]*R,v[1]=w[1]+M[1]*R,v},ti.distance=g,ti.squaredDistance=b,ti.length=S,ti.squaredLength=m,ti.negate=function(v,w){return v[0]=-w[0],v[1]=-w[1],v},ti.inverse=function(v,w){return v[0]=1/w[0],v[1]=1/w[1],v},ti.normalize=function(v,w){var M=w[0],R=w[1],z=M*M+R*R;return z>0&&(z=1/Math.sqrt(z)),v[0]=w[0]*z,v[1]=w[1]*z,v},ti.dot=function(v,w){return v[0]*w[0]+v[1]*w[1]},ti.cross=function(v,w,M){var R=w[0]*M[1]-w[1]*M[0];return v[0]=v[1]=0,v[2]=R,v},ti.lerp=function(v,w,M,R){var z=w[0],U=w[1];return v[0]=z+R*(M[0]-z),v[1]=U+R*(M[1]-U),v},ti.random=function(v,w){w=w||1;var M=2*e.RANDOM()*Math.PI;return v[0]=Math.cos(M)*w,v[1]=Math.sin(M)*w,v},ti.transformMat2=function(v,w,M){var R=w[0],z=w[1];return v[0]=M[0]*R+M[2]*z,v[1]=M[1]*R+M[3]*z,v},ti.transformMat2d=function(v,w,M){var R=w[0],z=w[1];return v[0]=M[0]*R+M[2]*z+M[4],v[1]=M[1]*R+M[3]*z+M[5],v},ti.transformMat3=function(v,w,M){var R=w[0],z=w[1];return v[0]=M[0]*R+M[3]*z+M[6],v[1]=M[1]*R+M[4]*z+M[7],v},ti.transformMat4=function(v,w,M){var R=w[0],z=w[1];return v[0]=M[0]*R+M[4]*z+M[12],v[1]=M[1]*R+M[5]*z+M[13],v},ti.rotate=function(v,w,M,R){var z=w[0]-M[0],U=w[1]-M[1],j=Math.sin(R),k=Math.cos(R);return v[0]=z*k-U*j+M[0],v[1]=z*j+U*k+M[1],v},ti.angle=function(v,w){var M=v[0],R=v[1],z=w[0],U=w[1],j=Math.sqrt(M*M+R*R)*Math.sqrt(z*z+U*U);return Math.acos(Math.min(Math.max(j&&(M*z+R*U)/j,-1),1))},ti.zero=function(v){return v[0]=0,v[1]=0,v},ti.str=function(v){return"vec2("+v[0]+", "+v[1]+")"},ti.exactEquals=function(v,w){return v[0]===w[0]&&v[1]===w[1]},ti.equals=function(v,w){var M=v[0],R=v[1],z=w[0],U=w[1];return Math.abs(M-z)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(z))&&Math.abs(R-U)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(U))},ti.forEach=ti.sqrLen=ti.sqrDist=ti.dist=ti.div=ti.mul=ti.sub=ti.len=void 0;var e=function(v,w){if(v&&v.__esModule)return v;if(v===null||s(v)!=="object"&&typeof v!="function")return{default:v};var M=i(void 0);if(M&&M.has(v))return M.get(v);var R={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in v)if(U!=="default"&&Object.prototype.hasOwnProperty.call(v,U)){var j=z?Object.getOwnPropertyDescriptor(v,U):null;j&&(j.get||j.set)?Object.defineProperty(R,U,j):R[U]=v[U]}return R.default=v,M&&M.set(v,R),R}(Be());function i(v){if(typeof WeakMap!="function")return null;var w=new WeakMap,M=new WeakMap;return(i=function(R){return R?M:w})(v)}function o(){var v=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(v[0]=0,v[1]=0),v}function h(v,w,M){return v[0]=w[0]-M[0],v[1]=w[1]-M[1],v}function l(v,w,M){return v[0]=w[0]*M[0],v[1]=w[1]*M[1],v}function d(v,w,M){return v[0]=w[0]/M[0],v[1]=w[1]/M[1],v}function g(v,w){return Math.hypot(w[0]-v[0],w[1]-v[1])}function b(v,w){var M=w[0]-v[0],R=w[1]-v[1];return M*M+R*R}function S(v){return Math.hypot(v[0],v[1])}function m(v){var w=v[0],M=v[1];return w*w+M*M}ti.len=S,ti.sub=h,ti.mul=l,ti.div=d,ti.dist=g,ti.sqrDist=b,ti.sqrLen=m;var x,E=(x=o(),function(v,w,M,R,z,U){var j,k;for(w||(w=2),M||(M=0),k=R?Math.min(R*w+M,v.length):v.length,j=M;j<k;j+=w)x[0]=v[j],x[1]=v[j+1],z(x,x,U),v[j]=x[0],v[j+1]=x[1];return v});return ti.forEach=E,ti}function gr(){if(_n)return ue;function s(v){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},s(v)}_n=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.vec4=ue.vec3=ue.vec2=ue.quat2=ue.quat=ue.mat4=ue.mat3=ue.mat2d=ue.mat2=ue.glMatrix=void 0;var e=E(Be());ue.glMatrix=e;var i=E(Xe());ue.mat2=i;var o=E(ht());ue.mat2d=o;var h=E(Bt());ue.mat3=h;var l=E(zi());ue.mat4=l;var d=E(Oi());ue.quat=d;var g=E(Vr());ue.quat2=g;var b=E(Yn());ue.vec2=b;var S=E(Pr());ue.vec3=S;var m=E(Ii());function x(v){if(typeof WeakMap!="function")return null;var w=new WeakMap,M=new WeakMap;return(x=function(R){return R?M:w})(v)}function E(v,w){if(v&&v.__esModule)return v;if(v===null||s(v)!=="object"&&typeof v!="function")return{default:v};var M=x(w);if(M&&M.has(v))return M.get(v);var R={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in v)if(U!=="default"&&Object.prototype.hasOwnProperty.call(v,U)){var j=z?Object.getOwnPropertyDescriptor(v,U):null;j&&(j.get||j.set)?Object.defineProperty(R,U,j):R[U]=v[U]}return R.default=v,M&&M.set(v,R),R}return ue.vec4=m,ue}var Tt,Kt,Zt,ni,ge=gr(),Ki=function(){if(Kt)return Tt;function s(e,i,o,h){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=h}return Kt=1,Tt=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,h=0;h<8;h++){var l=this.sampleCurveX(o)-e;if(Math.abs(l)<i)return o;var d=this.sampleCurveDerivativeX(o);if(Math.abs(d)<1e-6)break;o-=l/d}var g=0,b=1;for(o=e,h=0;h<20&&(l=this.sampleCurveX(o),!(Math.abs(l-e)<i));h++)e>l?g=o:b=o,o=.5*(b-g)+g;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Tt}(),Ae=ne(Ki);function ke(){if(ni)return Zt;function s(e,i){this.x=e,this.y=i}return ni=1,Zt=s,s.prototype={clone:function(){return new s(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,o=e.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),o=Math.sin(e),h=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=h,this},_rotateAround:function(e,i){var o=Math.cos(e),h=Math.sin(e),l=i.y+h*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-h*(this.y-i.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(e){return e instanceof s?e:Array.isArray(e)?new s(e[0],e[1]):e},Zt}var Se=ne(ke());function Ct(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(!Ct(s[i],e[i]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const i in s)if(!Ct(s[i],e[i]))return!1;return!0}return s===e}const _t=Math.PI/180,ve=180/Math.PI;function _e(s){return s*_t}function Ze(s){return s*ve}const pt=[[0,0],[1,0],[1,1],[0,1]];function It(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,i=e*s;return 4*(s<.5?i:3*(s-e)+i-.75)}function Ut(s,e,i,o){const h=new Ae(s,e,i,o);return function(l){return h.solve(l)}}const Ge=Ut(.25,.1,.25,1);function $e(s,e,i){return Math.min(i,Math.max(e,s))}function Xt(s,e,i){return(i=$e((i-s)/(e-s),0,1))*i*(3-2*i)}function li(s,e,i){const o=i-e,h=((s-e)%o+o)%o+e;return h===e?i:h}function Ui(s,e,i){if(!s.length)return i(null,[]);let o=s.length;const h=new Array(s.length);let l=null;s.forEach((d,g)=>{e(d,(b,S)=>{b&&(l=b),h[g]=S,--o==0&&i(l,h)})})}function Si(s,...e){for(const i of e)for(const o in i)s[o]=i[o];return s}let sr=1;function kr(){return sr++}function hn(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function en(s,e){s.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Cn(s,e){return s.indexOf(e,s.length-e.length)!==-1}function zs(s,e,i){const o={};for(const h in s)o[h]=e.call(this,s[h],h,s);return o}function tn(s,e,i){const o={};for(const h in s)e.call(this,s[h],h,s)&&(o[h]=s[h]);return o}function jr(s){return Array.isArray(s)?s.map(jr):typeof s=="object"&&s?zs(s,jr):s}const vo={};function ki(s){vo[s]||(typeof console<"u"&&console.warn(s),vo[s]=!0)}function Os(s,e,i){return(i.y-s.y)*(e.x-s.x)>(e.y-s.y)*(i.x-s.x)}function Cc(s){let e=0;for(let i,o,h=0,l=s.length,d=l-1;h<l;d=h++)i=s[h],o=s[d],e+=(o.x-i.x)*(i.y+o.y);return e}function Kn([s,e,i]){const o=_e(e+90),h=_e(i);return{x:s*Math.cos(o)*Math.sin(h),y:s*Math.sin(o)*Math.sin(h),z:s*Math.cos(h),azimuthal:e,polar:i}}function $o(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Al(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,h,l)=>{const d=h||l;return e[o]=!d||d.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let ya,Il=null;function qo(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}function We(s,e,i,o){for(;e<i;){const h=e+i>>1;s[h]<o?e=h+1:i=h}return e}function Y(s,e,i,o){for(;e<i;){const h=e+i>>1;s[h]<=o?e=h+1:i=h}return e}function J(s){return s>0?1/(1.001-s):1+s}function he(s){return s>0?1-1/(1.001-s):-s}const we={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(ya==null){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ya=T.API_URL_REGEX!=null?new RegExp(T.API_URL_REGEX):s}catch{ya=s}}return ya},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!we.API_URL)return null;try{const s=new URL(we.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function xe(s){return we.API_URL_REGEX.test(s)}function Le(s){return we.API_SPRITE_REGEX.test(s)}let qe,Fe,He,rt,et,gt;function Lt(){return qe==null&&(qe=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),qe}const Dt={now:()=>rt!==void 0?rt:performance.now(),setNow(s){rt=s},restoreNow(){rt=void 0},frame(s){const e=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:i,height:o}=s;et||(et=document.createElement("canvas"));const h=et.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>et.width||o>et.height)&&(et.width=i,et.height=o),h.clearRect(-e,-e,i+2*e,o+2*e),h.drawImage(s,0,0,i,o),h.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:s=>(Fe||(Fe=document.createElement("a")),Fe.href=s,Fe.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(He==null&&(He=window.matchMedia("(prefers-reduced-motion: reduce)")),He.matches)},hasCanvasFingerprintNoise(){if(gt!==void 0)return gt;if(!Lt())return gt=!1,!1;const s=new OffscreenCanvas(85,1),e=s.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<s.width;++h)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(h,0,1,1);const o=e.getImageData(0,0,s.width,s.height);i=0;for(let h=0;h<o.data.length;++h)if(h%4!=3&&i++!==o.data[h])return gt=!0,!0;return gt=!1,!1}};function ci(s,e){const i=s.indexOf("?");if(i<0)return`${s}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(s.slice(i));for(const h in e)o.set(h,e[h]);return`${s.slice(0,i)}?${o.toString()}`}function hi(s,e={persistentParams:[]}){const i=s.indexOf("?");if(i<0)return s;const o=new URLSearchParams,h=new URLSearchParams(s.slice(i));for(const d of e.persistentParams){const g=h.get(d);g&&o.set(d,g)}const l=o.toString();return`${s.slice(0,i)}${l.length>0?`?${l}`:""}`}const fi="mapbox-tiles";let di=500,qi=50;const Ji=["language","worldview","jobid"];let gi,Xi;function yr(){try{return caches}catch{}}function Wr(){const s=yr();s&&gi==null&&(gi=s.open(fi))}let Xr=1/0;const dn={supported:!1,testSupport:function(s){!Pc&&Qs&&(Ml?Rc(s):xs=s)}};let xs,Qs,Pc=!1,Ml=!1;const xa=typeof self<"u"?self:{};function Rc(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Qs),s.isContextLost())return;dn.supported=!0}catch{}s.deleteTexture(e),Pc=!0}xa.document&&(Qs=xa.document.createElement("img"),Qs.onload=function(){xs&&Rc(xs),xs=null,Ml=!0},Qs.onerror=function(){Pc=!0,xs=null},Qs.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const va={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(va);class dh extends Error{constructor(e,i,o){i===401&&xe(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const fh=$o()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Cl=function(s,e){if(!(/^file:/.test(i=s.url)||/^file:/.test(fh())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,h){const l=new AbortController,d=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:fh(),referrerPolicy:o.referrerPolicy,signal:l.signal});let g=!1,b=!1;const S=(m=d.url).indexOf("sku=")>0&&xe(m);var m;o.type==="json"&&d.headers.set("Accept","application/json");const x=(v,w,M)=>{if(b)return;if(v&&v.message!=="SecurityError"&&ki(v.toString()),w&&M)return E(w);const R=Date.now();fetch(d).then(z=>{if(z.ok){const U=S?z.clone():null;return E(z,U,R)}return h(new dh(z.statusText,z.status,o.url))}).catch(z=>{z.name!=="AbortError"&&h(new Error(`${z.message} ${o.url}`))})},E=(v,w,M)=>{(o.type==="arrayBuffer"?v.arrayBuffer():o.type==="json"?v.json():v.text()).then(R=>{b||(w&&M&&function(z,U,j){if(Wr(),gi==null)return;const k=Al(U.headers.get("Cache-Control")||"");if(k["no-store"])return;const G={status:U.status,statusText:U.statusText,headers:new Headers};U.headers.forEach((te,re)=>G.headers.set(re,te)),k["max-age"]&&G.headers.set("Expires",new Date(j+1e3*k["max-age"]).toUTCString());const $=G.headers.get("Expires");if(!$||new Date($).getTime()-j<42e4)return;let K=hi(z.url,{persistentParams:Ji});if(U.status===206){const te=z.headers.get("Range");if(!te)return;G.status=200,K=ci(K,{range:te})}(function(te,re){if(Xi===void 0)try{new Response(new ReadableStream),Xi=!0}catch{Xi=!1}Xi?re(te.body):te.blob().then(re)})(U,te=>{const re=new Response((Q=U.status)!==200&&Q!==404&&[101,103,204,205,304].includes(Q)?null:te,G);var Q;Wr(),gi!=null&&gi.then(de=>de.put(K,re)).catch(de=>ki(de.message))})}(d,w,M),g=!0,h(null,R,v.headers.get("Cache-Control"),v.headers.get("Expires")))}).catch(R=>{b||h(new Error(R.message))})};return S?function(v,w){if(Wr(),gi==null)return w(null);gi.then(M=>{let R=hi(v.url,{persistentParams:Ji});const z=v.headers.get("Range");z&&(R=ci(R,{range:z})),M.match(R).then(U=>{const j=function(k){if(!k)return!1;const G=new Date(k.headers.get("Expires")||0),$=Al(k.headers.get("Cache-Control")||"");return G>Date.now()&&!$["no-cache"]}(U);M.delete(R),j&&M.put(R,U.clone()),w(null,U,j)}).catch(w)}).catch(w)}(d,x):x(null,null),{cancel:()=>{b=!0,g||l.abort()}}}(s,e);if($o()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var i;return function(o,h){const l=new XMLHttpRequest;l.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(const d in o.headers)l.setRequestHeader(d,o.headers[d]);return o.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=o.credentials==="include",l.onerror=()=>{h(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let d=l.response;if(o.type==="json")try{d=JSON.parse(l.response)}catch(g){return h(g)}h(null,d,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else h(new dh(l.statusText,l.status,o.url))},l.send(o.body),{cancel:()=>l.abort()}}(s,e)},ba=function(s,e){return Cl(Si(s,{type:"arrayBuffer"}),e)};function us(s){const e=document.createElement("a");return e.href=s,e.protocol===location.protocol&&e.host===location.host}const vs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let bs,Un;bs=[],Un=0;const ks=function(s,e){if(dn.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Un>=we.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return bs.push(l),l}Un++;let i=!1;const o=()=>{if(!i)for(i=!0,Un--;bs.length&&Un<we.MAX_PARALLEL_IMAGE_REQUESTS;){const l=bs.shift(),{requestParameters:d,callback:g,cancelled:b}=l;b||(l.cancel=ks(d,g).cancel)}},h=ba(s,(l,d,g,b)=>{o(),l?e(l):d&&(self.createImageBitmap?function(S,m){const x=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(x).then(E=>{m(null,E)}).catch(E=>{m(new Error(`Could not load image because of ${E.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(S,m)=>e(S,m,g,b)):function(S,m){const x=new Image;x.onload=()=>{m(null,x),URL.revokeObjectURL(x.src),x.onload=null,requestAnimationFrame(()=>{x.src=vs})},x.onerror=()=>m(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const E=new Blob([new Uint8Array(S)],{type:"image/png"});x.src=S.byteLength?URL.createObjectURL(E):vs}(d,(S,m)=>e(S,m,g,b)))});return{cancel:()=>{h.cancel(),o()}}};var Pl,ph,mh,Fs={exports:{}},Lc={exports:{}},Df={exports:{}},p_=function(){if(mh)return Fs.exports;mh=1;var s=(Pl||(Pl=1,Lc.exports=function(i,o){var h,l,d,g,b,S,m,x;for(l=i.length-(h=3&i.length),d=o,b=3432918353,S=461845907,x=0;x<l;)m=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24,++x,d=27492+(65535&(g=5*(65535&(d=(d^=m=(65535&(m=(m=(65535&m)*b+(((m>>>16)*b&65535)<<16)&4294967295)<<15|m>>>17))*S+(((m>>>16)*S&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(m=0,h){case 3:m^=(255&i.charCodeAt(x+2))<<16;case 2:m^=(255&i.charCodeAt(x+1))<<8;case 1:d^=m=(65535&(m=(m=(65535&(m^=255&i.charCodeAt(x)))*b+(((m>>>16)*b&65535)<<16)&4294967295)<<15|m>>>17))*S+(((m>>>16)*S&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}),Lc.exports),e=(ph||(ph=1,Df.exports=function(i,o){for(var h,l=i.length,d=o^l,g=0;l>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(h>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),l-=4,++g;switch(l){case 3:d^=(255&i.charCodeAt(g+2))<<16;case 2:d^=(255&i.charCodeAt(g+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(g)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}),Df.exports);return Fs.exports=s,Fs.exports.murmur3=s,Fs.exports.murmur2=e,Fs.exports}(),Vn=ne(p_);class bo{constructor(e,...i){Si(this,i[0]||{}),this.type=e}}class Rl extends bo{constructor(e,i={}){super("error",Si({error:e},i))}}function wa(s,e,i){i[s]&&i[s].indexOf(e)!==-1||(i[s]=i[s]||[],i[s].push(e))}function _h(s,e,i){if(i&&i[s]){const o=i[s].indexOf(e);o!==-1&&i[s].splice(o,1)}}class Ta{on(e,i){return this._listeners=this._listeners||{},wa(e,i,this._listeners),this}off(e,i){return _h(e,i,this._listeners),_h(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},wa(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){const o=typeof e=="string"?new bo(e,i):e,h=o.type;if(this.listens(h)){o.target=this;const l=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const b of l)b.call(this,o);const d=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const b of d)_h(h,b,this._oneTimeListeners),b.call(this,o);const g=this._eventedParent;g&&(Si(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(o))}else o instanceof Rl&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var gh,Fi={},yh=function(){if(gh)return Fi;gh=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(l){return(l=Math.round(l))<0?0:l>255?255:l}function i(l){return e(l[l.length-1]==="%"?parseFloat(l)/100*255:parseInt(l))}function o(l){return(d=l[l.length-1]==="%"?parseFloat(l)/100:parseFloat(l))<0?0:d>1?1:d;var d}function h(l,d,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?l+(d-l)*g*6:2*g<1?d:3*g<2?l+(d-l)*(2/3-g)*6:l}try{Fi.parseCSSColor=function(l){var d,g=l.replace(/ /g,"").toLowerCase();if(g in s)return s[g].slice();if(g[0]==="#")return g.length===4?(d=parseInt(g.substr(1),16))>=0&&d<=4095?[(3840&d)>>4|(3840&d)>>8,240&d|(240&d)>>4,15&d|(15&d)<<4,1]:null:g.length===7&&(d=parseInt(g.substr(1),16))>=0&&d<=16777215?[(16711680&d)>>16,(65280&d)>>8,255&d,1]:null;var b=g.indexOf("("),S=g.indexOf(")");if(b!==-1&&S+1===g.length){var m=g.substr(0,b),x=g.substr(b+1,S-(b+1)).split(","),E=1;switch(m){case"rgba":if(x.length!==4)return null;E=o(x.pop());case"rgb":return x.length!==3?null:[i(x[0]),i(x[1]),i(x[2]),E];case"hsla":if(x.length!==4)return null;E=o(x.pop());case"hsl":if(x.length!==3)return null;var v=(parseFloat(x[0])%360+360)%360/360,w=o(x[1]),M=o(x[2]),R=M<=.5?M*(w+1):M+w-M*w,z=2*M-R;return[e(255*h(z,R,v+1/3)),e(255*h(z,R,v)),e(255*h(z,R,v-1/3)),E];default:return null}}return null}}catch{}return Fi}();class Hi{constructor(e,i,o,h=1){this.r=e,this.g=i,this.b=o,this.a=h}static parse(e){if(!e)return;if(e instanceof Hi)return e;if(typeof e!="string")return;const i=yh.parseCSSColor(e);return i?new Hi(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,o,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${h})`}toRenderColor(e){const{r:i,g:o,b:h,a:l}=this;return new m_(e,i,o,h,l)}}class m_{constructor(e,i,o,h,l){if(e){const d=e.image.height,g=d*d;i=l===0?0:i/l*(d-1),o=l===0?0:o/l*(d-1),h=l===0?0:h/l*(d-1);const b=Math.floor(i),S=Math.floor(o),m=Math.floor(h),x=Math.ceil(i),E=Math.ceil(o),v=Math.ceil(h),w=i-b,M=o-S,R=h-m,z=e.image.data,U=4*(b+S*g+m*d),j=4*(b+S*g+v*d),k=4*(b+E*g+m*d),G=4*(b+E*g+v*d),$=4*(x+S*g+m*d),K=4*(x+S*g+v*d),te=4*(x+E*g+m*d),re=4*(x+E*g+v*d);if(U<0||re>=z.length)throw new Error("out of range");this.r=ii(ii(ii(z[U],z[j],R),ii(z[k],z[G],R),M),ii(ii(z[$],z[K],R),ii(z[te],z[re],R),M),w)/255*l,this.g=ii(ii(ii(z[U+1],z[j+1],R),ii(z[k+1],z[G+1],R),M),ii(ii(z[$+1],z[K+1],R),ii(z[te+1],z[re+1],R),M),w)/255*l,this.b=ii(ii(ii(z[U+2],z[j+2],R),ii(z[k+2],z[G+2],R),M),ii(ii(z[$+2],z[K+2],R),ii(z[te+2],z[re+2],R),M),w)/255*l,this.a=l}else this.r=i,this.g=o,this.b=h,this.a=l}toArray(){const{r:e,g:i,b:o,a:h}=this;return h===0?[0,0,0,0]:[255*e/h,255*i/h,255*o/h,h]}toArray01(){const{r:e,g:i,b:o,a:h}=this;return h===0?[0,0,0,0]:[e/h,i/h,o/h,h]}toArray01Scaled(e){const{r:i,g:o,b:h,a:l}=this;return l===0?[0,0,0]:[i/l*e,o/l*e,h/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:o,a:h}=this;return[e,i,o,h]}toArray01Linear(){const{r:e,g:i,b:o,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(e/h,2.2),Math.pow(i/h,2.2),Math.pow(o/h,2.2),h]}}function ii(s,e,i){return s*(1-i)+e*i}function Ll(s,e,i){return s.map((o,h)=>ii(o,e[h],i))}Hi.black=new Hi(0,0,0,1),Hi.white=new Hi(1,1,1,1),Hi.transparent=new Hi(0,0,0,0),Hi.red=new Hi(1,0,0,1),Hi.blue=new Hi(0,0,1,1);var Ho=Object.freeze({__proto__:null,array:Ll,color:function(s,e,i){return new Hi(ii(s.r,e.r,i),ii(s.g,e.g,i),ii(s.b,e.b,i),ii(s.a,e.a,i))},number:ii});function Ea(s,...e){for(const i of e)for(const o in i)s[o]=i[o];return s}class Bs extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Dc{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,h]of i)this.bindings[o]=h}concat(e){return new Dc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ws={kind:"null"},Nt={kind:"number"},Ci={kind:"string"},Pi={kind:"boolean"},jn={kind:"color"},wn={kind:"object"},Di={kind:"value"},zc={kind:"collator"},Sa={kind:"formatted"},Aa={kind:"resolvedImage"};function Pn(s,e){return{kind:"array",itemType:s,N:e}}function Rr(s){if(s.kind==="array"){const e=Rr(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const zf=[ws,Nt,Ci,Pi,jn,Sa,wn,Pn(Di),Aa];function Ia(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ia(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const i of zf)if(!Ia(i,e))return null}}return`Expected ${Rr(s)} but found ${Rr(e)} instead.`}function Ma(s,e){return e.some(i=>i.kind===s.kind)}function Ns(s,e){return e.some(i=>i==="null"?s===null:i==="array"?Array.isArray(s):i==="object"?s&&!Array.isArray(s)&&typeof s=="object":i===typeof s)}class Oc{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Jn{constructor(e,i,o,h,l){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=h,this.textColor=l}}class Tn{constructor(e){this.sections=e}static fromString(e){return new Tn([new Jn(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Tn?e:Tn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class Rn{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new Rn({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Of(s,e,i,o){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[s,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[s,e,i,o]:[s,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wo(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Hi||s instanceof Oc||s instanceof Tn||s instanceof Rn)return!0;if(Array.isArray(s)){for(const e of s)if(!wo(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!wo(s[e]))return!1;return!0}return!1}function Gr(s){if(s===null)return ws;if(typeof s=="string")return Ci;if(typeof s=="boolean")return Pi;if(typeof s=="number")return Nt;if(s instanceof Hi)return jn;if(s instanceof Oc)return zc;if(s instanceof Tn)return Sa;if(s instanceof Rn)return Aa;if(Array.isArray(s)){const e=s.length;let i;for(const o of s){const h=Gr(o);if(i){if(i===h)continue;i=Di;break}i=h}return Pn(i||Di,e)}return wn}function Ln(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof Hi||s instanceof Tn||s instanceof Rn?s.toString():JSON.stringify(s)}class Ts{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!wo(e[1]))return i.error("invalid value");const o=e[1];let h=Gr(o);const l=i.expectedType;return h.kind!=="array"||h.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(h=l),new Ts(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Hi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Tn?this.value.serialize():this.value}}class rn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const xh={string:Ci,number:Nt,boolean:Pi,object:wn};class Es{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,h=1;const l=e[0];if(l==="array"){let g,b;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in xh)||S==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=xh[S],h++}else g=Di;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],h++}o=Pn(g,b)}else o=xh[l];const d=[];for(;h<e.length;h++){const g=i.parse(e[h],h,Di);if(!g)return null;d.push(g)}return new Es(o,d)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!Ia(this.type,Gr(o)))return o;if(i===this.args.length-1)throw new rn(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Rr(Gr(o))} but was expected to be of type ${Rr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(o=>o.serialize()))}}class Ca{constructor(e){this.type=Sa,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const h=[];let l=!1;for(let d=1;d<=e.length-1;++d){const g=e[d];if(l&&typeof g=="object"&&!Array.isArray(g)){l=!1;let b=null;if(g["font-scale"]&&(b=i.parseObjectValue(g["font-scale"],d,"font-scale",Nt),!b))return null;let S=null;if(g["text-font"]&&(S=i.parseObjectValue(g["text-font"],d,"text-font",Pn(Ci)),!S))return null;let m=null;if(g["text-color"]&&(m=i.parseObjectValue(g["text-color"],d,"text-color",jn),!m))return null;const x=h[h.length-1];x.scale=b,x.font=S,x.textColor=m}else{const b=i.parse(e[d],d,Di);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new Ca(h)}evaluate(e){return new Tn(this.sections.map(i=>{const o=i.content.evaluate(e);return Gr(o)===Aa?new Jn("",o,null,null,null):new Jn(Ln(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class Wo{constructor(e,i){this.type=Aa,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const o=i.parse(e[1],1,Ci);if(!o)return i.error("No image name provided.");if(e.length===2)return new Wo(o);const h=i.parse(e[2],1,Ci);return h?new Wo(o,h):i.error("Secondary image variant is not a string.")}evaluate(e){const i=Rn.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Zo(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}const kc={"to-boolean":Pi,"to-color":jn,"to-number":Nt,"to-string":Ci};class eo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],h=[];let l=ws;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);l=Pn(i.expectedType.itemType,d)}else{if(!(d>0&&wo(e[1][0])))return null;l=Pn(Gr(e[1][0]),d)}for(let g=0;g<d;g++){const b=e[1][g];let S;if(Zo(b)==="array")S=i.parse(b,void 0,l.itemType);else{const m=Zo(b);if(m!==l.itemType.kind)return i.error(`Expected ${l.itemType.kind} but found ${m}.`);S=i.registry.literal.parse(["literal",b===void 0?null:b],i)}if(!S)return null;h.push(S)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");l=kc[o];for(let d=1;d<e.length;d++){const g=i.parse(e[d],d,Di);if(!g)return null;h.push(g)}}return new eo(l,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const h of this.args){if(i=h.evaluate(e),o=null,i instanceof Hi)return i;if(typeof i=="string"){const l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Of(i[0],i[1],i[2],i[3]),!o))return new Hi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new rn(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new rn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Tn.fromString(Ln(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Rn.fromString(Ln(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Ln(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ca([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Wo(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const __=["Unknown","Point","LineString","Polygon"];class kf{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?__[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(h*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Hi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Gn{constructor(e,i,o,h,l){this.name=e,this.type=i,this._evaluate=o,this.args=h,this._overloadIndex=l}evaluate(e){if(!this._evaluate){const i=Gn.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],h=Gn.definitions[o];if(!h)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(h)?h[0]:h.type,d=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,g=[];let b=null,S=-1;for(const[m,x]of d){if(Array.isArray(m)&&m.length!==e.length-1)continue;g.push(m),S++,b=new Zf(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const E=[];let v=!1;for(let w=1;w<e.length;w++){const M=e[w],R=Array.isArray(m)?m[w-1]:m.type,z=b.parse(M,1+E.length,R);if(!z){v=!0;break}E.push(z)}if(!v)if(Array.isArray(m)&&m.length!==E.length)b.error(`Expected ${m.length} arguments, but found ${E.length} instead.`);else{for(let w=0;w<E.length;w++){const M=Array.isArray(m)?m[w]:m.type,R=E[w];b.concat(w+1).checkSubtype(M,R.type)}if(b.errors.length===0)return new Gn(o,l,x,E,S)}}if(g.length===1)i.errors.push(...b.errors);else{const m=(g.length?g:d.map(([E])=>E)).map(g_).join(" | "),x=[];for(let E=1;E<e.length;E++){const v=i.parse(e[E],1+x.length);if(!v)return null;x.push(Rr(v.type))}i.error(`Expected arguments of type ${m}, but found (${x.join(", ")}) instead.`)}return null}static register(e,i){Gn.definitions=i;for(const o in i)e[o]=Gn}}function g_(s){return Array.isArray(s)?`(${s.map(Rr).join(", ")})`:`(${Rr(s.type)}...)`}class Fc{constructor(e,i,o){this.type=zc,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const h=o["case-sensitive"]===void 0?i.parse(!1,1,Pi):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",Pi);if(!h)return null;const l=o["diacritic-sensitive"]===void 0?i.parse(!1,1,Pi):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",Pi);if(!l)return null;let d=null;return o.locale&&(d=i.parseObjectValue(o.locale,1,"locale",Ci),!d)?null:new Fc(h,l,d)}evaluate(e){return new Oc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Ff(s,e,i=0,o=s.length-1,h=Ra){for(;o>i;){if(o-i>600){const b=o-i+1,S=e-i+1,m=Math.log(b),x=.5*Math.exp(2*m/3),E=.5*Math.sqrt(m*x*(b-x)/b)*(S-b/2<0?-1:1);Ff(s,e,Math.max(i,Math.floor(e-S*x/b+E)),Math.min(o,Math.floor(e+(b-S)*x/b+E)),h)}const l=s[e];let d=i,g=o;for(Pa(s,i,e),h(s[o],l)>0&&Pa(s,i,o);d<g;){for(Pa(s,d,g),d++,g--;h(s[d],l)<0;)d++;for(;h(s[g],l)>0;)g--}h(s[i],l)===0?Pa(s,i,g):(g++,Pa(s,g,o)),g<=e&&(i=g+1),e<=g&&(o=g-1)}}function Pa(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}function Ra(s,e){return s<e?-1:s>e?1:0}function y_(s){let e=0;for(let i,o,h=0,l=s.length,d=l-1;h<l;d=h++)i=s[h],o=s[d],e+=(o.x-i.x)*(i.y+o.y);return e}function Dl(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Xo(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function x_(s,e,i){const o=s[0]-e[0],h=s[1]-e[1],l=s[0]-i[0],d=s[1]-i[1];return o*d-l*h==0&&o*l<=0&&h*d<=0}function La(s,e,i=!1){let o=!1;for(let g=0,b=e.length;g<b;g++){const S=e[g];for(let m=0,x=S.length,E=x-1;m<x;E=m++){const v=S[E],w=S[m];if(x_(s,v,w))return i;(l=v)[1]>(h=s)[1]!=(d=w)[1]>h[1]&&h[0]<(d[0]-l[0])*(h[1]-l[1])/(d[1]-l[1])+l[0]&&(o=!o)}}var h,l,d;return o}function Bf(s,e,i,o){const h=o[0]-i[0],l=o[1]-i[1],d=(s[0]-i[0])*l-h*(s[1]-i[1]),g=(e[0]-i[0])*l-h*(e[1]-i[1]);return d>0&&g<0||d<0&&g>0}function Bc(s,e,i,o){return(h=[o[0]-i[0],o[1]-i[1]])[0]*(l=[e[0]-s[0],e[1]-s[1]])[1]-h[1]*l[0]!=0&&!(!Bf(s,e,i,o)||!Bf(i,o,s,e));var h,l}const Qn=8192;function Ei(s,e){const i=(180+s[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*Qn),Math.round(o*h*Qn)]}function Yt(s,e){for(let i=0;i<e.length;i++)if(La(s,e[i]))return!0;return!1}function vh(s,e,i){for(const o of i)for(let h=0,l=o.length,d=l-1;h<l;d=h++)if(Bc(s,e,o[d],o[h]))return!0;return!1}function pi(s,e){for(let i=0;i<s.length;++i)if(!La(s[i],e))return!1;for(let i=0;i<s.length-1;++i)if(vh(s[i],s[i+1],e))return!1;return!0}function bh(s,e){for(let i=0;i<e.length;i++)if(pi(s,e[i]))return!0;return!1}function zl(s,e,i){const o=[];for(let h=0;h<s.length;h++){const l=[];for(let d=0;d<s[h].length;d++){const g=Ei(s[h][d],i);Dl(e,g),l.push(g)}o.push(l)}return o}function oi(s,e,i){const o=[];for(let h=0;h<s.length;h++){const l=zl(s[h],e,i);o.push(l)}return o}function wh(s,e,i,o){if(s[0]<i[0]||s[0]>i[2]){const h=.5*o;let l=s[0]-i[0]>h?-o:i[0]-s[0]>h?o:0;l===0&&(l=s[0]-i[2]>h?-o:i[2]-s[0]>h?o:0),s[0]+=l}Dl(e,s)}function Nc(s,e,i,o){const h=Math.pow(2,o.z)*Qn,l=[o.x*Qn,o.y*Qn],d=[];if(!s)return d;for(const g of s)for(const b of g){const S=[b.x+l[0],b.y+l[1]];wh(S,e,i,h),d.push(S)}return d}function Th(s,e,i,o){const h=Math.pow(2,o.z)*Qn,l=[o.x*Qn,o.y*Qn],d=[];if(!s)return d;for(const b of s){const S=[];for(const m of b){const x=[m.x+l[0],m.y+l[1]];Dl(e,x),S.push(x)}d.push(S)}if(e[2]-e[0]<=h/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const b of d)for(const S of b)wh(S,e,i,h)}var g;return d}class To{constructor(e,i){this.type=Pi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(wo(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let h=0;h<o.features.length;++h){const l=o.features[h].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new To(o,o.features[h].geometry)}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new To(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new To(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const h=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(o.type==="Polygon"){const g=zl(o.coordinates,l,d),b=Nc(i.geometry(),h,l,d);if(!Xo(h,l))return!1;for(const S of b)if(!La(S,g))return!1}if(o.type==="MultiPolygon"){const g=oi(o.coordinates,l,d),b=Nc(i.geometry(),h,l,d);if(!Xo(h,l))return!1;for(const S of b)if(!Yt(S,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const h=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(o.type==="Polygon"){const g=zl(o.coordinates,l,d),b=Th(i.geometry(),h,l,d);if(!Xo(h,l))return!1;for(const S of b)if(!pi(S,g))return!1}if(o.type==="MultiPolygon"){const g=oi(o.coordinates,l,d),b=Th(i.geometry(),h,l,d);if(!Xo(h,l))return!1;for(const S of b)if(!bh(S,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Yo={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},gn=1/298.257223563,Uc=gn*(2-gn),Da=Math.PI/180;class za{static fromTile(e,i,o){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),l=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Da;return new za(l,o)}static get units(){return Yo}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Yo[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Yo).join(", ")}`);const o=6378.137*Da*(i?Yo[i]:1),h=Math.cos(e*Da),l=1/(1-Uc*(1-h*h)),d=Math.sqrt(l);this.kx=o*d*h,this.ky=o*d*l*(1-Uc)}distance(e,i){const o=br(e[0]-i[0])*this.kx,h=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+h*h)}bearing(e,i){const o=br(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/Da}destination(e,i,o){const h=o*Da;return this.offset(e,Math.sin(h)*i,Math.cos(h)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const h=e[o];for(let l=0,d=h.length,g=d-1;l<d;g=l++)i+=br(h[l][0]-h[g][0])*(h[l][1]+h[g][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let h=0;h<e.length-1;h++){const l=e[h],d=e[h+1],g=this.distance(l,d);if(o+=g,o>i)return to(l,d,(i-(o-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[h,l]=i,d=br(o[0]-h)*this.kx,g=(o[1]-l)*this.ky;if(d!==0||g!==0){const b=(br(e[0]-h)*this.kx*d+(e[1]-l)*this.ky*g)/(d*d+g*g);b>1?(h=o[0],l=o[1]):b>0&&(h+=d/this.kx*b,l+=g/this.ky*b)}return d=br(e[0]-h)*this.kx,g=(e[1]-l)*this.ky,Math.sqrt(d*d+g*g)}pointOnLine(e,i){let o=1/0,h=e[0][0],l=e[0][1],d=0,g=0;for(let b=0;b<e.length-1;b++){let S=e[b][0],m=e[b][1],x=br(e[b+1][0]-S)*this.kx,E=(e[b+1][1]-m)*this.ky,v=0;x===0&&E===0||(v=(br(i[0]-S)*this.kx*x+(i[1]-m)*this.ky*E)/(x*x+E*E),v>1?(S=e[b+1][0],m=e[b+1][1]):v>0&&(S+=x/this.kx*v,m+=E/this.ky*v)),x=br(i[0]-S)*this.kx,E=(i[1]-m)*this.ky;const w=x*x+E*E;w<o&&(o=w,h=S,l=m,d=b,g=v)}return{point:[h,l],index:d,t:Math.max(0,Math.min(1,g))}}lineSlice(e,i,o){let h=this.pointOnLine(o,e),l=this.pointOnLine(o,i);if(h.index>l.index||h.index===l.index&&h.t>l.t){const S=h;h=l,l=S}const d=[h.point],g=h.index+1,b=l.index;!Vc(o[g],d[0])&&g<=b&&d.push(o[g]);for(let S=g+1;S<=b;S++)d.push(o[S]);return Vc(o[b],l.point)||d.push(l.point),d}lineSliceAlong(e,i,o){let h=0;const l=[];for(let d=0;d<o.length-1;d++){const g=o[d],b=o[d+1],S=this.distance(g,b);if(h+=S,h>e&&l.length===0&&l.push(to(g,b,(e-(h-S))/S)),h>=i)return l.push(to(g,b,(i-(h-S))/S)),l;h>e&&l.push(b)}return l}bufferPoint(e,i){const o=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-o,e[0]+h,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-o,e[2]+h,e[3]+o]}insideBBox(e,i){return br(e[0]-i[0])>=0&&br(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Vc(s,e){return s[0]===e[0]&&s[1]===e[1]}function to(s,e,i){const o=br(e[0]-s[0]);return[s[0]+o*i,s[1]+(e[1]-s[1])*i]}function br(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class Eh{constructor(e=[],i=(o,h)=>o<h?-1:o>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,h=i[e];for(;e>0;){const l=e-1>>1,d=i[l];if(o(h,d)>=0)break;i[e]=d,e=l}i[e]=h}_down(e){const{data:i,compare:o}=this,h=this.length>>1,l=i[e];for(;e<h;){let d=1+(e<<1);const g=d+1;if(g<this.length&&o(i[g],i[d])<0&&(d=g),o(i[d],l)>=0)break;i[e]=i[d],e=d}i[e]=l}}var Mt=8192;function Nf(s,e){return e.dist-s.dist}const Oa=100,jc=50;function Gc(s){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==s.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==s[i])return!1;return!0}function $c(s){return s[1]-s[0]+1}function io(s,e){const i=s[1]>=s[0]&&s[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Sh(s,e){if(s[0]>s[1])return[null,null];const i=$c(s);if(e){if(i===2)return[s,null];const o=Math.floor(i/2);return[[s[0],s[0]+o],[s[0]+o,s[1]]]}{if(i===1)return[s,null];const o=Math.floor(i/2)-1;return[[s[0],s[0]+o],[s[0]+o+1,s[1]]]}}function es(s,e){const i=[1/0,1/0,-1/0,-1/0];if(!io(e,s.length))return i;for(let o=e[0];o<=e[1];++o)Dl(i,s[o]);return i}function qc(s){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<s.length;++i)for(let o=0;o<s[i].length;++o)Dl(e,s[i][o]);return e}function ka(s,e,i){if(Gc(s)||Gc(e))return NaN;let o=0,h=0;return s[2]<e[0]&&(o=e[0]-s[2]),s[0]>e[2]&&(o=s[0]-e[2]),s[1]>e[3]&&(h=s[1]-e[3]),s[3]<e[1]&&(h=e[1]-s[3]),i.distance([0,0],[o,h])}function Uf(s){return 360*s-180}function Vf(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function ts(s,e){const i=Math.pow(2,e.z),o=(s.y/Mt+e.y)/i;return[Uf((s.x/Mt+e.x)/i),Vf(o)]}function jf(s,e){const i=[];for(let o=0;o<s.length;++o)i.push(ts(s[o],e));return i}function Ah(s,e,i){const o=i.pointOnLine(e,s).point;return i.distance(s,o)}function Ih(s,e,i,o,h){const l=i.slice(o[0],o[1]+1);let d=1/0;for(let g=e[0];g<=e[1];++g)if((d=Math.min(d,Ah(s[g],l,h)))===0)return 0;return d}function Hc(s,e,i,o,h){const l=Math.min(h.pointToSegmentDistance(s,i,o),h.pointToSegmentDistance(e,i,o)),d=Math.min(h.pointToSegmentDistance(i,s,e),h.pointToSegmentDistance(o,s,e));return Math.min(l,d)}function Gf(s,e,i,o,h){if(!io(e,s.length)||!io(o,i.length))return NaN;let l=1/0;for(let d=e[0];d<e[1];++d)for(let g=o[0];g<o[1];++g){if(Bc(s[d],s[d+1],i[g],i[g+1]))return 0;l=Math.min(l,Hc(s[d],s[d+1],i[g],i[g+1],h))}return l}function $f(s,e,i,o,h){if(!io(e,s.length)||!io(o,i.length))return NaN;let l=1/0;for(let d=e[0];d<=e[1];++d)for(let g=o[0];g<=o[1];++g)if((l=Math.min(l,h.distance(s[d],i[g])))===0)return l;return l}function qf(s,e,i){if(La(s,e,!0))return 0;let o=1/0;for(const h of e){const l=h.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[l-1]&&(o=Math.min(o,i.pointToSegmentDistance(s,h[l-1],h[0])))===0||(o=Math.min(o,Ah(s,h,i)))===0)return o}return o}function Hf(s,e,i,o){if(!io(e,s.length))return NaN;for(let l=e[0];l<=e[1];++l)if(La(s[l],i,!0))return 0;let h=1/0;for(let l=e[0];l<e[1];++l)for(const d of i)for(let g=0,b=d.length,S=b-1;g<b;S=g++){if(Bc(s[l],s[l+1],d[S],d[g]))return 0;h=Math.min(h,Hc(s[l],s[l+1],d[S],d[g],o))}return h}function Mh(s,e){for(const i of s)for(let o=0;o<=i.length-1;++o)if(La(i[o],e,!0))return!0;return!1}function Wf(s,e,i,o=1/0){const h=qc(s),l=qc(e);if(o!==1/0&&ka(h,l,i)>=o)return o;if(Xo(h,l)){if(Mh(s,e))return 0}else if(Mh(e,s))return 0;let d=o;for(const g of s)for(let b=0,S=g.length,m=S-1;b<S;m=b++)for(const x of e)for(let E=0,v=x.length,w=v-1;E<v;w=E++){if(Bc(g[m],g[b],x[w],x[E]))return 0;d=Math.min(d,Hc(g[m],g[b],x[w],x[E],i))}return d}function Ol(s,e,i,o,h,l,d){if(l===null||d===null)return;const g=ka(es(o,l),es(h,d),i);g<e&&s.push({dist:g,range1:l,range2:d})}function Wc(s,e,i,o,h=1/0){let l=Math.min(o.distance(s[0],i[0][0]),h);if(l===0)return l;const d=new Eh([{dist:0,range1:[0,s.length-1],range2:[0,0]}],Nf),g=e?jc:Oa,b=qc(i);for(;d.length;){const S=d.pop();if(S.dist>=l)continue;const m=S.range1;if($c(m)<=g){if(!io(m,s.length))return NaN;if(e){const x=Hf(s,m,i,o);if((l=Math.min(l,x))===0)return l}else for(let x=m[0];x<=m[1];++x){const E=qf(s[x],i,o);if((l=Math.min(l,E))===0)return l}}else{const x=Sh(m,e);if(x[0]!==null){const E=ka(es(s,x[0]),b,o);E<l&&d.push({dist:E,range1:x[0],range2:[0,0]})}if(x[1]!==null){const E=ka(es(s,x[1]),b,o);E<l&&d.push({dist:E,range1:x[1],range2:[0,0]})}}}return l}function kl(s,e,i,o,h,l=1/0){let d=Math.min(l,h.distance(s[0],i[0]));if(d===0)return d;const g=new Eh([{dist:0,range1:[0,s.length-1],range2:[0,i.length-1]}],Nf),b=e?jc:Oa,S=o?jc:Oa;for(;g.length;){const m=g.pop();if(m.dist>=d)continue;const x=m.range1,E=m.range2;if($c(x)<=b&&$c(E)<=S){if(!io(x,s.length)||!io(E,i.length))return NaN;if(e&&o?d=Math.min(d,Gf(s,x,i,E,h)):e||o?e&&!o?d=Math.min(d,Ih(i,E,s,x,h)):!e&&o&&(d=Math.min(d,Ih(s,x,i,E,h))):d=Math.min(d,$f(s,x,i,E,h)),d===0)return d}else{const v=Sh(x,e),w=Sh(E,o);Ol(g,d,h,s,i,v[0],w[0]),Ol(g,d,h,s,i,v[0],w[1]),Ol(g,d,h,s,i,v[1],w[0]),Ol(g,d,h,s,i,v[1],w[1])}}return d}function Fa(s,e,i,o,h=1/0){let l=h;const d=es(s,[0,s.length-1]);for(const g of i)if(!(l!==1/0&&ka(d,es(g,[0,g.length-1]),o)>=l)&&(l=Math.min(l,kl(s,e,g,!0,o,l)),l===0))return l;return l}function Fl(s,e,i,o,h=1/0){let l=h;const d=es(s,[0,s.length-1]);for(const g of i){if(l!==1/0&&ka(d,qc(g),o)>=l)continue;const b=Wc(s,e,g,o,l);if(isNaN(b))return b;if((l=Math.min(l,b))===0)return l}return l}function Zc(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class Eo{constructor(e,i){this.type=Nt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(wo(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let h=0;h<o.features.length;++h)if(Zc(o.features[h].geometry.type))return new Eo(o,o.features[h].geometry)}else if(o.type==="Feature"){if(Zc(o.geometry.type))return new Eo(o,o.geometry)}else if(Zc(o.type))return new Eo(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(h,l,d){const g=[];for(const S of h)for(const m of S)g.push(ts(m,l));const b=new za(g[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?kl(g,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",b):d.type==="MultiLineString"?Fa(g,!1,d.coordinates,b):d.type==="Polygon"||d.type==="MultiPolygon"?Fl(g,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,b):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(h,l,d){const g=[];for(const S of h){const m=[];for(const x of S)m.push(ts(x,l));g.push(m)}const b=new za(g[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Fa(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",g,b);if(d.type==="MultiLineString"){let S=1/0;for(let m=0;m<d.coordinates.length;m++){const x=Fa(d.coordinates[m],!0,g,b,S);if(isNaN(x))return x;if((S=Math.min(S,x))===0)return S}return S}if(d.type==="Polygon"||d.type==="MultiPolygon"){let S=1/0;for(let m=0;m<g.length;m++){const x=Fl(g[m],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,b,S);if(isNaN(x))return x;if((S=Math.min(S,x))===0)return S}return S}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(h,l,d){const g=[];for(const S of function(m,x){const E=m.length;if(E<=1)return[m];const v=[];let w,M;for(let R=0;R<E;R++){const z=y_(m[R]);z!==0&&(m[R].area=Math.abs(z),M===void 0&&(M=z<0),M===z<0?(w&&v.push(w),w=[m[R]]):w.push(m[R]))}return w&&v.push(w),v}(h)){const m=[];for(let x=0;x<S.length;++x)m.push(jf(S[x],l));g.push(m)}const b=new za(g[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Fl(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",g,b);if(d.type==="MultiLineString"){let S=1/0;for(let m=0;m<d.coordinates.length;m++){const x=Fl(d.coordinates[m],!0,g,b,S);if(isNaN(x))return x;if((S=Math.min(S,x))===0)return S}return S}return d.type==="Polygon"||d.type==="MultiPolygon"?function(S,m,x){let E=1/0;for(const v of S)for(const w of m){const M=Wf(v,w,x,E);if(isNaN(M))return M;if((E=Math.min(E,M))===0)return E}return E}(d.type==="Polygon"?[d.coordinates]:d.coordinates,g,b):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function So(s,e){switch(s){case"string":return Ln(e);case"number":return+e;case"boolean":return!!e;case"color":return Hi.parse(e);case"formatted":return Tn.fromString(Ln(e));case"resolvedImage":return Rn.fromString(Ln(e))}return e}function Ri(s,e,i,o){return o!==void 0&&(s=o*Math.round(s/o)),e!==void 0&&s<e&&(s=e),i!==void 0&&s>i&&(s=i),s}class Ba{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=Di),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(e[1],1);if(!(h instanceof Ts))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const l=i.parse(e[2],2);return l instanceof Ts?new Ba(o,Ln(h.value),Ln(l.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Ba(o,Ln(h.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;const{type:h,value:l,values:d,minValue:g,maxValue:b,stepValue:S}=o,m=o.default.evaluate(e);let x=m;if(l){const E=e.scope;e.scope=(E||"").split("").slice(1).join(""),x=l.evaluate(e),e.scope=E}return h&&(x=So(h,x)),x===void 0||g===void 0&&b===void 0&&S===void 0||(typeof x=="number"?x=Ri(x,g,b,S):Array.isArray(x)&&(x=x.map(E=>typeof E=="number"?Ri(E,g,b,S):E))),l!==void 0&&x!==void 0&&d&&!d.includes(x)&&(x=m,h&&(x=So(h,x))),(h&&h!==this.type||x!==void 0&&Gr(x)!==this.type)&&(x=So(this.type.kind,x)),x}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Bl(s){if(s instanceof Gn&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof To||s instanceof Eo)return!1;let e=!0;return s.eachChild(i=>{e&&!Bl(i)&&(e=!1)}),e}function Xc(s){if(s instanceof Gn&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(i=>{e&&!Xc(i)&&(e=!1)}),e}function Yc(s){if(s instanceof Ba)return new Set([s.key]);let e=new Set;return s.eachChild(i=>{e=new Set([...e,...Yc(i)])}),e}function Nl(s,e){if(s instanceof Gn&&e.indexOf(s.name)>=0)return!1;let i=!0;return s.eachChild(o=>{i&&!Nl(o,e)&&(i=!1)}),i}class ir{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new ir(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ch{constructor(e,i=[],o,h=new Dc,l=[],d,g){this.registry=e,this.path=i,this.key=i.map(b=>typeof b=="string"?`['${b}']`:`[${b}]`).join(""),this.scope=h,this.errors=l,this.expectedType=o,this._scope=d,this.options=g}parse(e,i,o,h,l={}){return i||o?this.concat(i,null,o,h)._parse(e,l):this._parse(e,l)}parseObjectValue(e,i,o,h,l,d={}){return this.concat(i,o,h,l)._parse(e,d)}_parse(e,i){function o(h,l,d){return d==="assert"?new Es(l,[h]):d==="coerce"?new eo(l,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let l=h.parse(e,this);if(!l)return null;if(this.expectedType){const d=this.expectedType,g=l.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||g.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(d,g))return null}else l=o(l,d,i.typeAnnotation||"coerce");else l=o(l,d,i.typeAnnotation||"assert")}if(!(l instanceof Ts)&&l.type.kind!=="resolvedImage"&&Ph(l)){const d=new kf(this._scope,this.options);try{l=new Ts(l.type,l.evaluate(d))}catch(g){return this.error(g.message),null}}return l}return eo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,h){let l=typeof e=="number"?this.path.concat(e):this.path;l=typeof i=="string"?l.concat(i):l;const d=h?this.scope.concat(h):this.scope;return new Ch(this.registry,l,o||null,d,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new Bs(o,e))}checkSubtype(e,i){const o=Ia(e,i);return o&&this.error(o),o}}var Zf=Ch;function Ph(s){if(s instanceof ir)return Ph(s.boundExpression);if(s instanceof Gn&&s.name==="error"||s instanceof Fc||s instanceof To||s instanceof Eo||s instanceof Ba)return!1;const e=s instanceof eo||s instanceof Es;let i=!0;return s.eachChild(o=>{i=e?i&&Ph(o):i&&o instanceof Ts}),!!i&&Bl(s)&&Nl(s,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Kc(s,e){const i=s.length-1;let o,h,l=0,d=i,g=0;for(;l<=d;)if(g=Math.floor((l+d)/2),o=s[g],h=s[g+1],o<=e){if(g===i||e<h)return g;l=g+1}else{if(!(o>e))throw new rn("Input is not a number.");d=g-1}return 0}class Ul{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,l]of o)this.labels.push(h),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Nt);if(!o)return null;const h=[];let l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let d=1;d<e.length;d+=2){const g=d===1?-1/0:e[d],b=e[d+1],S=d,m=d+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(h.length&&h[h.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const x=i.parse(b,m,l);if(!x)return null;l=l||x.type,h.push([g,x])}return new Ul(l,o,h)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return o[0].evaluate(e);const l=i.length;return h>=i[l-1]?o[l-1].evaluate(e):o[Kc(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Xf=.95047,Yf=1.08883,Kf=4/29,Na=6/29,Jf=3*Na*Na,v_=Na*Na*Na,b_=Math.PI/180,w_=180/Math.PI;function Rh(s){return s>v_?Math.pow(s,1/3):s/Jf+Kf}function Lh(s){return s>Na?s*s*s:Jf*(s-Kf)}function Dh(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function zh(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Qf(s){const e=zh(s.r),i=zh(s.g),o=zh(s.b),h=Rh((.4124564*e+.3575761*i+.1804375*o)/Xf),l=Rh((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*l-16,a:500*(h-l),b:200*(l-Rh((.0193339*e+.119192*i+.9503041*o)/Yf)),alpha:s.a}}function ep(s){let e=(s.l+16)/116,i=isNaN(s.a)?e:e+s.a/500,o=isNaN(s.b)?e:e-s.b/200;return e=1*Lh(e),i=Xf*Lh(i),o=Yf*Lh(o),new Hi(Dh(3.2404542*i-1.5371385*e-.4985314*o),Dh(-.969266*i+1.8760108*e+.041556*o),Dh(.0556434*i-.2040259*e+1.0572252*o),s.alpha)}function T_(s,e,i){const o=e-s;return s+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Vl={forward:Qf,reverse:ep,interpolate:function(s,e,i){return{l:ii(s.l,e.l,i),a:ii(s.a,e.a,i),b:ii(s.b,e.b,i),alpha:ii(s.alpha,e.alpha,i)}}},jl={forward:function(s){const{l:e,a:i,b:o}=Qf(s),h=Math.atan2(o,i)*w_;return{h:h<0?h+360:h,c:Math.sqrt(i*i+o*o),l:e,alpha:s.a}},reverse:function(s){const e=s.h*b_,i=s.c;return ep({l:s.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:s.alpha})},interpolate:function(s,e,i){return{h:T_(s.h,e.h,i),c:ii(s.c,e.c,i),l:ii(s.l,e.l,i),alpha:ii(s.alpha,e.alpha,i)}}};var tp=Object.freeze({__proto__:null,hcl:jl,lab:Vl});class is{constructor(e,i,o,h,l){this.type=e,this.operator=i,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[d,g]of l)this.labels.push(d),this.outputs.push(g)}static interpolationFactor(e,i,o,h){let l=0;if(e.name==="exponential")l=Oh(i,e.base,o,h);else if(e.name==="linear")l=Oh(i,1,o,h);else if(e.name==="cubic-bezier"){const d=e.controlPoints;l=new Ae(d[0],d[1],d[2],d[3]).solve(Oh(i,1,o,h))}return l}static parse(e,i){let[o,h,l,...d]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const S=h[1];if(typeof S!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const S=h.slice(1);if(S.length!==4||S.some(m=>typeof m!="number"||m<0||m>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,Nt),!l)return null;const g=[];let b=null;o==="interpolate-hcl"||o==="interpolate-lab"?b=jn:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let S=0;S<d.length;S+=2){const m=d[S],x=d[S+1],E=S+3,v=S+4;if(typeof m!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(g.length&&g[g.length-1][0]>=m)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',E);const w=i.parse(x,v,b);if(!w)return null;b=b||w.type,g.push([m,w])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new is(b,o,h,l,g):i.error(`Type ${Rr(b)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return o[0].evaluate(e);const l=i.length;if(h>=i[l-1])return o[l-1].evaluate(e);const d=Kc(i,h),g=is.interpolationFactor(this.interpolation,h,i[d],i[d+1]),b=o[d].evaluate(e),S=o[d+1].evaluate(e);return this.operator==="interpolate"?Ho[this.type.kind.toLowerCase()](b,S,g):this.operator==="interpolate-hcl"?jl.reverse(jl.interpolate(jl.forward(b),jl.forward(S),g)):Vl.reverse(Vl.interpolate(Vl.forward(b),Vl.forward(S),g))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Oh(s,e,i,o){const h=o-i,l=s-i;return h===0?0:e===1?l/h:(Math.pow(e,l)-1)/(Math.pow(e,h)-1)}class Jc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const h=i.expectedType;h&&h.kind!=="value"&&(o=h);const l=[];for(const g of e.slice(1)){const b=i.parse(g,1+l.length,o,void 0,{typeAnnotation:"omit"});if(!b)return null;o=o||b.type,l.push(b)}const d=h&&l.some(g=>Ia(h,g.type));return new Jc(d?Di:o,l)}evaluate(e){let i,o=null,h=0;for(const l of this.args){if(h++,o=l.evaluate(e),o&&o instanceof Rn&&!o.available&&(i||(i=o),o=null,h===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Qc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let l=1;l<e.length-1;l+=2){const d=e[l];if(typeof d!="string")return i.error(`Expected string, but found ${typeof d} instead.`,l);if(/[^a-zA-Z0-9_]/.test(d))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);const g=i.parse(e[l+1],l+1);if(!g)return null;o.push([d,g])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return h?new Qc(o,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class kh{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Nt),h=i.parse(e[2],2,Pn(i.expectedType||Di));return o&&h?new kh(h.type.itemType,o,h):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new rn(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new rn(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new rn(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Fh{constructor(e,i){this.type=Pi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Di),h=i.parse(e[2],2,Di);return o&&h?Ma(o.type,[Pi,Ci,Nt,ws,Di])?new Fh(o,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Ns(i,["boolean","string","number","null"]))throw new rn(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(Gr(i))} instead.`);if(!Ns(o,["string","array"]))throw new rn(`Expected second argument to be of type array or string, but found ${Rr(Gr(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class eu{constructor(e,i,o){this.type=Nt,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Di),h=i.parse(e[2],2,Di);if(!o||!h)return null;if(!Ma(o.type,[Pi,Ci,Nt,ws,Di]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(o.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,Nt);return l?new eu(o,h,l):null}return new eu(o,h)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ns(i,["boolean","string","number","null"]))throw new rn(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(Gr(i))} instead.`);if(!Ns(o,["string","array"]))throw new rn(`Expected second argument to be of type array or string, but found ${Rr(Gr(o))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return o.indexOf(i,h)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Bh{constructor(e,i,o,h,l,d){this.inputType=e,this.type=i,this.input=o,this.cases=h,this.outputs=l,this.otherwise=d}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const l={},d=[];for(let S=2;S<e.length-1;S+=2){let m=e[S];const x=e[S+1];Array.isArray(m)||(m=[m]);const E=i.concat(S);if(m.length===0)return E.error("Expected at least one branch label.");for(const w of m){if(typeof w!="number"&&typeof w!="string")return E.error("Branch labels must be numbers or strings.");if(typeof w=="number"&&Math.abs(w)>Number.MAX_SAFE_INTEGER)return E.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof w=="number"&&Math.floor(w)!==w)return E.error("Numeric branch labels must be integer values.");if(o){if(E.checkSubtype(o,Gr(w)))return null}else o=Gr(w);if(l[String(w)]!==void 0)return E.error("Branch labels must be unique.");l[String(w)]=d.length}const v=i.parse(x,S,h);if(!v)return null;h=h||v.type,d.push(v)}const g=i.parse(e[1],1,Di);if(!g)return null;const b=i.parse(e[e.length-1],e.length-1,h);return b?g.type.kind!=="value"&&i.concat(1).checkSubtype(o,g.type)?null:new Bh(o,h,g,l,d,b):null}evaluate(e){const i=this.input.evaluate(e);return(Gr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],h={};for(const d of i){const g=h[this.cases[d]];g===void 0?(h[this.cases[d]]=o.length,o.push([this.cases[d],[d]])):o[g][1].push(d)}const l=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,g]of o)e.push(g.length===1?l(g[0]):g.map(l)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}class Gl{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const h=[];for(let d=1;d<e.length-1;d+=2){const g=i.parse(e[d],d,Pi);if(!g)return null;const b=i.parse(e[d+1],d+1,o);if(!b)return null;h.push([g,b]),o=o||b.type}const l=i.parse(e[e.length-1],e.length-1,o);return l?new Gl(o,h,l):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class tu{constructor(e,i,o,h){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Di),h=i.parse(e[2],2,Nt);if(!o||!h)return null;if(!Ma(o.type,[Pn(Di),Ci,Di]))return i.error(`Expected first argument to be of type array or string, but found ${Rr(o.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,Nt);return l?new tu(o.type,o,h,l):null}return new tu(o.type,o,h)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Ns(i,["string","array"]))throw new rn(`Expected first argument to be of type array or string, but found ${Rr(Gr(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(o,h)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Nh(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ip(s,e,i,o){return o.compare(e,i)===0}function Ua(s,e,i){const o=s!=="=="&&s!=="!=";return class rS{constructor(l,d,g){this.type=Pi,this.lhs=l,this.rhs=d,this.collator=g,this.hasUntypedArgument=l.type.kind==="value"||d.type.kind==="value"}static parse(l,d){if(l.length!==3&&l.length!==4)return d.error("Expected two or three arguments.");const g=l[0];let b=d.parse(l[1],1,Di);if(!b)return null;if(!Nh(g,b.type))return d.concat(1).error(`"${g}" comparisons are not supported for type '${Rr(b.type)}'.`);let S=d.parse(l[2],2,Di);if(!S)return null;if(!Nh(g,S.type))return d.concat(2).error(`"${g}" comparisons are not supported for type '${Rr(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return d.error(`Cannot compare types '${Rr(b.type)}' and '${Rr(S.type)}'.`);o&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new Es(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new Es(b.type,[S])));let m=null;if(l.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(m=d.parse(l[3],3,zc),!m)return null}return new rS(b,S,m)}evaluate(l){const d=this.lhs.evaluate(l),g=this.rhs.evaluate(l);if(o&&this.hasUntypedArgument){const b=Gr(d),S=Gr(g);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new rn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const b=Gr(d),S=Gr(g);if(b.kind!=="string"||S.kind!=="string")return e(l,d,g)}return this.collator?i(l,d,g,this.collator.evaluate(l)):e(l,d,g)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[s];return this.eachChild(d=>{l.push(d.serialize())}),l}}}const E_=Ua("==",function(s,e,i){return e===i},ip),rp=Ua("!=",function(s,e,i){return e!==i},function(s,e,i,o){return!ip(0,e,i,o)}),np=Ua("<",function(s,e,i){return e<i},function(s,e,i,o){return o.compare(e,i)<0}),Va=Ua(">",function(s,e,i){return e>i},function(s,e,i,o){return o.compare(e,i)>0}),sp=Ua("<=",function(s,e,i){return e<=i},function(s,e,i,o){return o.compare(e,i)<=0}),op=Ua(">=",function(s,e,i){return e>=i},function(s,e,i,o){return o.compare(e,i)>=0});class Uh{constructor(e,i,o,h,l,d){this.type=Ci,this.number=e,this.locale=i,this.currency=o,this.unit=h,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Nt);if(!o)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let l=null;if(h.locale&&(l=i.parseObjectValue(h.locale,2,"locale",Ci),!l))return null;let d=null;if(h.currency&&(d=i.parseObjectValue(h.currency,2,"currency",Ci),!d))return null;let g=null;if(h.unit&&(g=i.parseObjectValue(h.unit,2,"unit",Ci),!g))return null;let b=null;if(h["min-fraction-digits"]&&(b=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Nt),!b))return null;let S=null;return h["max-fraction-digits"]&&(S=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Nt),!S)?null:new Uh(o,l,d,g,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class $l{constructor(e){this.type=Nt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Rr(o.type)} instead.`):new $l(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new rn(`Expected value to be of type string or array, but found ${Rr(Gr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function iu(s){return function(){s=1831565813+(s|=0)|0;let e=Math.imul(s^s>>>15,1|s);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ja={"==":E_,"!=":rp,">":Va,"<":np,">=":op,"<=":sp,array:Es,at:kh,boolean:Es,case:Gl,coalesce:Jc,collator:Fc,format:Ca,image:Wo,in:Fh,"index-of":eu,interpolate:is,"interpolate-hcl":is,"interpolate-lab":is,length:$l,let:Qc,literal:Ts,match:Bh,number:Es,"number-format":Uh,object:Es,slice:tu,step:Ul,string:Es,"to-boolean":eo,"to-color":eo,"to-number":eo,"to-string":eo,var:ir,within:To,distance:Eo,config:Ba};function ap(s,[e,i,o,h]){e=e.evaluate(s),i=i.evaluate(s),o=o.evaluate(s);const l=h?h.evaluate(s):1,d=Of(e,i,o,l);if(d)throw new rn(d);return new Hi(e/255*l,i/255*l,o/255*l,l)}function Vh(s,[e,i,o,h]){e=e.evaluate(s),i=i.evaluate(s),o=o.evaluate(s);const l=h?h.evaluate(s):1,d=function(S,m,x,E){return typeof S=="number"&&S>=0&&S<=360?typeof m=="number"&&m>=0&&m<=100&&typeof x=="number"&&x>=0&&x<=100?E===void 0||typeof E=="number"&&E>=0&&E<=1?null:`Invalid hsla value [${[S,m,x,E].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof E=="number"?[S,m,x,E]:[S,m,x]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof E=="number"?[S,m,x,E]:[S,m,x]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,l);if(d)throw new rn(d);const g=`hsla(${e}, ${i}%, ${o}%, ${l})`,b=Hi.parse(g);if(!b)throw new rn(`Failed to parse HSLA color: ${g}`);return b}function jh(s,e){return s in e}function Gh(s,e){const i=e[s];return i===void 0?null:i}function Ko(s){return{type:s}}function lp(s){return{result:"success",value:s}}function Ao(s){return{result:"error",value:s}}function $h(s,e){return!!s&&!!s.parameters&&s.parameters.indexOf(e)>-1}function ru(s){return s["property-type"]==="data-driven"}function qh(s){return $h(s.expression,"measure-light")}function cp(s){return $h(s.expression,"zoom")}function Hh(s){return!!s.expression&&s.expression.interpolated}function nu(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function up(s){return s}function hp(s,e){const i=e.type==="color",o=s.stops&&typeof s.stops[0][0]=="object",h=o||!(o||s.property!==void 0),l=s.type||(Hh(e)?"exponential":"interval");if(i&&((s=Ea({},s)).stops&&(s.stops=s.stops.map(S=>[S[0],Hi.parse(S[1])])),s.default=Hi.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!tp[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let d,g,b;if(l==="exponential")d=fp;else if(l==="interval")d=dp;else if(l==="categorical"){d=S_,g=Object.create(null);for(const S of s.stops)g[S[0]]=S[1];b=typeof s.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);d=A_}if(o){const S={},m=[];for(let v=0;v<s.stops.length;v++){const w=s.stops[v],M=w[0].zoom;S[M]===void 0&&(S[M]={zoom:M,type:s.type,property:s.property,default:s.default,stops:[]},m.push(M)),S[M].stops.push([w[0].value,w[1]])}const x=[];for(const v of m)x.push([S[v].zoom,hp(S[v],e)]);const E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:is.interpolationFactor.bind(void 0,E),zoomStops:x.map(v=>v[0]),evaluate:({zoom:v},w)=>fp({stops:x,base:s.base},e,v).evaluate(v,w)}}if(h){const S=l==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:is.interpolationFactor.bind(void 0,S),zoomStops:s.stops.map(m=>m[0]),evaluate:({zoom:m})=>d(s,e,m,g,b)}}return{kind:"source",evaluate(S,m){const x=m&&m.properties?m.properties[s.property]:void 0;return x===void 0?ql(s.default,e.default):d(s,e,x,g,b)}}}function ql(s,e,i){return s!==void 0?s:e!==void 0?e:i!==void 0?i:void 0}function S_(s,e,i,o,h){return ql(typeof i===h?o[i]:void 0,s.default,e.default)}function dp(s,e,i){if(Zo(i)!=="number")return ql(s.default,e.default);const o=s.stops.length;if(o===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[o-1][0])return s.stops[o-1][1];const h=Kc(s.stops.map(l=>l[0]),i);return s.stops[h][1]}function fp(s,e,i){const o=s.base!==void 0?s.base:1;if(Zo(i)!=="number")return ql(s.default,e.default);const h=s.stops.length;if(h===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[h-1][0])return s.stops[h-1][1];const l=Kc(s.stops.map(m=>m[0]),i),d=function(m,x,E,v){const w=v-E,M=m-E;return w===0?0:x===1?M/w:(Math.pow(x,M)-1)/(Math.pow(x,w)-1)}(i,o,s.stops[l][0],s.stops[l+1][0]),g=s.stops[l][1],b=s.stops[l+1][1];let S=Ho[e.type]||up;if(s.colorSpace&&s.colorSpace!=="rgb"){const m=tp[s.colorSpace];S=(x,E)=>m.reverse(m.interpolate(m.forward(x),m.forward(E),d))}return typeof g.evaluate=="function"?{evaluate(...m){const x=g.evaluate.apply(void 0,m),E=b.evaluate.apply(void 0,m);if(x!==void 0&&E!==void 0)return S(x,E,d)}}:S(g,b,d)}function A_(s,e,i){return e.type==="color"?i=Hi.parse(i):e.type==="formatted"?i=Tn.fromString(i.toString()):e.type==="resolvedImage"?i=Rn.fromString(i.toString()):Zo(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ql(i,s.default,e.default)}Gn.register(ja,{error:[{kind:"error"},[Ci],(s,[e])=>{throw new rn(e.evaluate(s))}],typeof:[Ci,[Di],(s,[e])=>Rr(Gr(e.evaluate(s)))],"to-rgba":[Pn(Nt,4),[jn],(s,[e])=>e.evaluate(s).toRenderColor(null).toArray()],rgb:[jn,[Nt,Nt,Nt],ap],rgba:[jn,[Nt,Nt,Nt,Nt],ap],hsl:[jn,[Nt,Nt,Nt],Vh],hsla:[jn,[Nt,Nt,Nt,Nt],Vh],has:{type:Pi,overloads:[[[Ci],(s,[e])=>jh(e.evaluate(s),s.properties())],[[Ci,wn],(s,[e,i])=>jh(e.evaluate(s),i.evaluate(s))]]},get:{type:Di,overloads:[[[Ci],(s,[e])=>Gh(e.evaluate(s),s.properties())],[[Ci,wn],(s,[e,i])=>Gh(e.evaluate(s),i.evaluate(s))]]},"feature-state":[Di,[Ci],(s,[e])=>Gh(e.evaluate(s),s.featureState||{})],properties:[wn,[],s=>s.properties()],"geometry-type":[Ci,[],s=>s.geometryType()],id:[Di,[],s=>s.id()],zoom:[Nt,[],s=>s.globals.zoom],pitch:[Nt,[],s=>s.globals.pitch||0],"distance-from-center":[Nt,[],s=>s.distanceFromCenter()],"measure-light":[Nt,[Ci],(s,[e])=>s.measureLight(e.evaluate(s))],"heatmap-density":[Nt,[],s=>s.globals.heatmapDensity||0],"line-progress":[Nt,[],s=>s.globals.lineProgress||0],"raster-value":[Nt,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[Nt,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[Nt,[],s=>s.globals.skyRadialProgress||0],accumulated:[Di,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Nt,Ko(Nt),(s,e)=>{let i=0;for(const o of e)i+=o.evaluate(s);return i}],"*":[Nt,Ko(Nt),(s,e)=>{let i=1;for(const o of e)i*=o.evaluate(s);return i}],"-":{type:Nt,overloads:[[[Nt,Nt],(s,[e,i])=>e.evaluate(s)-i.evaluate(s)],[[Nt],(s,[e])=>-e.evaluate(s)]]},"/":[Nt,[Nt,Nt],(s,[e,i])=>e.evaluate(s)/i.evaluate(s)],"%":[Nt,[Nt,Nt],(s,[e,i])=>e.evaluate(s)%i.evaluate(s)],ln2:[Nt,[],()=>Math.LN2],pi:[Nt,[],()=>Math.PI],e:[Nt,[],()=>Math.E],"^":[Nt,[Nt,Nt],(s,[e,i])=>Math.pow(e.evaluate(s),i.evaluate(s))],sqrt:[Nt,[Nt],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[Nt,[Nt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[Nt,[Nt],(s,[e])=>Math.log(e.evaluate(s))],log2:[Nt,[Nt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[Nt,[Nt],(s,[e])=>Math.sin(e.evaluate(s))],cos:[Nt,[Nt],(s,[e])=>Math.cos(e.evaluate(s))],tan:[Nt,[Nt],(s,[e])=>Math.tan(e.evaluate(s))],asin:[Nt,[Nt],(s,[e])=>Math.asin(e.evaluate(s))],acos:[Nt,[Nt],(s,[e])=>Math.acos(e.evaluate(s))],atan:[Nt,[Nt],(s,[e])=>Math.atan(e.evaluate(s))],min:[Nt,Ko(Nt),(s,e)=>Math.min(...e.map(i=>i.evaluate(s)))],max:[Nt,Ko(Nt),(s,e)=>Math.max(...e.map(i=>i.evaluate(s)))],abs:[Nt,[Nt],(s,[e])=>Math.abs(e.evaluate(s))],round:[Nt,[Nt],(s,[e])=>{const i=e.evaluate(s);return i<0?-Math.round(-i):Math.round(i)}],floor:[Nt,[Nt],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[Nt,[Nt],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[Pi,[Ci,Di],(s,[e,i])=>s.properties()[e.value]===i.value],"filter-id-==":[Pi,[Di],(s,[e])=>s.id()===e.value],"filter-type-==":[Pi,[Ci],(s,[e])=>s.geometryType()===e.value],"filter-<":[Pi,[Ci,Di],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o<h}],"filter-id-<":[Pi,[Di],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Pi,[Ci,Di],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o>h}],"filter-id->":[Pi,[Di],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Pi,[Ci,Di],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[Pi,[Di],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Pi,[Ci,Di],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[Pi,[Di],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Pi,[Di],(s,[e])=>e.value in s.properties()],"filter-has-id":[Pi,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Pi,[Pn(Ci)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[Pi,[Pn(Di)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[Pi,[Ci,Pn(Di)],(s,[e,i])=>i.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[Pi,[Ci,Pn(Di)],(s,[e,i])=>function(o,h,l,d){for(;l<=d;){const g=l+d>>1;if(h[g]===o)return!0;h[g]>o?d=g-1:l=g+1}return!1}(s.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Pi,overloads:[[[Pi,Pi],(s,[e,i])=>e.evaluate(s)&&i.evaluate(s)],[Ko(Pi),(s,e)=>{for(const i of e)if(!i.evaluate(s))return!1;return!0}]]},any:{type:Pi,overloads:[[[Pi,Pi],(s,[e,i])=>e.evaluate(s)||i.evaluate(s)],[Ko(Pi),(s,e)=>{for(const i of e)if(i.evaluate(s))return!0;return!1}]]},"!":[Pi,[Pi],(s,[e])=>!e.evaluate(s)],"is-supported-script":[Pi,[Ci],(s,[e])=>{const i=s.globals&&s.globals.isSupportedScript;return!i||i(e.evaluate(s))}],upcase:[Ci,[Ci],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[Ci,[Ci],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[Ci,Ko(Di),(s,e)=>e.map(i=>Ln(i.evaluate(s))).join("")],"resolved-locale":[Ci,[zc],(s,[e])=>e.evaluate(s).resolvedLocale()],random:[Nt,[Nt,Nt,Di],(s,e)=>{const[i,o,h]=e.map(d=>d.evaluate(s));if(i>o||i===o)return i;let l;if(typeof h=="string")l=function(d){let g=0;if(d.length===0)return g;for(let b=0;b<d.length;b++)g=(g<<5)-g+d.charCodeAt(b),g|=0;return g}(h);else{if(typeof h!="number")throw new rn(`Invalid seed input: ${h}`);l=h}return i+iu(l)()*(o-i)}]});class su{constructor(e,i,o,h){this.expression=e,this._warningHistory={},this._evaluator=new kf(o,h),this._defaultValue=i?function(l){return l.type==="color"&&(nu(l.default)||Array.isArray(l.default))?new Hi(0,0,0,0):l.type==="color"?Hi.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,o,h,l,d,g,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=h||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,h,l,d,g,b){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new rn(`Expected value to be one of ${Object.keys(this._enumValues).map(m=>JSON.stringify(m)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${S.message}`)),this._defaultValue}}}function ou(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in ja}function Hl(s,e,i,o){const h=new Zf(ja,[],e?function(d){const g={color:jn,string:Ci,number:Nt,enum:Ci,boolean:Pi,formatted:Sa,resolvedImage:Aa};return d.type==="array"?Pn(g[d.value]||Di,d.length):g[d.type]}(e):void 0,void 0,void 0,i,o),l=h.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?lp(new su(l,e,i,o)):Ao(h.errors)}class Wh{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isStateDependent=e!=="constant"&&!Xc(i.expression),this.configDependencies=Yc(i.expression)}evaluateWithoutErrorHandling(e,i,o,h,l,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,h,l,d)}evaluate(e,i,o,h,l,d){return this._styleExpression.evaluate(e,i,o,h,l,d)}}class Us{constructor(e,i,o,h,l){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Xc(i.expression),this.isLightConstant=l,this.configDependencies=Yc(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,o,h,l,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,h,l,d)}evaluate(e,i,o,h,l,d){return this._styleExpression.evaluate(e,i,o,h,l,d)}interpolationFactor(e,i,o){return this.interpolationType?is.interpolationFactor(this.interpolationType,e,i,o):0}}function pp(s,e,i,o){if((s=Hl(s,e,i,o)).result==="error")return s;const h=s.value.expression,l=Bl(h);if(!l&&!ru(e))return Ao([new Bs("","data expressions not supported")]);const d=Nl(h,["zoom","pitch","distance-from-center"]);if(!d&&!cp(e))return Ao([new Bs("","zoom expressions not supported")]);const g=Nl(h,["measure-light"]);if(!g&&!qh(e))return Ao([new Bs("","measure-light expression not supported")]);const b=e.expression&&e.expression.relaxZoomRestriction,S=lu(h);return S||d||b?S instanceof Bs?Ao([S]):S instanceof is&&!Hh(e)?Ao([new Bs("",'"interpolate" expressions cannot be used with this property')]):lp(S?new Us(l?"camera":"composite",s.value,S.labels,S instanceof is?S.interpolation:void 0,g):new Wh(l?"constant":"source",s.value,g)):Ao([new Bs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class au{constructor(e,i){this._parameters=e,this._specification=i,Ea(this,hp(this._parameters,this._specification))}static deserialize(e){return new au(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function lu(s){let e=null;if(s instanceof Qc)e=lu(s.result);else if(s instanceof Jc){for(const i of s.args)if(e=lu(i),e)break}else(s instanceof Ul||s instanceof is)&&s.input instanceof Gn&&s.input.name==="zoom"&&(e=s);return e instanceof Bs||s.eachChild(i=>{const o=lu(i);o instanceof Bs?e=o:e&&o&&e!==o&&(e=new Bs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var cu,Zh,mp=function(){if(Zh)return cu;Zh=1,cu=e;var s=3;function e(i,o,h){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var d=new Int32Array(this.arrayBuffer);i=d[0],this.d=(o=d[1])+2*(h=d[2]);for(var g=0;g<this.d*this.d;g++){var b=d[s+g],S=d[s+g+1];l.push(b===S?null:d.subarray(b,S))}var m=d[s+l.length+1];this.keys=d.subarray(d[s+l.length],m),this.bboxes=d.subarray(m),this.insert=this._insertReadonly}else{this.d=o+2*h;for(var x=0;x<this.d*this.d;x++)l.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=h,this.scale=o/i,this.uid=0;var E=h/o*i;this.min=-E,this.max=i+E}return e.prototype.insert=function(i,o,h,l,d){this._forEachCell(o,h,l,d,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(l),this.bboxes.push(d)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,h,l,d,g){this.cells[d].push(g)},e.prototype.query=function(i,o,h,l,d){var g=this.min,b=this.max;if(i<=g&&o<=g&&b<=h&&b<=l&&!d)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(i,o,h,l,this._queryCell,S,{},d),S},e.prototype._queryCell=function(i,o,h,l,d,g,b,S){var m=this.cells[d];if(m!==null)for(var x=this.keys,E=this.bboxes,v=0;v<m.length;v++){var w=m[v];if(b[w]===void 0){var M=4*w;(S?S(E[M+0],E[M+1],E[M+2],E[M+3]):i<=E[M+2]&&o<=E[M+3]&&h>=E[M+0]&&l>=E[M+1])?(b[w]=!0,g.push(x[w])):b[w]=!1}}},e.prototype._forEachCell=function(i,o,h,l,d,g,b,S){for(var m=this._convertToCellCoord(i),x=this._convertToCellCoord(o),E=this._convertToCellCoord(h),v=this._convertToCellCoord(l),w=m;w<=E;w++)for(var M=x;M<=v;M++){var R=this.d*M+w;if((!S||S(this._convertFromCellCoord(w),this._convertFromCellCoord(M),this._convertFromCellCoord(w+1),this._convertFromCellCoord(M+1)))&&d.call(this,i,o,h,l,R,g,b,S))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=s+this.cells.length+1+1,h=0,l=0;l<this.cells.length;l++)h+=this.cells[l].length;var d=new Int32Array(o+h+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var g=o,b=0;b<i.length;b++){var S=i[b];d[s+b]=g,d.set(S,g),g+=S.length}return d[s+i.length]=g,d.set(this.keys,g),d[s+i.length+1]=g+=this.keys.length,d.set(this.bboxes,g),g+=this.bboxes.length,d.buffer},cu}(),Jo=ne(mp);const Ga={};function Ft(s,e,i={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writable:!1}),Ga[e]={klass:s,omit:i.omit||[]}}Ft(Object,"Object"),Jo.serialize=function(s,e){const i=s.toArrayBuffer();return e&&e.add(i),{buffer:i}},Jo.deserialize=function(s){return new Jo(s.buffer)},Object.defineProperty(Jo,"name",{value:"Grid"}),Ft(Jo,"Grid"),Ft(Hi,"Color"),Ft(Error,"Error"),Ft(Tn,"Formatted"),Ft(Jn,"FormattedSection"),Ft(dh,"AJAXError"),Ft(Rn,"ResolvedImage"),Ft(au,"StylePropertyFunction"),Ft(su,"StyleExpression",{omit:["_evaluator"]}),Ft(Us,"ZoomDependentExpression"),Ft(Wh,"ZoomConstantExpression"),Ft(Gn,"CompoundExpression",{omit:["_evaluate"]});for(const s in ja)Ga[ja[s]._classRegistryKey]||Ft(ja[s],`Expression${s}`);function Xh(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function _p(s){return self.ImageBitmap&&s instanceof ImageBitmap}function $n(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Xh(s)||_p(s))return e&&e.add(s),s;if(ArrayBuffer.isView(s)){const i=s;return e&&e.add(i.buffer),i}if(s instanceof ImageData)return e&&e.add(s.data.buffer),s;if(Array.isArray(s)){const i=[];for(const o of s)i.push($n(o,e));return i}if(s instanceof Map){const i={$name:"Map"};for(const[o,h]of s.entries())i[o]=$n(h);return i}if(s instanceof Set){const i={$name:"Set"};let o=0;for(const h of s.values())i[++o]=$n(h);return i}if(typeof s=="object"){const i=s.constructor,o=i._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);const h=i.serialize?i.serialize(s,e):{};if(!i.serialize){for(const l in s)s.hasOwnProperty(l)&&(Ga[o].omit.indexOf(l)>=0||(h[l]=$n(s[l],e)));s instanceof Error&&(h.message=s.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(h.$name=o),h}throw new Error("can't serialize object of type "+typeof s)}function Qo(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Xh(s)||_p(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Qo);if(typeof s=="object"){const e=s.$name||"Object";if(e==="Map"){const h=new Map;for(const l of Object.keys(s))l!=="$name"&&h.set(l,Qo(s[l]));return h}if(e==="Set"){const h=new Set;for(const l of Object.keys(s))l!=="$name"&&h.add(Qo(s[l]));return h}const{klass:i}=Ga[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(s);const o=Object.create(i.prototype);for(const h of Object.keys(s))h!=="$name"&&(o[h]=Qo(s[h]));return o}throw new Error("can't deserialize object of type "+typeof s)}const Gt={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function uu(s){for(const e of s)if(du(e.charCodeAt(0)))return!0;return!1}function I_(s){for(const e of s)if(!hu(e.charCodeAt(0)))return!1;return!0}function hu(s){return!(Gt.Arabic(s)||Gt["Arabic Supplement"](s)||Gt["Arabic Extended-A"](s)||Gt["Arabic Presentation Forms-A"](s)||Gt["Arabic Presentation Forms-B"](s))}function du(s){return!(s!==746&&s!==747&&(s<4352||!(Gt["Bopomofo Extended"](s)||Gt.Bopomofo(s)||Gt["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Gt["CJK Compatibility Ideographs"](s)||Gt["CJK Compatibility"](s)||Gt["CJK Radicals Supplement"](s)||Gt["CJK Strokes"](s)||!(!Gt["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Gt["CJK Unified Ideographs Extension A"](s)||Gt["CJK Unified Ideographs"](s)||Gt["Enclosed CJK Letters and Months"](s)||Gt["Hangul Compatibility Jamo"](s)||Gt["Hangul Jamo Extended-A"](s)||Gt["Hangul Jamo Extended-B"](s)||Gt["Hangul Jamo"](s)||Gt["Hangul Syllables"](s)||Gt.Hiragana(s)||Gt["Ideographic Description Characters"](s)||Gt.Kanbun(s)||Gt["Kangxi Radicals"](s)||Gt["Katakana Phonetic Extensions"](s)||Gt.Katakana(s)&&s!==12540||!(!Gt["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Gt["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Gt["Unified Canadian Aboriginal Syllabics"](s)||Gt["Unified Canadian Aboriginal Syllabics Extended"](s)||Gt["Vertical Forms"](s)||Gt["Yijing Hexagram Symbols"](s)||Gt["Yi Syllables"](s)||Gt["Yi Radicals"](s))))}function Wl(s){return!(du(s)||function(e){return!!(Gt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Gt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Gt["Letterlike Symbols"](e)||Gt["Number Forms"](e)||Gt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Gt["Control Pictures"](e)&&e!==9251||Gt["Optical Character Recognition"](e)||Gt["Enclosed Alphanumerics"](e)||Gt["Geometric Shapes"](e)||Gt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Gt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Gt["CJK Symbols and Punctuation"](e)||Gt.Katakana(e)||Gt["Private Use Area"](e)||Gt["CJK Compatibility Forms"](e)||Gt["Small Form Variants"](e)||Gt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function Yh(s){return s>=1424&&s<=2303||Gt["Arabic Presentation Forms-A"](s)||Gt["Arabic Presentation Forms-B"](s)}function M_(s,e){return!(!e&&Yh(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Gt.Khmer(s))}function C_(s){for(const e of s)if(Yh(e.charCodeAt(0)))return!0;return!1}const Zl="deferred",Xl="loading",fu="loaded";let $a=null,an="unavailable",Io=null;const gp=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(an="error"),$a&&$a(s)};function Kh(){Jh.fire(new bo("pluginStateChange",{pluginStatus:an,pluginURL:Io}))}const Jh=new Ta,Qh=function(){return an},ed=function(){if(an!==Zl||!Io)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");an=Xl,Kh(),Io&&ba({url:Io},s=>{s?gp(s):(an=fu,Kh())})},qn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>an===fu||qn.applyArabicShaping!=null,isLoading:()=>an===Xl,setState(s){an=s.pluginStatus,Io=s.pluginURL},isParsed:()=>qn.applyArabicShaping!=null&&qn.processBidirectionalText!=null&&qn.processStyledBidirectionalText!=null,getPluginURL:()=>Io};class Ar{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const h of i)if(!M_(h.charCodeAt(0),o))return!1;return!0}(e,qn.isLoaded())}}class pu{constructor(e,i,o,h){this.property=e,this.value=i,this.expression=function(l,d,g,b){if(nu(l))return new au(l,d);if(ou(l)||Array.isArray(l)&&l.length>0){const S=pp(l,d,g,b);if(S.result==="error")throw new Error(S.value.map(m=>`${m.key}: ${m.message}`).join(", "));return S.value}{let S=l;return typeof l=="string"&&d.type==="color"&&(S=Hi.parse(l)),{kind:"constant",configDependencies:new Set,evaluate:()=>S}}}(i===void 0?e.specification.default:i,e.specification,o,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class td{constructor(e,i,o){this.property=e,this.value=new pu(e,void 0,i,o)}transitioned(e,i){return new xp(this.property,this.value,i,Si({},e.transition,this.transition),e.now)}untransitioned(){return new xp(this.property,this.value,null,{},0)}}class yp{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return jr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new td(this._values[e].property,this._scope,this._options)),this._values[e].value=new pu(this._values[e].property,i===null?void 0:jr(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const h in e){const l=e[h];if(Cn(h,"-transition")){const d=h.slice(0,-11);o[d]&&this.setTransition(d,l)}else o.hasOwnProperty(h)&&this.setValue(h,l)}}getTransition(e){return jr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new td(this._values[e].property)),this._values[e].transition=jr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const o=new vp(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(e,i._values[h]);return o}untransitioned(){const e=new vp(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class xp{constructor(e,i,o,h,l){const d=h.delay||0,g=h.duration||0;l=l||0,this.property=e,this.value=i,this.begin=l+d,this.end=this.begin+g,e.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const h=e.now||0,l=this.value.possiblyEvaluate(e,i,o),d=this.prior;if(d){if(h>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(h<this.begin)return d.possiblyEvaluate(e,i,o);{const g=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,i,o),l,It(g))}}return l}}class vp{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const h=new Ha(this._properties);for(const l of Object.keys(this._values))h._values[l]=this._values[l].possiblyEvaluate(e,i,o);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class P_{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return jr(this._values[e].value)}setValue(e,i){this._values[e]=new pu(this._values[e].property,i===null?void 0:jr(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const h=new Ha(this._properties);for(const l of Object.keys(this._values))h._values[l]=this._values[l].possiblyEvaluate(e,i,o);return h}}class qa{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,h){return this.property.evaluate(this.value,this.parameters,e,i,o,h)}}class Ha{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class bt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const h=Ho[this.specification.type];return h?h(e,i,o):e}}class qt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,h){return new qa(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,h)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new qa(this,{kind:"constant",value:void 0},e.parameters);const h=Ho[this.specification.type];return h?new qa(this,{kind:"constant",value:h(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,h,l,d){return e.kind==="constant"?e.value:e.evaluate(i,o,h,l,d)}}class Ss{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,h){return!!e.expression.evaluate(i,null,{},o,h)}interpolate(){return!1}}class pr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Ar(0,{});for(const o in e){const h=e[o];h.specification.overridable&&this.overridableProperties.push(o);const l=this.defaultPropertyValues[o]=new pu(h,void 0),d=this.defaultTransitionablePropertyValues[o]=new td(h);this.defaultTransitioningPropertyValues[o]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=l.possiblyEvaluate(i)}}}Ft(qt,"DataDrivenProperty"),Ft(bt,"DataConstantProperty"),Ft(Ss,"ColorRampProperty");var Ue=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Yl(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function mu(s){if(Array.isArray(s))return s.map(mu);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const i in s)e[i]=mu(s[i]);return e}return Yl(s)}function id(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!id(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function As(s,e="",i=null,o="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};id(s)||(s=_u(s));const h=s;let l=!0;try{l=function(x){if(!Wa(x))return x;let E=mu(x);return ea(E),E=rd(E),E}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}const d=Ue[`filter_${o}`],g=Hl(l,d,e,i);let b=null;if(g.result==="error")throw new Error(g.value.map(x=>`${x.key}: ${x.message}`).join(", "));b=(x,E,v)=>g.value.evaluate(x,E,{},v);let S=null,m=null;if(l!==h){const x=Hl(h,d,e,i);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));S=(E,v,w,M,R)=>x.value.evaluate(E,v,{},w,void 0,void 0,M,R),m=!Bl(x.value.expression)}return{filter:b,dynamicFilter:S||void 0,needGeometry:bp(l),needFeature:!!m}}function rd(s){if(!Array.isArray(s))return s;const e=function(i){if(R_.has(i[0])){for(let o=1;o<i.length;o++)if(Wa(i[o]))return!0}return i}(s);return e===!0?e:e.map(i=>rd(i))}function ea(s){let e=!1;const i=[];if(s[0]==="case"){for(let o=1;o<s.length-1;o+=2)e=e||Wa(s[o]),i.push(s[o+1]);i.push(s[s.length-1])}else if(s[0]==="match"){e=e||Wa(s[1]);for(let o=2;o<s.length-1;o+=2)i.push(s[o+1]);i.push(s[s.length-1])}else if(s[0]==="step"){e=e||Wa(s[1]);for(let o=1;o<s.length-1;o+=2)i.push(s[o+1])}e&&(s.length=0,s.push("any",...i));for(let o=1;o<s.length;o++)ea(s[o])}function Wa(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<s.length;i++)if(Wa(s[i]))return!0;return!1}const R_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function L_(s,e){return s<e?-1:s>e?1:0}function bp(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(bp(s[e]))return!0;return!1}function _u(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?gu(s[1],s[2],"=="):e==="!="?Jl(gu(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?gu(s[1],s[2],e):e==="any"?(i=s.slice(1),["any"].concat(i.map(_u))):e==="all"?["all"].concat(s.slice(1).map(_u)):e==="none"?["all"].concat(s.slice(1).map(_u).map(Jl)):e==="in"?yu(s[1],s.slice(2)):e==="!in"?Jl(yu(s[1],s.slice(2))):e==="has"?Kl(s[1]):e!=="!has"||Jl(Kl(s[1]));var i}function gu(s,e,i){switch(s){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,s,e]}}function yu(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",s,["literal",e.sort(L_)]]:["filter-in-small",s,["literal",e]]}}function Kl(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Jl(s){return["!",s]}const Za="";function wp(s,e){return e?`${s}${Za}${e}`:s}const Is="-transition",D_=new Set(["fill","line","background","hillshade","raster"]);class En extends Ta{constructor(e,i,o,h,l){if(super(),this.id=e.id,this.fqid=wp(this.id,o),this.type=e.type,this.scope=o,this.lut=h,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new P_(i.layout,this.scope,l),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint)){this._transitionablePaint=new yp(i.paint,this.scope,l);for(const d in e.paint)this.setPaintProperty(d,e.paint[d]);for(const d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ha(i.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&D_.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Cn(e,Is)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,h=o._properties.properties;if(Cn(e,Is)){const x=e.slice(0,-11);return h[x]&&o.setTransition(x,i||void 0),!1}if(!h[e])return!1;const l=o._values[e],d=l.value.isDataDriven(),g=l.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const b=o._values[e].value,S=b.isDataDriven(),m=Cn(e,"pattern")||e==="line-dasharray";return S||d||m||this._handleOverridablePaintPropertyUpdate(e,g,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return tn({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof qa&&ru(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=As(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,h,l,d,g,b,S){}queryIntersectsMatchingFeature(e,i,o,h){}}const z_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ql{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Bi(s,e=1){let i=0,o=0;return{members:s.map(h=>{const l=z_[h.type].BYTES_PER_ELEMENT,d=i=Tp(i,Math.max(e,l)),g=h.components||1;return o=Math.max(o,l),i+=l*g,{name:h.name,type:h.type,components:g,offset:d}}),size:Tp(i,Math.max(o,e)),alignment:e}}function Tp(s,e){return Math.ceil(s/e)*e}class Mo extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=o,e}}Mo.prototype.bytesPerElement=4,Ft(Mo,"StructArrayLayout2i4");class xu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const l=3*e;return this.int16[l+0]=i,this.int16[l+1]=o,this.int16[l+2]=h,e}}xu.prototype.bytesPerElement=6,Ft(xu,"StructArrayLayout3i6");class Co extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,h)}emplace(e,i,o,h,l){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=h,this.int16[d+3]=l,e}}Co.prototype.bytesPerElement=8,Ft(Co,"StructArrayLayout4i8");class vu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,h,l)}emplace(e,i,o,h,l,d){const g=5*e;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=h,this.int16[g+3]=l,this.int16[g+4]=d,e}}vu.prototype.bytesPerElement=10,Ft(vu,"StructArrayLayout5i10");class nd extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,h,l,d,g)}emplace(e,i,o,h,l,d,g,b){const S=6*e,m=12*e,x=3*e;return this.int16[S+0]=i,this.int16[S+1]=o,this.uint8[m+4]=h,this.uint8[m+5]=l,this.uint8[m+6]=d,this.uint8[m+7]=g,this.float32[x+2]=b,e}}nd.prototype.bytesPerElement=12,Ft(nd,"StructArrayLayout2i4ub1f12");class ro extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,h)}emplace(e,i,o,h,l){const d=4*e;return this.float32[d+0]=i,this.float32[d+1]=o,this.float32[d+2]=h,this.float32[d+3]=l,e}}ro.prototype.bytesPerElement=16,Ft(ro,"StructArrayLayout4f16");class Po extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const l=3*e;return this.float32[l+0]=i,this.float32[l+1]=o,this.float32[l+2]=h,e}}Po.prototype.bytesPerElement=12,Ft(Po,"StructArrayLayout3f12");class no extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,h,l)}emplace(e,i,o,h,l,d){const g=6*e,b=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=o,this.uint16[g+2]=h,this.uint16[g+3]=l,this.float32[b+2]=d,e}}no.prototype.bytesPerElement=12,Ft(no,"StructArrayLayout4ui1f12");class ta extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,h)}emplace(e,i,o,h,l){const d=4*e;return this.uint16[d+0]=i,this.uint16[d+1]=o,this.uint16[d+2]=h,this.uint16[d+3]=l,e}}ta.prototype.bytesPerElement=8,Ft(ta,"StructArrayLayout4ui8");class bu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,h,l,d)}emplace(e,i,o,h,l,d,g){const b=6*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=h,this.int16[b+3]=l,this.int16[b+4]=d,this.int16[b+5]=g,e}}bu.prototype.bytesPerElement=12,Ft(bu,"StructArrayLayout6i12");class sd extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d,g,b,S,m,x,E){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,o,h,l,d,g,b,S,m,x,E)}emplace(e,i,o,h,l,d,g,b,S,m,x,E,v){const w=12*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=h,this.int16[w+3]=l,this.uint16[w+4]=d,this.uint16[w+5]=g,this.uint16[w+6]=b,this.uint16[w+7]=S,this.int16[w+8]=m,this.int16[w+9]=x,this.int16[w+10]=E,this.int16[w+11]=v,e}}sd.prototype.bytesPerElement=24,Ft(sd,"StructArrayLayout4i4ui4i24");class od extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,h,l,d)}emplace(e,i,o,h,l,d,g){const b=10*e,S=5*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=h,this.float32[S+2]=l,this.float32[S+3]=d,this.float32[S+4]=g,e}}od.prototype.bytesPerElement=20,Ft(od,"StructArrayLayout3i3f20");class ad extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}ad.prototype.bytesPerElement=4,Ft(ad,"StructArrayLayout1ul4");class Ro extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=o,e}}Ro.prototype.bytesPerElement=4,Ft(Ro,"StructArrayLayout2ui4");class Xa extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d,g,b,S,m,x,E,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,l,d,g,b,S,m,x,E,v)}emplace(e,i,o,h,l,d,g,b,S,m,x,E,v,w){const M=20*e,R=10*e;return this.int16[M+0]=i,this.int16[M+1]=o,this.int16[M+2]=h,this.int16[M+3]=l,this.int16[M+4]=d,this.float32[R+3]=g,this.float32[R+4]=b,this.float32[R+5]=S,this.float32[R+6]=m,this.int16[M+14]=x,this.uint32[R+8]=E,this.uint16[M+18]=v,this.uint16[M+19]=w,e}}Xa.prototype.bytesPerElement=40,Ft(Xa,"StructArrayLayout5i4f1i1ul2ui40");class ia extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,h,l,d,g)}emplace(e,i,o,h,l,d,g,b){const S=8*e;return this.int16[S+0]=i,this.int16[S+1]=o,this.int16[S+2]=h,this.int16[S+4]=l,this.int16[S+5]=d,this.int16[S+6]=g,this.int16[S+7]=b,e}}ia.prototype.bytesPerElement=16,Ft(ia,"StructArrayLayout3i2i2i16");class Dn extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,h,l)}emplace(e,i,o,h,l,d){const g=4*e,b=8*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=h,this.int16[b+6]=l,this.int16[b+7]=d,e}}Dn.prototype.bytesPerElement=16,Ft(Dn,"StructArrayLayout2f1f2i16");class Ya extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,h,l,d)}emplace(e,i,o,h,l,d,g){const b=20*e,S=5*e;return this.uint8[b+0]=i,this.uint8[b+1]=o,this.float32[S+1]=h,this.float32[S+2]=l,this.float32[S+3]=d,this.float32[S+4]=g,e}}Ya.prototype.bytesPerElement=20,Ft(Ya,"StructArrayLayout2ub4f20");class fn extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const l=3*e;return this.uint16[l+0]=i,this.uint16[l+1]=o,this.uint16[l+2]=h,e}}fn.prototype.bytesPerElement=6,Ft(fn,"StructArrayLayout3ui6");class ld extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d,g,b,S,m,x,E,v,w,M,R,z,U,j,k,G){const $=this.length;return this.resize($+1),this.emplace($,e,i,o,h,l,d,g,b,S,m,x,E,v,w,M,R,z,U,j,k,G)}emplace(e,i,o,h,l,d,g,b,S,m,x,E,v,w,M,R,z,U,j,k,G,$){const K=30*e,te=15*e,re=60*e;return this.int16[K+0]=i,this.int16[K+1]=o,this.int16[K+2]=h,this.float32[te+2]=l,this.float32[te+3]=d,this.uint16[K+8]=g,this.uint16[K+9]=b,this.uint32[te+5]=S,this.uint32[te+6]=m,this.uint32[te+7]=x,this.uint16[K+16]=E,this.uint16[K+17]=v,this.uint16[K+18]=w,this.float32[te+10]=M,this.float32[te+11]=R,this.uint8[re+48]=z,this.uint8[re+49]=U,this.uint8[re+50]=j,this.uint32[te+13]=k,this.int16[K+28]=G,this.uint8[re+58]=$,e}}ld.prototype.bytesPerElement=60,Ft(ld,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class cd extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d,g,b,S,m,x,E,v,w,M,R,z,U,j,k,G,$,K,te,re,Q,de,oe,pe,Ee,Ce,Pe){const Re=this.length;return this.resize(Re+1),this.emplace(Re,e,i,o,h,l,d,g,b,S,m,x,E,v,w,M,R,z,U,j,k,G,$,K,te,re,Q,de,oe,pe,Ee,Ce,Pe)}emplace(e,i,o,h,l,d,g,b,S,m,x,E,v,w,M,R,z,U,j,k,G,$,K,te,re,Q,de,oe,pe,Ee,Ce,Pe,Re){const je=20*e,De=40*e,tt=80*e;return this.float32[je+0]=i,this.float32[je+1]=o,this.int16[De+4]=h,this.int16[De+5]=l,this.int16[De+6]=d,this.int16[De+7]=g,this.int16[De+8]=b,this.int16[De+9]=S,this.int16[De+10]=m,this.int16[De+11]=x,this.int16[De+12]=E,this.uint16[De+13]=v,this.uint16[De+14]=w,this.uint16[De+15]=M,this.uint16[De+16]=R,this.uint16[De+17]=z,this.uint16[De+18]=U,this.uint16[De+19]=j,this.uint16[De+20]=k,this.uint16[De+21]=G,this.uint16[De+22]=$,this.uint16[De+23]=K,this.uint16[De+24]=te,this.uint16[De+25]=re,this.uint16[De+26]=Q,this.uint16[De+27]=de,this.uint32[je+14]=oe,this.float32[je+15]=pe,this.float32[je+16]=Ee,this.float32[je+17]=Ce,this.float32[je+18]=Pe,this.uint8[tt+76]=Re,e}}cd.prototype.bytesPerElement=80,Ft(cd,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ka extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ka.prototype.bytesPerElement=4,Ft(Ka,"StructArrayLayout1f4");class so extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,h,l)}emplace(e,i,o,h,l,d){const g=5*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=h,this.float32[g+3]=l,this.float32[g+4]=d,e}}so.prototype.bytesPerElement=20,Ft(so,"StructArrayLayout5f20");class ud extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,h,l,d,g)}emplace(e,i,o,h,l,d,g,b){const S=7*e;return this.float32[S+0]=i,this.float32[S+1]=o,this.float32[S+2]=h,this.float32[S+3]=l,this.float32[S+4]=d,this.float32[S+5]=g,this.float32[S+6]=b,e}}ud.prototype.bytesPerElement=28,Ft(ud,"StructArrayLayout7f28");class ec extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,h)}emplace(e,i,o,h,l){const d=6*e;return this.uint32[3*e+0]=i,this.uint16[d+2]=o,this.uint16[d+3]=h,this.uint16[d+4]=l,e}}ec.prototype.bytesPerElement=12,Ft(ec,"StructArrayLayout1ul3ui12");class hd extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}hd.prototype.bytesPerElement=2,Ft(hd,"StructArrayLayout1ui2");class tc extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=o,e}}tc.prototype.bytesPerElement=8,Ft(tc,"StructArrayLayout2f8");class ic extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d,g,b,S,m,x,E,v,w,M,R){const z=this.length;return this.resize(z+1),this.emplace(z,e,i,o,h,l,d,g,b,S,m,x,E,v,w,M,R)}emplace(e,i,o,h,l,d,g,b,S,m,x,E,v,w,M,R,z){const U=16*e;return this.float32[U+0]=i,this.float32[U+1]=o,this.float32[U+2]=h,this.float32[U+3]=l,this.float32[U+4]=d,this.float32[U+5]=g,this.float32[U+6]=b,this.float32[U+7]=S,this.float32[U+8]=m,this.float32[U+9]=x,this.float32[U+10]=E,this.float32[U+11]=v,this.float32[U+12]=w,this.float32[U+13]=M,this.float32[U+14]=R,this.float32[U+15]=z,e}}ic.prototype.bytesPerElement=64,Ft(ic,"StructArrayLayout16f64");class wu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,d,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,h,l,d,g)}emplace(e,i,o,h,l,d,g,b){const S=10*e,m=5*e;return this.uint16[S+0]=i,this.uint16[S+1]=o,this.uint16[S+2]=h,this.uint16[S+3]=l,this.float32[m+2]=d,this.float32[m+3]=g,this.float32[m+4]=b,e}}wu.prototype.bytesPerElement=20,Ft(wu,"StructArrayLayout4ui3f20");class Tu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Tu.prototype.bytesPerElement=2,Ft(Tu,"StructArrayLayout1i2");class Eu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Eu.prototype.bytesPerElement=1,Ft(Eu,"StructArrayLayout1ub1");class Ep extends Ql{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ep.prototype.size=40;class Su extends Xa{get(e){return new Ep(this,e)}}Ft(Su,"CollisionBoxArray");class rc extends Ql{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}rc.prototype.size=60;class dd extends ld{get(e){return new rc(this,e)}}Ft(dd,"PlacedSymbolArray");class Sp extends Ql{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Sp.prototype.size=80;class fd extends cd{get(e){return new Sp(this,e)}}Ft(fd,"SymbolInstanceArray");class Ap extends Ka{getoffsetX(e){return this.float32[1*e+0]}}Ft(Ap,"GlyphOffsetArray");class Au extends Mo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ft(Au,"SymbolLineVertexArray");class Ip extends Ql{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ip.prototype.size=12;class Mp extends ec{get(e){return new Ip(this,e)}}Ft(Mp,"FeatureIndexArray");class Cp extends Ro{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ft(Cp,"FillExtrusionCentroidArray");class Pp extends Ql{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Pp.prototype.size=6;class pd extends xu{get(e){return new Pp(this,e)}}Ft(pd,"FillExtrusionWallArray");const O_=Bi([{name:"a_pos",components:2,type:"Int16"}],4),k_=Bi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ir{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,h){let l=this.segments[this.segments.length-1];return e>Ir.MAX_VERTEX_ARRAY_LENGTH&&ki(`Max vertices per segment is ${Ir.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>Ir.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==h)&&(l={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},h!==void 0&&(l.sortKey=h),this.segments.push(l)),l}prepareSegment(e,i,o,h){return this._prepareSegment(e,i.length,o.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,h){return new Ir([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function Rp(s,e){return 256*(s=$e(Math.floor(s),0,255))+$e(Math.floor(e),0,255)}Ir.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ft(Ir,"SegmentVector");const F_=Bi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),B_=Bi([{name:"a_dash",components:4,type:"Uint16"}]);class nc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,h){this.ids.push(Lp(e)),this.positions.push(i,o,h)}eachPosition(e,i){const o=Lp(e);let h=0,l=this.ids.length-1;for(;h<l;){const d=h+l>>1;this.ids[d]>=o?l=d:h=d+1}for(;this.ids[h]===o;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,i){const o=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Ja(o,h,0,o.length-1),i&&(i.add(o.buffer),i.add(h.buffer)),{ids:o,positions:h}}static deserialize(e){const i=new nc;let o;i.ids=e.ids,i.positions=e.positions;for(const h of i.ids)h!==o&&i.uniqueIds.push(h),o=h;return i.indexed=!0,i}}function Lp(s){const e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Vn(String(s))}function Ja(s,e,i,o){for(;i<o;){const h=s[i+o>>1];let l=i-1,d=o+1;for(;;){do l++;while(s[l]<h);do d--;while(s[d]>h);if(l>=d)break;Iu(s,l,d),Iu(e,3*l,3*d),Iu(e,3*l+1,3*d+1),Iu(e,3*l+2,3*d+2)}d-i<o-d?(Ja(s,e,i,d),i=d+1):(Ja(s,e,d+1,o),o=d)}}function Iu(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}Ft(nc,"FeaturePositionMap");class oo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class ra extends oo{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Sn extends oo{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Vs extends oo{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class md extends oo{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class Mu extends oo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class _d extends oo{constructor(e){super(e),this.current=Hi.transparent.toRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const Dp=new Float32Array(16);class sc extends oo{constructor(e){super(e),this.current=Dp}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let h=1;h<16;h++)if(o[h]!==this.current[h]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const N_=new Float32Array(9),U_=new Float32Array(4);class gd extends oo{constructor(e){super(e),this.current=U_}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let h=0;h<4;h++)if(o[h]!==this.current[h]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function yd(s){return[Rp(255*s.r,255*s.g),Rp(255*s.b,255*s.a)]}class oc{constructor(e,i,o,h){this.value=e,this.uniformNames=i.map(l=>`u_${l}`),this.type=o,this.context=h}setUniform(e,i,o,h,l){const d=h.constantOr(this.value);i.set(e,l,d instanceof Hi?d.toRenderColor(this.context.lut):d)}getBinding(e,i){return this.type==="color"?new _d(e):new Sn(e)}}class Qa{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,o,h,l){const d=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;d&&i.set(e,l,d)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Mu(e):new Sn(e)}}class js{constructor(e,i,o,h){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(l=>({name:`a_${l}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,o,h,l,d,g){const b=this.paintVertexArray.length,S=this.expression.evaluate(new Ar(0,{brightness:d}),i,{},l,h,g);this.paintVertexArray.resize(e),this._setPaintValue(b,e,S,this.context)}updatePaintArray(e,i,o,h,l,d,g){const b=this.expression.evaluate({zoom:0,brightness:g},o,h,void 0,l);this._setPaintValue(e,i,b,this.context)}_setPaintValue(e,i,o,h){if(this.type==="color"){const l=yd(o.toRenderColor(h.lut));for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class rs{constructor(e,i,o,h,l,d){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=h,this.context=l,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,o,h,l,d,g){const b=this.expression.evaluate(new Ar(this.context.zoom,{brightness:d}),i,{},l,h,g),S=this.expression.evaluate(new Ar(this.context.zoom+1,{brightness:d}),i,{},l,h,g),m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(m,e,b,S,this.context)}updatePaintArray(e,i,o,h,l,d,g){const b=this.expression.evaluate({zoom:this.context.zoom,brightness:g},o,h,void 0,l),S=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g},o,h,void 0,l);this._setPaintValue(e,i,b,S,this.context)}_setPaintValue(e,i,o,h,l){if(this.type==="color"){const d=yd(o.toRenderColor(l.lut)),g=yd(o.toRenderColor(l.lut));for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,d[0],d[1],g[0],g[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,h,l){const d=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=$e(this.expression.interpolationFactor(d,this.context.zoom,this.context.zoom+1),0,1);i.set(e,l,g)}getBinding(e,i){return new Sn(e)}}class Gs{constructor(e,i,o,h,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(o==="array"?B_:F_).members;for(let d=0;d<i.length;++d);this.paintVertexArray=new h}populatePaintArray(e,i,o,h){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,h,l,d,g){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],d)}_setPaintValues(e,i,o,h){if(!h||!o)return;const l=h[o];if(!l)return;const{tl:d,br:g,pixelRatio:b}=l;for(let S=e;S<i;S++)this.paintVertexArray.emplace(S,d[0],d[1],g[0],g[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class na{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const h=[];for(const l in e.paint._values){const d=e.paint.get(l);if(!o(l)||!(d instanceof qa&&ru(d.property.specification)))continue;const g=j_(l,e.type),b=d.value,S=d.property.specification.type,m=!!d.property.useIntegerZoom,x=l==="line-dasharray"||l.endsWith("pattern"),E=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||E)if(b.kind==="source"||E||x){const v=c(l,S,"source");this.binders[l]=x?new Gs(b,g,S,v,e.id):new js(b,g,S,v),h.push(`/a_${l}`)}else{const v=c(l,S,"composite");this.binders[l]=new rs(b,g,S,m,i,v),h.push(`/z_${l}`)}else this.binders[l]=x?new Qa(b.value,g):new oc(b.value,g,S,i),h.push(`/u_${l}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof js||i instanceof rs?i.maxValue:0}populatePaintArrays(e,i,o,h,l,d,g){for(const b in this.binders){const S=this.binders[b];S.context=this.context,(S instanceof js||S instanceof rs||S instanceof Gs)&&S.populatePaintArray(e,i,o,h,l,d,g)}}setConstantPatternPositions(e){for(const i in this.binders){const o=this.binders[i];o instanceof Qa&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,i,o,h,l,d,g,b){let S=!1;const m=Object.keys(e),x=m.length!==0,E=x?m:i.uniqueIds;this.context.lut=l.lut;for(const v in this.binders){const w=this.binders[v];if(w.context=this.context,(w instanceof js||w instanceof rs||w instanceof Gs)&&(w.expression.isStateDependent===!0||w.expression.isLightConstant===!1)){const M=l.paint.get(v);w.expression=M.value;for(const R of E){const z=e[R.toString()];i.eachPosition(R,(U,j,k)=>{const G=h.feature(U);w.updatePaintArray(j,k,G,z,d,g,b)})}if(!x)for(const R of o.uniqueIds){const z=e[R.toString()];o.eachPosition(R,(U,j,k)=>{const G=h.feature(U);w.updatePaintArray(j,k,G,z,d,g,b)})}S=!0}}return S}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof oc||o instanceof Qa)&&e.push(...o.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof js||o instanceof rs||o instanceof Gs)for(let h=0;h<o.paintVertexAttributes.length;h++)e.push(o.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof oc||o instanceof Qa||o instanceof rs)for(const h of o.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const h=this.binders[o];if(h instanceof oc||h instanceof Qa||h instanceof rs)for(const l of h.uniformNames)i.push({name:l,property:o,binding:h.getBinding(e,l)})}return i}setUniforms(e,i,o,h,l){for(const{name:d,property:g,binding:b}of o)this.binders[g].setUniform(e,b,l,h.get(g),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof js||i instanceof rs||i instanceof Gs)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof js||o instanceof rs||o instanceof Gs)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof js||i instanceof rs||i instanceof Gs)&&i.destroy()}}}class Lo{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new na(h,i,o);this.needsUpload=!1,this._featureMap=new nc,this._featureMapWithoutIds=new nc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,h,l,d,g,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,i,h,l,d,g,b);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,h,l,d){for(const g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,g,h,l,d||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const V_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function j_(s,e){return V_[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const G_={"line-pattern":{source:no,composite:no},"fill-pattern":{source:no,composite:no},"fill-extrusion-pattern":{source:no,composite:no},"line-dasharray":{source:ta,composite:ta}},zp={color:{source:tc,composite:ro},number:{source:Ka,composite:tc}};function c(s,e,i){const o=G_[s];return o&&o[i]||zp[e][i]}Ft(oc,"ConstantBinder"),Ft(Qa,"PatternConstantBinder"),Ft(js,"SourceExpressionBinder"),Ft(Gs,"PatternCompositeBinder"),Ft(rs,"CompositeExpressionBinder"),Ft(na,"ProgramConfiguration",{omit:["_buffers"]}),Ft(Lo,"ProgramConfigurationSet");const t=Mt/Math.PI/2,r=5,u=6,p=16383,_=64,y=[_,32,16],A=-t,C=t;function L(s,e,i,o=t){return i=_e(i),[s*Math.sin(i)*o,-e*o,s*Math.cos(i)*o]}function D(s,e,i){return L(Math.cos(_e(s)),Math.sin(_e(s)),e,i)}const F=63710088e-1,B=2*Math.PI*F;class V{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new V(li(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,h=e.lat*i,l=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return F*Math.acos(Math.min(l,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new q({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return D(this.lat,this.lng,t+e*t/F)}static convert(e){if(e instanceof V)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new V(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new V(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class q{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof V?new V(e.lng,e.lat):V.convert(e),this}setSouthWest(e){return this._sw=e instanceof V?new V(e.lng,e.lat):V.convert(e),this}extend(e){const i=this._sw,o=this._ne;let h,l;if(e instanceof V)h=e,l=e;else{if(!(e instanceof q))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(q.convert(e)):this.extend(V.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(V.convert(e)):this;if(h=e._sw,l=e._ne,!h||!l)return this}return i||o?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),o.lng=Math.max(l.lng,o.lng),o.lat=Math.max(l.lat,o.lat)):(this._sw=new V(h.lng,h.lat),this._ne=new V(l.lng,l.lat)),this}getCenter(){return new V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new V(this.getWest(),this.getNorth())}getSouthEast(){return new V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=V.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&h}static convert(e){if(e)return e instanceof q?e:new q(e)}}const W=0,Z=25.5;function X(s){return B*Math.cos(s*Math.PI/180)}function ie(s){return(180+s)/360}function se(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function ee(s,e){return s/X(e)}function ce(s){return 360*s-180}function le(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function me(s,e){return s*X(le(e))}const fe=85.051129;function ye(s){return Math.cos(_e($e(s,-fe,fe)))}function Ie(s,e){const i=$e(e,W,Z),o=Math.pow(2,i);return ye(s)*B/(512*o)}function Te(s){return 1/Math.cos(s*Math.PI/180)}function be(s,e=0){const i=Math.exp(Math.PI*(1-(s.y+e/Mt)/(1<<s.z)*2));return 80150034*i/(i*i+1)/Mt/(1<<s.z)}class ze{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=V.convert(e);return new ze(ie(o.lng),se(o.lat),ee(i,o.lat))}toLngLat(){return new V(ce(this.x),le(this.y))}toAltitude(){return me(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/B*Te(le(this.y))}}function Je(s,e,i,o,h,l,d,g,b){const S=(e+o)/2,m=(i+h)/2,x=new Se(S,m);g(x),function(E,v,w,M,R,z){const U=w-R,j=M-z;return Math.abs((M-v)*U-(w-E)*j)/Math.hypot(U,j)}(x.x,x.y,l.x,l.y,d.x,d.y)>=b?(Je(s,e,i,S,m,l,x,g,b),Je(s,S,m,o,h,x,d,g,b)):s.push(d)}function lt(s,e,i){let o=s[0],h=o.x,l=o.y;e(o);const d=[o];for(let g=1;g<s.length;g++){const b=s[g],{x:S,y:m}=b;e(b),Je(d,h,l,S,m,o,b,e,i),h=S,l=m,o=b}return d}function Ke(s,e,i,o){if(o(e,i)){const h=e.add(i)._mult(.5);Ke(s,e,h,o),Ke(s,h,i,o)}else s.push(i)}function mt(s,e){let i=s[0];const o=[i];for(let h=1;h<s.length;h++){const l=s[h];Ke(o,i,l,e),i=l}return o}const Oe=Math.pow(2,14)-1,ot=-Oe-1;function it(s,e){const i=Math.round(s.x*e),o=Math.round(s.y*e);return s.x=$e(i,ot,Oe),s.y=$e(o,ot,Oe),(i<s.x||i>s.x+1||o<s.y||o>s.y+1)&&ki("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function yt(s,e,i){const o=s.loadGeometry(),h=s.extent,l=Mt/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:g,x:b,y:S,projection:m}=i,x=E=>{const v=ce((e.x+E.x/h)/d),w=le((e.y+E.y/h)/d),M=m.project(v,w);E.x=(M.x*g-b)*h,E.y=(M.y*g-S)*h};for(let E=0;E<o.length;E++)if(s.type!==1)o[E]=lt(o[E],x,1);else{const v=[];for(const w of o[E])w.x<0||w.x>=h||w.y<0||w.y>=h||(x(w),v.push(w));o[E]=v}}for(const d of o)for(const g of d)it(g,l);return o}function vt(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?yt(s):[]}}function at(s,e,i,o,h){s.emplaceBack(2*e+(o+1)/2,2*i+(h+1)/2)}function ut(s,e,i){s.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Ht{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Mo,this.indexArray=new fn,this.segments=new Ir,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,o,h){const l=this.layers[0],d=[];let g=null;l.type==="circle"&&(g=l.layout.get("circle-sort-key"));for(const{feature:S,id:m,index:x,sourceLayerIndex:E}of e){const v=this.layers[0]._featureFilter.needGeometry,w=vt(S,v);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom),w,o))continue;const M=g?g.evaluate(w,{},o):void 0,R={id:m,properties:S.properties,type:S.type,sourceLayerIndex:E,index:x,geometry:v?w.geometry:yt(S,o,h),patterns:{},sortKey:M};d.push(R)}g&&d.sort((S,m)=>S.sortKey-m.sortKey);let b=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new bu,b=h.projection);for(const S of d){const{geometry:m,index:x,sourceLayerIndex:E}=S,v=e[x].feature;this.addFeature(S,m,x,i.availableImages,o,b,i.brightness),i.featureIndex.insert(v,m,x,E,this.index)}}update(e,i,o,h,l){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,d?this.stateDependentLayers:this.layers,o,h,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,O_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,k_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,h,l,d,g){for(const b of i)for(const S of b){const m=S.x,x=S.y;if(m<0||m>=Mt||x<0||x>=Mt)continue;if(d){const w=d.projectTilePoint(m,x,l),M=d.upVector(l,m,x),R=this.globeExtVertexArray;ut(R,w,M),ut(R,w,M),ut(R,w,M),ut(R,w,M)}const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),v=E.vertexLength;at(this.layoutVertexArray,m,x,-1,-1),at(this.layoutVertexArray,m,x,1,-1),at(this.layoutVertexArray,m,x,1,1),at(this.layoutVertexArray,m,x,-1,1),this.indexArray.emplaceBack(v,v+1,v+2),this.indexArray.emplaceBack(v,v+2,v+3),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},h,l,g)}}function St(s,e){for(let i=0;i<s.length;i++)if(ur(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(ur(s,e[i]))return!0;return!!Qt(s,e)}function Ot(s,e,i){return!!ur(s,e)||!!yi(e,s,i)}function ri(s,e){if(s.length===1)return rr(e,s[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let h=0;h<o.length;h++)if(ur(s,o[h]))return!0}for(let i=0;i<s.length;i++)if(rr(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(Qt(s,e[i]))return!0;return!1}function Vt(s,e,i){if(s.length>1){if(Qt(s,e))return!0;for(let o=0;o<e.length;o++)if(yi(e[o],s,i))return!0}for(let o=0;o<s.length;o++)if(yi(s[o],e,i))return!0;return!1}function Qt(s,e){if(s.length===0||e.length===0)return!1;for(let i=0;i<s.length-1;i++){const o=s[i],h=s[i+1];for(let l=0;l<e.length-1;l++)if(bi(o,h,e[l],e[l+1]))return!0}return!1}function bi(s,e,i,o){return Os(s,i,o)!==Os(e,i,o)&&Os(s,e,i)!==Os(s,e,o)}function yi(s,e,i){const o=i*i;if(e.length===1)return s.distSqr(e[0])<o;for(let h=1;h<e.length;h++)if(Yi(s,e[h-1],e[h])<o)return!0;return!1}function Yi(s,e,i){const o=e.distSqr(i);if(o===0)return s.distSqr(e);const h=((s.x-e.x)*(i.x-e.x)+(s.y-e.y)*(i.y-e.y))/o;return s.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function rr(s,e){let i,o,h,l=!1;for(let d=0;d<s.length;d++){i=s[d];for(let g=0,b=i.length-1;g<i.length;b=g++)o=i[g],h=i[b],o.y>e.y!=h.y>e.y&&e.x<(h.x-o.x)*(e.y-o.y)/(h.y-o.y)+o.x&&(l=!l)}return l}function ur(s,e){let i=!1;for(let o=0,h=s.length-1;o<s.length;h=o++){const l=s[o],d=s[h];l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(i=!i)}return i}function hs(s,e,i,o,h){for(const d of s)if(e<=d.x&&i<=d.y&&o>=d.x&&h>=d.y)return!0;const l=[new Se(e,i),new Se(e,h),new Se(o,h),new Se(o,i)];if(s.length>2){for(const d of l)if(ur(s,d))return!0}for(let d=0;d<s.length-1;d++)if(Fr(s[d],s[d+1],l))return!0;return!1}function Fr(s,e,i){const o=i[0],h=i[2];if(s.x<o.x&&e.x<o.x||s.x>h.x&&e.x>h.x||s.y<o.y&&e.y<o.y||s.y>h.y&&e.y>h.y)return!1;const l=Os(s,e,i[0]);return l!==Os(s,e,i[1])||l!==Os(s,e,i[2])||l!==Os(s,e,i[3])}function Ai(s,e,i,o,h,l){let d=e.y-s.y,g=s.x-e.x;if(l=l||0){const b=d*d+g*g;if(b===0)return!0;const S=Math.sqrt(b);d/=S,g/=S}return!((i.x-s.x)*d+(i.y-s.y)*g-l<0||(o.x-s.x)*d+(o.y-s.y)*g-l<0||(h.x-s.x)*d+(h.y-s.y)*g-l<0)}function tr(s,e,i,o,h,l,d){return!(Ai(s,e,o,h,l,d)||Ai(e,i,o,h,l,d)||Ai(i,s,o,h,l,d)||Ai(o,h,s,e,i,d)||Ai(h,l,s,e,i,d)||Ai(l,o,s,e,i,d))}function mr(s,e,i){const o=e.paint.get(s).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(s)}function Qi(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function xi(s,e,i,o,h){if(!e[0]&&!e[1])return s;const l=Se.convert(e)._mult(h);i==="viewport"&&l._rotate(-o);const d=[];for(let g=0;g<s.length;g++)d.push(s[g].sub(l));return d}function Ni(s,e,i,o){const h=Se.convert(s)._mult(o);return e==="viewport"&&h._rotate(-i),h}let Wi,Mr;Ft(Ht,"CircleBucket",{omit:["layers"]});var Br,Li={exports:{}},Yr=(Br||(Br=1,function(s,e){(function(i){function o(l,d,g){var b=h(256*l,256*(d=Math.pow(2,g)-d-1),g),S=h(256*(l+1),256*(d+1),g);return b[0]+","+b[1]+","+S[0]+","+S[1]}function h(l,d,g){var b=2*Math.PI*6378137/256/Math.pow(2,g);return[l*b-2*Math.PI*6378137/2,d*b-2*Math.PI*6378137/2]}i.getURL=function(l,d,g,b,S,m){return m=m||{},l+"?"+["bbox="+o(g,b,S),"format="+(m.format||"image/png"),"service="+(m.service||"WMS"),"version="+(m.version||"1.1.1"),"request="+(m.request||"GetMap"),"srs="+(m.srs||"EPSG:3857"),"width="+(m.width||256),"height="+(m.height||256),"layers="+d].join("&")},i.getTileBBox=o,i.getMercCoords=h,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Li.exports)),Li.exports);class nn{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=zn(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=Yr.getTileBBox(this.x,this.y,this.z),h=function(l,d,g){let b,S="";for(let m=l;m>0;m--)b=1<<m-1,S+=(d&b?1:0)+(g&b?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kr{constructor(e,i){this.wrap=e,this.canonical=i,this.key=zn(e,i.z,i.z,i.x,i.y)}}class ar{constructor(e,i,o,h,l){this.overscaledZ=e,this.wrap=i,this.canonical=new nn(o,+h,+l),this.key=i===0&&e===o?this.canonical.key:zn(i,e,o,h,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ar(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ar(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return zn(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return zn(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ar(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new ar(i,this.wrap,i,o,h),new ar(i,this.wrap,i,o+1,h),new ar(i,this.wrap,i,o,h+1),new ar(i,this.wrap,i,o+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ar(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ar(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function zn(s,e,i,o,h){const l=1<<Math.min(i,22);let d=l*(h%l)+o%l;return s&&i<22&&(d+=l*l*((s<0?-2*s-1:2*s)%(1<<2*(22-i)))),16*(32*d+i)+(e-i)}const On=[s=>{let e=s.canonical.x-1,i=s.wrap;return e<0&&(e=(1<<s.canonical.z)-1,i--),new ar(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>{let e=s.canonical.x+1,i=s.wrap;return e===1<<s.canonical.z&&(e=0,i++),new ar(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>new ar(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new ar(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];Ft(nn,"CanonicalTileID"),Ft(ar,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ds=Bi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ns}=ds,Hn=Bi([{name:"a_pos_3",components:3,type:"Int16"}]);var fs=Bi([{name:"a_pos",type:"Int16",components:2}]);class ao{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const h=ge.vec3.dot(i,this.dir);if(Math.abs(h)<1e-6)return!1;const l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return o[0]=this.pos[0]+this.dir[0]*l,o[1]=this.pos[1]+this.dir[1]*l,o[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,i,o){if(ge.vec3.equals(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[h,l,d]=this.dir,g=this.pos[0]-e[0],b=this.pos[1]-e[1],S=this.pos[2]-e[2],m=h*h+l*l+d*d,x=2*(g*h+b*l+S*d),E=x*x-4*m*(g*g+b*b+S*S-i*i);if(E<0){const v=Math.max(-x/2,0),w=g+h*v,M=b+l*v,R=S+d*v,z=Math.hypot(w,M,R);return o[0]=w*i/z,o[1]=M*i/z,o[2]=R*i/z,!1}{const v=(-x-Math.sqrt(E))/(2*m);if(v<0){const w=Math.hypot(g,b,S);return o[0]=g*i/w,o[1]=b*i/w,o[2]=S*i/w,!1}return o[0]=g+h*v,o[1]=b+l*v,o[2]=S+d*v,!0}}}class Do{constructor(e,i,o,h,l){this.TL=e,this.TR=i,this.BR=o,this.BL=h,this.horizon=l}static fromInvProjectionMatrix(e,i,o){const h=[-1,1,1],l=[1,1,1],d=[1,-1,1],g=[-1,-1,1],b=ge.vec3.transformMat4(h,h,e),S=ge.vec3.transformMat4(l,l,e),m=ge.vec3.transformMat4(d,d,e),x=ge.vec3.transformMat4(g,g,e);return new Do(b,S,m,x,i/o)}}function $s(s,e,i){let o=1/0,h=-1/0;const l=[];for(const d of s){ge.vec3.sub(l,d,e);const g=ge.vec3.dot(l,i);o=Math.min(o,g),h=Math.max(h,g)}return[o,h]}function el(s,e){let i=!0;for(let o=0;o<s.planes.length;o++){const h=s.planes[o];let l=0;for(let d=0;d<e.length;d++)l+=ge.vec3.dot(h,e[d])+h[3]>=0;if(l===0)return 0;l!==e.length&&(i=!1)}return i?2:1}function tl(s,e){for(const i of s.projections){const o=$s(e,s.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function Cu(s,e){let i=0;const o=[0,0,0,0];for(let h=0;h<s.length;h++)o[0]=s[h][0],o[1]=s[h][1],o[2]=s[h][2],o[3]=1,ge.vec4.dot(o,e)>=0&&i++;return i}class il{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=lr.fromPoints(this.points),this.projections=[],this.frustumEdges=[ge.vec3.sub([],this.points[2],this.points[3]),ge.vec3.sub([],this.points[0],this.points[3]),ge.vec3.sub([],this.points[4],this.points[0]),ge.vec3.sub([],this.points[5],this.points[1]),ge.vec3.sub([],this.points[6],this.points[2]),ge.vec3.sub([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const h=[0,-o[2],o[1]],l=[o[2],0,-o[0]];this.projections.push({axis:h,projection:$s(this.points,this.points[0],h)}),this.projections.push({axis:l,projection:$s(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,i,o,h){const l=Math.pow(2,o),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const m=ge.vec4.transformMat4([],S,e),x=1/m[3]/i*l;return ge.vec4.mul(m,m,[x,x,h?1/m[3]:x,x])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const m=ge.vec3.sub([],d[S[0]],d[S[1]]),x=ge.vec3.sub([],d[S[2]],d[S[1]]),E=ge.vec3.normalize([],ge.vec3.cross([],m,x)),v=-ge.vec3.dot(E,d[S[1]]);return E.concat(v)}),b=[];for(let S=0;S<d.length;S++)b.push([d[S][0],d[S][1],d[S][2]]);return new il(b,g)}intersectsPrecise(e,i,o){for(let h=0;h<i.length;h++)if(!Cu(e,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Cu(e,this.planes[h]))return 0;for(const h of o)for(const l of this.frustumEdges){const d=ge.vec3.cross([],h,l),g=ge.vec3.length(d);if(g===0)continue;ge.vec3.scale(d,d,1/g);const b=$s(this.points,this.points[0],d),S=$s(e,this.points[0],d);if(b[0]>S[1]||S[0]>b[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(ge.vec3.dot([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class lr{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const h of e)ge.vec3.min(i,i,h),ge.vec3.max(o,o,h);return new lr(i,o)}static fromTileIdAndHeight(e,i,o){const h=1<<e.canonical.z,l=e.canonical.x,d=e.canonical.y;return new lr([l/h,d/h,i],[(l+1)/h,(d+1)/h,o])}static applyTransform(e,i){const o=e.getCorners();for(let h=0;h<o.length;++h)ge.vec3.transformMat4(o[h],o[h],i);return lr.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],h=[...o];for(let l=0;l<3;l++)for(let d=0;d<3;d++){const g=i[4*d+l],b=g*e.min[d],S=g*e.max[d];o[l]+=Math.min(b,S),h[l]+=Math.max(b,S)}return new lr(o,h)}static projectAabbCorners(e,i){const o=e.getCorners();for(let h=0;h<o.length;++h)ge.vec3.transformMat4(o[h],o[h],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=ge.vec3.scale([],ge.vec3.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=ge.vec3.clone(this.min),h=ge.vec3.clone(this.max);for(let l=0;l<i.length;l++)o[l]=i[l]?this.min[l]:this.center[l],h[l]=i[l]?this.center[l]:this.max[l];return h[2]=this.max[2],new lr(o,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?el(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?el(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?tl(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?tl(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function sa(s){return s*t/F}Ft(lr,"Aabb");const $_=[new lr([A,A,A],[C,C,C]),new lr([A,A,A],[0,0,C]),new lr([0,A,A],[C,0,C]),new lr([A,0,A],[0,C,C]),new lr([0,0,A],[C,C,C])];function Op(s,e,i,o=!0){const h=ge.vec3.scale([],s._camera.position,s.worldSize),l=[e,i,1,1];ge.vec4.transformMat4(l,l,s.pixelMatrixInverse),ge.vec4.scale(l,l,1/l[3]);const d=ge.vec3.sub([],l,h),g=ge.vec3.normalize([],d),b=s.globeMatrix,S=[b[12],b[13],b[14]],m=ge.vec3.sub([],S,h),x=ge.vec3.length(m),E=ge.vec3.normalize([],m),v=s.worldSize/(2*Math.PI),w=ge.vec3.dot(E,g),M=Math.asin(v/x);if(M<Math.acos(w)){if(!o)return null;const de=[],oe=[];ge.vec3.scale(de,g,x/w),ge.vec3.normalize(oe,ge.vec3.sub(oe,de,m)),ge.vec3.normalize(g,ge.vec3.add(g,m,ge.vec3.scale(g,oe,Math.tan(M)*x)))}const R=[];new ao(h,g).closestPointOnSphere(S,v,R);const z=ge.vec3.normalize([],qo(b,0)),U=ge.vec3.normalize([],qo(b,1)),j=ge.vec3.normalize([],qo(b,2)),k=ge.vec3.dot(z,R),G=ge.vec3.dot(U,R),$=ge.vec3.dot(j,R),K=Ze(Math.asin(-G/v));let te=Ze(Math.atan2(k,$));te=s.center.lng+function(de,oe){const pe=(oe-de+180)%360-180;return pe<-180?pe+360:pe}(s.center.lng,te);const re=ie(te),Q=$e(se(K),0,1);return new ze(re,Q)}class nS{constructor(e,i,o){this.a=ge.vec3.sub([],e,o),this.b=ge.vec3.sub([],i,o),this.center=o;const h=ge.vec3.normalize([],this.a),l=ge.vec3.normalize([],this.b);this.angle=Math.acos(ge.vec3.dot(h,l))}}function q_(s,e){if(s.angle===0)return null;let i;return i=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),i<0||i>1?null:function(o,h,l,d){const g=Math.sin(l);return o*(Math.sin((1-d)*l)/g)+h*(Math.sin(d*l)/g)}(s.a[e],s.b[e],s.angle,$e(i,0,1))+s.center[e]}function zo(s){if(s.z<=1)return $_[s.z+2*s.y+s.x];const e=H_(kp(s));return lr.fromPoints(e)}function oa(s,e,i){return ge.vec3.scale(s,s,1-i),ge.vec3.scaleAndAdd(s,s,e,i)}function V0(s,e,i){for(const o of s)ge.vec3.transformMat4(o,o,e),ge.vec3.scale(o,o,i)}function j0(s,e,i,o){const h=e/s.worldSize,l=s.globeMatrix;if(i.z<=1){const re=zo(i).getCorners();return V0(re,l,h),lr.fromPoints(re)}const d=kp(i,o),g=H_(d,t+sa(s._tileCoverLift));V0(g,l,h);const b=Number.MAX_VALUE,S=[-b,-b,-b],m=[b,b,b];if(d.contains(s.center)){for(const de of g)ge.vec3.min(m,m,de),ge.vec3.max(S,S,de);S[2]=0;const re=s.point,Q=[re.x*h,re.y*h,0];return ge.vec3.min(m,m,Q),ge.vec3.max(S,S,Q),new lr(m,S)}if(s._tileCoverLift>0){for(const re of g)ge.vec3.min(m,m,re),ge.vec3.max(S,S,re);return new lr(m,S)}const x=[l[12]*h,l[13]*h,l[14]*h],E=d.getCenter(),v=$e(s.center.lat,-fe,fe),w=$e(E.lat,-fe,fe),M=ie(s.center.lng),R=se(v);let z=M-ie(E.lng);const U=R-se(w);z>.5?z-=1:z<-.5&&(z+=1);let j=0;if(Math.abs(z)>Math.abs(U))j=z>=0?1:3;else{j=U>=0?0:2;const re=[l[4]*h,l[5]*h,l[6]*h],Q=-Math.sin(_e(U>=0?d.getSouth():d.getNorth()))*t;ge.vec3.scaleAndAdd(x,x,re,Q)}const k=g[j],G=g[(j+1)%4],$=new nS(k,G,x),K=[q_($,0)||k[0],q_($,1)||k[1],q_($,2)||k[2]],te=rl(s.zoom);if(te>0){const re=function({x:de,y:oe,z:pe},Ee,Ce,Pe,Re){const je=1/(1<<pe);let De=de*je,tt=De+je,ct=oe*je,Ye=ct+je,Rt=0;const At=(De+tt)/2-Pe;return At>.5?Rt=-1:At<-.5&&(Rt=1),De=((De+Rt)*Ee-(Pe*=Ee))*Ce+Pe,tt=((tt+Rt)*Ee-Pe)*Ce+Pe,ct=(ct*Ee-(Re*=Ee))*Ce+Re,Ye=(Ye*Ee-Re)*Ce+Re,[[De,Ye,0],[tt,Ye,0],[tt,ct,0],[De,ct,0]]}(i,e,s._pixelsPerMercatorPixel,M,R);for(let de=0;de<g.length;de++)oa(g[de],re[de],te);const Q=ge.vec3.add([],re[j],re[(j+1)%4]);ge.vec3.scale(Q,Q,.5),oa(K,Q,te)}for(const re of g)ge.vec3.min(m,m,re),ge.vec3.max(S,S,re);return m[2]=Math.min(k[2],G[2]),ge.vec3.min(m,m,K),ge.vec3.max(S,S,K),new lr(m,S)}function kp({x:s,y:e,z:i},o=!1){const h=1/(1<<i),l=new V(ce(s*h),e===(1<<i)-1&&o?-90:le((e+1)*h)),d=new V(ce((s+1)*h),e===0&&o?90:le(e*h));return new q(l,d)}function H_(s,e=t){const i=_e(s.getNorth()),o=_e(s.getSouth()),h=Math.cos(i),l=Math.cos(o),d=Math.sin(i),g=Math.sin(o),b=s.getWest(),S=s.getEast();return[L(l,g,b,e),L(l,g,S,e),L(h,d,S,e),L(h,d,b,e)]}function xd(s,e,i,o){const h=1<<i.z,l=(s/Mt+i.x)/h;return D(le((e/Mt+i.y)/h),ce(l),o)}function Fp({min:s,max:e}){return p/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const G0=new Float64Array(16);function Bp(s){const e=Fp(s),i=ge.mat4.fromScaling(G0,[e,e,e]);return ge.mat4.translate(i,i,ge.vec3.negate([],s.min))}function W_(s){const e=ge.mat4.fromTranslation(G0,s.min),i=1/Fp(s);return ge.mat4.scale(e,e,[i,i,i])}function Z_(s){const e=Mt/(2*Math.PI);return s/(2*Math.PI)/e}function $0(s,e){return Mt/(512*Math.pow(2,s))*Fp(zo(e))}function q0(s,e,i,o,h){const l=Z_(i),d=[s,e,-i/(2*Math.PI)],g=ge.mat4.identity(new Float64Array(16));return ge.mat4.translate(g,g,d),ge.mat4.scale(g,g,[l,l,l]),ge.mat4.rotateX(g,g,_e(-h)),ge.mat4.rotateY(g,g,_e(-o)),g}function rl(s){return Xt(r,u,s)}function H0(s,e){const i=D(e.lat,e.lng),o=function(l){const d=D(l._center.lat,l._center.lng),g=ge.vec3.fromValues(0,1,0);let b=ge.vec3.cross([],g,d);const S=ge.mat4.fromRotation([],-l.angle,d);b=ge.vec3.transformMat4(b,b,S),ge.mat4.fromRotation(S,-l._pitch,b);const m=ge.vec3.normalize([],d);return ge.vec3.scale(m,m,sa(l.cameraToCenterDistance/l.pixelsPerMeter)),ge.vec3.transformMat4(m,m,S),ge.vec3.add([],d,m)}(s),h=ge.vec3.subtract([],o,i);return ge.vec3.angle(h,i)}function X_(s,e){return H0(s,e)>Math.PI/2*1.01}const W0=_e(85),sS=Math.cos(W0),oS=Math.sin(W0),aS=ge.mat4.create(),Z0=s=>{const e=[];return s.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function X0(s,e,i,o,h,l,d,g,b){if(l&&s.queryGeometry.isAboveHorizon)return!1;l&&(b*=s.pixelToTileUnitsFactor);const S=s.tileID.canonical,m=i.projection.upVectorScale(S,i.center.lat,i.worldSize).metersToTile;for(const x of e)for(const E of x){const v=E.add(g),w=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(v.x,v.y,!0):0,M=i.projection.projectTilePoint(v.x,v.y,S);if(w>0){const j=i.projection.upVector(S,v.x,v.y);M.x+=j[0]*m*w,M.y+=j[1]*m*w,M.z+=j[2]*m*w}const R=l?v:lS(M.x,M.y,M.z,o),z=l?s.tilespaceRays.map(j=>uS(j,w)):s.queryGeometry.screenGeometry,U=ge.vec4.transformMat4([],[M.x,M.y,M.z,1],o);if(!d&&l?b*=U[3]/i.cameraToCenterDistance:d&&!l&&(b*=i.cameraToCenterDistance/U[3]),l){const j=le((E.y/Mt+S.y)/(1<<S.z));b/=i.projection.pixelsPerMeter(j,1)/ee(1,j)}if(Ot(z,R,b))return!0}return!1}function lS(s,e,i,o){const h=ge.vec4.transformMat4([],[s,e,i,1],o);return new Se(h[0]/h[3],h[1]/h[3])}const Y0=ge.vec3.fromValues(0,0,0),cS=ge.vec3.fromValues(0,0,1);function uS(s,e){const i=ge.vec3.create();return Y0[2]=e,s.intersectsPlane(Y0,cS,i),new Se(i[0],i[1])}class K0 extends Ht{}let J0,Q0,ex,tx;function ix(s,{width:e,height:i},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*o)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*o);return s.width=e,s.height=i,s.data=h,s}function rx(s,e,i){const{width:o,height:h}=e;o===s.width&&h===s.height||(Y_(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,o),height:Math.min(s.height,h)},i,null),s.width=o,s.height=h,s.data=e.data)}function Y_(s,e,i,o,h,l,d,g){if(h.width===0||h.height===0)return e;if(h.width>s.width||h.height>s.height||i.x>s.width-h.width||i.y>s.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||o.x>e.width-h.width||o.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const b=s.data,S=e.data,m=l===4&&g;for(let x=0;x<h.height;x++){const E=((i.y+x)*s.width+i.x)*l,v=((o.y+x)*e.width+o.x)*l;if(m)for(let w=0;w<h.width;w++){const M=E+w*l+3,R=v+w*l;S[R+0]=255,S[R+1]=255,S[R+2]=255,S[R+3]=b[M]}else if(d)for(let w=0;w<h.width;w++){const M=E+w*l,R=v+w*l,z=b[M+3],U=new Hi(b[M+0]/255*z,b[M+1]/255*z,b[M+2]/255*z,z).toRenderColor(d).toArray();S[R+0]=U[0],S[R+1]=U[1],S[R+2]=U[2],S[R+3]=U[3]}else for(let w=0;w<h.width*l;w++)S[v+w]=b[E+w]}return e}Ft(K0,"HeatmapBucket",{omit:["layers"]});class nl{constructor(e,i){ix(this,e,1,i)}resize(e){rx(this,new nl(e),1)}clone(){return new nl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,h,l){Y_(e,i,o,h,l,1,null)}}class kn{constructor(e,i){ix(this,e,4,i)}resize(e){rx(this,new kn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new kn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,h,l,d,g){Y_(e,i,o,h,l,4,d,g)}}class nx{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function vd(s){const e={},i=s.resolution||256,o=s.clips?s.clips.length:1,h=s.image||new kn({width:i,height:o}),l=(d,g,b)=>{e[s.evaluationKey]=b;const S=s.expression.evaluate(e);S&&(h.data[d+g+0]=Math.floor(255*S.r/S.a),h.data[d+g+1]=Math.floor(255*S.g/S.a),h.data[d+g+2]=Math.floor(255*S.b/S.a),h.data[d+g+3]=Math.floor(255*S.a))};if(s.clips)for(let d=0,g=0;d<o;++d,g+=4*i)for(let b=0,S=0;b<i;b++,S+=4){const m=b/(i-1),{start:x,end:E}=s.clips[d];l(g,S,x*(1-m)+E*m)}else for(let d=0,g=0;d<i;d++,g+=4)l(0,g,d/(i-1));return h}Ft(nl,"AlphaImage"),Ft(kn,"RGBAImage");const hS=Bi([{name:"a_pos",components:2,type:"Int16"}],4),{members:dS}=hS;function bd(s,e,i=2){const o=e&&e.length,h=o?e[0]*i:s.length;let l=sx(s,0,h,i,!0);const d=[];if(!l||l.next===l.prev)return d;let g,b,S;if(o&&(l=function(m,x,E,v){const w=[];for(let M=0,R=x.length;M<R;M++){const z=sx(m,x[M]*v,M<R-1?x[M+1]*v:m.length,v,!1);z===z.next&&(z.steiner=!0),w.push(vS(z))}w.sort(gS);for(let M=0;M<w.length;M++)E=yS(w[M],E);return E}(s,e,l,i)),s.length>80*i){g=1/0,b=1/0;let m=-1/0,x=-1/0;for(let E=i;E<h;E+=i){const v=s[E],w=s[E+1];v<g&&(g=v),w<b&&(b=w),v>m&&(m=v),w>x&&(x=w)}S=Math.max(m-g,x-b),S=S!==0?32767/S:0}return wd(l,d,i,g,b,S,0),d}function sx(s,e,i,o,h){let l;if(h===function(d,g,b,S){let m=0;for(let x=g,E=b-S;x<b;x+=S)m+=(d[E]-d[x])*(d[x+1]+d[E+1]),E=x;return m}(s,e,i,o)>0)for(let d=e;d<i;d+=o)l=lx(d/o|0,s[d],s[d+1],l);else for(let d=i-o;d>=e;d-=o)l=lx(d/o|0,s[d],s[d+1],l);return l&&Np(l,l.next)&&(Ed(l),l=l.next),l}function ac(s,e){if(!s)return s;e||(e=s);let i,o=s;do if(i=!1,o.steiner||!Np(o,o.next)&&Jr(o.prev,o,o.next)!==0)o=o.next;else{if(Ed(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function wd(s,e,i,o,h,l,d){if(!s)return;!d&&l&&function(b,S,m,x){let E=b;do E.z===0&&(E.z=K_(E.x,E.y,S,m,x)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next;while(E!==b);E.prevZ.nextZ=null,E.prevZ=null,function(v){let w,M=1;do{let R,z=v;v=null;let U=null;for(w=0;z;){w++;let j=z,k=0;for(let $=0;$<M&&(k++,j=j.nextZ,j);$++);let G=M;for(;k>0||G>0&&j;)k!==0&&(G===0||!j||z.z<=j.z)?(R=z,z=z.nextZ,k--):(R=j,j=j.nextZ,G--),U?U.nextZ=R:v=R,R.prevZ=U,U=R;z=j}U.nextZ=null,M*=2}while(w>1)}(E)}(s,o,h,l);let g=s;for(;s.prev!==s.next;){const b=s.prev,S=s.next;if(l?pS(s,o,h,l):fS(s))e.push(b.i,s.i,S.i),Ed(s),s=S.next,g=S.next;else if((s=S)===g){d?d===1?wd(s=mS(ac(s),e),e,i,o,h,l,2):d===2&&_S(s,e,i,o,h,l):wd(ac(s),e,i,o,h,l,1);break}}}function fS(s){const e=s.prev,i=s,o=s.next;if(Jr(e,i,o)>=0)return!1;const h=e.x,l=i.x,d=o.x,g=e.y,b=i.y,S=o.y,m=h<l?h<d?h:d:l<d?l:d,x=g<b?g<S?g:S:b<S?b:S,E=h>l?h>d?h:d:l>d?l:d,v=g>b?g>S?g:S:b>S?b:S;let w=o.next;for(;w!==e;){if(w.x>=m&&w.x<=E&&w.y>=x&&w.y<=v&&Pu(h,g,l,b,d,S,w.x,w.y)&&Jr(w.prev,w,w.next)>=0)return!1;w=w.next}return!0}function pS(s,e,i,o){const h=s.prev,l=s,d=s.next;if(Jr(h,l,d)>=0)return!1;const g=h.x,b=l.x,S=d.x,m=h.y,x=l.y,E=d.y,v=g<b?g<S?g:S:b<S?b:S,w=m<x?m<E?m:E:x<E?x:E,M=g>b?g>S?g:S:b>S?b:S,R=m>x?m>E?m:E:x>E?x:E,z=K_(v,w,e,i,o),U=K_(M,R,e,i,o);let j=s.prevZ,k=s.nextZ;for(;j&&j.z>=z&&k&&k.z<=U;){if(j.x>=v&&j.x<=M&&j.y>=w&&j.y<=R&&j!==h&&j!==d&&Pu(g,m,b,x,S,E,j.x,j.y)&&Jr(j.prev,j,j.next)>=0||(j=j.prevZ,k.x>=v&&k.x<=M&&k.y>=w&&k.y<=R&&k!==h&&k!==d&&Pu(g,m,b,x,S,E,k.x,k.y)&&Jr(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;j&&j.z>=z;){if(j.x>=v&&j.x<=M&&j.y>=w&&j.y<=R&&j!==h&&j!==d&&Pu(g,m,b,x,S,E,j.x,j.y)&&Jr(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;k&&k.z<=U;){if(k.x>=v&&k.x<=M&&k.y>=w&&k.y<=R&&k!==h&&k!==d&&Pu(g,m,b,x,S,E,k.x,k.y)&&Jr(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function mS(s,e){let i=s;do{const o=i.prev,h=i.next.next;!Np(o,h)&&ox(o,i,i.next,h)&&Td(o,h)&&Td(h,o)&&(e.push(o.i,i.i,h.i),Ed(i),Ed(i.next),i=s=h),i=i.next}while(i!==s);return ac(i)}function _S(s,e,i,o,h,l){let d=s;do{let g=d.next.next;for(;g!==d.prev;){if(d.i!==g.i&&bS(d,g)){let b=ax(d,g);return d=ac(d,d.next),b=ac(b,b.next),wd(d,e,i,o,h,l,0),void wd(b,e,i,o,h,l,0)}g=g.next}d=d.next}while(d!==s)}function gS(s,e){return s.x-e.x}function yS(s,e){const i=function(h,l){let d=l;const g=h.x,b=h.y;let S,m=-1/0;do{if(b<=d.y&&b>=d.next.y&&d.next.y!==d.y){const M=d.x+(b-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(M<=g&&M>m&&(m=M,S=d.x<d.next.x?d:d.next,M===g))return S}d=d.next}while(d!==l);if(!S)return null;const x=S,E=S.x,v=S.y;let w=1/0;d=S;do{if(g>=d.x&&d.x>=E&&g!==d.x&&Pu(b<v?g:m,b,E,v,b<v?m:g,b,d.x,d.y)){const M=Math.abs(b-d.y)/(g-d.x);Td(d,h)&&(M<w||M===w&&(d.x>S.x||d.x===S.x&&xS(S,d)))&&(S=d,w=M)}d=d.next}while(d!==x);return S}(s,e);if(!i)return e;const o=ax(i,s);return ac(o,o.next),ac(i,i.next)}function xS(s,e){return Jr(s.prev,s,e.prev)<0&&Jr(e.next,s,s.next)<0}function K_(s,e,i,o,h){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-i)*h|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vS(s){let e=s,i=s;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==s);return i}function Pu(s,e,i,o,h,l,d,g){return(h-d)*(e-g)>=(s-d)*(l-g)&&(s-d)*(o-g)>=(i-d)*(e-g)&&(i-d)*(l-g)>=(h-d)*(o-g)}function bS(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(i,o){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==o.i&&h.next.i!==o.i&&ox(h,h.next,i,o))return!0;h=h.next}while(h!==i);return!1}(s,e)&&(Td(s,e)&&Td(e,s)&&function(i,o){let h=i,l=!1;const d=(i.x+o.x)/2,g=(i.y+o.y)/2;do h.y>g!=h.next.y>g&&h.next.y!==h.y&&d<(h.next.x-h.x)*(g-h.y)/(h.next.y-h.y)+h.x&&(l=!l),h=h.next;while(h!==i);return l}(s,e)&&(Jr(s.prev,s,e.prev)||Jr(s,e.prev,e))||Np(s,e)&&Jr(s.prev,s,s.next)>0&&Jr(e.prev,e,e.next)>0)}function Jr(s,e,i){return(e.y-s.y)*(i.x-e.x)-(e.x-s.x)*(i.y-e.y)}function Np(s,e){return s.x===e.x&&s.y===e.y}function ox(s,e,i,o){const h=Vp(Jr(s,e,i)),l=Vp(Jr(s,e,o)),d=Vp(Jr(i,o,s)),g=Vp(Jr(i,o,e));return h!==l&&d!==g||!(h!==0||!Up(s,i,e))||!(l!==0||!Up(s,o,e))||!(d!==0||!Up(i,s,o))||!(g!==0||!Up(i,e,o))}function Up(s,e,i){return e.x<=Math.max(s.x,i.x)&&e.x>=Math.min(s.x,i.x)&&e.y<=Math.max(s.y,i.y)&&e.y>=Math.min(s.y,i.y)}function Vp(s){return s>0?1:s<0?-1:0}function Td(s,e){return Jr(s.prev,s,s.next)<0?Jr(s,e,s.next)>=0&&Jr(s,s.prev,e)>=0:Jr(s,e,s.prev)<0||Jr(s,s.next,e)<0}function ax(s,e){const i=J_(s.i,s.x,s.y),o=J_(e.i,e.x,e.y),h=s.next,l=e.prev;return s.next=e,e.prev=s,i.next=h,h.prev=i,o.next=i,i.prev=o,l.next=o,o.prev=l,o}function lx(s,e,i,o){const h=J_(s,e,i);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function Ed(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function J_(s,e,i){return{i:s,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function jp(s,e){const i=s.length;if(i<=1)return[s];const o=[];let h,l;for(let d=0;d<i;d++){const g=Cc(s[d]);g!==0&&(s[d].area=Math.abs(g),l===void 0&&(l=g<0),l===g<0?(h&&o.push(h),h=[s[d]]):h.push(s[d]))}if(h&&o.push(h),e>1)for(let d=0;d<o.length;d++)o[d].length<=e||(Ff(o[d],e,1,o[d].length-1,wS),o[d]=o[d].slice(0,e));return o}function wS(s,e){return e.area-s.area}function Q_(s,e,i){const o=i.patternDependencies;let h=!1;for(const l of e){const d=l.paint.get(`${s}-pattern`);d.isConstant()||(h=!0);const g=d.constantOr(null);g&&(h=!0,o[g]=!0)}return h}function eg(s,e,i,o,h){const l=h.patternDependencies;for(const d of e){const g=d.paint.get(`${s}-pattern`).value;if(g.kind!=="constant"){let b=g.evaluate({zoom:o},i,{},h.availableImages);b=b&&b.name?b.name:b,l[b]=!0,i.patterns[d.id]=b}}return i}class tg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Mo,this.indexArray=new fn,this.indexArray2=new Ro,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Ir,this.segments2=new Ir,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,o,h){this.hasPattern=Q_("fill",this.layers,i);const l=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:g,id:b,index:S,sourceLayerIndex:m}of e){const x=this.layers[0]._featureFilter.needGeometry,E=vt(g,x);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom),E,o))continue;const v=l?l.evaluate(E,{},o,i.availableImages):void 0,w={id:b,properties:g.properties,type:g.type,sourceLayerIndex:m,index:S,geometry:x?E.geometry:yt(g,o,h),patterns:{},sortKey:v};d.push(w)}l&&d.sort((g,b)=>g.sortKey-b.sortKey);for(const g of d){const{geometry:b,index:S,sourceLayerIndex:m}=g;if(this.hasPattern){const x=eg("fill",this.layers,g,this.zoom,i);this.patternFeatures.push(x)}else this.addFeature(g,b,S,o,{},i.availableImages,i.brightness);i.featureIndex.insert(e[S].feature,b,S,m,this.index)}}update(e,i,o,h,l){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,d?this.stateDependentLayers:this.layers,o,h,l)}addFeatures(e,i,o,h,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,h,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dS),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,h,l,d=[],g){for(const b of jp(i,500)){let S=0;for(const M of b)S+=M.length;const m=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray),x=m.vertexLength,E=[],v=[];for(const M of b){if(M.length===0)continue;M!==b[0]&&v.push(E.length/2);const R=this.segments2.prepareSegment(M.length,this.layoutVertexArray,this.indexArray2),z=R.vertexLength;this.layoutVertexArray.emplaceBack(M[0].x,M[0].y),this.indexArray2.emplaceBack(z+M.length-1,z),E.push(M[0].x),E.push(M[0].y);for(let U=1;U<M.length;U++)this.layoutVertexArray.emplaceBack(M[U].x,M[U].y),this.indexArray2.emplaceBack(z+U-1,z+U),E.push(M[U].x),E.push(M[U].y);R.vertexLength+=M.length,R.primitiveLength+=M.length}const w=bd(E,v);for(let M=0;M<w.length;M+=3)this.indexArray.emplaceBack(x+w[M],x+w[M+1],x+w[M+2]);m.vertexLength+=S,m.primitiveLength+=w.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,d,h,g)}}let cx,ux,hx,dx;Ft(tg,"FillBucket",{omit:["layers","patternFeatures"]});class ig{constructor(e,i,o,h){if(this.triangleCount=i.length/3,this.min=new Se(0,0),this.max=new Se(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[l,d]=[e[0].clone(),e[0].clone()];for(let x=1;x<e.length;++x){const E=e[x];l.x=Math.min(l.x,E.x),l.y=Math.min(l.y,E.y),d.x=Math.max(d.x,E.x),d.y=Math.max(d.y,E.y)}if(h){const x=Math.ceil(Math.max(d.x-l.x,d.y-l.y)/h);o=Math.max(o,x)}if(o===0)return;this.min=l,this.max=d;const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const b=Math.max(g.x,g.y)/o;this.cellsX=Math.max(1,Math.ceil(g.x/b)),this.cellsY=Math.max(1,Math.ceil(g.y/b)),this.xScale=1/b,this.yScale=1/b;const S=[];for(let x=0;x<this.triangleCount;x++){const E=e[i[3*x+0]].sub(this.min),v=e[i[3*x+1]].sub(this.min),w=e[i[3*x+2]].sub(this.min),M=Oo(Math.floor(Math.min(E.x,v.x,w.x)),this.xScale,this.cellsX),R=Oo(Math.floor(Math.max(E.x,v.x,w.x)),this.xScale,this.cellsX),z=Oo(Math.floor(Math.min(E.y,v.y,w.y)),this.yScale,this.cellsY),U=Oo(Math.floor(Math.max(E.y,v.y,w.y)),this.yScale,this.cellsY),j=new Se(0,0),k=new Se(0,0),G=new Se(0,0),$=new Se(0,0);for(let K=z;K<=U;++K){j.y=k.y=K*b,G.y=$.y=(K+1)*b;for(let te=M;te<=R;++te)j.x=G.x=te*b,k.x=$.x=(te+1)*b,(tr(E,v,w,j,k,$)||tr(E,v,w,j,$,G))&&S.push({cellIdx:K*this.cellsX+te,triIdx:x})}}if(S.length===0)return;S.sort((x,E)=>x.cellIdx-E.cellIdx||x.triIdx-E.triIdx);let m=0;for(;m<S.length;){const x=S[m].cellIdx,E={start:this.payload.length,len:0};for(;m<S.length&&S[m].cellIdx===x;)++E.len,this.payload.push(S[m++].triIdx);this.cells[x]=E}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=Oo(e.x-this.min.x,this.xScale,this.cellsX),h=Oo(e.y-this.min.y,this.yScale,this.cellsY),l=this.cells[h*this.cellsX+o];if(l){this._lazyInitLookup();for(let d=0;d<l.len;d++){const g=this.payload[l.start+d],b=Math.floor(g/8),S=1<<g%8;if(!(this.lookup[b]&S)&&(this.lookup[b]|=S,i.push(g),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=Oo(e.x-this.min.x,this.xScale,this.cellsX),l=Oo(i.x-this.min.x,this.xScale,this.cellsX),d=Oo(e.y-this.min.y,this.yScale,this.cellsY),g=Oo(i.y-this.min.y,this.yScale,this.cellsY);for(let b=d;b<=g;b++)for(let S=h;S<=l;S++){const m=this.cells[b*this.cellsX+S];if(m)for(let x=0;x<m.len;x++){const E=this.payload[m.start+x],v=Math.floor(E/8),w=1<<E%8;if(!(this.lookup[v]&w)&&(this.lookup[v]|=w,o.push(E),o.length===this.triangleCount))return}}}}function Oo(s,e,i){return Math.max(0,Math.min(i-1,Math.floor(s*e)))}Ft(ig,"TriangleGridIndex");class fx{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,h){const l=[];for(const{feature:d,id:g,index:b,sourceLayerIndex:S}of e){const m=this.layers[0]._featureFilter.needGeometry,x=vt(d,m);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom),x,o))continue;const E={id:g,properties:d.properties,type:d.type,sourceLayerIndex:S,index:b,geometry:m?x.geometry:yt(d,o,h),patterns:{}};l.push(E)}for(const d of l){const{geometry:g,index:b,sourceLayerIndex:S}=d;this.addFeature(d,g,b,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[b].feature,g,b,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,h,l){}destroy(){}addFeature(e,i,o,h,l,d=[],g){for(const b of jp(i,2)){const S=[],m=[],x=[],E=new Se(1/0,1/0),v=new Se(-1/0,-1/0);for(const R of b)if(R.length!==0){R!==b[0]&&x.push(m.length/2);for(let z=0;z<R.length;z++)m.push(R[z].x),m.push(R[z].y),S.push(R[z]),E.x=Math.min(E.x,R[z].x),E.y=Math.min(E.y,R[z].y),v.x=Math.max(v.x,R[z].x),v.y=Math.max(v.y,R[z].y)}const w=bd(m,x),M=new ig(S,w,8,256);this.footprints.push({vertices:S,indices:w,grid:M,min:E,max:v})}}}Ft(fx,"ClipBucket",{omit:["layers"]});const TS=Bi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ES=Bi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),SS=Bi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),AS=Bi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),IS=Bi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),MS=Bi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:CS}=TS;var rg,px,ng,mx,sg,_x,gx,Gp={};function yx(){if(px)return rg;px=1;var s=ke();function e(h,l,d,g,b){this.properties={},this.extent=d,this.type=0,this._pbf=h,this._geometry=-1,this._keys=g,this._values=b,h.readFields(i,this,l)}function i(h,l,d){h==1?l.id=d.readVarint():h==2?function(g,b){for(var S=g.readVarint()+g.pos;g.pos<S;){var m=b._keys[g.readVarint()],x=b._values[g.readVarint()];b.properties[m]=x}}(d,l):h==3?l.type=d.readVarint():h==4&&(l._geometry=d.pos)}function o(h){for(var l,d,g=0,b=0,S=h.length,m=S-1;b<S;m=b++)g+=((d=h[m]).x-(l=h[b]).x)*(l.y+d.y);return g}return rg=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var l,d=h.readVarint()+h.pos,g=1,b=0,S=0,m=0,x=[];h.pos<d;){if(b<=0){var E=h.readVarint();g=7&E,b=E>>3}if(b--,g===1||g===2)S+=h.readSVarint(),m+=h.readSVarint(),g===1&&(l&&x.push(l),l=[]),l.push(new s(S,m));else{if(g!==7)throw new Error("unknown command "+g);l&&l.push(l[0].clone())}}return l&&x.push(l),x},e.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var l=h.readVarint()+h.pos,d=1,g=0,b=0,S=0,m=1/0,x=-1/0,E=1/0,v=-1/0;h.pos<l;){if(g<=0){var w=h.readVarint();d=7&w,g=w>>3}if(g--,d===1||d===2)(b+=h.readSVarint())<m&&(m=b),b>x&&(x=b),(S+=h.readSVarint())<E&&(E=S),S>v&&(v=S);else if(d!==7)throw new Error("unknown command "+d)}return[m,E,x,v]},e.prototype.toGeoJSON=function(h,l,d){var g,b,S=this.extent*Math.pow(2,d),m=this.extent*h,x=this.extent*l,E=this.loadGeometry(),v=e.types[this.type];function w(z){for(var U=0;U<z.length;U++){var j=z[U];z[U]=[360*(j.x+m)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+x)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(g=0;g<E.length;g++)M[g]=E[g][0];w(E=M);break;case 2:for(g=0;g<E.length;g++)w(E[g]);break;case 3:for(E=function(z){var U=z.length;if(U<=1)return[z];for(var j,k,G=[],$=0;$<U;$++){var K=o(z[$]);K!==0&&(k===void 0&&(k=K<0),k===K<0?(j&&G.push(j),j=[z[$]]):j.push(z[$]))}return j&&G.push(j),G}(E),g=0;g<E.length;g++)for(b=0;b<E[g].length;b++)w(E[g][b])}E.length===1?E=E[0]:v="Multi"+v;var R={type:"Feature",geometry:{type:v,coordinates:E},properties:this.properties};return"id"in this&&(R.id=this.id),R},rg}function xx(){if(mx)return ng;mx=1;var s=yx();function e(o,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(i,this,h),this.length=this._features.length}function i(o,h,l){o===15?h.version=l.readVarint():o===1?h.name=l.readString():o===5?h.extent=l.readVarint():o===2?h._features.push(l.pos):o===3?h._keys.push(l.readString()):o===4&&h._values.push(function(d){for(var g=null,b=d.readVarint()+d.pos;d.pos<b;){var S=d.readVarint()>>3;g=S===1?d.readString():S===2?d.readFloat():S===3?d.readDouble():S===4?d.readVarint64():S===5?d.readVarint():S===6?d.readSVarint():S===7?d.readBoolean():null}return g}(l))}return ng=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var h=this._pbf.readVarint()+this._pbf.pos;return new s(this._pbf,h,this.extent,this._keys,this._values)},ng}function vx(){return gx||(gx=1,Gp.VectorTile=function(){if(_x)return sg;_x=1;var s=xx();function e(i,o,h){if(i===3){var l=new s(h,h.readVarint()+h.pos);l.length&&(o[l.name]=l)}}return sg=function(i,o){this.layers=i.readFields(e,{},o)},sg}(),Gp.VectorTileFeature=yx(),Gp.VectorTileLayer=xx()),Gp}var Ru=vx();class lc extends Se{constructor(e,i,o){super(e,i),this.z=o}}class bx extends lc{constructor(e,i,o,h){super(e,i,o),this.w=h}}function $p(s,e,i,o){const h=[],l=o===0?(d,g,b,S,m,x)=>{d.push(new Se(x,b+(x-g)/(S-g)*(m-b)))}:(d,g,b,S,m,x)=>{d.push(new Se(g+(x-b)/(m-b)*(S-g),x))};for(const d of s){const g=[];for(const b of d){if(b.length<=2)continue;const S=[];for(let E=0;E<b.length-1;E++){const v=b[E].x,w=b[E].y,M=b[E+1].x,R=b[E+1].y,z=o===0?v:w,U=o===0?M:R;z<e?U>e&&l(S,v,w,M,R,e):z>i?U<i&&l(S,v,w,M,R,i):S.push(b[E]),U<e&&z>=e&&l(S,v,w,M,R,e),U>i&&z<=i&&l(S,v,w,M,R,i)}let m=b[b.length-1];const x=o===0?m.x:m.y;x>=e&&x<=i&&S.push(m),S.length&&(m=S[S.length-1],S[0].x===m.x&&S[0].y===m.y||S.push(S[0]),g.push(S))}g.length&&h.push(g)}return h}function wx(s,e,i,o){const h=i==="x"?"y":"x",l=(o-s[i])/(e[i]-s[i]);s[h]=s[h]+(e[h]-s[h])*l,s[i]=o,s.hasOwnProperty("z")&&(s.z=ii(s.z,e.z,l)),s.hasOwnProperty("w")&&(s.w=ii(s.w,e.w,l))}function Tx(s,e,i,o){const h=i,l=o;for(const d of["x","y"]){let g=s,b=e;g[d]>=b[d]&&(g=e,b=s),g[d]<h&&b[d]>h&&wx(g,b,d,h),g[d]<l&&b[d]>l&&wx(b,g,d,l)}}const qp=Number.MAX_SAFE_INTEGER;function Ex(s,e,i,o){return s.order<e||s.order===qp||!(s.clipMask&i)||function(h,l){return l.length!==0&&l.find(d=>d===h)===void 0}(o,s.clipScope)}function Hp(s,e){return s.x-e.x||s.y-e.y}function Sx(s,e){return Hp(s.min,e.min)===0&&Hp(s.max,e.max)===0}function og(s,e){return!(s.min.x>e.max.x||s.max.x<e.min.x||s.min.y>e.max.y||s.max.y<e.min.y)}function ag(s,e){if(s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(s[i].sourceId!==e[i].sourceId||!Sx(s[i],e[i])||s[i].order!==e[i].order||s[i].clipMask!==e[i].clipMask||!Ct(s[i].clipScope,e[i].clipScope))return!1;return!0}function Ax(s,e,i){const o=1/Mt,h=1/(1<<i.canonical.z),l=(e.x*o+i.canonical.x)*h+i.wrap,d=(e.y*o+i.canonical.y)*h;return{min:new Se((s.x*o+i.canonical.x)*h+i.wrap,(s.y*o+i.canonical.y)*h),max:new Se(l,d)}}function PS(s,e,i){const o=1<<i.canonical.z,h=((e.x-i.wrap)*o-i.canonical.x)*Mt,l=(e.y*o-i.canonical.y)*Mt;return{min:new Se(((s.x-i.wrap)*o-i.canonical.x)*Mt,(s.y*o-i.canonical.y)*Mt),max:new Se(h,l)}}function Ix(s,e,i,o,h,l,d){const g=s.indices,b=s.vertices,S=[];for(let m=o;m<o+h;m+=3){const x=e[i[m+0]+l],E=e[i[m+1]+l],v=e[i[m+2]+l],w=Math.min(x.x,E.x,v.x),M=Math.max(x.x,E.x,v.x),R=Math.min(x.y,E.y,v.y),z=Math.max(x.y,E.y,v.y);S.length=0,s.grid.query(new Se(w,R),new Se(M,z),S);for(let U=0;U<S.length;U++){const j=S[U];if(tr(b[g[3*j+0]],b[g[3*j+1]],b[g[3*j+2]],x,E,v,d))return!0}}return!1}function Mx(s,e,i,o){if(!s||!i)return!1;let h=s.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<s.vertices.length)return Mx(i,o,s,e);const l=e.canonical,d=o.canonical,g=Math.pow(2,d.z-l.z);h=s.vertices.map(b=>new Se((b.x+l.x*Mt)*g-d.x*Mt,(b.y+l.y*Mt)*g-d.y*Mt))}return Ix(i,h,s.indices,0,s.indices.length,0,0)}function Cx(s,e,i,o){const h=Math.pow(2,o.z-i.z);return new Se((s+i.x*Mt)*h-o.x*Mt,(e+i.y*Mt)*h-o.y*Mt)}function Px(s,e){const i=[];e.grid.queryPoint(s,i);const o=e.indices,h=e.vertices;for(let l=0;l<i.length;l++){const d=i[l];if(ur([h[o[3*d+0]],h[o[3*d+1]],h[o[3*d+2]]],s))return!0}return!1}const lg=[new Se(0,0),new Se(Mt,0),new Se(Mt,Mt),new Se(0,Mt)];function Rx(s,e){const i=[];let o=[];if(!e||s.length<2)return[s];if(s.length===2)return Fr(s[0],s[1],lg)?[s]:[];for(let h=0;h<s.length+2;h++){const l=s[h%s.length],d=s[(h+1)%s.length],g=Fr(h===0?s[s.length-1]:s[(h-1)%s.length],l,lg),b=Fr(l,d,lg),S=g||b;S&&o.push(l),S&&b||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const cg=Ru.VectorTileFeature.types,RS=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],LS=["fill-extrusion-flood-light-ground-radius"],DS=Math.pow(2,13),zS=Math.pow(2,15)-1,Lx=new Se(0,1),sl=2147483648;function Sd(s,e,i,o,h,l,d,g){s.emplaceBack((e<<1)+d,(i<<1)+l,(Math.floor(o*DS)<<1)+h,Math.round(g))}function Ad(s,e,i){s.emplaceBack(e.x*Mt,e.y*Mt,i?1:0)}function Wp(s,e,i,o,h,l){s.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+h,l)}function Id(s,e,i){s.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Dx{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class zx{constructor(){this.centroidXY=new Se(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Se(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Se(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Se(this.max.x-this.min.x,this.max.y-this.min.y)}}class Ox{constructor(){this.acc=new Se(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<e.min.x?(e.min.x=i.x,h=!0):i.x>e.max.x&&(e.max.x=i.x,h=!0),i.y<e.min.y?(e.min.y=i.y,h=!0):i.y>e.max.y&&(e.max.y=i.y,h=!0),((i.x===0||i.x===Mt)&&i.x===o.x)!=((i.y===0||i.y===Mt)&&i.y===o.y)&&this.processBorderOverlap(i,o),h&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,ii(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Mt!=e.x>Mt&&this.addBorderIntersection(1,ii(i.y,e.y,(Mt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,ii(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Mt!=e.y>Mt&&this.addBorderIntersection(3,ii(i.x,e.x,(Mt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Se(0,0):new Se(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function kx(s,e){const i=s.add(e)._unit(),o=$e(s.x*i.x+s.y*i.y,-1,1);var h,l,d;return d=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(d)))/4*zS*((h=s).x*(l=e).y-h.y*l.x<0?-1:1)}const OS=[s=>s.x<0,s=>s.x>Mt,s=>s.y<0,s=>s.y>Mt];function kS(s,e,i,o){const h=[4];if(o===0)return h;i._mult(o);const l=s.sub(i),d=e.sub(i),g=[s,e,l,d];for(let b=0;b<4;b++)for(const S of g)if(OS[b](S)){h.push(b);break}return h}class Fx{constructor(e){this.vertexArray=new vu,this.indexArray=new fn,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut},i=>LS.includes(i)),this._segments=new Ir,this.hiddenByLandmarkVertexArray=new Eu,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ir}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,h=!1){const l=e.length;if(l>2){let d=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let b;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const S=e[0],m=e[1];b=kx(S.sub(e[l-1])._perp()._unit(),m.sub(S)._perp()._unit())}for(let S=0;S<l;S++){const m=S===l-1?0:S+1,x=e[S],E=e[m],v=e[m===l-1?0:m+1],w=E.sub(x)._perp()._unit(),M=kx(w,v.sub(E)._perp()._unit()),R=b,z=M;if(ug(x,E,i)||h&&Ux(x,i)&&Ux(E,i)){b=M;continue}const U=g.vertexLength;Wp(this.vertexArray,x,E,1,1,R),Wp(this.vertexArray,x,E,1,0,R),Wp(this.vertexArray,x,E,0,1,z),Wp(this.vertexArray,x,E,0,0,z),g.vertexLength+=4;const j=kS(x,E,w,o);for(const k of j)this._segmentToGroundQuads[d].push({id:U,region:k}),this._segmentToRegionTriCounts[d][k]+=2,g.primitiveLength+=2;b=M}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((h,l)=>h.region-l.region);for(let o=0;o<i;o++){const h=this._segmentToGroundQuads[o],l=e[o],d=this._segmentToRegionTriCounts[o];d.reduce((b,S)=>b+S,0);let g=0;for(let b=0;b<=4;b++){const S=d[b];if(S!==0){let m=this.regionSegments[b];m||(m=this.regionSegments[b]=new Ir);const x={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+g,vertexLength:l.vertexLength,primitiveLength:S};m.get().push(x)}g+=S}for(let b=0;b<h.length;b++){const S=h[b].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,h,l,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,h,l,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,ES.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,h,l,d){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,h,l,d)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&sl?1:0;for(let h=e.groundVertexArrayOffset;h<i;++h)this.hiddenByLandmarkVertexArray.emplace(h,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,IS.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Zp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new fn,this.footprintVertices=new Mo,this.footprintSegments=[],this.layoutVertexArray=new Co,this.centroidVertexArray=new Cp,this.wallVertexArray=new pd,this.indexArray=new fn,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut},i=>RS.includes(i)),this.segments=new Ir,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Fx(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,o,h){this.features=[],this.hasPattern=Q_("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=be(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:l,id:d,index:g,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,m=vt(l,S);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom),m,o))continue;const x={id:d,sourceLayerIndex:b,index:g,geometry:S?m.geometry:yt(l,o,h),properties:l.properties,type:l.type,patterns:{}},E=this.layoutVertexArray.length,v=cg[x.type]==="Polygon";if(this.hasPattern)this.features.push(eg("fill-extrusion",this.layers,x,this.zoom,i));else if(this.wallMode)for(const w of x.geometry)for(const M of Rx(w,v))this.addFeature(x,[M],g,o,{},i.availableImages,h,i.brightness);else this.addFeature(x,x.geometry,g,o,{},i.availableImages,h,i.brightness);i.featureIndex.insert(l,x.geometry,g,b,this.index,E)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,h,l,d){for(const g of this.features){const b=cg[g.type]==="Polygon",{geometry:S}=g;if(this.wallMode)for(const m of S)for(const x of Rx(m,b))this.addFeature(g,[x],g.index,i,o,h,l,d);else this.addFeature(g,S,g.index,i,o,h,l,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,h,l){const d=Object.keys(e).length!==0;if(d&&!this.stateDependentLayers.length)return;const g=d?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,g,o,h,l),this.groundEffect.update(e,i,g,o,h,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,CS),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,AS.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,MS.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,SS.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,h,l,d,g,b){const S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,m=[new Se(0,0),new Se(Mt,Mt)],x=g.projection,E=x.name==="globe",v=this.wallMode||cg[e.type]==="Polygon",w=new Ox;w.centroidDataIndex=this.centroidData.length;const M=new zx,R=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},h)<=0,z=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},h);let U;if(M.height=z,M.vertexArrayOffset=this.layoutVertexArray.length,M.groundVertexArrayOffset=this.groundEffect.vertexArray.length,E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new bu),this.wallMode){if(E)return void ki("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;U=function(Q){const de=Q[0].x===Q[Q.length-1].x&&Q[0].y===Q[Q.length-1].y;(function(xt){let dt=0;const Wt=xt.length;for(let Pt=0;Pt<Wt;Pt++)dt+=(xt[(Pt+1)%Wt].x-xt[Pt].x)*(xt[(Pt+1)%Wt].y+xt[Pt].y);return dt>=0})(Q)||(Q=Q.reverse());const pe={geometry:[],joinNormals:[],indices:[]},Ee=[],Ce=[],Pe=[];let Re=Q.length;if(Re<(de?3:2))return pe;for(;Re>=2&&Q[Re-1].equals(Q[Re-2]);)Re--;let je,De,tt,ct,Ye,Rt=0;for(;Rt<Re-1&&Q[Rt].equals(Q[Rt+1]);)Rt++;de&&(je=Q[Re-2],Ye=Q[Rt].sub(je)._unit()._perp());for(let xt=Rt;xt<Re;xt++){if(tt=xt===Re-1?de?Q[Rt+1]:void 0:Q[xt+1],tt&&Q[xt].equals(tt))continue;Ye&&(ct=Ye),je&&(De=je),je=Q[xt],Ye=tt?tt.sub(je)._unit()._perp():ct,ct=ct||Ye;let dt=ct.add(Ye);dt.x===0&&dt.y===0||dt._unit();const Wt=dt.x*Ye.x+dt.y*Ye.y,Pt=Wt!==0?1/Wt:1/0,kt=ct.x*Ye.y-ct.y*Ye.x>0;let ai="miter";const vi=2;ai==="miter"&&Pt>vi&&(ai="bevel"),ai==="bevel"&&(Pt>100&&(ai="flipbevel"),Pt<vi&&(ai="miter"));const mi=(_i,wi,Ti,nr)=>{const Zi=new Se(_i.x,_i.y),ui=new Se(_i.x,_i.y);Zi.x+=wi.x*nr,Zi.y+=wi.y*nr,ui.x-=wi.x*Math.max(Ti,1),ui.y-=wi.y*Math.max(Ti,1),Pe.push(wi),Ee.push(Zi),Ce.push(ui)};if(ai==="miter")dt._mult(Pt),mi(je,dt,0,0);else if(ai==="flipbevel")dt=Ye.mult(-1),mi(je,dt,0,0),mi(je,dt.mult(-1),0,0);else{const _i=-Math.sqrt(Pt*Pt-1),wi=kt?_i:0,Ti=kt?0:_i;De&&mi(je,ct,wi,Ti),tt&&mi(je,Ye,wi,Ti)}}pe.geometry=[...Ee,...Ce.reverse(),Ee[0]],pe.joinNormals=[...Pe,...Pe.reverse(),Pe[Pe.length-1]];const At=pe.geometry.length-1;for(let xt=0;xt<At/2;xt++)if(xt+1<At/2){let dt=xt,Wt=xt+1,Pt=At-1-xt,kt=At-2-xt;dt=dt===0?At-1:dt-1,Wt=Wt===0?At-1:Wt-1,Pt=Pt===0?At-1:Pt-1,kt=kt===0?At-1:kt-1,pe.indices.push(Pt),pe.indices.push(Wt),pe.indices.push(dt),pe.indices.push(Pt),pe.indices.push(kt),pe.indices.push(Wt)}return pe}(i[0]),i=[U.geometry]}const j=(Q,de)=>Q<(de.length-1)/2||Q===de.length-1,k=this.wallMode?[i]:jp(i,500);for(let Q=k.length-1;Q>=0;Q--){const de=k[Q];(de.length===0||(G=de[0]).every(oe=>oe.x<=0)||G.every(oe=>oe.x>=Mt)||G.every(oe=>oe.y<=0)||G.every(oe=>oe.y>=Mt))&&k.splice(Q,1)}var G;let $;if(E)$=$x(k,m,h);else{$=[];for(const Q of k)$.push({polygon:Q,bounds:m})}const K=v?this.edgeRadius:0,te=K>0&&this.zoom<17,re=(Q,de)=>{if(Q.length===0)return!1;const oe=Q[Q.length-1];return de.x===oe.x&&de.y===oe.y};for(const{polygon:Q,bounds:de}of $){let oe=0,pe=0;for(const Re of Q)v&&!Re[0].equals(Re[Re.length-1])&&Re.push(Re[0]),pe+=v?Re.length-1:Re.length;const Ee=this.segments.prepareSegment((v?5:4)*pe,this.layoutVertexArray,this.indexArray);M.footprintSegIdx<0&&(M.footprintSegIdx=this.footprintSegments.length),M.polygonSegIdx<0&&(M.polygonSegIdx=this.polygonSegments.length);const Ce={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Pe=new Dx;if(Pe.vertexOffset=this.footprintVertices.length,Pe.indexOffset=3*this.footprintIndices.length,Pe.ringIndices=[],v){const Re=[],je=[];oe=Ee.vertexLength;for(let tt=0;tt<Q.length;tt++){const ct=Q[tt];ct.length&&tt!==0&&je.push(Re.length/2);const Ye=[];let Rt,At;Rt=ct[1].sub(ct[0])._perp()._unit(),Pe.ringIndices.push(ct.length-1);for(let xt=1;xt<ct.length;xt++){const dt=ct[xt],Wt=ct[xt===ct.length-1?1:xt+1],Pt=dt.clone();if(K){At=Wt.sub(dt)._perp()._unit();const kt=Rt.add(At)._unit(),ai=K*Math.min(4,1/(Rt.x*kt.x+Rt.y*kt.y));Pt.x+=ai*kt.x,Pt.y+=ai*kt.y,Pt.x=Math.round(Pt.x),Pt.y=Math.round(Pt.y),Rt=At}if(!R||K!==0&&!te||re(Ye,Pt)||Ye.push(Pt),Sd(this.layoutVertexArray,Pt.x,Pt.y,0,0,1,1,0),this.wallMode){const kt=j(xt,ct);Ad(this.wallVertexArray,U.joinNormals[xt],!kt)}Ee.vertexLength++,this.footprintVertices.emplaceBack(dt.x,dt.y),Re.push(dt.x,dt.y),E&&Id(this.layoutVertexExtArray,x.projectTilePoint(Pt.x,Pt.y,h),x.upVector(h,Pt.x,Pt.y))}R&&(K===0||te)&&(Ye.length!==0&&re(Ye,Ye[0])&&Ye.pop(),this.groundEffect.addData(Ye,de,S))}const De=this.wallMode?U.indices:bd(Re,je);for(let tt=0;tt<De.length;tt+=3)this.footprintIndices.emplaceBack(Pe.vertexOffset+De[tt+0],Pe.vertexOffset+De[tt+1],Pe.vertexOffset+De[tt+2]),this.indexArray.emplaceBack(oe+De[tt],oe+De[tt+2],oe+De[tt+1]),Ee.primitiveLength++;Pe.indexCount+=De.length,Pe.vertexCount+=this.footprintVertices.length-Pe.vertexOffset}for(let Re=0;Re<Q.length;Re++){const je=Q[Re];w.startRing(M,je[0]);let De=je.length>4&&Vx(je[je.length-2],je[0],je[1]),tt=K?FS(je[je.length-2],je[0],je[1],K):0;const ct=[];let Ye,Rt,At;Rt=je[1].sub(je[0])._perp()._unit();let xt=!0;for(let dt=1,Wt=0;dt<je.length;dt++){let Pt=je[dt-1],kt=je[dt];const ai=je[dt===je.length-1?1:dt+1];if(w.appendEdge(M,kt,Pt),ug(kt,Pt,de)){K&&(Rt=ai.sub(kt)._perp()._unit(),xt=!xt);continue}const vi=kt.sub(Pt)._perp(),mi=vi.x/(Math.abs(vi.x)+Math.abs(vi.y)),_i=vi.y>0?1:0,wi=Pt.dist(kt);if(Wt+wi>32768&&(Wt=0),K){At=ai.sub(kt)._perp()._unit();let ui=Nx(Pt,kt,ai,Bx(Rt,At),K);isNaN(ui)&&(ui=0);const Vi=kt.sub(Pt)._unit();Pt=Pt.add(Vi.mult(tt))._round(),kt=kt.add(Vi.mult(-ui))._round(),tt=ui,Rt=At,R&&this.zoom>=17&&(re(ct,Pt)||ct.push(Pt),re(ct,kt)||ct.push(kt))}const Ti=Ee.vertexLength,nr=je.length>4&&Vx(Pt,kt,ai);let Zi=jx(Wt,De,xt);if(Sd(this.layoutVertexArray,Pt.x,Pt.y,mi,_i,0,0,Zi),Sd(this.layoutVertexArray,Pt.x,Pt.y,mi,_i,0,1,Zi),this.wallMode){const ui=j(dt-1,je),Vi=U.joinNormals[dt-1];Ad(this.wallVertexArray,Vi,ui),Ad(this.wallVertexArray,Vi,ui)}if(Wt+=wi,Zi=jx(Wt,nr,!xt),De=nr,Sd(this.layoutVertexArray,kt.x,kt.y,mi,_i,0,0,Zi),Sd(this.layoutVertexArray,kt.x,kt.y,mi,_i,0,1,Zi),this.wallMode){const ui=j(dt,je),Vi=U.joinNormals[dt];Ad(this.wallVertexArray,Vi,ui),Ad(this.wallVertexArray,Vi,ui)}if(Ee.vertexLength+=4,this.indexArray.emplaceBack(Ti+0,Ti+1,Ti+2),this.indexArray.emplaceBack(Ti+1,Ti+3,Ti+2),Ee.primitiveLength+=2,K){const ui=oe+(dt===1?je.length-2:dt-2),Vi=dt===1?oe:ui+1;if(this.indexArray.emplaceBack(Ti+1,ui,Ti+3),this.indexArray.emplaceBack(ui,Vi,Ti+3),Ee.primitiveLength+=2,Ye===void 0&&(Ye=Ti),!ug(ai,je[dt],de)){const Gi=dt===je.length-1?Ye:Ee.vertexLength;this.indexArray.emplaceBack(Ti+2,Ti+3,Gi),this.indexArray.emplaceBack(Ti+3,Gi+1,Gi),this.indexArray.emplaceBack(Ti+3,Vi,Gi+1),Ee.primitiveLength+=3}xt=!xt}if(E){const ui=this.layoutVertexExtArray,Vi=x.projectTilePoint(Pt.x,Pt.y,h),Gi=x.projectTilePoint(kt.x,kt.y,h),hr=x.upVector(h,Pt.x,Pt.y),Lr=x.upVector(h,kt.x,kt.y);Id(ui,Vi,hr),Id(ui,Vi,hr),Id(ui,Gi,Lr),Id(ui,Gi,Lr)}}v&&(oe+=je.length-1),R&&K&&this.zoom>=17&&(ct.length!==0&&re(ct,ct[0])&&ct.pop(),this.groundEffect.addData(ct,de,S,K>0))}this.footprintSegments.push(Pe),Ce.triangleCount=this.indexArray.length-Ce.triangleArrayOffset,this.polygonSegments.push(Ce),++M.footprintSegLen,++M.polygonSegLen}if(M.vertexCount=this.layoutVertexArray.length-M.vertexArrayOffset,M.groundVertexCount=this.groundEffect.vertexArray.length-M.groundVertexArrayOffset,M.vertexCount!==0){if(M.centroidXY=w.borders?Lx:this.encodeCentroid(w,M),this.centroidData.push(M),w.borders){this.featuresOnBorder.push(w);const Q=this.featuresOnBorder.length-1;for(let de=0;de<w.borders.length;de++)w.borders[de][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[de].push(Q)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,d,h,b),this.groundEffect.addPaintPropertiesData(e,o,l,d,h,b),this.maxHeight=Math.max(this.maxHeight,z)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const b=this.centroidData[g],S=+(b.min.y+b.max.y>Mt),m=2*S+(+(b.min.x+b.max.x>Mt)^S);for(let x=0;x<b.polygonSegLen;x++){const E=b.polygonSegIdx+x;e.push({centroidIdx:g,subtile:m,polygonSegmentIdx:E,triangleSegmentIdx:this.polygonSegments[E].triangleSegIdx})}}const i=new fn;e.sort((g,b)=>g.triangleSegmentIdx===b.triangleSegmentIdx?g.subtile-b.subtile:g.triangleSegmentIdx-b.triangleSegmentIdx);let o=0,h=0,l=0;for(const g of e){if(g.triangleSegmentIdx!==o)break;l++}const d=e.length;for(;h!==e.length;){o=e[h].triangleSegmentIdx;let g=0,b=h,S=h;for(let m=b;m<l&&e[m].subtile===g;m++)S++;for(;b!==l;){const m=e[b];g=m.subtile;const x=this.centroidData[m.centroidIdx].min.clone(),E=this.centroidData[m.centroidIdx].max.clone(),v={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let w=b;w<S;w++){const M=e[w],R=this.polygonSegments[M.polygonSegmentIdx],z=this.centroidData[M.centroidIdx].min,U=this.centroidData[M.centroidIdx].max,j=this.indexArray.uint16;for(let k=R.triangleArrayOffset;k<R.triangleArrayOffset+R.triangleCount;k++)i.emplaceBack(j[3*k],j[3*k+1],j[3*k+2]);v.primitiveLength+=R.triangleCount,x.x=Math.min(x.x,z.x),x.y=Math.min(x.y,z.y),E.x=Math.max(E.x,U.x),E.y=Math.max(E.y,U.y)}v.primitiveLength>0&&this.triangleSubSegments.push({segment:v,min:x,max:E}),b=S;for(let w=b;w<l&&e[w].subtile===e[b].subtile;w++)S++}h=l;for(let m=h;m<d&&e[m].triangleSegmentIdx===e[h].triangleSegmentIdx;m++)l++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const h=new Ir;if(this.wallMode){for(const M of this.triangleSubSegments)h.segments.push(M.segment);return h}let l=0,d=0;const g=1<<e.canonical.z;if(i){const M=i.getMinMaxForTile(e);M&&(l=M.min,d=M.max)}d+=this.maxHeight;const b=e.toUnwrapped();let S;const m=[b.canonical.x/g+b.wrap,b.canonical.y/g],x=[(b.canonical.x+1)/g+b.wrap,(b.canonical.y+1)/g],E=(M,R,z)=>[M[0]*(1-z[0])+R[0]*z[0],M[1]*(1-z[1])+R[1]*z[1]],v=[],w=[];for(const M of this.triangleSubSegments){v[0]=M.min.x/Mt,v[1]=M.min.y/Mt,w[0]=M.max.x/Mt,w[1]=M.max.y/Mt;const R=E(m,x,v),z=E(m,x,w);if(new lr([R[0],R[1],l],[z[0],z[1],d]).intersectsPrecise(o)===0){S&&(h.segments.push(S),S=void 0);continue}const U=M.segment;S&&S.vertexOffset!==U.vertexOffset&&(h.segments.push(S),S=void 0),S?(S.vertexLength+=U.vertexLength,S.primitiveLength+=U.primitiveLength):S={vertexOffset:U.vertexOffset,primitiveLength:U.primitiveLength,vertexLength:U.vertexLength,primitiveOffset:U.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&h.segments.push(S),h}encodeCentroid(e,i){const o=e.centroid(),h=i.span(),l=Math.min(7,Math.round(h.x*this.tileToMeter/10)),d=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Se($e(o.x,1,Mt-1)<<3|l,$e(o.y,1,Mt-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new Se(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const h=i[0][0]!==o?0:1;return new Se(6|(i[0][0]!==o?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==o?2:3;return new Se((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=sl,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,h=e.flags&sl?Lx:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||l!==h.x){for(let d=i;d<o;++d)this.centroidVertexArray.emplace(d,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(ag(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const l=[];for(const d of this.activeReplacements){if(d.order<o)continue;const g=Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z);for(const b of this.centroidData)if(!(b.flags&sl||d.min.x>b.max.x||b.min.x>d.max.x||d.min.y>b.max.y||b.min.y>d.max.y))for(let S=0;S<b.footprintSegLen;S++){const m=this.footprintSegments[b.footprintSegIdx+S];if(l.length=0,BS(this.footprintVertices,m.vertexOffset,m.vertexCount,d.footprintTileId.canonical,e.canonical,l),Ix(d.footprint,l,this.footprintIndices.uint16,m.indexOffset,m.indexCount,-m.vertexOffset,-g)){b.flags|=sl;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let h=!1;for(let l=0;l<o.footprintSegLen;l++){const d=this.footprintSegments[o.footprintSegIdx+l];let g=0;for(const b of d.ringIndices){for(let S=g,m=b+g-1;S<b+g;m=S++){const x=this.footprintVertices.int16[2*(S+d.vertexOffset)+0],E=this.footprintVertices.int16[2*(S+d.vertexOffset)+1],v=this.footprintVertices.int16[2*(m+d.vertexOffset)+1];E>i!=v>i&&e<(this.footprintVertices.int16[2*(m+d.vertexOffset)+0]-x)*(i-E)/(v-E)+x&&(h=!h)}g=b}}return h}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,h=!0;const l=4*(e+Mt)*Mt+(i+Mt);if(this.partLookup.hasOwnProperty(l)){const d=this.partLookup[l];return d?{height:d.height,hidden:!!(d.flags&sl)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||i>d.max.y||d.min.y>i||this.footprintContainsPoint(e,i,d)&&d&&d.height>o&&(o=d.height,this.partLookup[l]=d,h=!!(d.flags&sl));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:h};this.partLookup[l]=void 0}}function Bx(s,e){const i=s.add(e)._unit();return s.x*i.x+s.y*i.y}function FS(s,e,i,o){const h=e.sub(s)._perp()._unit(),l=i.sub(e)._perp()._unit();return Nx(s,e,i,Bx(h,l),o)}function Nx(s,e,i,o,h){const l=Math.sqrt(1-o*o);return Math.min(s.dist(e)/3,e.dist(i)/3,h*l/o)}function ug(s,e,i){return s.x<i[0].x&&e.x<i[0].x||s.x>i[1].x&&e.x>i[1].x||s.y<i[0].y&&e.y<i[0].y||s.y>i[1].y&&e.y>i[1].y}function Ux(s,e){return s.x<e[0].x||s.x>e[1].x||s.y<e[0].y||s.y>e[1].y}function Vx(s,e,i){if(s.x<0||s.x>=Mt||e.x<0||e.x>=Mt||i.x<0||i.x>=Mt)return!1;const o=i.sub(e),h=o.perp(),l=s.sub(e);return(o.x*l.x+o.y*l.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(l.x*l.x+l.y*l.y))>-.866&&h.x*l.x+h.y*l.y<0}function jx(s,e,i){const o=e?2|s:-3&s;return i?1|o:-2&o}function Gx(){const s=Math.PI/32,e=Math.tan(s),i=F;return i*Math.sqrt(1+2*e*e)-i}function $x(s,e,i){const o=1<<i.z,h=ce(i.x/o),l=ce((i.x+1)/o),d=le(i.y/o),g=le((i.y+1)/o);return function(b,S,m,x,E=0,v){const w=[];if(!b.length||!m||!x)return w;const M=($,K)=>{for(const te of $)w.push({polygon:te,bounds:K})},R=Math.ceil(Math.log2(m)),z=Math.ceil(Math.log2(x)),U=R-z,j=[];for(let $=0;$<Math.abs(U);$++)j.push(U>0?0:1);for(let $=0;$<Math.min(R,z);$++)j.push(0),j.push(1);let k=b;if(k=$p(k,S[0].y-E,S[1].y+E,1),k=$p(k,S[0].x-E,S[1].x+E,0),!k.length)return w;const G=[];for(j.length?G.push({polygons:k,bounds:S,depth:0}):M(k,S);G.length;){const $=G.pop(),K=$.depth,te=j[K],re=$.bounds[0],Q=$.bounds[1],de=te===0?re.x:re.y,oe=te===0?Q.x:Q.y,pe=v?v(te,de,oe):.5*(de+oe),Ee=$p($.polygons,de-E,pe+E,te),Ce=$p($.polygons,pe-E,oe+E,te);if(Ee.length){const Pe=[re,new Se(te===0?pe:Q.x,te===1?pe:Q.y)];j.length>K+1?G.push({polygons:Ee,bounds:Pe,depth:K+1}):M(Ee,Pe)}if(Ce.length){const Pe=[new Se(te===0?pe:re.x,te===1?pe:re.y),Q];j.length>K+1?G.push({polygons:Ce,bounds:Pe,depth:K+1}):M(Ce,Pe)}}return w}(s,e,Math.ceil((l-h)/11.25),Math.ceil((d-g)/11.25),1,(b,S,m)=>{if(b===0)return .5*(S+m);{const x=le((i.y+S/Mt)/o);return(se(.5*(le((i.y+m/Mt)/o)+x))*o-i.y)*Mt}})}function BS(s,e,i,o,h,l){const d=Math.pow(2,o.z-h.z);for(let g=0;g<i;g++){let b=s.int16[2*(g+e)+0],S=s.int16[2*(g+e)+1];b=(b+h.x*Mt)*d-o.x*Mt,S=(S+h.y*Mt)*d-o.y*Mt,l.push(new Se(b,S))}}let qx,Hx;function Md(s,e){return s.x*e.x+s.y*e.y}function Wx(s,e){if(s.length===1){let i=0;const o=e[i++];let h;for(;!h||o.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const l=e[i],d=s[0],g=h.sub(o),b=l.sub(o),S=d.sub(o),m=Md(g,g),x=Md(g,b),E=Md(b,b),v=Md(S,g),w=Md(S,b),M=m*E-x*x,R=(E*v-x*w)/M,z=(m*w-x*v)/M,U=o.z*(1-R-z)+h.z*R+l.z*z;if(isFinite(U))return U}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function Zx(s,e,i,o,h,l,d,g){const b=d*h.getElevationAt(s,e,!0,!0),S=l[0]!==0,m=S?l[1]===0?d*(l[0]/7-450):d*function(x,E,v){const w=Math.floor(E[0]/8),M=Math.floor(E[1]/8),R=10*(E[0]-8*w),z=10*(E[1]-8*M),U=x.getElevationAt(w,M,!0,!0),j=x.getMeterToDEM(v),k=Math.floor(.5*(R*j-1)),G=Math.floor(.5*(z*j-1)),$=x.tileCoordToPixel(w,M),K=2*k+1,te=2*G+1,re=function(Ce,Pe,Re,je,De){return[Ce.getElevationAtPixel(Pe,Re,!0),Ce.getElevationAtPixel(Pe+De,Re,!0),Ce.getElevationAtPixel(Pe,Re+De,!0),Ce.getElevationAtPixel(Pe+je,Re+De,!0)]}(x,$.x-k,$.y-G,K,te),Q=Math.abs(re[0]-re[1]),de=Math.abs(re[2]-re[3]),oe=Math.abs(re[0]-re[2])+Math.abs(re[1]-re[3]),pe=Math.min(.25,.5*j*(Q+de)/K),Ee=Math.min(.25,.5*j*oe/te);return U+Math.max(pe*R,Ee*z)}(h,l,g):b;return{base:b+(i===0)?-1:i,top:S?Math.max(m+o,b+i+2):b+o}}Ft(Zp,"FillExtrusionBucket",{omit:["layers","features"]}),Ft(zx,"PartData"),Ft(Dx,"FootprintSegment"),Ft(Ox,"BorderCentroidData"),Ft(Fx,"GroundEffect");const NS=Bi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),US=Bi([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:VS}=NS,jS=Bi([{name:"a_packed",components:4,type:"Float32"}]),{members:GS}=jS,$S=Bi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:qS}=$S;class Xx{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new nl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=hn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const h=[];let l=e.length%2==1?-e[e.length-1]*o:0,d=e[0]*o,g=!0;h.push({left:l,right:d,isDash:g,zeroLength:e[0]===0});let b=e[0];for(let S=1;S<e.length;S++){g=!g;const m=e[S];l=b*o,b+=m,d=b*o,h.push({left:l,right:d,isDash:g,zeroLength:m===0})}return h}addRoundDash(e,i,o){const h=i/2;for(let l=-o;l<=o;l++){const d=this.width*(this.nextRow+o+l);let g=0,b=e[g];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++g]);const m=Math.abs(S-b.left),x=Math.abs(S-b.right),E=Math.min(m,x);let v;const w=l/o*(h+1);if(b.isDash){const M=h-Math.abs(w);v=Math.sqrt(E*E+M*M)}else v=h-Math.sqrt(E*E+w*w);this.image.data[d+S]=Math.max(0,Math.min(255,v+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){const S=e[b],m=e[b+1];S.zeroLength?e.splice(b,1):m&&m.isDash===S.isDash&&(m.left=S.left,e.splice(b,1))}const o=e[0],h=e[e.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);const l=this.width*this.nextRow;let d=0,g=e[d];for(let b=0;b<this.width;b++){b/g.right>1&&(g=e[++d]);const S=Math.abs(b-g.left),m=Math.abs(b-g.right),x=Math.min(S,m);this.image.data[l+b]=Math.max(0,Math.min(255,(g.isDash?x:-x)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const h=i==="round",l=h?7:0,d=2*l+1;if(this.nextRow+d>this.height)return ki("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let m=0;m<e.length;m++)e[m]<0&&(ki("Negative value is found in line dasharray, replacing values with 0"),e[m]=0),g+=e[m];if(g!==0){const m=this.width/g,x=this.getDashRanges(e,this.width,m);h?this.addRoundDash(x,m,l):this.addRegularDash(x,i==="square"?.5*m:0)}const b=this.nextRow+l;this.nextRow+=d;const S={tl:[b,l],br:[g,0]};return this.positions[o]=S,S}}Ft(Xx,"LineAtlas");const HS=Ru.VectorTileFeature.types,WS=Math.cos(Math.PI/180*37.5),ZS=Math.cos(Math.PI/180*5);class hg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new nd,this.layoutVertexArray2=new ro,this.patternVertexArray=new Po,this.indexArray=new fn,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Ir,this.maxLineLength=0,this.zOffsetVertexArray=new Ka,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Mt/64}updateFootprints(e,i){}populate(e,i,o,h){this.hasPattern=Q_("line",this.layers,i);const l=this.layers[0].layout.get("line-sort-key"),d=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!d.isConstant()||!!d.constantOr(0);const g=[];for(const{feature:x,id:E,index:v,sourceLayerIndex:w}of e){const M=this.layers[0]._featureFilter.needGeometry,R=vt(x,M);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom),R,o))continue;const z=l?l.evaluate(R,{},o):void 0,U={id:E,properties:x.properties,type:x.type,sourceLayerIndex:w,index:v,geometry:M?R.geometry:yt(x,o,h),patterns:{},sortKey:z};g.push(U)}l&&g.sort((x,E)=>x.sortKey-E.sortKey);const{lineAtlas:b,featureIndex:S}=i,m=this.addConstantDashes(b);for(const x of g){const{geometry:E,index:v,sourceLayerIndex:w}=x;if(m&&this.addFeatureDashes(x,b),this.hasPattern){const M=eg("line",this.layers,x,this.zoom,i);this.patternFeatures.push(M)}else this.addFeature(x,E,v,o,b.positions,i.availableImages,i.brightness);S.insert(e[v].feature,E,v,w,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const h=o.paint.get("line-dasharray").value,l=o.layout.get("line-cap").value;if(h.kind!=="constant"||l.kind!=="constant")i=!0;else{const d=l.value,g=h.value;if(!g)continue;e.addDash(g,d)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const h of this.layers){const l=h.paint.get("line-dasharray").value,d=h.layout.get("line-cap").value;if(l.kind==="constant"&&d.kind==="constant")continue;let g,b;if(l.kind==="constant"){if(g=l.value,!g)continue}else g=l.evaluate({zoom:o},e);b=d.kind==="constant"?d.value:d.evaluate({zoom:o},e),i.addDash(g,b),e.patterns[h.id]=i.getKey(g,b)}}update(e,i,o,h,l){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,d?this.stateDependentLayers:this.layers,o,h,l)}addFeatures(e,i,o,h,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,h,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,GS)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,qS)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,US.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,VS),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,h,l,d,g){const b=this.layers[0].layout,S=b.get("line-join").evaluate(e,{}),m=b.get("line-cap").evaluate(e,{}),x=b.get("line-miter-limit"),E=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const v of i)this.addLine(v,e,h,S,m,x,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,d,h,g)}addLine(e,i,o,h,l,d,g){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const b={zoom:this.zoom,lineProgress:void 0},S=this.layers[0].layout,m=h==="none";if(this.patternJoinNone=this.hasPattern&&m,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let $=0;$<e.length-1;$++)this.totalDistance+=e[$].dist(e[$+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=HS[i.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let v=0;for(;v<E-1&&e[v].equals(e[v+1]);)v++;if(E<(x?3:2))return;h==="bevel"&&(d=1.05);const w=this.overscaling<=16?15*Mt/(512*this.overscaling):0,M=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let R,z,U,j,k,G;this.e1=this.e2=-1,x&&(R=e[E-2],k=e[v].sub(R)._unit()._perp());for(let $=v;$<E;$++){if(U=$===E-1?x?e[v+1]:void 0:e[$+1],U&&e[$].equals(U))continue;if(k&&(j=k),R&&(z=R),R=e[$],this.hasZOffset){const Pe=S.get("line-z-offset").value;if(Pe.kind==="constant")G=Pe.value;else{if(this.lineClips){const Re=this.totalDistance/(this.lineClips.end-this.lineClips.start);b.lineProgress=(Re*this.lineClips.start+this.distance+(z?z.dist(R):0))/Re}else ki(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),b.lineProgress=0;G=Pe.evaluate(b,i)}G=G||0}k=U?U.sub(R)._unit()._perp():j,j=j||k;const K=z&&U;let te=K?h:x||m?"butt":l;const re=j.x*k.x+j.y*k.y;if(m){const Pe=function(Re){if(Re.patternJoinNone){const je=Re.segmentPoints.length/2,De=Re.lineSoFar-Re.segmentStart;for(let tt=0;tt<je;++tt){const ct=Re.segmentPoints[2*tt+1],Ye=Math.round(Re.segmentPoints[2*tt])+.5+.25*ct;Re.patternVertexArray.emplaceBack(Ye,De,Re.segmentStart),Re.patternVertexArray.emplaceBack(Ye,De,Re.segmentStart)}Re.segmentPoints.length=0}Re.e1=Re.e2=-1};if(K&&re<ZS){this.updateDistance(z,R),this.addCurrentVertex(R,j,1,1,M,G),Pe(this),this.addCurrentVertex(R,k,-1,-1,M,G);continue}if(z){if(!U){this.updateDistance(z,R),this.addCurrentVertex(R,j,1,1,M,G),Pe(this);continue}te="miter"}}let Q=j.add(k);Q.x===0&&Q.y===0||Q._unit();const de=Q.x*k.x+Q.y*k.y,oe=de!==0?1/de:1/0,pe=2*Math.sqrt(2-2*de),Ee=de<WS&&z&&U,Ce=j.x*k.y-j.y*k.x>0;if(Ee&&$>v){const Pe=R.dist(z);if(Pe>2*w){const Re=R.sub(R.sub(z)._mult(w/Pe)._round());this.updateDistance(z,Re),this.addCurrentVertex(Re,j,0,0,M,G),z=Re}}if(K&&te==="round"&&(oe<g?te="miter":oe<=2&&(te="fakeround")),te==="miter"&&oe>d&&(te="bevel"),te==="bevel"&&(oe>2&&(te="flipbevel"),oe<d&&(te="miter")),z&&this.updateDistance(z,R),te==="miter")Q._mult(oe),this.addCurrentVertex(R,Q,0,0,M,G);else if(te==="flipbevel"){if(oe>100)Q=k.mult(-1);else{const Pe=oe*j.add(k).mag()/j.sub(k).mag();Q._perp()._mult(Pe*(Ce?-1:1))}this.addCurrentVertex(R,Q,0,0,M,G),this.addCurrentVertex(R,Q.mult(-1),0,0,M,G)}else if(te==="bevel"||te==="fakeround"){const Pe=-Math.sqrt(oe*oe-1),Re=Ce?Pe:0,je=Ce?0:Pe;if(z&&this.addCurrentVertex(R,j,Re,je,M,G),te==="fakeround"){const De=Math.round(180*pe/Math.PI/20);for(let tt=1;tt<De;tt++){let ct=tt/De;if(ct!==.5){const Rt=ct-.5;ct+=ct*Rt*(ct-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*Rt*Rt+(.848013+re*(.215638*re-1.06021)))}const Ye=k.sub(j)._mult(ct)._add(j)._unit()._mult(Ce?-1:1);this.addHalfVertex(R,Ye.x,Ye.y,!1,Ce,0,M,G)}}U&&this.addCurrentVertex(R,k,-Re,-je,M,G)}else te==="butt"?this.addCurrentVertex(R,Q,0,0,M,G):te==="square"?(z||this.addCurrentVertex(R,Q,-1,-1,M,G),this.addCurrentVertex(R,Q,0,0,M,G),z&&this.addCurrentVertex(R,Q,1,1,M,G)):te==="round"&&(z&&(this.addCurrentVertex(R,j,0,0,M,G),this.addCurrentVertex(R,j,1,1,M,G,!0)),U&&(this.addCurrentVertex(R,k,-1,-1,M,G,!0),this.addCurrentVertex(R,k,0,0,M,G)));if(Ee&&$<E-1){const Pe=R.dist(U);if(Pe>2*w){const Re=R.add(U.sub(R)._mult(w/Pe)._round());this.updateDistance(R,Re),this.addCurrentVertex(Re,k,0,0,M,G),R=Re}}}}addVerticesTo(e,i,o,h,l,d,g,b,S,m){const x=(i.w-e.w)/this.tessellationStep|0;if(x>1){this.lineSoFar=e.w;const E=(i.x-e.x)/x,v=(i.y-e.y)/x,w=(i.z-e.z)/x,M=(i.w-e.w)/x;for(let R=1;R<x;++R)e.x+=E,e.y+=v,e.z+=w,this.lineSoFar+=M,this.addHalfVertex(e,o,h,m,!1,g,S,e.z),this.addHalfVertex(e,l,d,m,!0,-b,S,e.z)}this.lineSoFar=i.w,this.addHalfVertex(i,o,h,m,!1,g,S,i.z),this.addHalfVertex(i,l,d,m,!0,-b,S,i.z)}addCurrentVertex(e,i,o,h,l,d,g=!1){const b=i.x+i.y*o,S=i.y-i.x*o,m=i.y*h-i.x,x=-i.y-i.x*h;if(d!=null){const v=Mt+10,w=d,M=new bx(e.x,e.y,w,this.lineSoFar),R=Yx(e,-10,v),z=this.lineSoFar;if(this.currentVertex)if(R){const U=this.currentVertexIsOutside,j=this.currentVertex,k=new bx(e.x,e.y,w,this.lineSoFar);Tx(j,k,-10,v),Yx(k,-10,v)||(U&&(this.e1=this.e2=-1,this.lineSoFar=j.w,this.addHalfVertex(j,b,S,g,!1,o,l,j.z),this.addHalfVertex(j,m,x,g,!0,-h,l,j.z)),this.addVerticesTo(j,k,b,S,m,x,o,h,l,g))}else{const U=this.currentVertex;this.currentVertexIsOutside&&(Tx(U,M,-10,v),this.e1=this.e2=-1,this.lineSoFar=U.w,this.addHalfVertex(U,b,S,g,!1,o,l,U.z),this.addHalfVertex(U,m,x,g,!0,-h,l,U.z)),this.addVerticesTo(U,M,b,S,m,x,o,h,l,g)}else R||(this.addHalfVertex(e,b,S,g,!1,o,l,d),this.addHalfVertex(e,m,x,g,!0,-h,l,d));this.currentVertex=M,this.currentVertexIsOutside=R,this.lineSoFar=z}else this.addHalfVertex(e,b,S,g,!1,o,l,d),this.addHalfVertex(e,m,x,g,!0,-h,l,d)}addHalfVertex({x:e,y:i},o,h,l,d,g,b,S){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),d||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(i<<1)+(d?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const m=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,m),b.primitiveLength++),d?this.e2=m:this.e1=m,S!=null&&this.zOffsetVertexArray.emplaceBack(S)}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}function Yx(s,e,i){return s.x<e||s.x>i||s.y<e||s.y>i}let Kx,Jx;function Qx(s,e,i){return e*(Mt/(s.tileSize*Math.pow(2,i-s.tileID.overscaledZ)))}function ev(s,e){return 1/Qx(s,1,e.tileZoom)}function tv(s,e,i,o){return s.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}Ft(hg,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const iv=s=>{const e=[];rv(s)&&e.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=s.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=s.layout.get("line-join").constantOr("miter")==="none",h=!!s.paint.get("line-pattern").constantOr(1);return o&&h&&e.push("LINE_JOIN_NONE"),e};function rv(s){const e=s.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let dg;const nv=()=>dg||(dg={layout:Kx||(Kx=new pr({"line-cap":new qt(Ue.layout_line["line-cap"]),"line-join":new qt(Ue.layout_line["line-join"]),"line-miter-limit":new bt(Ue.layout_line["line-miter-limit"]),"line-round-limit":new bt(Ue.layout_line["line-round-limit"]),"line-sort-key":new qt(Ue.layout_line["line-sort-key"]),"line-z-offset":new qt(Ue.layout_line["line-z-offset"]),visibility:new bt(Ue.layout_line.visibility)})),paint:Jx||(Jx=new pr({"line-opacity":new qt(Ue.paint_line["line-opacity"]),"line-color":new qt(Ue.paint_line["line-color"]),"line-translate":new bt(Ue.paint_line["line-translate"]),"line-translate-anchor":new bt(Ue.paint_line["line-translate-anchor"]),"line-width":new qt(Ue.paint_line["line-width"]),"line-gap-width":new qt(Ue.paint_line["line-gap-width"]),"line-offset":new qt(Ue.paint_line["line-offset"]),"line-blur":new qt(Ue.paint_line["line-blur"]),"line-dasharray":new qt(Ue.paint_line["line-dasharray"]),"line-pattern":new qt(Ue.paint_line["line-pattern"]),"line-gradient":new Ss(Ue.paint_line["line-gradient"]),"line-trim-offset":new bt(Ue.paint_line["line-trim-offset"]),"line-trim-fade-range":new bt(Ue.paint_line["line-trim-fade-range"]),"line-trim-color":new bt(Ue.paint_line["line-trim-color"]),"line-emissive-strength":new bt(Ue.paint_line["line-emissive-strength"]),"line-border-width":new qt(Ue.paint_line["line-border-width"]),"line-border-color":new qt(Ue.paint_line["line-border-color"]),"line-occlusion-opacity":new bt(Ue.paint_line["line-occlusion-opacity"])}))},dg);class XS extends qt{possiblyEvaluate(e,i){return i=new Ar(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,h){return i=Si({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,h)}}let Cd;function sv(s,e){return e>0?e+2*s:s}const YS=Bi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),KS=Bi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),JS=Bi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Bi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const QS=Bi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),eA=Bi([{name:"a_texb",components:2,type:"Uint16"}]),tA=Bi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),iA=Bi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Bi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ov=Bi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rA=Bi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Bi([{name:"triangle",components:3,type:"Uint16"}]),Bi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Bi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Bi([{type:"Float32",name:"offsetX"}]),Bi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var yn=24;const lo=128;function fg(s,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Ar(s+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=i;let l=0;for(;l<o.length&&o[l]<=s;)l++;l=Math.max(0,l-1);let d=l;for(;d<o.length&&o[d]<s+1;)d++;d=Math.min(o.length-1,d);const g=o[l],b=o[d];return i.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:g,maxZoom:b,minSize:i.evaluate(new Ar(g)),maxSize:i.evaluate(new Ar(b)),interpolationType:h}}}function Xp(s,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:h}){return s.kind==="source"?o/lo:s.kind==="composite"?ii(o/lo,h/lo,i):e}function Lu(s,e){let i=0,o=0;if(s.kind==="constant")o=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:h,minZoom:l,maxZoom:d}=s,g=h?$e(is.interpolationFactor(h,e,l,d),0,1):0;s.kind==="camera"?o=ii(s.minSize,s.maxSize,g):i=g}return{uSizeT:i,uSize:o}}var nA=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:lo,evaluateSizeForFeature:Xp,evaluateSizeForZoom:Lu,getSizeData:fg});function sA(s,e,i){return s.sections.forEach(o=>{o.text=function(h,l,d){const g=l.layout.get("text-transform").evaluate(d,{});return g==="uppercase"?h=h.toLocaleUpperCase():g==="lowercase"&&(h=h.toLocaleLowerCase()),qn.applyArabicShaping&&(h=qn.applyArabicShaping(h)),h}(o.text,e,i)}),s}const Pd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function oA(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function aA(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var av,pg,lv,mg={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function lA(){return av||(av=1,mg.read=function(s,e,i,o,h){var l,d,g=8*h-o-1,b=(1<<g)-1,S=b>>1,m=-7,x=i?h-1:0,E=i?-1:1,v=s[e+x];for(x+=E,l=v&(1<<-m)-1,v>>=-m,m+=g;m>0;l=256*l+s[e+x],x+=E,m-=8);for(d=l&(1<<-m)-1,l>>=-m,m+=o;m>0;d=256*d+s[e+x],x+=E,m-=8);if(l===0)l=1-S;else{if(l===b)return d?NaN:1/0*(v?-1:1);d+=Math.pow(2,o),l-=S}return(v?-1:1)*d*Math.pow(2,l-o)},mg.write=function(s,e,i,o,h,l){var d,g,b,S=8*l-h-1,m=(1<<S)-1,x=m>>1,E=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=o?0:l-1,w=o?1:-1,M=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,d=m):(d=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-d))<1&&(d--,b*=2),(e+=d+x>=1?E/b:E*Math.pow(2,1-x))*b>=2&&(d++,b/=2),d+x>=m?(g=0,d=m):d+x>=1?(g=(e*b-1)*Math.pow(2,h),d+=x):(g=e*Math.pow(2,x-1)*Math.pow(2,h),d=0));h>=8;s[i+v]=255&g,v+=w,g/=256,h-=8);for(d=d<<h|g,S+=h;S>0;s[i+v]=255&d,v+=w,d/=256,S-=8);s[i+v-w]|=128*M}),mg}function cv(){if(lv)return pg;lv=1,pg=e;var s=lA();function e(k){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(k)?k:new Uint8Array(k||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,o=1/i,h=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function l(k){return k.type===e.Bytes?k.readVarint()+k.pos:k.pos+1}function d(k,G,$){return $?4294967296*G+(k>>>0):4294967296*(G>>>0)+(k>>>0)}function g(k,G,$){var K=G<=16383?1:G<=2097151?2:G<=268435455?3:Math.floor(Math.log(G)/(7*Math.LN2));$.realloc(K);for(var te=$.pos-1;te>=k;te--)$.buf[te+K]=$.buf[te]}function b(k,G){for(var $=0;$<k.length;$++)G.writeVarint(k[$])}function S(k,G){for(var $=0;$<k.length;$++)G.writeSVarint(k[$])}function m(k,G){for(var $=0;$<k.length;$++)G.writeFloat(k[$])}function x(k,G){for(var $=0;$<k.length;$++)G.writeDouble(k[$])}function E(k,G){for(var $=0;$<k.length;$++)G.writeBoolean(k[$])}function v(k,G){for(var $=0;$<k.length;$++)G.writeFixed32(k[$])}function w(k,G){for(var $=0;$<k.length;$++)G.writeSFixed32(k[$])}function M(k,G){for(var $=0;$<k.length;$++)G.writeFixed64(k[$])}function R(k,G){for(var $=0;$<k.length;$++)G.writeSFixed64(k[$])}function z(k,G){return(k[G]|k[G+1]<<8|k[G+2]<<16)+16777216*k[G+3]}function U(k,G,$){k[$]=G,k[$+1]=G>>>8,k[$+2]=G>>>16,k[$+3]=G>>>24}function j(k,G){return(k[G]|k[G+1]<<8|k[G+2]<<16)+(k[G+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(k,G,$){for($=$||this.length;this.pos<$;){var K=this.readVarint(),te=K>>3,re=this.pos;this.type=7&K,k(te,G,this),this.pos===re&&this.skip(K)}return G},readMessage:function(k,G){return this.readFields(k,G,this.readVarint()+this.pos)},readFixed32:function(){var k=z(this.buf,this.pos);return this.pos+=4,k},readSFixed32:function(){var k=j(this.buf,this.pos);return this.pos+=4,k},readFixed64:function(){var k=z(this.buf,this.pos)+z(this.buf,this.pos+4)*i;return this.pos+=8,k},readSFixed64:function(){var k=z(this.buf,this.pos)+j(this.buf,this.pos+4)*i;return this.pos+=8,k},readFloat:function(){var k=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,k},readDouble:function(){var k=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,k},readVarint:function(k){var G,$,K=this.buf;return G=127&($=K[this.pos++]),$<128?G:(G|=(127&($=K[this.pos++]))<<7,$<128?G:(G|=(127&($=K[this.pos++]))<<14,$<128?G:(G|=(127&($=K[this.pos++]))<<21,$<128?G:function(te,re,Q){var de,oe,pe=Q.buf;if(de=(112&(oe=pe[Q.pos++]))>>4,oe<128||(de|=(127&(oe=pe[Q.pos++]))<<3,oe<128)||(de|=(127&(oe=pe[Q.pos++]))<<10,oe<128)||(de|=(127&(oe=pe[Q.pos++]))<<17,oe<128)||(de|=(127&(oe=pe[Q.pos++]))<<24,oe<128)||(de|=(1&(oe=pe[Q.pos++]))<<31,oe<128))return d(te,de,re);throw new Error("Expected varint not more than 10 bytes")}(G|=(15&($=K[this.pos]))<<28,k,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var k=this.readVarint();return k%2==1?(k+1)/-2:k/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var k=this.readVarint()+this.pos,G=this.pos;return this.pos=k,k-G>=12&&h?function($,K,te){return h.decode($.subarray(K,te))}(this.buf,G,k):function($,K,te){for(var re="",Q=K;Q<te;){var de,oe,pe,Ee=$[Q],Ce=null,Pe=Ee>239?4:Ee>223?3:Ee>191?2:1;if(Q+Pe>te)break;Pe===1?Ee<128&&(Ce=Ee):Pe===2?(192&(de=$[Q+1]))==128&&(Ce=(31&Ee)<<6|63&de)<=127&&(Ce=null):Pe===3?(oe=$[Q+2],(192&(de=$[Q+1]))==128&&(192&oe)==128&&((Ce=(15&Ee)<<12|(63&de)<<6|63&oe)<=2047||Ce>=55296&&Ce<=57343)&&(Ce=null)):Pe===4&&(oe=$[Q+2],pe=$[Q+3],(192&(de=$[Q+1]))==128&&(192&oe)==128&&(192&pe)==128&&((Ce=(15&Ee)<<18|(63&de)<<12|(63&oe)<<6|63&pe)<=65535||Ce>=1114112)&&(Ce=null)),Ce===null?(Ce=65533,Pe=1):Ce>65535&&(Ce-=65536,re+=String.fromCharCode(Ce>>>10&1023|55296),Ce=56320|1023&Ce),re+=String.fromCharCode(Ce),Q+=Pe}return re}(this.buf,G,k)},readBytes:function(){var k=this.readVarint()+this.pos,G=this.buf.subarray(this.pos,k);return this.pos=k,G},readPackedVarint:function(k,G){if(this.type!==e.Bytes)return k.push(this.readVarint(G));var $=l(this);for(k=k||[];this.pos<$;)k.push(this.readVarint(G));return k},readPackedSVarint:function(k){if(this.type!==e.Bytes)return k.push(this.readSVarint());var G=l(this);for(k=k||[];this.pos<G;)k.push(this.readSVarint());return k},readPackedBoolean:function(k){if(this.type!==e.Bytes)return k.push(this.readBoolean());var G=l(this);for(k=k||[];this.pos<G;)k.push(this.readBoolean());return k},readPackedFloat:function(k){if(this.type!==e.Bytes)return k.push(this.readFloat());var G=l(this);for(k=k||[];this.pos<G;)k.push(this.readFloat());return k},readPackedDouble:function(k){if(this.type!==e.Bytes)return k.push(this.readDouble());var G=l(this);for(k=k||[];this.pos<G;)k.push(this.readDouble());return k},readPackedFixed32:function(k){if(this.type!==e.Bytes)return k.push(this.readFixed32());var G=l(this);for(k=k||[];this.pos<G;)k.push(this.readFixed32());return k},readPackedSFixed32:function(k){if(this.type!==e.Bytes)return k.push(this.readSFixed32());var G=l(this);for(k=k||[];this.pos<G;)k.push(this.readSFixed32());return k},readPackedFixed64:function(k){if(this.type!==e.Bytes)return k.push(this.readFixed64());var G=l(this);for(k=k||[];this.pos<G;)k.push(this.readFixed64());return k},readPackedSFixed64:function(k){if(this.type!==e.Bytes)return k.push(this.readSFixed64());var G=l(this);for(k=k||[];this.pos<G;)k.push(this.readSFixed64());return k},skip:function(k){var G=7&k;if(G===e.Varint)for(;this.buf[this.pos++]>127;);else if(G===e.Bytes)this.pos=this.readVarint()+this.pos;else if(G===e.Fixed32)this.pos+=4;else{if(G!==e.Fixed64)throw new Error("Unimplemented type: "+G);this.pos+=8}},writeTag:function(k,G){this.writeVarint(k<<3|G)},realloc:function(k){for(var G=this.length||16;G<this.pos+k;)G*=2;if(G!==this.length){var $=new Uint8Array(G);$.set(this.buf),this.buf=$,this.length=G}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(k){this.realloc(4),U(this.buf,k,this.pos),this.pos+=4},writeSFixed32:function(k){this.realloc(4),U(this.buf,k,this.pos),this.pos+=4},writeFixed64:function(k){this.realloc(8),U(this.buf,-1&k,this.pos),U(this.buf,Math.floor(k*o),this.pos+4),this.pos+=8},writeSFixed64:function(k){this.realloc(8),U(this.buf,-1&k,this.pos),U(this.buf,Math.floor(k*o),this.pos+4),this.pos+=8},writeVarint:function(k){(k=+k||0)>268435455||k<0?function(G,$){var K,te;if(G>=0?(K=G%4294967296|0,te=G/4294967296|0):(te=~(-G/4294967296),4294967295^(K=~(-G%4294967296))?K=K+1|0:(K=0,te=te+1|0)),G>=18446744073709552e3||G<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");$.realloc(10),function(re,Q,de){de.buf[de.pos++]=127&re|128,re>>>=7,de.buf[de.pos++]=127&re|128,re>>>=7,de.buf[de.pos++]=127&re|128,re>>>=7,de.buf[de.pos++]=127&re|128,de.buf[de.pos]=127&(re>>>=7)}(K,0,$),function(re,Q){var de=(7&re)<<4;Q.buf[Q.pos++]|=de|((re>>>=3)?128:0),re&&(Q.buf[Q.pos++]=127&re|((re>>>=7)?128:0),re&&(Q.buf[Q.pos++]=127&re|((re>>>=7)?128:0),re&&(Q.buf[Q.pos++]=127&re|((re>>>=7)?128:0),re&&(Q.buf[Q.pos++]=127&re|((re>>>=7)?128:0),re&&(Q.buf[Q.pos++]=127&re)))))}(te,$)}(k,this):(this.realloc(4),this.buf[this.pos++]=127&k|(k>127?128:0),k<=127||(this.buf[this.pos++]=127&(k>>>=7)|(k>127?128:0),k<=127||(this.buf[this.pos++]=127&(k>>>=7)|(k>127?128:0),k<=127||(this.buf[this.pos++]=k>>>7&127))))},writeSVarint:function(k){this.writeVarint(k<0?2*-k-1:2*k)},writeBoolean:function(k){this.writeVarint(!!k)},writeString:function(k){k=String(k),this.realloc(4*k.length),this.pos++;var G=this.pos;this.pos=function(K,te,re){for(var Q,de,oe=0;oe<te.length;oe++){if((Q=te.charCodeAt(oe))>55295&&Q<57344){if(!de){Q>56319||oe+1===te.length?(K[re++]=239,K[re++]=191,K[re++]=189):de=Q;continue}if(Q<56320){K[re++]=239,K[re++]=191,K[re++]=189,de=Q;continue}Q=de-55296<<10|Q-56320|65536,de=null}else de&&(K[re++]=239,K[re++]=191,K[re++]=189,de=null);Q<128?K[re++]=Q:(Q<2048?K[re++]=Q>>6|192:(Q<65536?K[re++]=Q>>12|224:(K[re++]=Q>>18|240,K[re++]=Q>>12&63|128),K[re++]=Q>>6&63|128),K[re++]=63&Q|128)}return re}(this.buf,k,this.pos);var $=this.pos-G;$>=128&&g(G,$,this),this.pos=G-1,this.writeVarint($),this.pos+=$},writeFloat:function(k){this.realloc(4),s.write(this.buf,k,this.pos,!0,23,4),this.pos+=4},writeDouble:function(k){this.realloc(8),s.write(this.buf,k,this.pos,!0,52,8),this.pos+=8},writeBytes:function(k){var G=k.length;this.writeVarint(G),this.realloc(G);for(var $=0;$<G;$++)this.buf[this.pos++]=k[$]},writeRawMessage:function(k,G){this.pos++;var $=this.pos;k(G,this);var K=this.pos-$;K>=128&&g($,K,this),this.pos=$-1,this.writeVarint(K),this.pos+=K},writeMessage:function(k,G,$){this.writeTag(k,e.Bytes),this.writeRawMessage(G,$)},writePackedVarint:function(k,G){G.length&&this.writeMessage(k,b,G)},writePackedSVarint:function(k,G){G.length&&this.writeMessage(k,S,G)},writePackedBoolean:function(k,G){G.length&&this.writeMessage(k,E,G)},writePackedFloat:function(k,G){G.length&&this.writeMessage(k,m,G)},writePackedDouble:function(k,G){G.length&&this.writeMessage(k,x,G)},writePackedFixed32:function(k,G){G.length&&this.writeMessage(k,v,G)},writePackedSFixed32:function(k,G){G.length&&this.writeMessage(k,w,G)},writePackedFixed64:function(k,G){G.length&&this.writeMessage(k,M,G)},writePackedSFixed64:function(k,G){G.length&&this.writeMessage(k,R,G)},writeBytesField:function(k,G){this.writeTag(k,e.Bytes),this.writeBytes(G)},writeFixed32Field:function(k,G){this.writeTag(k,e.Fixed32),this.writeFixed32(G)},writeSFixed32Field:function(k,G){this.writeTag(k,e.Fixed32),this.writeSFixed32(G)},writeFixed64Field:function(k,G){this.writeTag(k,e.Fixed64),this.writeFixed64(G)},writeSFixed64Field:function(k,G){this.writeTag(k,e.Fixed64),this.writeSFixed64(G)},writeVarintField:function(k,G){this.writeTag(k,e.Varint),this.writeVarint(G)},writeSVarintField:function(k,G){this.writeTag(k,e.Varint),this.writeSVarint(G)},writeStringField:function(k,G){this.writeTag(k,e.Bytes),this.writeString(G)},writeFloatField:function(k,G){this.writeTag(k,e.Fixed32),this.writeFloat(G)},writeDoubleField:function(k,G){this.writeTag(k,e.Fixed64),this.writeDouble(G)},writeBooleanField:function(k,G){this.writeVarintField(k,!!G)}},pg}var Yp=ne(cv());const _g=3;function cA(s,e,i){e.glyphs=[],s===1&&i.readMessage(uA,e)}function uA(s,e,i){if(s===3){const{id:o,bitmap:h,width:l,height:d,left:g,top:b,advance:S}=i.readMessage(hA,{});e.glyphs.push({id:o,bitmap:new nl({width:l+2*_g,height:d+2*_g},h),metrics:{width:l,height:d,left:g,top:b,advance:S}})}else s===4?e.ascender=i.readSVarint():s===5&&(e.descender=i.readSVarint())}function hA(s,e,i){s===1?e.id=i.readVarint():s===2?e.bitmap=i.readBytes():s===3?e.width=i.readVarint():s===4?e.height=i.readVarint():s===5?e.left=i.readSVarint():s===6?e.top=i.readSVarint():s===7&&(e.advance=i.readVarint())}const uv=_g,Ms={horizontal:1,vertical:2,horizontalOnly:3};class Rd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const o=new Rd;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new Rd;return i.imageName=e,i}}class Du{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new Du;for(let h=0;h<e.sections.length;h++){const l=e.sections[h];l.image?o.addImageSection(l):o.addTextSection(l,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let h="";for(let l=0;l<i.length;l++){const d=i.charCodeAt(l+1)||null,g=i.charCodeAt(l-1)||null;h+=!o&&(d&&Wl(d)&&!Pd[i[l+1]]||g&&Wl(g)&&!Pd[i[l-1]])||!Pd[i[l]]?i[l]:Pd[i[l]]}return h}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Kp[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Kp[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new Du;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Rd.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(o)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void ki("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(Rd.forImage(i)),this.sectionIndex.push(this.sections.length-1)):ki("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gg(s,e,i,o,h,l,d,g,b,S,m,x,E,v,w){const M=Du.fromFeature(s,h);x===Ms.vertical&&M.verticalizePunctuation(E);let R=[];const z=function($,K,te,re,Q,de){if(!$)return[];const oe=[],pe=function(Re,je,De,tt,ct,Ye){let Rt=0;for(let At=0;At<Re.length();At++){const xt=Re.getSection(At);Rt+=hv(Re.getCodePoint(At),xt,tt,ct,je,Ye)}return Rt/Math.max(1,Math.ceil(Rt/De))}($,K,te,re,Q,de),Ee=$.text.indexOf("")>=0;let Ce=0;for(let Re=0;Re<$.length();Re++){const je=$.getSection(Re),De=$.getCodePoint(Re);if(Kp[De]||(Ce+=hv(De,je,re,Q,K,de)),Re<$.length()-1){const tt=!((Pe=De)<11904||!(Gt["Bopomofo Extended"](Pe)||Gt.Bopomofo(Pe)||Gt["CJK Compatibility Forms"](Pe)||Gt["CJK Compatibility Ideographs"](Pe)||Gt["CJK Compatibility"](Pe)||Gt["CJK Radicals Supplement"](Pe)||Gt["CJK Strokes"](Pe)||Gt["CJK Symbols and Punctuation"](Pe)||Gt["CJK Unified Ideographs Extension A"](Pe)||Gt["CJK Unified Ideographs"](Pe)||Gt["Enclosed CJK Letters and Months"](Pe)||Gt["Halfwidth and Fullwidth Forms"](Pe)||Gt.Hiragana(Pe)||Gt["Ideographic Description Characters"](Pe)||Gt["Kangxi Radicals"](Pe)||Gt["Katakana Phonetic Extensions"](Pe)||Gt.Katakana(Pe)||Gt["Vertical Forms"](Pe)||Gt["Yi Radicals"](Pe)||Gt["Yi Syllables"](Pe)));(dA[De]||tt||je.imageName)&&oe.push(fv(Re+1,Ce,pe,oe,fA(De,$.getCodePoint(Re+1),tt&&Ee),!1))}}var Pe;return pv(fv($.length(),Ce,pe,oe,0,!0))}(M,S,l,e,o,v),{processBidirectionalText:U,processStyledBidirectionalText:j}=qn;if(U&&M.sections.length===1){const $=U(M.toString(),z);for(const K of $){const te=new Du;te.text=K,te.sections=M.sections;for(let re=0;re<K.length;re++)te.sectionIndex.push(0);R.push(te)}}else if(j){const $=j(M.text,M.sectionIndex,z);for(const K of $){const te=new Du;te.text=K[0],te.sectionIndex=K[1],te.sections=M.sections,R.push(te)}}else R=function($,K){const te=[],re=$.text;let Q=0;for(const de of K)te.push($.substring(Q,de)),Q=de;return Q<re.length&&te.push($.substring(Q,re.length)),te}(M,z);const k=[],G={positionedLines:k,text:M.toString(),top:m[1],bottom:m[1],left:m[0],right:m[0],writingMode:x,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function($,K,te,re,Q,de,oe,pe,Ee,Ce,Pe,Re){let je=0,De=0,tt=0;const ct=pe==="right"?1:pe==="left"?0:.5;let Ye=!1;for(const Pt of Q){const kt=Pt.getSections();for(const ai of kt){if(ai.imageName)continue;const vi=K[ai.fontStack];if(vi&&(Ye=vi.ascender!==void 0&&vi.descender!==void 0,!Ye))break}if(!Ye)break}let Rt=0;for(const Pt of Q){Pt.trim();const kt=Pt.getMaxScale(),ai=(kt-1)*yn,vi={positionedGlyphs:[],lineOffset:0};$.positionedLines[Rt]=vi;const mi=vi.positionedGlyphs;let _i=0;if(!Pt.length()){De+=de,++Rt;continue}let wi=0,Ti=0;for(let Zi=0;Zi<Pt.length();Zi++){const ui=Pt.getSection(Zi),Vi=Pt.getSectionIndex(Zi),Gi=Pt.getCodePoint(Zi);let hr=ui.scale,Lr=null,qr=null,Dr=null,wr=yn,ln=0;const Zr=!(Ee===Ms.horizontal||!Pe&&!du(Gi)||Pe&&(Kp[Gi]||(At=Gi,Gt.Arabic(At)||Gt["Arabic Supplement"](At)||Gt["Arabic Extended-A"](At)||Gt["Arabic Presentation Forms-A"](At)||Gt["Arabic Presentation Forms-B"](At))));if(ui.imageName){const xn=re[ui.imageName];if(!xn)continue;Dr=ui.imageName,$.iconsInText=$.iconsInText||!0,qr=xn.paddedRect;const cr=xn.displaySize;hr=hr*yn/Re,Lr={width:cr[0],height:cr[1],left:0,top:-uv,advance:Zr?cr[1]:cr[0],localGlyph:!1},ln=Ye?-Lr.height*hr:kt*yn-17-cr[1]*hr,wr=Lr.advance;const ss=(Zr?cr[0]:cr[1])*hr-yn*kt;ss>0&&ss>_i&&(_i=ss)}else{const xn=te[ui.fontStack];if(!xn)continue;xn[Gi]&&(qr=xn[Gi]);const cr=K[ui.fontStack];if(!cr)continue;const ss=cr.glyphs[Gi];if(!ss)continue;if(Lr=ss.metrics,wr=Gi!==8203?yn:0,Ye){const po=cr.ascender!==void 0?Math.abs(cr.ascender):0,Hs=cr.descender!==void 0?Math.abs(cr.descender):0,Ws=(po+Hs)*hr;wi<Ws&&(wi=Ws,Ti=(po-Hs)/2*hr),ln=-po*hr}else ln=(kt-hr)*yn-17}Zr?($.verticalizable=!0,mi.push({glyph:Gi,imageName:Dr,x:je,y:De+ln,vertical:Zr,scale:hr,localGlyph:Lr.localGlyph,fontStack:ui.fontStack,sectionIndex:Vi,metrics:Lr,rect:qr}),je+=wr*hr+Ce):(mi.push({glyph:Gi,imageName:Dr,x:je,y:De+ln,vertical:Zr,scale:hr,localGlyph:Lr.localGlyph,fontStack:ui.fontStack,sectionIndex:Vi,metrics:Lr,rect:qr}),je+=Lr.advance*hr+Ce)}mi.length!==0&&(tt=Math.max(je-Ce,tt),Ye?mv(mi,ct,_i,Ti,de*kt/2):mv(mi,ct,_i,0,de/2)),je=0;const nr=de*kt+_i;vi.lineOffset=Math.max(_i,ai),De+=nr,++Rt}var At;const xt=De,{horizontalAlign:dt,verticalAlign:Wt}=yg(oe);(function(Pt,kt,ai,vi,mi,_i){const wi=(kt-ai)*mi,Ti=-_i*vi;for(const nr of Pt)for(const Zi of nr.positionedGlyphs)Zi.x+=wi,Zi.y+=Ti})($.positionedLines,ct,dt,Wt,tt,xt),$.top+=-Wt*xt,$.bottom=$.top+xt,$.left+=-dt*tt,$.right=$.left+tt,$.hasBaseline=Ye}(G,e,i,o,R,d,g,b,x,S,E,w),!function($){for(const K of $)if(K.positionedGlyphs.length!==0)return!1;return!0}(k)&&G}const Kp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hv(s,e,i,o,h,l){if(e.imageName){const d=o[e.imageName];return d?d.displaySize[0]*e.scale*yn/l+h:0}{const d=i[e.fontStack],g=d&&d.glyphs[s];return g?g.metrics.advance*e.scale+h:0}}function dv(s,e,i,o){const h=Math.pow(s-e,2);return o?s<e?h/2:2*h:h+Math.abs(i)*i}function fA(s,e,i){let o=0;return s===10&&(o-=1e4),i&&(o+=150),s!==40&&s!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function fv(s,e,i,o,h,l){let d=null,g=dv(e,i,h,l);for(const b of o){const S=dv(e-b.x,i,h,l)+b.badness;S<=g&&(d=b,g=S)}return{index:s,x:e,priorBreak:d,badness:g}}function pv(s){return s?pv(s.priorBreak).concat(s.index):[]}function yg(s){let e=.5,i=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function mv(s,e,i,o,h){if(!(e||i||o||h))return;const l=s.length-1,d=s[l],g=(d.x+d.metrics.advance*d.scale)*e;for(let b=0;b<=l;b++)s[b].x-=g,s[b].y+=i+o+h}function pA(s,e,i,o){const{horizontalAlign:h,verticalAlign:l}=yg(o),d=i[0]-s.displaySize[0]*h,g=i[1]-s.displaySize[1]*l;return{imagePrimary:s,imageSecondary:e,top:g,bottom:g+s.displaySize[1],left:d,right:d+s.displaySize[0]}}function _v(s,e,i,o,h,l){const d=s.imagePrimary;let g;if(d.content){const R=d.content,z=d.pixelRatio||1;g=[R[0]/z,R[1]/z,d.displaySize[0]-R[2]/z,d.displaySize[1]-R[3]/z]}const b=e.left*l,S=e.right*l;let m,x,E,v;i==="width"||i==="both"?(v=h[0]+b-o[3],x=h[0]+S+o[1]):(v=h[0]+(b+S-d.displaySize[0])/2,x=v+d.displaySize[0]);const w=e.top*l,M=e.bottom*l;return i==="height"||i==="both"?(m=h[1]+w-o[0],E=h[1]+M+o[2]):(m=h[1]+(w+M-d.displaySize[1])/2,E=m+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:m,right:x,bottom:E,left:v,collisionPadding:g}}class aa extends Se{constructor(e,i,o,h,l){super(e,i),this.angle=h,this.z=o,l!==void 0&&(this.segment=l)}clone(){return new aa(this.x,this.y,this.z,this.angle,this.segment)}}function gv(s,e,i,o,h){if(e.segment===void 0)return!0;let l=e,d=e.segment+1,g=0;for(;g>-i/2;){if(d--,d<0)return!1;g-=s[d].dist(l),l=s[d]}g+=s[d].dist(s[d+1]),d++;const b=[];let S=0;for(;g<i/2;){const m=s[d],x=s[d+1];if(!x)return!1;let E=s[d-1].angleTo(m)-m.angleTo(x);for(E=Math.abs((E+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:g,angleDelta:E}),S+=E;g-b[0].distance>o;)S-=b.shift().angleDelta;if(S>h)return!1;d++,g+=m.dist(x)}return!0}function yv(s){let e=0;for(let i=0;i<s.length-1;i++)e+=s[i].dist(s[i+1]);return e}function xv(s,e,i){return s?.6*e*i:0}function vv(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function mA(s,e,i,o,h,l){const d=xv(i,h,l),g=vv(i,o)*l;let b=0;const S=yv(s)/2;for(let m=0;m<s.length-1;m++){const x=s[m],E=s[m+1],v=x.dist(E);if(b+v>S){const w=(S-b)/v,M=ii(x.x,E.x,w),R=ii(x.y,E.y,w),z=new aa(M,R,0,E.angleTo(x),m);return!d||gv(s,z,g,d,e)?z:void 0}b+=v}}function _A(s,e,i,o,h,l,d,g,b){const S=xv(o,l,d),m=vv(o,h),x=m*d,E=s[0].x===0||s[0].x===b||s[0].y===0||s[0].y===b;return e-x<e/4&&(e=x+e/4),bv(s,E?e/2*g%e:(m/2+2*l)*d*g%e,e,S,i,x,E,!1,b)}function bv(s,e,i,o,h,l,d,g,b){const S=l/2,m=yv(s);let x=0,E=e-i,v=[];for(let w=0;w<s.length-1;w++){const M=s[w],R=s[w+1],z=M.dist(R),U=R.angleTo(M);for(;E+i<x+z;){E+=i;const j=(E-x)/z,k=ii(M.x,R.x,j),G=ii(M.y,R.y,j);if(k>=0&&k<b&&G>=0&&G<b&&E-S>=0&&E+S<=m){const $=new aa(k,G,0,U,w);o&&!gv(s,$,l,o,h)||v.push($)}}x+=z}return g||v.length||d||(v=bv(s,x/2,i,o,h,l,d,!0,b)),v}function wv(s,e,i,o,h){const l=[];for(let d=0;d<s.length;d++){const g=s[d];let b;for(let S=0;S<g.length-1;S++){let m=g[S],x=g[S+1];m.x<e&&x.x<e||(m.x<e?m=new Se(e,m.y+(e-m.x)/(x.x-m.x)*(x.y-m.y))._round():x.x<e&&(x=new Se(e,m.y+(e-m.x)/(x.x-m.x)*(x.y-m.y))._round()),m.y<i&&x.y<i||(m.y<i?m=new Se(m.x+(i-m.y)/(x.y-m.y)*(x.x-m.x),i)._round():x.y<i&&(x=new Se(m.x+(i-m.y)/(x.y-m.y)*(x.x-m.x),i)._round()),m.x>=o&&x.x>=o||(m.x>=o?m=new Se(o,m.y+(o-m.x)/(x.x-m.x)*(x.y-m.y))._round():x.x>=o&&(x=new Se(o,m.y+(o-m.x)/(x.x-m.x)*(x.y-m.y))._round()),m.y>=h&&x.y>=h||(m.y>=h?m=new Se(m.x+(h-m.y)/(x.y-m.y)*(x.x-m.x),h)._round():x.y>=h&&(x=new Se(m.x+(h-m.y)/(x.y-m.y)*(x.x-m.x),h)._round()),b&&m.equals(b[b.length-1])||(b=[m],l.push(b)),b.push(x)))))}}return l}function Tv(s){let e=0,i=0;for(const d of s)e+=d.w*d.h,i=Math.max(i,d.w);s.sort((d,g)=>g.h-d.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,l=0;for(const d of s)for(let g=o.length-1;g>=0;g--){const b=o[g];if(!(d.w>b.w||d.h>b.h)){if(d.x=b.x,d.y=b.y,l=Math.max(l,d.y+d.h),h=Math.max(h,d.x+d.w),d.w===b.w&&d.h===b.h){const S=o.pop();g<o.length&&(o[g]=S)}else d.h===b.h?(b.x+=d.w,b.w-=d.w):d.w===b.w?(b.y+=d.h,b.h-=d.h):(o.push({x:b.x+d.w,y:b.y,w:b.w-d.w,h:d.h}),b.y+=d.h,b.h-=d.h);break}}return{w:h,h:l,fill:e/(h*l)||0}}Ft(aa,"Anchor");const Ld=1;class xg{constructor(e,{pixelRatio:i,version:o,stretchX:h,stretchY:l,content:d},g){this.paddedRect=e,this.pixelRatio=i,this.stretchX=h,this.stretchY=l,this.content=d,this.version=o,this.padding=g}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class Ev{constructor(e,i,o){const h={},l={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,h,Ld,d),this.addImages(i,l,2,d);const{w:g,h:b}=Tv(d),S=new kn({width:g||1,height:b||1});for(const m in e){const x=e[m],E=h[m].paddedRect;kn.copy(x.data,S,{x:0,y:0},{x:E.x+Ld,y:E.y+Ld},x.data,o,x.sdf)}for(const m in i){const x=i[m],E=l[m].paddedRect;let v=l[m].padding;const w=E.x+v,M=E.y+v,R=x.data.width,z=x.data.height;v=v>1?v-1:v,kn.copy(x.data,S,{x:0,y:0},{x:w,y:M},x.data,o),kn.copy(x.data,S,{x:0,y:z-v},{x:w,y:M-v},{width:R,height:v},o),kn.copy(x.data,S,{x:0,y:0},{x:w,y:M+z},{width:R,height:v},o),kn.copy(x.data,S,{x:R-v,y:0},{x:w-v,y:M},{width:v,height:z},o),kn.copy(x.data,S,{x:0,y:0},{x:w+R,y:M},{width:v,height:z},o),kn.copy(x.data,S,{x:R-v,y:z-v},{x:w-v,y:M-v},{width:v,height:v},o),kn.copy(x.data,S,{x:0,y:z-v},{x:w+R,y:M-v},{width:v,height:v},o),kn.copy(x.data,S,{x:0,y:0},{x:w+R,y:M+z},{width:v,height:v},o),kn.copy(x.data,S,{x:R-v,y:0},{x:w-v,y:M+z},{width:v,height:v},o)}this.image=S,this.iconPositions=h,this.patternPositions=l}addImages(e,i,o,h){for(const l in e){const d=e[l],g={x:0,y:0,w:d.data.width+2*o,h:d.data.height+2*o};h.push(g),i[l]=new xg(g,d,o),d.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>e.hasImage(h,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const h in e.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[h],e.getImage(h,o),i),this.patchUpdatedImage(this.patternPositions[h],e.getImage(h,o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,l]=e.tl;o.update(i.data,{position:{x:h,y:l}})}}Ft(xg,"ImagePosition"),Ft(Ev,"ImageAtlas");const Dd=1e20;function Sv(s,e,i,o,h,l,d,g,b){for(let S=e;S<e+o;S++)Av(s,i*l+S,l,h,d,g,b);for(let S=i;S<i+h;S++)Av(s,S*l+e,1,o,d,g,b)}function Av(s,e,i,o,h,l,d){l[0]=0,d[0]=-Dd,d[1]=Dd,h[0]=s[e];for(let g=1,b=0,S=0;g<o;g++){h[g]=s[e+g*i];const m=g*g;do{const x=l[b];S=(h[g]-h[x]+m-x*x)/(g-x)/2}while(S<=d[b]&&--b>-1);b++,l[b]=g,d[b]=S,d[b+1]=Dd}for(let g=0,b=0;g<o;g++){for(;d[b+1]<g;)b++;const S=l[b],m=g-S;s[e+g*i]=h[S]+m*m}}const co=2,vg={none:0,ideographs:1,all:2};class zu{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const h=[],l=this.urls[i]||we.GLYPHS_URL;for(const d in e)for(const g of e[d])h.push({stack:d,id:g});Ui(h,({stack:d,id:g},b)=>{let S=this.entries[d];S||(S=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let m=S.glyphs[g];if(m!==void 0)return void b(null,{stack:d,id:g,glyph:m});if(m=this._tinySDF(S,d,g),m)return S.glyphs[g]=m,void b(null,{stack:d,id:g,glyph:m});const x=Math.floor(g/256);if(256*x>65535)return void b(new Error("glyphs > 65535 not supported"));if(S.ranges[x])return void b(null,{stack:d,id:g,glyph:m});let E=S.requests[x];E||(E=S.requests[x]=[],zu.loadGlyphRange(d,x,l,this.requestManager,(v,w)=>{if(w){S.ascender=w.ascender,S.descender=w.descender;for(const M in w.glyphs)this._doesCharSupportLocalGlyph(+M)||(S.glyphs[+M]=w.glyphs[+M]);S.ranges[x]=!0}for(const M of E)M(v,w);delete S.requests[x]})),E.push((v,w)=>{v?b(v):w&&b(null,{stack:d,id:g,glyph:w.glyphs[g]||null})})},(d,g)=>{if(d)o(d);else if(g){const b={};for(const{stack:S,id:m,glyph:x}of g)b[S]===void 0&&(b[S]={}),b[S].glyphs===void 0&&(b[S].glyphs={}),b[S].glyphs[m]=x&&{id:x.id,bitmap:x.bitmap.clone(),metrics:x.metrics},b[S].ascender=this.entries[S].ascender,b[S].descender=this.entries[S].descender;o(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==vg.none&&(this.localGlyphMode===vg.all?!!this.localFontFamily:!!this.localFontFamily&&(Gt["CJK Unified Ideographs"](e)||Gt["Hangul Syllables"](e)||Gt.Hiragana(e)||Gt.Katakana(e)||Gt["CJK Symbols and Punctuation"](e)||Gt["CJK Unified Ideographs Extension A"](e)||Gt["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,o){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(o))return;let l=e.tinySDF;if(!l){let M="400";/bold/i.test(i)?M="900":/medium/i.test(i)?M="500":/light/i.test(i)&&(M="200"),l=e.tinySDF=new zu.TinySDF({fontFamily:h,fontWeight:M,fontSize:24*co,buffer:3*co,radius:8*co}),l.fontWeight=M}if(this.localGlyphs[l.fontWeight][o])return this.localGlyphs[l.fontWeight][o];const d=String.fromCodePoint(o),{data:g,width:b,height:S,glyphWidth:m,glyphHeight:x,glyphLeft:E,glyphTop:v,glyphAdvance:w}=l.draw(d);return this.localGlyphs[l.fontWeight][o]={id:o,bitmap:new nl({width:b,height:S},g),metrics:{width:m/co,height:x/co,left:E/co,top:v/co-27,advance:w/co,localGlyph:!0}}}}zu.loadGlyphRange=function(s,e,i,o,h){const l=256*e,d=l+255,g=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",s).replace("{range}",`${l}-${d}`),va.Glyphs);ba(g,(b,S)=>{if(b)h(b);else if(S){const m={},x=function(E){return new Yp(E).readFields(cA,{})}(S);for(const E of x.glyphs)m[E.id]=E;h(null,{glyphs:m,ascender:x.ascender,descender:x.descender})}})},zu.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:h="sans-serif",fontWeight:l="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const g=this.size=s+4*e,b=this._createCanvas(g),S=this.ctx=b.getContext("2d",{willReadFrequently:!0});S.font=`${d} ${l} ${s}px ${h}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:h,actualBoundingBoxRight:l}=this.ctx.measureText(s),d=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-h))),b=Math.min(this.size-this.buffer,d+Math.ceil(o)),S=g+2*this.buffer,m=b+2*this.buffer,x=Math.max(S*m,0),E=new Uint8ClampedArray(x),v={data:E,width:S,height:m,glyphWidth:g,glyphHeight:b,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(g===0||b===0)return v;const{ctx:w,buffer:M,gridInner:R,gridOuter:z}=this;w.clearRect(M,M,g,b),w.fillText(s,M,M+d);const U=w.getImageData(M,M,g,b);z.fill(Dd,0,x),R.fill(0,0,x);for(let j=0;j<b;j++)for(let k=0;k<g;k++){const G=U.data[4*(j*g+k)+3]/255;if(G===0)continue;const $=(j+M)*S+k+M;if(G===1)z[$]=0,R[$]=Dd;else{const K=.5-G;z[$]=K>0?K*K:0,R[$]=K<0?K*K:0}}Sv(z,0,0,S,m,S,this.f,this.v,this.z),Sv(R,M,M,g,b,S,this.f,this.v,this.z);for(let j=0;j<x;j++){const k=Math.sqrt(z[j])-Math.sqrt(R[j]);E[j]=Math.round(255-255*(k/this.radius+this.cutoff))}return v}};const ol=Ld;function Iv(s,e,i,o){const h=[],l=s.imagePrimary,d=l.pixelRatio,g=l.paddedRect.w-2*ol,b=l.paddedRect.h-2*ol,S=s.right-s.left,m=s.bottom-s.top,x=l.stretchX||[[0,g]],E=l.stretchY||[[0,b]],v=(de,oe)=>de+oe[1]-oe[0],w=x.reduce(v,0),M=E.reduce(v,0),R=g-w,z=b-M;let U=0,j=w,k=0,G=M,$=0,K=R,te=0,re=z;if(l.content&&o){const de=l.content;U=Jp(x,0,de[0]),k=Jp(E,0,de[1]),j=Jp(x,de[0],de[2]),G=Jp(E,de[1],de[3]),$=de[0]-U,te=de[1]-k,K=de[2]-de[0]-j,re=de[3]-de[1]-G}const Q=(de,oe,pe,Ee)=>{const Ce=Qp(de.stretch-U,j,S,s.left),Pe=em(de.fixed-$,K,de.stretch,w),Re=Qp(oe.stretch-k,G,m,s.top),je=em(oe.fixed-te,re,oe.stretch,M),De=Qp(pe.stretch-U,j,S,s.left),tt=em(pe.fixed-$,K,pe.stretch,w),ct=Qp(Ee.stretch-k,G,m,s.top),Ye=em(Ee.fixed-te,re,Ee.stretch,M),Rt=new Se(Ce,Re),At=new Se(De,Re),xt=new Se(De,ct),dt=new Se(Ce,ct),Wt=new Se(Pe/d,je/d),Pt=new Se(tt/d,Ye/d),kt=e*Math.PI/180;if(kt){const Ti=Math.sin(kt),nr=Math.cos(kt),Zi=[nr,-Ti,Ti,nr];Rt._matMult(Zi),At._matMult(Zi),dt._matMult(Zi),xt._matMult(Zi)}const ai=de.stretch+de.fixed,vi=pe.stretch+pe.fixed,mi=oe.stretch+oe.fixed,_i=Ee.stretch+Ee.fixed,wi=s.imageSecondary;return{tl:Rt,tr:At,bl:dt,br:xt,texPrimary:{x:l.paddedRect.x+ol+ai,y:l.paddedRect.y+ol+mi,w:vi-ai,h:_i-mi},texSecondary:wi?{x:wi.paddedRect.x+ol+ai,y:wi.paddedRect.y+ol+mi,w:vi-ai,h:_i-mi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Wt,pixelOffsetBR:Pt,minFontScaleX:K/d/S,minFontScaleY:re/d/m,isSDF:i}};if(o&&(l.stretchX||l.stretchY)){const de=Mv(x,R,w),oe=Mv(E,z,M);for(let pe=0;pe<de.length-1;pe++){const Ee=de[pe],Ce=de[pe+1];for(let Pe=0;Pe<oe.length-1;Pe++)h.push(Q(Ee,oe[Pe],Ce,oe[Pe+1]))}}else h.push(Q({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:b+1}));return h}function Jp(s,e,i){let o=0;for(const h of s)o+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return o}function Mv(s,e,i){const o=[{fixed:-ol,stretch:0}];for(const[h,l]of s){const d=o[o.length-1];o.push({fixed:h-d.stretch,stretch:d.stretch}),o.push({fixed:h-d.stretch,stretch:d.stretch+(l-h)})}return o.push({fixed:e+ol,stretch:i}),o}function Qp(s,e,i,o){return s/e*i+o}function em(s,e,i,o){return s-e*i/o}function gA(s,e,i,o){const h=e+s.positionedLines[o].lineOffset;return o===0?i+h/2:i+(h+(e+s.positionedLines[o-1].lineOffset))/2}function yA(s,e=1,i=!1){let o=1/0,h=1/0,l=-1/0,d=-1/0;const g=s[0];for(let v=0;v<g.length;v++){const w=g[v];(!v||w.x<o)&&(o=w.x),(!v||w.y<h)&&(h=w.y),(!v||w.x>l)&&(l=w.x),(!v||w.y>d)&&(d=w.y)}const b=Math.min(l-o,d-h);let S=b/2;const m=new Eh([],xA);if(b===0)return new Se(o,h);for(let v=o;v<l;v+=b)for(let w=h;w<d;w+=b)m.push(new Ou(v+S,w+S,S,s));let x=function(v){let w=0,M=0,R=0;const z=v[0];for(let U=0,j=z.length,k=j-1;U<j;k=U++){const G=z[U],$=z[k],K=G.x*$.y-$.x*G.y;M+=(G.x+$.x)*K,R+=(G.y+$.y)*K,w+=3*K}return new Ou(M/w,R/w,0,v)}(s),E=m.length;for(;m.length;){const v=m.pop();(v.d>x.d||!x.d)&&(x=v,i&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,E)),v.max-x.d<=e||(S=v.h/2,m.push(new Ou(v.p.x-S,v.p.y-S,S,s)),m.push(new Ou(v.p.x+S,v.p.y-S,S,s)),m.push(new Ou(v.p.x-S,v.p.y+S,S,s)),m.push(new Ou(v.p.x+S,v.p.y+S,S,s)),E+=4)}return i&&(console.log(`num probes: ${E}`),console.log(`best distance: ${x.d}`)),x.p}function xA(s,e){return e.max-s.max}class Ou{constructor(e,i,o,h){this.p=new Se(e,i),this.h=o,this.d=function(l,d){let g=!1,b=1/0;for(let S=0;S<d.length;S++){const m=d[S];for(let x=0,E=m.length,v=E-1;x<E;v=x++){const w=m[x],M=m[v];w.y>l.y!=M.y>l.y&&l.x<(M.x-w.x)*(l.y-w.y)/(M.y-w.y)+w.x&&(g=!g),b=Math.min(b,Yi(l,w,M))}}return(g?1:-1)*Math.sqrt(b)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const bg=Number.POSITIVE_INFINITY,vA=Math.sqrt(2);function Cv(s,[e,i]){let o=0,h=0;if(i===bg){e<0&&(e=0);const l=e/vA;switch(s){case"top-right":case"top-left":h=l-7;break;case"bottom-right":case"bottom-left":h=7-l;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(s){case"top-right":case"bottom-right":o=-l;break;case"top-left":case"bottom-left":o=l;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),s){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(s){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,h]}function wg(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bA(s,e,i,o,h,l,d,g,b,S,m,x,E,v,w){let M=l.textMaxSize.evaluate(e,{},x);M===void 0&&(M=d);const R=s.layers[0].layout,z=R.get("icon-offset").evaluate(e,{},x),U=Rv(i.horizontal)||i.vertical,j=E.name==="globe",k=yn,G=d/k,$=s.tilePixelRatio*M/k,K=(Ce=s.overscaling,s.zoom>18&&Ce>2&&(Ce>>=1),Math.max(Mt/(512*Ce),1)*R.get("symbol-spacing")),te=R.get("text-padding")*s.tilePixelRatio,re=R.get("icon-padding")*s.tilePixelRatio,Q=_e(R.get("text-max-angle")),de=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",oe=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",pe=R.get("symbol-placement"),Ee=K/2;var Ce;const Pe=R.get("icon-text-fit").evaluate(e,{},x),Re=R.get("icon-text-fit-padding").evaluate(e,{},x),je=Pe!=="none";let De;s.hasAnyIconTextFit===!1&&je&&(s.hasAnyIconTextFit=!0),o&&je&&(s.allowVerticalPlacement&&i.vertical&&(De=_v(o,i.vertical,Pe,Re,z,G)),U&&(o=_v(o,U,Pe,Re,z,G)));const tt=(ct,Ye,Rt)=>{if(Ye.x<0||Ye.x>=Mt||Ye.y<0||Ye.y>=Mt)return;let At=null;if(j){const{x:xt,y:dt,z:Wt}=E.projectTilePoint(Ye.x,Ye.y,Rt);At={anchor:new aa(xt,dt,Wt,0,void 0),up:E.upVector(Rt,Ye.x,Ye.y)}}(function(xt,dt,Wt,Pt,kt,ai,vi,mi,_i,wi,Ti,nr,Zi,ui,Vi,Gi,hr,Lr,qr,Dr,wr,ln,Zr,xn,cr,ss,po){const Hs=xt.addToLineVertexArray(dt,Pt);let Ws,dc,hl,fc,Kd,J1,Q1,eb=0,tb=0,ib=0,rb=0,Kg=-1,Jg=-1;const ko={};let nb=Vn("");const pc=Wt?Wt.anchor:dt,Qg=_i.layout.get("icon-text-fit").evaluate(wr,{},cr)!=="none";let ey=0,ty=0;if(_i._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ey,ty]=_i.layout.get("text-offset").evaluate(wr,{},cr).map(ps=>ps*yn):(ey=_i.layout.get("text-radial-offset").evaluate(wr,{},cr)*yn,ty=bg),xt.allowVerticalPlacement&&kt.vertical){const ps=kt.vertical;if(Vi)J1=Tg(ps),mi&&(Q1=Tg(mi));else{const ms=_i.layout.get("text-rotate").evaluate(wr,{},cr)+90;hl=tm(wi,pc,dt,Ti,nr,Zi,ps,ui,ms,Gi),mi&&(fc=tm(wi,pc,dt,Ti,nr,Zi,mi,Lr,ms))}}if(ai){const ps=_i.layout.get("icon-rotate").evaluate(wr,{},cr),ms=Iv(ai,ps,Zr,Qg),Gu=mi?Iv(mi,ps,Zr,Qg):void 0;dc=tm(wi,pc,dt,Ti,nr,Zi,ai,Lr,ps),eb=4*ms.length;const sb=xt.iconSizeData;let mc=null;sb.kind==="source"?(mc=[lo*_i.layout.get("icon-size").evaluate(wr,{},cr)],mc[0]>al&&ki(`${xt.layerIds[0]}: Value for "icon-size" is >= ${zd}. Reduce your "icon-size".`)):sb.kind==="composite"&&(mc=[lo*ln.compositeIconSizes[0].evaluate(wr,{},cr),lo*ln.compositeIconSizes[1].evaluate(wr,{},cr)],(mc[0]>al||mc[1]>al)&&ki(`${xt.layerIds[0]}: Value for "icon-size" is >= ${zd}. Reduce your "icon-size".`)),xt.addSymbols(xt.icon,ms,mc,Dr,qr,wr,!1,Wt,dt,Hs.lineStartIndex,Hs.lineLength,-1,xn,cr,ss,po),Kg=xt.icon.placedSymbolArray.length-1,Gu&&(tb=4*Gu.length,xt.addSymbols(xt.icon,Gu,mc,Dr,qr,wr,Ms.vertical,Wt,dt,Hs.lineStartIndex,Hs.lineLength,-1,xn,cr,ss,po),Jg=xt.icon.placedSymbolArray.length-1)}for(const ps in kt.horizontal){const ms=kt.horizontal[ps];Ws||(nb=Vn(ms.text),Vi?Kd=Tg(ms):Ws=tm(wi,pc,dt,Ti,nr,Zi,ms,ui,_i.layout.get("text-rotate").evaluate(wr,{},cr),Gi));const Gu=ms.positionedLines.length===1;if(ib+=Pv(xt,Wt,dt,ms,vi,_i,Vi,wr,Gi,Hs,kt.vertical?Ms.horizontal:Ms.horizontalOnly,Gu?Object.keys(kt.horizontal):[ps],ko,Kg,ln,xn,cr,ss),Gu)break}kt.vertical&&(rb+=Pv(xt,Wt,dt,kt.vertical,vi,_i,Vi,wr,Gi,Hs,Ms.vertical,["vertical"],ko,Jg,ln,xn,cr,ss));let dl=-1;const iy=(ps,ms)=>ps?Math.max(ps,ms):ms;dl=iy(Kd,dl),dl=iy(J1,dl),dl=iy(Q1,dl);const kI=dl>-1?1:0;xt.glyphOffsetArray.length>=65535&&ki("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wr.sortKey!==void 0&&xt.addToSortKeyRanges(xt.symbolInstances.length,wr.sortKey),xt.symbolInstances.emplaceBack(dt.x,dt.y,pc.x,pc.y,pc.z,ko.right>=0?ko.right:-1,ko.center>=0?ko.center:-1,ko.left>=0?ko.left:-1,ko.vertical>=0?ko.vertical:-1,Kg,Jg,nb,Ws!==void 0?Ws:xt.collisionBoxArray.length,Ws!==void 0?Ws+1:xt.collisionBoxArray.length,hl!==void 0?hl:xt.collisionBoxArray.length,hl!==void 0?hl+1:xt.collisionBoxArray.length,dc!==void 0?dc:xt.collisionBoxArray.length,dc!==void 0?dc+1:xt.collisionBoxArray.length,fc||xt.collisionBoxArray.length,fc?fc+1:xt.collisionBoxArray.length,Ti,ib,rb,eb,tb,kI,0,ey,ty,dl,0,Qg?1:0)})(s,Ye,At,ct,i,o,h,De,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,te,de,b,0,re,oe,z,e,l,S,m,x,v,w)};if(pe==="line")for(const ct of wv(e.geometry,0,0,Mt,Mt)){const Ye=_A(ct,K,Q,i.vertical||U,o,k,$,s.overscaling,Mt);for(const Rt of Ye)U&&wA(s,U.text,Ee,Rt)||tt(ct,Rt,x)}else if(pe==="line-center"){for(const ct of e.geometry)if(ct.length>1){const Ye=mA(ct,Q,i.vertical||U,o,k,$);Ye&&tt(ct,Ye,x)}}else if(e.type==="Polygon")for(const ct of jp(e.geometry,0)){const Ye=yA(ct,16);tt(ct[0],new aa(Ye.x,Ye.y,0,0,void 0),x)}else if(e.type==="LineString")for(const ct of e.geometry)tt(ct,new aa(ct[0].x,ct[0].y,0,0,void 0),x);else if(e.type==="Point")for(const ct of e.geometry)for(const Ye of ct)tt([Ye],new aa(Ye.x,Ye.y,0,0,void 0),x)}const zd=255,al=zd*lo;function Pv(s,e,i,o,h,l,d,g,b,S,m,x,E,v,w,M,R,z){const U=function(G,$,K,te,re,Q,de,oe){const pe=[];if($.positionedLines.length===0)return pe;const Ee=te.layout.get("text-rotate").evaluate(Q,{})*Math.PI/180,Ce=function(tt){const ct=tt[0],Ye=tt[1],Rt=ct*Ye;return Rt>0?[ct,-Ye]:Rt<0?[-ct,Ye]:ct===0?[Ye,ct]:[Ye,-ct]}(K);let Pe=Math.abs($.top-$.bottom);for(const tt of $.positionedLines)Pe-=tt.lineOffset;const Re=$.positionedLines.length,je=Pe/Re;let De=$.top-K[1];for(let tt=0;tt<Re;++tt){const ct=$.positionedLines[tt];De=gA($,je,De,tt);for(const Ye of ct.positionedGlyphs){if(!Ye.rect)continue;const Rt=Ye.rect||{};let At=uv+1,xt=!0,dt=1,Wt=0;if(Ye.imageName){const Dr=de[Ye.imageName];if(!Dr)continue;if(Dr.sdf){ki("SDF images are not supported in formatted text and will be ignored.");continue}xt=!1,dt=Dr.pixelRatio,At=Ld/dt}const Pt=(re||oe)&&Ye.vertical,kt=Ye.metrics.advance*Ye.scale/2,ai=Ye.metrics,vi=Ye.rect;if(vi===null)continue;oe&&$.verticalizable&&(Wt=Ye.imageName?kt-Ye.metrics.width*Ye.scale/2:0);const mi=re?[Ye.x+kt,Ye.y]:[0,0];let _i=[0,0],wi=[0,0],Ti=!1;re||(Pt?(wi=[Ye.x+kt+Ce[0],Ye.y+Ce[1]-Wt],Ti=!0):_i=[Ye.x+kt+K[0],Ye.y+K[1]-Wt]);const nr=vi.w*Ye.scale/(dt*(Ye.localGlyph?co:1)),Zi=vi.h*Ye.scale/(dt*(Ye.localGlyph?co:1));let ui,Vi,Gi,hr;if(Pt){const Dr=Ye.y-De,wr=new Se(-kt,kt-Dr),ln=-Math.PI/2,Zr=new Se(...wi);ui=new Se(-kt+_i[0],_i[1]),ui._rotateAround(ln,wr)._add(Zr),ui.x+=-Dr+kt,ui.y-=(ai.left-At)*Ye.scale;const xn=Ye.imageName?ai.advance*Ye.scale:yn*Ye.scale,cr=String.fromCodePoint(Ye.glyph);oA(cr)?ui.x+=(1-At)*Ye.scale:aA(cr)?ui.x+=xn-ai.height*Ye.scale+(-At-1)*Ye.scale:ui.x+=Ye.imageName||ai.width+2*At===vi.w&&ai.height+2*At===vi.h?(xn-Zi)/2:(xn-(ai.height+2*At)*Ye.scale)/2,Vi=new Se(ui.x,ui.y-nr),Gi=new Se(ui.x+Zi,ui.y),hr=new Se(ui.x+Zi,ui.y-nr)}else{const Dr=(ai.left-At)*Ye.scale-kt+_i[0],wr=(-ai.top-At)*Ye.scale+_i[1],ln=Dr+nr,Zr=wr+Zi;ui=new Se(Dr,wr),Vi=new Se(ln,wr),Gi=new Se(Dr,Zr),hr=new Se(ln,Zr)}if(Ee){let Dr;Dr=re?new Se(0,0):Ti?new Se(Ce[0],Ce[1]):new Se(K[0],K[1]),ui._rotateAround(Ee,Dr),Vi._rotateAround(Ee,Dr),Gi._rotateAround(Ee,Dr),hr._rotateAround(Ee,Dr)}const Lr=new Se(0,0),qr=new Se(0,0);pe.push({tl:ui,tr:Vi,bl:Gi,br:hr,texPrimary:Rt,texSecondary:void 0,writingMode:$.writingMode,glyphOffset:mi,sectionIndex:Ye.sectionIndex,isSDF:xt,pixelOffsetTL:Lr,pixelOffsetBR:qr,minFontScaleX:0,minFontScaleY:0})}}return pe}(0,o,b,l,d,g,h,s.allowVerticalPlacement),j=s.textSizeData;let k=null;j.kind==="source"?(k=[lo*l.layout.get("text-size").evaluate(g,{},R)],k[0]>al&&ki(`${s.layerIds[0]}: Value for "text-size" is >= ${zd}. Reduce your "text-size".`)):j.kind==="composite"&&(k=[lo*w.compositeTextSizes[0].evaluate(g,{},R),lo*w.compositeTextSizes[1].evaluate(g,{},R)],(k[0]>al||k[1]>al)&&ki(`${s.layerIds[0]}: Value for "text-size" is >= ${zd}. Reduce your "text-size".`)),s.addSymbols(s.text,U,k,b,d,g,m,e,i,S.lineStartIndex,S.lineLength,v,M,R,z,!1);for(const G of x)E[G]=s.text.placedSymbolArray.length-1;return 4*U.length}function Rv(s){for(const e in s)return s[e];return null}function tm(s,e,i,o,h,l,d,g,b,S){let m=d.top,x=d.bottom,E=d.left,v=d.right;const w=d.collisionPadding;if(w&&(E-=w[0],m-=w[1],v+=w[2],x+=w[3]),b){const M=new Se(E,m),R=new Se(v,m),z=new Se(E,x),U=new Se(v,x),j=_e(b);let k=new Se(0,0);S&&(k=new Se(S[0],S[1])),M._rotateAround(j,k),R._rotateAround(j,k),z._rotateAround(j,k),U._rotateAround(j,k),E=Math.min(M.x,R.x,z.x,U.x),v=Math.max(M.x,R.x,z.x,U.x),m=Math.min(M.y,R.y,z.y,U.y),x=Math.max(M.y,R.y,z.y,U.y)}return s.emplaceBack(e.x,e.y,e.z,i.x,i.y,E,m,v,x,g,o,h,l),s.length-1}function Tg(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function wA(s,e,i,o){const h=s.compareText;if(e in h){const l=h[e];for(let d=l.length-1;d>=0;d--)if(o.dist(l[d])<i)return!0}else h[e]=[];return h[e].push(o),!1}function Lv(s,e){const i=s.fovAboveCenter,o=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,h=(s._camera.position[2]*s.worldSize-o)/Math.cos(s._pitch),l=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-s._pitch-i,.01));let d=Math.sin(s._pitch)*l+h;const g=h*(1/s._horizonShift);return s.elevation&&s.elevation.exaggeration()!==0||(d*=1+Math.max(s.zoom-17,0)),Math.min(1.01*d,g)}function Od(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const i=Math.pow(2,-s.z),o=s.x*i,h=(s.x+1)*i,l=s.y*i,d=(s.y+1)*i,g=ce(o),b=ce(h),S=le(l),m=le(d),x=e.project(g,S),E=e.project(b,S),v=e.project(b,m),w=e.project(g,m);let M=Math.min(x.x,E.x,v.x,w.x),R=Math.min(x.y,E.y,v.y,w.y),z=Math.max(x.x,E.x,v.x,w.x),U=Math.max(x.y,E.y,v.y,w.y);const j=i/16;function k($,K,te,re,Q,de){const oe=(te+Q)/2,pe=(re+de)/2,Ee=e.project(ce(oe),le(pe)),Ce=Math.max(0,M-Ee.x,R-Ee.y,Ee.x-z,Ee.y-U);M=Math.min(M,Ee.x),z=Math.max(z,Ee.x),R=Math.min(R,Ee.y),U=Math.max(U,Ee.y),Ce>j&&(k($,Ee,te,re,oe,pe),k(Ee,K,oe,pe,Q,de))}k(x,E,o,l,h,l),k(E,v,h,l,h,d),k(v,w,h,d,o,d),k(w,x,o,d,o,l),M-=j,R-=j,z+=j,U+=j;const G=1/Math.max(z-M,U-R);return{scale:G,x:M*G,y:R*G,x2:z*G,y2:U*G,projection:e}}function Dv(s,{x:e,y:i},o=0){return new Se(((e-o)*s.scale-s.x)*Mt,(i*s.scale-s.y)*Mt)}const TA=ge.mat4.identity(new Float32Array(16));class ll{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new V(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o=!0){return e._coordinatePoint(e.locationCoordinate(i),o)}pixelsPerMeter(e,i){return ee(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return Lv(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,h){const l=e.horizonLineFromTop(!1),d=new Se(i,Math.max(l,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,h))}pointCoordinate3D(e,i,o){const h=new Se(i,o);if(e.elevation)return e.elevation.pointCoordinate(h);{const l=this.pointCoordinate(e,h.x,h.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return TA}createTileMatrix(e,i,o){let h,l,d;const g=o.canonical,b=ge.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=Od(g,this);h=1,l=S.x+o.wrap*S.scale,d=S.y,ge.mat4.scale(b,b,[h/S.scale,h/S.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(g.z),l=(g.x+Math.pow(2,g.z)*o.wrap)*h,d=g.y*h;return ge.mat4.translate(b,b,[l,d,0]),ge.mat4.scale(b,b,[h/Mt,h/Mt,1]),b}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class EA extends ll{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(_e(i));this.n=(h+Math.sin(_e(o)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:h,r0:l}=this,d=_e(e-this.center[0]),g=_e(i),b=Math.sqrt(h-2*o*Math.sin(g))/o;return{x:b*Math.sin(d*o),y:b*Math.cos(d*o)-l,z:0}}unproject(e,i){const{n:o,c:h,r0:l}=this,d=l+i;let g=Math.atan2(e,Math.abs(d))*Math.sign(d);d*o<0&&(g-=Math.PI*Math.sign(e)*Math.sign(d));const b=_e(this.center[0])*o;g=li(g,-Math.PI-b,Math.PI-b);const S=$e(Ze(g/o)+this.center[0],-180,180),m=Math.asin($e((h-(e*e+d*d)*o*o)/(2*o),-1,1)),x=$e(Ze(m),-fe,fe);return new V(S,x)}}const kd=1.340264,Fd=-.081106,Bd=893e-6,Nd=.003796,im=Math.sqrt(3)/2;class SA extends ll{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(im*Math.sin(i)),h=o*o,l=h*h*h;return{x:.5*(e*Math.cos(o)/(im*(kd+3*Fd*h+l*(7*Bd+9*Nd*h)))/Math.PI+.5),y:1-.5*(o*(kd+Fd*h+l*(Bd+Nd*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,h=o*o,l=h*h*h;for(let m,x,E,v=0;v<12&&(x=o*(kd+Fd*h+l*(Bd+Nd*h))-i,E=kd+3*Fd*h+l*(7*Bd+9*Nd*h),m=x/E,o=$e(o-m,-Math.PI/3,Math.PI/3),h=o*o,l=h*h*h,!(Math.abs(m)<1e-12));++v);const d=im*e*(kd+3*Fd*h+l*(7*Bd+9*Nd*h))/Math.cos(o),g=Math.asin(Math.sin(o)/im),b=$e(180*d/Math.PI,-180,180),S=$e(180*g/Math.PI,-fe,fe);return new V(b,S)}}class AA extends ll{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),h=$e(360*(.5-i),-fe,fe);return new V(o,h)}}const ku=Math.PI/2;function rm(s){return Math.tan((ku+s)/2)}class IA extends ll{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let h=_e(i),l=_e(o);this.southernCenter=h+l<0,this.southernCenter&&(h=-h,l=-l);const d=Math.cos(h),g=rm(h);this.n=h===l?Math.sin(h):Math.log(d/Math.cos(l))/Math.log(rm(l)/g),this.f=d*Math.pow(rm(h),this.n)/this.n}project(e,i){i=_e(i),this.southernCenter&&(i=-i),e=_e(e-this.center[0]);const o=1e-6,{n:h,f:l}=this;l>0?i<-ku+o&&(i=-ku+o):i>ku-o&&(i=ku-o);const d=l/Math.pow(rm(i),h);let g=d*Math.sin(h*e),b=l-d*Math.cos(h*e);return g=.5*(g/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:g,y:this.southernCenter?b:1-b,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:h}=this,l=h-i,d=Math.sign(l),g=Math.sign(o)*Math.sqrt(e*e+l*l);let b=Math.atan2(e,Math.abs(l))*d;l*o<0&&(b-=Math.PI*Math.sign(e)*d);const S=$e(Ze(b/o)+this.center[0],-180,180),m=$e(Ze(2*Math.atan(Math.pow(h/g,1/o))-ku),-fe,fe);return new V(S,this.southernCenter?-m:m)}}class zv extends ll{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ie(e),y:se(i),z:0}}unproject(e,i){const o=ce(e),h=le(i);return new V(o,h)}}const Ov=_e(fe);class MA extends ll{project(e,i){const o=(i=_e(i))*i,h=o*o;return{x:.5*((e=_e(e))*(.8707-.131979*o+h*(h*(.003971*o-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+h*(.028874*o-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,h=25,l=0,d=o*o;do{d=o*o;const S=d*d;l=(o*(1.007226+d*(.015085+S*(.028874*d-.044475-.005916*S)))-i)/(1.007226+d*(.045255+S*(.259866*d-.311325-.005916*11*S))),o=$e(o-l,-Ov,Ov)}while(Math.abs(l)>1e-6&&--h>0);d=o*o;const g=$e(Ze(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),b=Ze(o);return new V(g,b)}}const kv=_e(fe);class CA extends ll{project(e,i){i=_e(i),e=_e(e);const o=Math.cos(i),h=2/Math.PI,l=Math.acos(o*Math.cos(e/2)),d=Math.sin(l)/l,g=.5*(e*h+2*o*Math.sin(e/2)/d)||0,b=.5*(i+Math.sin(i)/d)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,l=25;const d=1e-6;let g=0,b=0;do{const S=Math.cos(h),m=Math.sin(h),x=2*m*S,E=m*m,v=S*S,w=Math.cos(o/2),M=Math.sin(o/2),R=2*w*M,z=M*M,U=1-v*w*w,j=U?1/U:0,k=U?Math.acos(S*w)*Math.sqrt(1/U):0,G=.5*(2*k*S*M+2*o/Math.PI)-e,$=.5*(k*m+h)-i,K=.5*j*(v*z+k*S*w*E)+1/Math.PI,te=j*(R*x/4-k*m*M),re=.125*j*(x*M-k*m*v*R),Q=.5*j*(E*w+k*z*S)+.5,de=te*re-Q*K;g=($*te-G*Q)/de,b=(G*re-$*K)/de,o=$e(o-g,-Math.PI,Math.PI),h=$e(h-b,-kv,kv)}while((Math.abs(g)>d||Math.abs(b)>d)&&--l>0);return new V(Ze(o),Ze(h))}}class Fv extends ll{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_e(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:h}=this;return{x:_e(e)*h*o+.5,y:-Math.sin(_e(i))/h*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:h}=this,l=-(i-.5)/o,d=$e(Ze((e-.5)/o)/h,-180,180),g=Math.asin($e(l*h,-1,1)),b=$e(Ze(g),-fe,fe);return new V(d,b)}}class PA extends zv{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const h=xd(e,i,o),l=Bp(zo(o));return ge.vec3.transformMat4(h,h,l),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i){const o=D(i.lat,i.lng),h=ge.vec3.normalize([],o),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,d=ee(1,0)*Mt*l;ge.vec3.scaleAndAdd(o,o,h,d);const g=ge.mat4.identity(new Float64Array(16));return ge.mat4.multiply(g,e.pixelMatrix,e.globeMatrix),ge.vec3.transformMat4(o,o,g),new Se(o[0],o[1])}pixelsPerMeter(e,i){return ee(1,0)*i}pixelSpaceConversion(e,i,o){const h=ee(1,e)*i,l=ii(ee(1,45)*i,h,o);return this.pixelsPerMeter(e,i)/l}createTileMatrix(e,i,o){const h=W_(zo(o.canonical));return ge.mat4.multiply(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:o}=e,h=Bp(zo(i));return ge.mat4.rotateY(h,h,_e(o.lng)),ge.mat4.rotateX(h,h,_e(o.lat)),ge.mat4.scale(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,o,h){return Op(e,i,o,!0)||new ze(0,0)}pointCoordinate3D(e,i,o){const h=this.pointCoordinate(e,i,o,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!Op(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(h,l){const d=h.cameraToCenterDistance,g=h._centerAltitude*l,b=h._camera,S=h._camera.forward(),m=ge.vec3.add([],ge.vec3.scale([],S,-d),[0,0,g]),x=h.worldSize/(2*Math.PI),E=[0,0,-x],v=h.width/h.height,w=Math.tan(h.fovAboveCenter),M=ge.vec3.scale([],b.up(),w),R=ge.vec3.scale([],b.right(),w*v),z=ge.vec3.normalize([],ge.vec3.add([],ge.vec3.add([],S,M),R)),U=[];let j;if(new ao(m,z).closestPointOnSphere(E,x,U)){const k=ge.vec3.add([],U,E),G=ge.vec3.sub([],k,m);j=Math.cos(h.fovAboveCenter)*ge.vec3.length(G)}else{const k=ge.vec3.sub([],m,E),G=ge.vec3.sub([],E,m);ge.vec3.normalize(G,G);const $=ge.vec3.length(k)-x;j=Math.sqrt($*($+2*x));const K=Math.acos(j/(x+$))-Math.acos(ge.vec3.dot(S,G));j*=Math.cos(K)}return 1.01*j}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=rl(e.zoom);if(o>0){const h=Lv(e,ee(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ii(i,h+l*(1-Math.cos(d)),Math.pow(o,10))}return i}upVector(e,i,o){return xd(i,o,e,1)}upVectorScale(e){return{metersToTile:sa(Fp(zo(e)))}}}function Bv(s){const e=s.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new zv(s);case"equirectangular":return new AA(s);case"naturalEarth":return new MA(s);case"equalEarth":return new SA(s);case"winkelTripel":return new CA(s);case"albers":return i?new Fv(s):new EA(s);case"lambertConformalConic":return i?new Fv(s):new IA(s);case"globe":return new PA(s)}throw new Error(`Invalid projection name: ${s.name}`)}const RA=Ru.VectorTileFeature.types,LA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nm(s,e,i,o,h,l,d,g,b,S,m,x,E){const v=g?Math.min(al,Math.round(g[0])):0,w=g?Math.min(al,Math.round(g[1])):0;s.emplaceBack(e,i,Math.round(32*o),Math.round(32*h),l,d,(v<<1)+(b?1:0),w,16*S,16*m,256*x,256*E)}function sm(s,e,i){s.emplaceBack(e,i)}function om(s,e,i,o,h,l,d){s.emplaceBack(e,i,o,h,l,d)}function am(s,e,i,o,h){s.emplaceBack(e,i,o,h),s.emplaceBack(e,i,o,h),s.emplaceBack(e,i,o,h),s.emplaceBack(e,i,o,h)}function DA(s){for(const e of s.sections)if(C_(e.text))return!0;return!1}class Eg{constructor(e){this.layoutVertexArray=new sd,this.indexArray=new fn,this.programConfigurations=e,this.segments=new Ir,this.dynamicLayoutVertexArray=new ro,this.opacityVertexArray=new ad,this.placedSymbolArray=new dd,this.iconTransitioningVertexArray=new Ro,this.globeExtVertexArray=new od,this.zOffsetVertexArray=new Ka}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,h,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,YS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,JS.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,LA,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,eA.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,KS.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,QS.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ft(Eg,"SymbolBuffers");class Sg{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Ir,this.collisionVertexArray=new Ya,this.collisionVertexArrayExt=new ro}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,tA.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,iA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ft(Sg,"CollisionBuffers");class lm{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ge.mat4.identity([]),this.placementViewportMatrix=ge.mat4.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fg(this.zoom,i["text-size"]),this.iconSizeData=fg(this.zoom,i["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),l=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(d=>Ms[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Eg(new Lo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Eg(new Lo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Ap,this.lineVertexArray=new Au,this.symbolInstances=new fd}calculateGlyphDependencies(e,i,o,h,l){for(let d=0;d<e.length;d++){const g=e.codePointAt(d);if(g===void 0)break;if(i[g]=!0,h&&l&&g<=65535){const b=Pd[e.charAt(d)];b&&(i[b.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!ag(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,h){const l=this.layers[0],d=l.layout,g=this.projection.name==="globe",b=d.get("text-font"),S=d.get("text-field"),m=d.get("icon-image"),x=(S.value.kind!=="constant"||S.value.value instanceof Tn&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),E=m.value.kind!=="constant"||!!m.value.value||Object.keys(m.parameters).length>0,v=d.get("symbol-sort-key");if(this.features=[],!x&&!E)return;const w=i.iconDependencies,M=i.glyphDependencies,R=i.availableImages,z=new Ar(this.zoom);for(const{feature:U,id:j,index:k,sourceLayerIndex:G}of e){const $=l._featureFilter.needGeometry,K=vt(U,$);if(!l._featureFilter.filter(z,K,o))continue;if($||(K.geometry=yt(U,o,h)),g&&U.type!==1&&o.z<=5){const de=K.geometry,oe=.98078528056,pe=(Ee,Ce)=>{const Pe=xd(Ee.x,Ee.y,o,1),Re=xd(Ce.x,Ce.y,o,1);return ge.vec3.dot(Pe,Re)<oe};for(let Ee=0;Ee<de.length;Ee++)de[Ee]=mt(de[Ee],pe)}let te,re;if(x){const de=l.getValueAndResolveTokens("text-field",K,o,R),oe=Tn.factory(de);DA(oe)&&(this.hasRTLText=!0),(!this.hasRTLText||Qh()==="unavailable"||this.hasRTLText&&qn.isParsed())&&(te=sA(oe,l,K))}if(E){const de=l.getValueAndResolveTokens("icon-image",K,o,R);re=de instanceof Rn?de:Rn.fromString(de)}if(!te&&!re)continue;const Q=this.sortFeaturesByKey?v.evaluate(K,{},o):void 0;if(this.features.push({id:j,text:te,icon:re,index:k,sourceLayerIndex:G,geometry:K.geometry,properties:U.properties,type:RA[U.type],sortKey:Q}),re&&(w[re.namePrimary]=!0,re.nameSecondary&&(w[re.nameSecondary]=!0)),te){const de=b.evaluate(K,{},o).join(","),oe=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ms.vertical)>=0;for(const pe of te.sections)if(pe.image)w[pe.image.namePrimary]=!0;else{const Ee=uu(te.toString()),Ce=pe.fontStack||de,Pe=M[Ce]=M[Ce]||{};this.calculateGlyphDependencies(pe.text,Pe,oe,this.allowVerticalPlacement,Ee)}}}d.get("symbol-placement")==="line"&&(this.features=function(U){const j={},k={},G=[];let $=0;function K(de){G.push(U[de]),$++}function te(de,oe,pe){const Ee=k[de];return delete k[de],k[oe]=Ee,G[Ee].geometry[0].pop(),G[Ee].geometry[0]=G[Ee].geometry[0].concat(pe[0]),Ee}function re(de,oe,pe){const Ee=j[oe];return delete j[oe],j[de]=Ee,G[Ee].geometry[0].shift(),G[Ee].geometry[0]=pe[0].concat(G[Ee].geometry[0]),Ee}function Q(de,oe,pe){const Ee=pe?oe[0][oe[0].length-1]:oe[0][0];return`${de}:${Ee.x}:${Ee.y}`}for(let de=0;de<U.length;de++){const oe=U[de],pe=oe.geometry,Ee=oe.text?oe.text.toString():null;if(!Ee){K(de);continue}const Ce=Q(Ee,pe),Pe=Q(Ee,pe,!0);if(Ce in k&&Pe in j&&k[Ce]!==j[Pe]){const Re=re(Ce,Pe,pe),je=te(Ce,Pe,G[Re].geometry);delete j[Ce],delete k[Pe],k[Q(Ee,G[je].geometry,!0)]=je,G[Re].geometry=null}else Ce in k?te(Ce,Pe,pe):Pe in j?re(Ce,Pe,pe):(K(de),j[Ce]=$-1,k[Pe]=$-1)}return G.filter(de=>de.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((U,j)=>U.sortKey-j.sortKey)}update(e,i,o,h,l){const d=Object.keys(e).length!==0;if(d&&!this.stateDependentLayers.length)return;const g=d?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,g,o,h,l),this.icon.programConfigurations.updatePaintArrays(e,i,g,o,h,l)}updateZOffset(){const e=(l,d,g)=>{o+=d,o>l.length&&l.resize(o);for(let b=-d;b<0;b++)l.emplace(b+o,g)},i=(l,d,g)=>{h+=d,h>l.length&&l.resize(h);for(let b=-d;b<0;b++)l.emplace(b+h,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,h=0;for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:b,numIconVertices:S}=d,m=d.zOffset,x=S>0;if((g>0||b>0)&&(e(this.text.zOffsetVertexArray,g,m),e(this.text.zOffsetVertexArray,b,m)),x){const{placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:v}=d;E>=0&&i(this.icon.zOffsetVertexArray,S,m),v>=0&&i(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,m)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Bv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:l}of i)this.lineVertexArray.emplaceBack(h,l);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,h,l,d,g,b,S,m,x,E,v,w,M,R){const z=e.indexArray,U=e.layoutVertexArray,j=e.globeExtVertexArray,k=e.segments.prepareSegment(4*i.length,U,z,this.canOverlap?d.sortKey:void 0),G=this.glyphOffsetArray.length,$=k.vertexLength,K=this.allowVerticalPlacement&&g===Ms.vertical?Math.PI/2:0,te=d.text&&d.text.sections;for(let Q=0;Q<i.length;Q++){const{tl:de,tr:oe,bl:pe,br:Ee,texPrimary:Ce,texSecondary:Pe,pixelOffsetTL:Re,pixelOffsetBR:je,minFontScaleX:De,minFontScaleY:tt,glyphOffset:ct,isSDF:Ye,sectionIndex:Rt}=i[Q],At=k.vertexLength,xt=ct[1];if(nm(U,S.x,S.y,de.x,xt+de.y,Ce.x,Ce.y,o,Ye,Re.x,Re.y,De,tt),nm(U,S.x,S.y,oe.x,xt+oe.y,Ce.x+Ce.w,Ce.y,o,Ye,je.x,Re.y,De,tt),nm(U,S.x,S.y,pe.x,xt+pe.y,Ce.x,Ce.y+Ce.h,o,Ye,Re.x,je.y,De,tt),nm(U,S.x,S.y,Ee.x,xt+Ee.y,Ce.x+Ce.w,Ce.y+Ce.h,o,Ye,je.x,je.y,De,tt),b){const{x:dt,y:Wt,z:Pt}=b.anchor,[kt,ai,vi]=b.up;om(j,dt,Wt,Pt,kt,ai,vi),om(j,dt,Wt,Pt,kt,ai,vi),om(j,dt,Wt,Pt,kt,ai,vi),om(j,dt,Wt,Pt,kt,ai,vi),am(e.dynamicLayoutVertexArray,dt,Wt,Pt,K)}else am(e.dynamicLayoutVertexArray,S.x,S.y,S.z,K);if(R){const dt=Pe||Ce;sm(e.iconTransitioningVertexArray,dt.x,dt.y),sm(e.iconTransitioningVertexArray,dt.x+dt.w,dt.y),sm(e.iconTransitioningVertexArray,dt.x,dt.y+dt.h),sm(e.iconTransitioningVertexArray,dt.x+dt.w,dt.y+dt.h)}z.emplaceBack(At,At+1,At+2),z.emplaceBack(At+1,At+2,At+3),k.vertexLength+=4,k.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ct[0]),Q!==i.length-1&&Rt===i[Q+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,d,d.index,{},v,w,M,te&&te[Rt])}const re=b?b.anchor:S;e.placedSymbolArray.emplaceBack(re.x,re.y,re.z,S.x,S.y,G,this.glyphOffsetArray.length-G,$,m,x,S.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],g,0,!1,0,E,0)}_commitLayoutVertex(e,i,o,h,l,d,g){e.emplaceBack(i,o,h,l,d,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,o,h,l,d,g){const b=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),S=b.vertexLength,m=g.tileAnchorX,x=g.tileAnchorY;for(let v=0;v<4;v++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,g.zOffset),this._commitLayoutVertex(o.layoutVertexArray,h,l,d,m,x,new Se(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,h,l,d,m,x,new Se(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,h,l,d,m,x,new Se(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,h,l,d,m,x,new Se(e.x1,e.y2)),b.vertexLength+=4;const E=o.indexArray;E.emplaceBack(S,S+1),E.emplaceBack(S+1,S+2),E.emplaceBack(S+2,S+3),E.emplaceBack(S+3,S),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,h,l,d){for(let g=h;g<l;g++){const b=o.get(g),S=this.getSymbolInstanceTextSize(e,d,i,g);this._addCollisionDebugVertices(b,S,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,i,o,h,l,d){for(let g=h;g<l;g++){const b=o.get(g),S=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._addCollisionDebugVertices(b,S,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Sg(ia,ov.members,Ro),this.iconCollisionBox=new Sg(ia,ov.members,Ro);const o=Lu(this.iconSizeData,e),h=Lu(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(h,e,i,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(h,e,i,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(o,e,i,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(o,e,i,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(e,i,o,h){const l=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),d=Xp(this.textSizeData,e,l)/yn;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,i,o){const h=this.icon.placedSymbolArray.get(o),l=Xp(this.iconSizeData,e,h);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,i,o,h){e.emplaceBack(i,-o,-o,h),e.emplaceBack(i,o,-o,h),e.emplaceBack(i,o,o,h),e.emplaceBack(i,-o,o,h)}_updateTextDebugCollisionBoxes(e,i,o,h,l,d){for(let g=h;g<l;g++){const b=o.get(g),S=this.getSymbolInstanceTextSize(e,d,i,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,b.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,h,l,d){for(let g=h;g<l;g++){const b=o.get(g),S=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,b.padding,d.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=Lu(this.iconSizeData,e),h=Lu(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(h,e,i,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(h,e,i,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(o,e,i,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._updateIconDebugCollisionBoxes(o,e,i,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,h,l,d,g,b,S){const m={};if(i<o){const{x1:x,y1:E,x2:v,y2:w,padding:M,projectedAnchorX:R,projectedAnchorY:z,projectedAnchorZ:U,tileAnchorX:j,tileAnchorY:k,featureIndex:G}=e.get(i);m.textBox={x1:x,y1:E,x2:v,y2:w,padding:M,projectedAnchorX:R,projectedAnchorY:z,projectedAnchorZ:U,tileAnchorX:j,tileAnchorY:k},m.textFeatureIndex=G}if(h<l){const{x1:x,y1:E,x2:v,y2:w,padding:M,projectedAnchorX:R,projectedAnchorY:z,projectedAnchorZ:U,tileAnchorX:j,tileAnchorY:k,featureIndex:G}=e.get(h);m.verticalTextBox={x1:x,y1:E,x2:v,y2:w,padding:M,projectedAnchorX:R,projectedAnchorY:z,projectedAnchorZ:U,tileAnchorX:j,tileAnchorY:k},m.verticalTextFeatureIndex=G}if(d<g){const{x1:x,y1:E,x2:v,y2:w,padding:M,projectedAnchorX:R,projectedAnchorY:z,projectedAnchorZ:U,tileAnchorX:j,tileAnchorY:k,featureIndex:G}=e.get(d);m.iconBox={x1:x,y1:E,x2:v,y2:w,padding:M,projectedAnchorX:R,projectedAnchorY:z,projectedAnchorZ:U,tileAnchorX:j,tileAnchorY:k},m.iconFeatureIndex=G}if(b<S){const{x1:x,y1:E,x2:v,y2:w,padding:M,projectedAnchorX:R,projectedAnchorY:z,projectedAnchorZ:U,tileAnchorX:j,tileAnchorY:k,featureIndex:G}=e.get(b);m.verticalIconBox={x1:x,y1:E,x2:v,y2:w,padding:M,projectedAnchorX:R,projectedAnchorY:z,projectedAnchorZ:U,tileAnchorX:j,tileAnchorY:k},m.verticalIconFeatureIndex=G}return m}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),h=o.vertexStartIndex+4*o.numGlyphs;for(let l=o.vertexStartIndex;l<h;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),h=[],l=[],d=[];for(let g=0;g<this.symbolInstances.length;++g){d.push(g);const b=this.symbolInstances.get(g);h.push(0|Math.round(i*b.tileAnchorX+o*b.tileAnchorY)),l.push(b.featureIndex)}return d.sort((g,b)=>h[g]-h[b]||l[b]-l[g]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:S}=o;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),l>=0&&l!==h&&this.addIndicesForPlacedSymbol(this.text,l),d>=0&&d!==l&&d!==h&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Nv,Uv,Ag;Ft(lm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),lm.addDynamicAttributes=am;class Vv{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ws,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ft(Vv,"FormatSectionOverride",{omit:["defaultValue"]});const Ig=()=>Ag||(Ag={layout:Nv||(Nv=new pr({"symbol-placement":new bt(Ue.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(Ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(Ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qt(Ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(Ue.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new bt(Ue.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new bt(Ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bt(Ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(Ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(Ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new qt(Ue.layout_symbol["icon-size"]),"icon-text-fit":new qt(Ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new qt(Ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new qt(Ue.layout_symbol["icon-image"]),"icon-rotate":new qt(Ue.layout_symbol["icon-rotate"]),"icon-padding":new bt(Ue.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(Ue.layout_symbol["icon-keep-upright"]),"icon-offset":new qt(Ue.layout_symbol["icon-offset"]),"icon-anchor":new qt(Ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(Ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(Ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(Ue.layout_symbol["text-rotation-alignment"]),"text-field":new qt(Ue.layout_symbol["text-field"]),"text-font":new qt(Ue.layout_symbol["text-font"]),"text-size":new qt(Ue.layout_symbol["text-size"]),"text-max-width":new qt(Ue.layout_symbol["text-max-width"]),"text-line-height":new qt(Ue.layout_symbol["text-line-height"]),"text-letter-spacing":new qt(Ue.layout_symbol["text-letter-spacing"]),"text-justify":new qt(Ue.layout_symbol["text-justify"]),"text-radial-offset":new qt(Ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(Ue.layout_symbol["text-variable-anchor"]),"text-anchor":new qt(Ue.layout_symbol["text-anchor"]),"text-max-angle":new bt(Ue.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(Ue.layout_symbol["text-writing-mode"]),"text-rotate":new qt(Ue.layout_symbol["text-rotate"]),"text-padding":new bt(Ue.layout_symbol["text-padding"]),"text-keep-upright":new bt(Ue.layout_symbol["text-keep-upright"]),"text-transform":new qt(Ue.layout_symbol["text-transform"]),"text-offset":new qt(Ue.layout_symbol["text-offset"]),"text-allow-overlap":new bt(Ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bt(Ue.layout_symbol["text-ignore-placement"]),"text-optional":new bt(Ue.layout_symbol["text-optional"]),visibility:new bt(Ue.layout_symbol.visibility)})),paint:Uv||(Uv=new pr({"icon-opacity":new qt(Ue.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new qt(Ue.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new qt(Ue.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new qt(Ue.paint_symbol["text-emissive-strength"]),"icon-color":new qt(Ue.paint_symbol["icon-color"]),"icon-halo-color":new qt(Ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new qt(Ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qt(Ue.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(Ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(Ue.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new qt(Ue.paint_symbol["icon-image-cross-fade"]),"text-opacity":new qt(Ue.paint_symbol["text-opacity"]),"text-occlusion-opacity":new qt(Ue.paint_symbol["text-occlusion-opacity"]),"text-color":new qt(Ue.paint_symbol["text-color"],{runtimeType:jn,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new qt(Ue.paint_symbol["text-halo-color"]),"text-halo-width":new qt(Ue.paint_symbol["text-halo-width"]),"text-halo-blur":new qt(Ue.paint_symbol["text-halo-blur"]),"text-translate":new bt(Ue.paint_symbol["text-translate"]),"text-translate-anchor":new bt(Ue.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new bt(Ue.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new bt(Ue.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new bt(Ue.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new bt(Ue.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new qt(Ue.paint_symbol["symbol-z-offset"]),"symbol-elevation-reference":new bt(Ue.paint_symbol["symbol-elevation-reference"])}))},Ag);class cm extends En{constructor(e,i,o,h){super(e,Ig(),i,o,h),this._colorAdjustmentMatrix=ge.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const l of o)h.indexOf(l)<0&&h.push(l);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,h){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(l,d,g,b){l=he(l),d=J(d);const S=ge.mat4.create(),m=l/3,x=1-2*m,E=[x,m,m,0,m,x,m,0,m,m,x,0,0,0,0,1],v=.5-.5*d,w=b-g;return ge.mat4.multiply(S,[w,0,0,0,0,w,0,0,0,0,w,0,g,g,g,1],[d,0,0,0,0,d,0,0,0,0,d,0,v,v,v,1]),ge.mat4.multiply(S,S,E),S}(e,i,o,h),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,h){const l=this.layout.get(e).evaluate(i,{},o,h),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||ou(d.value)||!l?l:function(g,b){return b.replace(/{([^{}]+)}/g,(S,m)=>m in g?String(g[m]):"")}(i.properties,l)}createBucket(e){return new lm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Ig().paint.overridableProperties){if(!cm.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new Vv(i),h=new su(o,i.property.specification,this.scope,this.options);let l=null;l=i.value.kind==="constant"||i.value.kind==="source"?new Wh("source",h):new Us("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new qa(i.property,l,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&cm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),h=Ig().paint.properties[i];let l=!1;const d=g=>{for(const b of g)if(h.overrides&&h.overrides.hasOverride(b))return void(l=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Tn)d(o.value.value.sections);else if(o.value.kind==="source"){const g=S=>{l||(S instanceof Ts&&Gr(S.value)===Sa?d(S.value.sections):S instanceof Ca?d(S.sections):S.eachChild(g))},b=o.value;b._styleExpression&&g(b._styleExpression.expression)}return l}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new na(this,{zoom:i,lut:o}),overrideFog:!1}}}let jv,Gv,$v,qv;var Mg=Bi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Cg(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Pg(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Rg{constructor(e,i,o,h){this.context=e,this.format=o,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:l}=this,{gl:d}=l,{x:g,y:b}=i&&i.position?i.position:{x:0,y:0},S=Math.max(g+o,this.size?this.size[0]:0),m=Math.max(b+h,this.size?this.size[1]:0);!this.size||this.size[0]===S&&this.size[1]===m||(d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(this.texture),this.texture=d.createTexture(),this.size=null),d.bindTexture(d.TEXTURE_2D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA8&&(!i||i.premultiply!==!1));const x=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&S>0&&m>0){const E=this.useMipmap?Math.floor(Math.log2(Math.max(S,m)))+1:1;d.texStorage2D(d.TEXTURE_2D,E,this.format,S,m),this.size=[S,m]}if(this.size)if(x)d.texSubImage2D(d.TEXTURE_2D,0,g,b,Cg(this.format),Pg(this.format),e);else{const E=e.data;E&&d.texSubImage2D(d.TEXTURE_2D,0,g,b,o,h,Cg(this.format),Pg(this.format),E)}this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,i,o=!1){const{context:h}=this,{gl:l}=h;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,h){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,o),this.wrapS=o),h!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class um{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:h}=o;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}function hm(s,e,i,o,h,l,d,g){const b=[s,e,1,i,o,1,h,l,1],S=[d,g,1],m=ge.mat3.adjoint([],b),[x,E,v]=ge.vec3.transformMat3(S,S,m);return ge.mat3.multiply(b,b,[x,0,0,0,E,0,0,0,v])}function Hv(s,e,i,o,h,l,d,g){const b=function(S,m,x,E,v,w,M,R){const z=hm(0,0,1,0,1,1,0,1),U=hm(S,m,x,E,v,w,M,R),j=ge.mat3.adjoint([],z);return ge.mat3.multiply(U,U,j)}(s,e,i,o,h,l,d,g);return[b[2]/b[8]/Mt,b[5]/b[8]/Mt]}function dm(s){return[s[0],Math.min(Math.max(s[1],-fe),fe)]}class Wv extends Ta{constructor(e,i,o,h){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new bo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ks(this.map._requestManager.transformRequest(this.url,va.Image),(o,h)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Rl(o)):h&&(this.image=h instanceof HTMLImageElement?Dt.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new um(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new bo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof um||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const l of e)l[1]>o&&(o=l[1]),l[1]<i&&(i=l[1]);const h=(o+i)/2;if(h>fe?this.onNorthPole=!0:h<-fe&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(ze.fromLngLat);this.tileID=function(d){let g=1/0,b=1/0,S=-1/0,m=-1/0;for(const M of d)g=Math.min(g,M.x),b=Math.min(b,M.y),S=Math.max(S,M.x),m=Math.max(m,M.y);const x=Math.max(S-g,m-b),E=Math.max(0,Math.floor(-Math.log(x)/Math.LN2)),v=Math.pow(2,E);let w=Math.floor((g+S)/2*v);return w>1&&(w-=1),new nn(E,w,Math.floor((b+m)/2*v))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new bo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const z in this.tiles){const U=this.tiles[z];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Od(new nn(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(z){const U=z[1].x-z[0].x,j=z[1].y-z[0].y,k=z[2].x-z[1].x,G=z[2].y-z[1].y,$=z[3].x-z[2].x,K=z[3].y-z[2].y,te=z[0].x-z[3].x,re=z[0].y-z[3].y,Q=U*G-k*j,de=k*K-$*G,oe=$*re-te*K,pe=te*j-U*re;return Q>0&&de>0&&oe>0&&pe>0||Q<0&&de<0&&oe<0&&pe<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Od(this.tileID,this.map.transform.projection),[l,d,g,b]=this.coordinates.map(z=>{const U=h.projection.project(z[0],z[1]);return Dv(h,U)._round()});this.perspectiveTransform=Hv(l.x,l.y,d.x,d.y,g.x,g.y,b.x,b.y);const S=this._boundsArray=new Co;S.emplaceBack(l.x,l.y,0,0),S.emplaceBack(d.x,d.y,Mt,0),S.emplaceBack(b.x,b.y,0,Mt),S.emplaceBack(g.x,g.y,Mt,Mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,Mg.members),this.boundsSegments=Ir.simpleSegment(0,0,4,2);const m=[],x=[dm((E=this.coordinates)[0]),dm(E[1]),dm(E[2]),dm(E[3])];var E;const[v,w,M,R]=function(z){let U=z[0][0],j=U,k=z[0][1],G=k;for(let $=1;$<z.length;$++)z[$][0]<U?U=z[$][0]:z[$][0]>j&&(j=z[$][0]),z[$][1]<k?k=z[$][1]:z[$][1]>G&&(G=z[$][1]);return[U,k,j-U,G-k]}(x);{const z=new Co,[U,j,k,G]=function(Re){let je=Re[0].x,De=je,tt=Re[0].y,ct=tt;for(let Ye=1;Ye<Re.length;Ye++)Re[Ye].x<je?je=Re[Ye].x:Re[Ye].x>De&&(De=Re[Ye].x),Re[Ye].y<tt?tt=Re[Ye].y:Re[Ye].y>ct&&(ct=Re[Ye].y);return[je,tt,De-je,ct-tt]}(o),$=Re=>[(Re.x-U)/k,(Re.y-j)/G],[K,te,re,Q]=o.map($),de=function(Re,je,De,tt,ct,Ye,Rt,At){const xt=hm(0,0,1,0,1,1,0,1),dt=hm(Re,je,De,tt,ct,Ye,Rt,At),Wt=ge.mat3.adjoint([],dt);return ge.mat3.multiply(xt,xt,Wt)}(K[0],K[1],te[0],te[1],re[0],re[1],Q[0],Q[1]);this.elevatedGlobePerspectiveTransform=Hv(K[0],K[1],te[0],te[1],re[0],re[1],Q[0],Q[1]);const oe=(Re,je)=>{m.push(Re.lng);const De=Math.round((Re.lng-v)/M*Mt),tt=Math.round((Re.lat-w)/R*Mt),ct=$(je),Ye=ge.vec3.transformMat3([],[ct[0],ct[1],1],de),Rt=Math.round(Ye[0]/Ye[2]*Mt),At=Math.round(Ye[1]/Ye[2]*Mt);z.emplaceBack(De,tt,Rt,At)},pe=o[3].x-o[0].x,Ee=o[3].y-o[0].y,Ce=o[2].x-o[1].x,Pe=o[2].y-o[1].y;for(let Re=0;Re<65;Re++){const je=Re/64,De=[o[0].x+je*pe,o[0].y+je*Ee],tt=[o[1].x+je*Ce,o[1].y+je*Pe],ct=tt[0]-De[0],Ye=tt[1]-De[1];for(let Rt=0;Rt<65;Rt++){const At=Rt/64,xt={x:De[0]+ct*At,y:De[1]+Ye*At,z:0};oe(i.projection.unproject(xt.x,xt.y),xt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(z,Mg.members)}{this.maxLongitudeTriangleSize=0;let z=[],U=new fn;const j=(k,G,$)=>{U.emplaceBack(k,G,$);const K=m[k],te=m[G],re=m[$],Q=Math.min(Math.min(K,te),re),de=Math.max(Math.max(K,te),re)-Q;de>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=de),z.push(Q+de/2)};for(let k=0;k<64;k++)for(let G=0;G<64;G++){const $=65*k+G,K=$+1,te=$+65,re=te+1;j($,te,K),j(K,te,re)}[z,U]=function(k,G){const $=Array.from({length:k.length},(re,Q)=>Q);$.sort((re,Q)=>k[re]-k[Q]);const K=[],te=new fn;for(let re=0;re<$.length;re++){const Q=$[re];K.push(k[Q]);const de=3*Q,oe=de+1;te.emplaceBack(G.uint16[de],G.uint16[oe],G.uint16[oe+1])}return[K,te]}(z,U),this.elevatedGlobeTrianglesCenterLongitudes=z,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(U)}this.elevatedGlobeSegments=Ir.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,M/Mt,0,R/Mt,0,0,w,v,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof um||(this.texture?this.texture.update(this.image):(this.texture=new Rg(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let h=(l=e+180)+360*Math.round((o[0]-l)/360);var l;const d=new Ir,g=(x,E)=>{d.segments.push({vertexOffset:0,primitiveOffset:x,vertexLength:i.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-h)<=b){const x=Y(o,0,o.length,h+b);return x===o.length||g(x,We(o,x+1,o.length,h+360-b)-x),d}h<o[0]&&(h+=360);const S=We(o,0,o.length,h-b);if(S===o.length)return g(0,o.length),d;g(0,S-0);const m=Y(o,S+1,o.length,h+b);return m!==o.length&&g(m,o.length-m),d}}const zA=(Math.pow(256,2)-1)/16907520;class Zv extends En{constructor(e,i,o,h){super(e,{layout:$v||($v=new pr({visibility:new bt(Ue.layout_raster.visibility)})),paint:qv||(qv=new pr({"raster-opacity":new bt(Ue.paint_raster["raster-opacity"]),"raster-color":new Ss(Ue.paint_raster["raster-color"]),"raster-color-mix":new bt(Ue.paint_raster["raster-color-mix"]),"raster-color-range":new bt(Ue.paint_raster["raster-color-range"]),"raster-hue-rotate":new bt(Ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(Ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(Ue.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(Ue.paint_raster["raster-saturation"]),"raster-contrast":new bt(Ue.paint_raster["raster-contrast"]),"raster-resampling":new bt(Ue.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(Ue.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new bt(Ue.paint_raster["raster-emissive-strength"]),"raster-array-band":new bt(Ue.paint_raster["raster-array-band"]),"raster-elevation":new bt(Ue.paint_raster["raster-elevation"])}))},i,o,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Wv&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(h)||o===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=vd({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,h])}}let Xv,Yv,Kv,Jv,Qv;class e1 extends En{constructor(e,i,o,h){super(e,{layout:Xv||(Xv=new pr({visibility:new bt(Ue["layout_raster-particle"].visibility)})),paint:Yv||(Yv=new pr({"raster-particle-array-band":new bt(Ue["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new bt(Ue["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ss(Ue["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new bt(Ue["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new bt(Ue["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new bt(Ue["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new bt(Ue["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new bt(Ue["paint_raster-particle"]["raster-particle-elevation"])}))},i,o,h),this._updateColorRamp(),this.lastInvalidatedAt=Dt.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=vd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Dt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class OA extends En{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Lg(s,e,i){const o=[0,0,1],h=ge.quat.identity([]);return ge.quat.rotateY(h,h,i?-_e(s)+Math.PI:_e(s)),ge.quat.rotateX(h,h,-_e(e)),ge.vec3.transformQuat(o,o,h),ge.vec3.normalize(o,o)}function t1(s,e){const i=fm(s.projection,s.zoom,s.width,s.height),o=function(l,d,g,b,S){const m=new V(g.lng-180*cl,g.lat),x=new V(g.lng+180*cl,g.lat),E=l.project(m.lng,m.lat),v=l.project(x.lng,x.lat),w=-Math.atan2(v.y-E.y,v.x-E.x),M=ze.fromLngLat(g);M.y=$e(M.y,-1+cl,1-cl);const R=M.toLngLat(),z=l.project(R.lng,R.lat),U=ze.fromLngLat(R);U.x+=cl;const j=U.toLngLat(),k=l.project(j.lng,j.lat),G=r1(k.x-z.x,k.y-z.y,w),$=ze.fromLngLat(R);$.y+=cl;const K=$.toLngLat(),te=l.project(K.lng,K.lat),re=r1(te.x-z.x,te.y-z.y,w),Q=Math.abs(G.x)/Math.abs(re.y),de=ge.mat4.identity([]);ge.mat4.rotateZ(de,de,-w*(1-(S?0:b)));const oe=ge.mat4.identity([]);return ge.mat4.scale(oe,oe,[1,1-(1-Q)*b,1]),oe[4]=-re.x/re.y*b,ge.mat4.rotateZ(oe,oe,w),ge.mat4.multiply(oe,de,oe),oe}(s.projection,0,s.center,i,e),h=i1(s);return ge.mat4.scale(o,o,[h,h,1]),o}function i1(s){const e=s.projection,i=fm(s.projection,s.zoom,s.width,s.height),o=Dg(e,s.center),h=Dg(e,V.convert(e.center));return Math.pow(2,o*i+(1-i)*h)}function fm(s,e,i,o,h=1/0){const l=s.range;if(!l)return 0;const d=Math.min(h,Math.max(i,o)),g=Math.log(d/1024)/Math.LN2;return Xt(l[0]+g,l[1]+g,e)}const cl=1/4e4;function Dg(s,e){const i=$e(e.lat,-fe,fe),o=new V(e.lng-180*cl,i),h=new V(e.lng+180*cl,i),l=s.project(o.lng,i),d=s.project(h.lng,i),g=ze.fromLngLat(o),b=ze.fromLngLat(h),S=d.x-l.x,m=d.y-l.y,x=b.x-g.x,E=b.y-g.y,v=Math.sqrt((x*x+E*E)/(S*S+m*m));return Math.log(v)/Math.LN2}function r1(s,e,i){const o=Math.cos(i),h=Math.sin(i);return{x:s*o-e*h,y:s*h+e*o}}function n1(s,e,i){ge.mat4.identity(s),ge.mat4.rotateZ(s,s,_e(e[2])),ge.mat4.rotateX(s,s,_e(e[0])),ge.mat4.rotateY(s,s,_e(e[1])),ge.mat4.scale(s,s,i),ge.mat4.multiply(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function pm(s,e,i,o,h,l,d,g){const b=[i[0]-e[0],i[1]-e[1],0],S=[o[0]-e[0],o[1]-e[1],0];if(ge.vec3.length(b)<1e-12||ge.vec3.length(S)<1e-12)return ge.quat.identity(s);const m=ge.vec3.cross([],b,S);ge.vec3.normalize(m,m),ge.vec3.subtract(S,o,e),b[2]=(l-h)*g,S[2]=(d-h)*g;const x=b;return ge.vec3.cross(x,b,S),ge.vec3.normalize(x,x),ge.quat.rotationTo(s,m,x)}function zg(s,e,i=!1){const o=rl(e.zoom),h=function(l,d,g){const b=d.worldSize,S=[l[12],l[13],l[14]],m=le(S[1]/b),x=ce(S[0]/b),E=ge.mat4.identity([]),v=ee(1,m)*b,w=ee(1,0)*b*Ie(m,d.zoom),M=1/Z_(b);let R=w*M;if(g){const k=fm(d.projection,d.zoom,d.width,d.height,1024);R=M*d.projection.pixelSpaceConversion(d.center.lat,b,k)}const z=D(m,x);ge.vec3.add(z,z,ge.vec3.scale([],ge.vec3.normalize([],z),v*R*S[2]));const U=function(k){const G=[k[0],k[1],k[2]];let $=[0,1,0];const K=ge.vec3.cross([],$,G);return ge.vec3.cross($,G,K),ge.vec3.squaredLength($)===0&&($=[0,1,0],ge.vec3.cross(K,G,$)),ge.vec3.normalize(K,K),ge.vec3.normalize($,$),ge.vec3.normalize(G,G),[K[0],K[1],K[2],0,$[0],$[1],$[2],0,G[0],G[1],G[2],0,k[0],k[1],k[2],1]}(z);ge.mat4.scale(E,E,[R,R,R*v]),ge.mat4.translate(E,E,[-S[0],-S[1],-S[2]]);const j=ge.mat4.multiply([],d.globeMatrix,U);return ge.mat4.multiply(j,j,E),ge.mat4.multiply(j,j,l),j}(s,e,i);if(o>0){const l=function(d,g){const b=g.worldSize,S=ee(1,0)*b*Ie(g.center.lat,g.zoom)/Z_(b),m=ee(1,g.center.lat)*b,x=ge.mat4.identity([]);return ge.mat4.rotateY(x,x,_e(g.center.lng)),ge.mat4.rotateX(x,x,_e(g.center.lat)),ge.mat4.translate(x,x,[0,0,t]),ge.mat4.scale(x,x,[S,S,S*m]),ge.mat4.translate(x,x,[g.point.x-.5*b,g.point.y-.5*b,0]),ge.mat4.multiply(x,x,d),ge.mat4.multiply(x,g.globeMatrix,x)}(s,e);return function(d,g,b){const S=(w,M,R)=>{const z=ge.vec3.length(w),U=ge.vec3.length(M),j=oa(w,M,R);return ge.vec3.scale(j,j,1/ge.vec3.length(j)*ii(z,U,R))},m=S([d[0],d[1],d[2]],[g[0],g[1],g[2]],b),x=S([d[4],d[5],d[6]],[g[4],g[5],g[6]],b),E=S([d[8],d[9],d[10]],[g[8],g[9],g[10]],b),v=oa([d[12],d[13],d[14]],[g[12],g[13],g[14]],b);return[m[0],m[1],m[2],0,x[0],x[1],x[2],0,E[0],E[1],E[2],0,v[0],v[1],v[2],1]}(h,l,o)}return h}function s1(s,e,i,o){const h=lr.projectAabbCorners(o,i);let l=Number.MAX_VALUE,d=-1;for(let S=0;S<h.length;++S){const m=h[S];m[0]=(.5*m[0]+.5)*e.width,m[1]=(.5-.5*m[1])*e.height,m[2]<l&&(d=S,l=m[2])}const g=S=>new Se(h[S][0],h[S][1]);let b;switch(d){case 0:case 6:b=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:b=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:b=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:b=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(St(s,b))return l}const kA=Bi([{name:"a_pos_3f",components:3,type:"Float32"}]),FA=Bi([{name:"a_color_3f",components:3,type:"Float32"}]),BA=Bi([{name:"a_color_4f",components:4,type:"Float32"}]),NA=Bi([{name:"a_uv_2f",components:2,type:"Float32"}]),UA=Bi([{name:"a_normal_3f",components:3,type:"Float32"}]),VA=Bi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),jA=Bi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),o1={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class mm{constructor(e,i,o,h){this.message=(e?`${e}: `:"")+o,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function a1(s,e){const i=s.indexOf("://")===-1;try{return new URL(s,i&&e?"http://example.com":void 0),!0}catch{return!1}}class l1{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class c1{constructor(){this.instancedDataArray=new ic,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Og{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,o,h){this.tileToMeter=be(o);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:g,index:b,sourceLayerIndex:S}of e){const m=g??(d.properties&&d.properties.hasOwnProperty("id")?d.properties.id:void 0),x=vt(d,l);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom),x,o))continue;const E={id:m,sourceLayerIndex:S,index:b,geometry:l?x.geometry:yt(d,o,h),properties:d.properties,type:d.type,patterns:{}},v=this.addFeature(E,E.geometry,x);v&&i.featureIndex.insert(d,E.geometry,b,S,this.index,this.instancesPerModel[v].instancedDataArray.length,Mt/32)}this.lookup=null}update(e,i,o,h){for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];for(const g in e)d.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(d.features[d.idToFeaturesIndex[g]],e[g],d,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const h of o.features){const l=this.layers[0],d=h.feature,g=this.canonical,b=l.paint.get("model-rotation").evaluate(d,{},g),S=l.paint.get("model-scale").evaluate(d,{},g),m=l.paint.get("model-translation").evaluate(d,{},g);ge.vec3.exactEquals(h.rotation,b)&&ge.vec3.exactEquals(h.scale,S)&&ge.vec3.exactEquals(h.translation,m)||(this.evaluate(h,h.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(ag(this.activeReplacements,l))return!1;this.activeReplacements=l;let d=!1;for(const g in this.instancesPerModel){const b=this.instancesPerModel[g],S=b.instancedDataArray;for(const m of b.features){const x=m.instancedDataOffset,E=m.instancedDataCount;for(let v=0;v<E;v++){const w=16*(v+x);let M=S.float32[w+0];const R=M>Mt;M=R?M-Mt:M;const z=Math.floor(M),U=S.float32[w+1];let j=!1;for(const k of this.activeReplacements)if(!Ex(k,o,o1.Model,h)&&!(k.min.x>z||z>k.max.x||k.min.y>U||U>k.max.y)&&(j=Px(Cx(z,U,e.canonical,k.footprintTileId.canonical),k.footprint),j))break;S.float32[w]=j?M+Mt:M,d=d||j!==R}}}return d}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,VA.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,o){const h=this.layers[0],l=h.layout.get("model-id").evaluate(o,{},this.canonical);if(!l)return ki(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),l;a1(l,!1)&&(this.modelUris.includes(l)||this.modelUris.push(l)),this.instancesPerModel[l]||(this.instancesPerModel[l]=new c1);const d=this.instancesPerModel[l],g=d.instancedDataArray,b=new l1(o,g.length);for(const S of i)for(const m of S){if(m.x<0||m.x>=Mt||m.y<0||m.y>=Mt)continue;const x=(this.lookupDim-1)/Mt,E=this.lookupDim*(m.y*x|0)+m.x*x|0;if(this.lookup){if(this.lookup[E]!==0)continue;this.lookup[E]=1}this.instanceCount++;const v=g.length;g.resize(v+1),d.instancesEvaluatedElevation.push(0),g.float32[16*v]=m.x,g.float32[16*v+1]=m.y}return b.instancedDataCount=d.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(b),this.evaluate(b,{},d,!1)),l}getModelUris(){return this.modelUris}evaluate(e,i,o,h){const l=this.layers[0],d=e.feature,g=this.canonical,b=e.rotation=l.paint.get("model-rotation").evaluate(d,i,g),S=e.scale=l.paint.get("model-scale").evaluate(d,i,g),m=e.translation=l.paint.get("model-translation").evaluate(d,i,g),x=l.paint.get("model-color").evaluate(d,i,g);x.a=l.paint.get("model-color-mix-intensity").evaluate(d,i,g);const E=[];this.maxVerticalOffset<m[2]&&(this.maxVerticalOffset=m[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),n1(E,b,S);const v=Math.round(100*x.a)+x.b/1.05;for(let w=0;w<e.instancedDataCount;++w){const M=e.instancedDataOffset+w,R=16*M,z=o.instancedDataArray.float32;let U=0;h&&(U=z[R+6]-o.instancesEvaluatedElevation[M]);const j=0|z[R+1];z[R]=(0|z[R])+x.r/1.05,z[R+1]=j+x.g/1.05,z[R+2]=v,z[R+3]=1/(g.z>10?this.tileToMeter:be(g,j)),z[R+4]=m[0],z[R+5]=m[1],z[R+6]=m[2]+U,z[R+7]=E[0],z[R+8]=E[1],z[R+9]=E[2],z[R+10]=E[4],z[R+11]=E[5],z[R+12]=E[6],z[R+13]=E[8],z[R+14]=E[9],z[R+15]=E[10],o.instancesEvaluatedElevation[M]=m[2]}}}let u1,h1;Ft(Og,"ModelBucket",{omit:["layers"]}),Ft(c1,"PerModelAttributes"),Ft(l1,"ModelFeature");const cc=64,Fu={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function d1(s,e,i,o,h,l,d,g,b,S=!1){const m=i.zoom,x=i.project(o),E=Ie(o.lat,m),v=1/E;ge.mat4.identity(s),ge.mat4.translate(s,s,[x.x+d[0]*v,x.y+d[1]*v,d[2]]);let w=1,M=1;const R=i.worldSize;if(S){if(i.projection.name==="mercator"){let k=0;i.elevation&&(k=i.elevation.getAtPointOrZero(new ze(x.x/R,x.y/R),0));const G=ge.vec4.transformMat4([],[x.x,x.y,k,1],i.projMatrix)[3]/i.cameraToCenterDistance;w=G,M=G*Ie(i.center.lat,m)}else if(i.projection.name==="globe"){const k=zg(s,i),G=ge.mat4.multiply([],i.projMatrix,k),$=[0,0,0,1];ge.vec4.transformMat4($,$,G);const K=$[3]/i.cameraToCenterDistance,te=rl(m),re=i.projection.pixelsPerMeter(o.lat,R)*Ie(o.lat,m),Q=i.projection.pixelsPerMeter(i.center.lat,R)*Ie(i.center.lat,m);w=K/ii(re,ye(i.center.lat),te),M=K*E/re,w*=Q,M*=Q}}else w=v;ge.mat4.scale(s,s,[w,w,M]);const z=[...s],U=e.orientation,j=[];if(n1(j,[U[0]+h[0],U[1]+h[1],U[2]+h[2]],l),ge.mat4.multiply(s,z,j),g&&i.elevation){let k=0;const G=[];if(b&&i.elevation){k=function(te,re,Q,de,oe){const pe=re.elevation;if(!pe)return 0;const Ee=lr.projectAabbCorners(Q,de),Ce=ee(1,oe.lat)*re.worldSize,Pe=function(Wt,Pt){const kt=[0,0,1],ai=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const vi of ai){const mi=Wt[vi.corners[0]],_i=Wt[vi.corners[1]],wi=Wt[vi.corners[2]],Ti=[_i[0]-mi[0],_i[1]-mi[1],Pt*(_i[2]-mi[2])],nr=ge.vec3.cross(Ti,Ti,[wi[0]-mi[0],wi[1]-mi[1],Pt*(wi[2]-mi[2])]);ge.vec3.normalize(nr,nr),vi.dotProductWithUp=ge.vec3.dot(nr,kt)}return ai.sort((vi,mi)=>vi.dotProductWithUp-mi.dotProductWithUp),ai[0].corners}(Ee,Ce),Re=Ee[Pe[0]],je=Ee[Pe[1]],De=Ee[Pe[2]],tt=Ee[Pe[3]],ct=pe.getAtPointOrZero(new ze(Re[0]/re.worldSize,Re[1]/re.worldSize),0),Ye=pe.getAtPointOrZero(new ze(je[0]/re.worldSize,je[1]/re.worldSize),0),Rt=pe.getAtPointOrZero(new ze(De[0]/re.worldSize,De[1]/re.worldSize),0),At=pe.getAtPointOrZero(new ze(tt[0]/re.worldSize,tt[1]/re.worldSize),0),xt=(ct+At)/2,dt=(Ye+Rt)/2;return xt>dt?Ye<Rt?pm(te,je,tt,Re,Ye,At,ct,Ce):pm(te,De,Re,tt,Rt,ct,At,Ce):ct<At?pm(te,Re,je,De,ct,Ye,Rt,Ce):pm(te,tt,De,je,At,Rt,Ye,Ce),Math.max(xt,dt)}(G,i,e.aabb,s,o);const $=ge.mat4.fromQuat([],G),K=ge.mat4.multiply([],$,j);ge.mat4.multiply(s,z,K)}else k=i.elevation.getAtPointOrZero(new ze(x.x/R,x.y/R),0);k!==0&&(s[14]+=k)}}function Ud(s,e,i=!1){s.uploaded||(s.gfxTexture=new Rg(e,s.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:s.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function GA(s,e,i){s.indexBuffer=e.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=e.createVertexBuffer(s.vertexArray,kA.members,!1,!0),s.normalArray&&(s.normalBuffer=e.createVertexBuffer(s.normalArray,UA.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=e.createVertexBuffer(s.texcoordArray,NA.members,!1,!0)),s.colorArray&&(s.colorBuffer=e.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?FA:BA).members,!1,!0)),s.featureArray&&(s.pbrBuffer=e.createVertexBuffer(s.featureArray,jA.members,!0)),s.segments=Ir.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const o=s.material;o.pbrMetallicRoughness.baseColorTexture&&Ud(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&Ud(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&Ud(o.normalTexture,e),o.occlusionTexture&&Ud(o.occlusionTexture,e,i),o.emissionTexture&&Ud(o.emissionTexture,e)}function kg(s,e,i){if(s.meshes)for(const o of s.meshes)GA(o,e,i);if(s.children)for(const o of s.children)kg(o,e,i)}function _m(s){if(s.meshes)for(const e of s.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(s.children)for(const e of s.children)_m(e)}function Fg(s){if(s.meshes)for(const i of s.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(s.children)for(const i of s.children)Fg(i)}class Bu{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const h=o||e.findDEMTileFor(i);if(!h||!h.dem)return;const l=h.dem,d=h.tileID,g=1<<i.canonical.z-d.canonical.z;return new Bu(h,l.dim/Mt/g,[(i.canonical.x/g-d.canonical.x)*l.dim,(i.canonical.y/g-d.canonical.y)*l.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(o);return new Se(h,l)}getElevationAt(e,i,o,h){const l=e*this._scale+this._offset[0],d=i*this._scale+this._offset[1],g=Math.floor(l),b=Math.floor(d),S=this._dem;return h=!!h,o?ii(ii(S.get(g,b,h),S.get(g,b+1,h),d-b),ii(S.get(g+1,b,h),S.get(g+1,b+1,h),d-b),l-g):S.get(g,b,h)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ee(1,e)*this._dem.stride}}const Bg=new Float32Array(262144),uc=new Uint8Array(262144);function f1(s){let e=0;if(s.meshes)for(const i of s.meshes)e=Math.max(e,i.aabb.max[2]);if(s.children)for(const i of s.children)e=Math.max(e,f1(i));return e}function p1(s,e,i){if(s.meshes)for(const o of s.meshes)o.aabb.min[0]!==1/0&&i.insert(e,o.aabb.min[0],o.aabb.min[1],o.aabb.max[0],o.aabb.max[1]);if(s.children)for(const o of s.children)p1(o,e,i)}const m1=["","wall","door","roof","window","lamp","logo"];class _1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:f1(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new lr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new lr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=lr.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class gm{constructor(e,i,o,h,l,d){this.id=i,this.modelTraits|=Fu.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=Fu.HasMapboxMeshFeatures),h&&(this.modelTraits|=Fu.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=l,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const g of e)this.nodesInfo.push(new _1(g)),p1(g,d.featureIndexArray.length,d.grid),d.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,d.bucketLayerIDs.length-1,0)}updateFootprints(e,i){for(const o of this.getNodesInfo()){const h=o.node;h.footprint&&i.push({footprint:h.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const h=o.node;this.uploaded?this.updatePbrBuffer(h):kg(h,e,!0)}for(const o of i)_m(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const h=e.transform.projectionOptions,l=e.style.getBrightness(),d=this.brightness!==l;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||Vd(o.paint.get("model-color").value,d)||Vd(o.paint.get("model-color-mix-intensity").value,d)||Vd(o.paint.get("model-roughness").value,d)||Vd(o.paint.get("model-emissive-strength").value,d)||Vd(o.paint.get("model-height-based-emissive-strength-multiplier").value,d))&&(this.projection=h,this.brightness=l,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),h=this.id.canonical;for(const l of o){const d=l.feature;l.evaluatedScale=i.paint.get("model-scale").evaluate(d,{},h)}}evaluate(e){const i=this.getNodesInfo();for(const o of i){if(!o.node.meshes)continue;const h=o.feature,l=o.node.meshes&&o.node.meshes[0].featureData,d=o.evaluatedColor[2],g=o.evaluatedRMEA[2],b=this.id.canonical;if(o.hasTranslucentParts=!1,l){for(let S=0;S<m1.length;S++){const m=m1[S];m.length&&(h.properties.part=m);const x=e.paint.get("model-color").evaluate(h,{},b).toRenderColor(null),E=e.paint.get("model-color-mix-intensity").evaluate(h,{},b);o.evaluatedColor[S]=[x.r,x.g,x.b,E],o.evaluatedRMEA[S][0]=e.paint.get("model-roughness").evaluate(h,{},b),o.evaluatedRMEA[S][2]=e.paint.get("model-emissive-strength").evaluate(h,{},b),o.evaluatedRMEA[S][3]=x.a,o.emissionHeightBasedParams[S]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},b),!o.hasTranslucentParts&&x.a<1&&(o.hasTranslucentParts=!0)}delete h.properties.part,qA(o,d!==o.evaluatedColor[2]||g!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(h,{},b);o.evaluatedScale=e.paint.get("model-scale").evaluate(h,{},b),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,h){const l=e.findDEMTileFor(o);if(l&&(l.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const d=Bu.create(e,o,l);if(!d)return;this.modelTraits&Fu.HasMapboxMeshFeatures&&this.updateDEM(e,d,o,h);for(const g of this.getNodesInfo()){const b=g.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const S=b.footprint.vertices;let m=d.getElevationAt(S[0].x,S[0].y,!0,!0);for(let x=1;x<S.length;x++)m=Math.min(m,d.getElevationAt(S[x].x,S[x].y,!0,!0));b.elevation=m}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,h){let l=i._dem._modifiedForSources[h];if(l===void 0&&(i._dem._modifiedForSources[h]=[],l=i._dem._modifiedForSources[h]),l.includes(o.canonical))return;const d=i._dem.dim;l.push(o.canonical);let g=!1;for(const b of this.getNodesInfo()){const S=b.node;if(!S.footprint||!S.footprint.grid)continue;const m=S.footprint.grid,x=i.tileCoordToPixel(m.min.x,m.min.y),E=i.tileCoordToPixel(m.max.x,m.max.y),v=Math.min(Math.min(d-E.y,x.x),Math.min(x.y,d-E.x));if(v<0)continue;const w=$e(v,2,5);let M=Math.max(0,x.x-w),R=Math.max(0,x.y-w),z=Math.min(E.x+w,d-1),U=Math.min(E.y+w,d-1);for(let $=R;$<=U;++$)for(let K=M;K<=z;++K)uc[$*d+K]=255;let j=0,k=0;for(let $=0;$<m.cellsY;++$)for(let K=0;K<m.cellsX;++K){if(!m.cells[$*m.cellsX+K])continue;const te=i.tileCoordToPixel(m.min.x+K/m.xScale,m.min.y+$/m.yScale),re=i.tileCoordToPixel(m.min.x+(K+1)/m.xScale,m.min.y+($+1)/m.yScale);for(let Q=te.y;Q<=Math.min(re.y+1,d-1);++Q)for(let de=te.x;de<=Math.min(re.x+1,d-1);++de)uc[Q*d+de]===255&&(uc[Q*d+de]=0,j+=i.getElevationAtPixel(de,Q),k++)}const G=j/k;M=Math.max(1,x.x-w),R=Math.max(1,x.y-w),z=Math.min(E.x+w,d-2),U=Math.min(E.y+w,d-2),g=!0;for(let $=R;$<=U;++$)for(let K=M;K<=z;++K)uc[$*d+K]===0&&(Bg[$*d+K]=i._dem.set(K,$,G));for(let $=1;$<w;++$){M=Math.max(1,x.x-$),R=Math.max(1,x.y-$),z=Math.min(E.x+$,d-2),U=Math.min(E.y+$,d-2);for(let K=R;K<=U;++K)for(let te=M;te<=z;++te){const re=K*d+te;if(uc[re]===255){let Q=0,de=0,oe=-1,pe=-1;for(let Ee=-1;Ee<=1;++Ee)for(let Ce=-1;Ce<=1;++Ce){const Pe=(K+Ee)*d+te+Ce;if(uc[Pe]>=$)continue;const Re=Bg[Pe],je=Math.abs(Re);je>de&&(Q=Re,de=je,oe=Ce,pe=Ee)}if(de>.1){const Ee=1-($+.5*Math.abs(oe*pe))/w;let Ce=i._dem.get(te,K)+Q*Ee;const Pe=i._dem.get(te+oe,K+pe),Re=i._dem.get(te-oe,K-pe,!0);(Ce-Pe)*(Ce-Re)>0&&(Ce=(Pe+Re)/2),Bg[re]=i._dem.set(te,K,Ce),uc[re]=$}}}}}g&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Dt.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)_m(i.node),Fg(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped()),h=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const d=h[l].node;h[l].hiddenByReplacement=!!d.footprint&&!o.find(g=>g.footprint===d.footprint)}}getHeightAtTileCoord(e,i){const o=this.getNodesInfo(),h=[],l=[0,0,0],d=ge.mat4.identity([]);for(let g=0;g<this.nodesInfo.length;g++){const b=o[g],S=b.node.meshes[0],m=S.transformedAabb;if(e<m.min[0]||i<m.min[1]||e>m.max[0]||i>m.max[1])continue;if(b.node.hidden===!0)return{height:1/0,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};ge.mat4.invert(d,b.node.matrix),l[0]=e,l[1]=i,ge.vec3.transformMat4(l,l,d);const x=(l[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*cc|0,E=Math.min(63,(l[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*cc|0)*cc+Math.min(63,x),v=S.heightmap[E];if(!(v<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:v,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new Se(e,i),new Se(e,i),h),h.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function Vd(s,e){return!s.isLightConstant&&e}function $A(s,e,i,o,h,l,d,g){let b=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,m=240&e|(240&e)>>4;i[3]>0&&(b=ii(b,255*i[0],i[3]),S=ii(S,255*i[1],i[3]),m=ii(m,255*i[2],i[3]));const x=b<<8|S,E=m<<8|Math.floor(255*o[3]),v=function($){const K=$e($,0,2);return Math.min(Math.round(.5*K*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],w=$e(h[0],0,1),M=$e(h[1],0,1),R=$e(h[2],0,1),z=$e(h[3],0,1);let U,j,k,G;if(w!==M&&d!==l&&M!==w){const $=d-l;j=1/($*(M-w)),k=-(l+$*w)/($*(M-w));const K=$e(h[4],-1,1);G=Math.pow(10,K),U=255*R<<8|255*z}else U=65535,j=0,k=1,G=1;if(s.emplaceBack(x,E,v,U,j,k,G),g){const $=g.length;g.clear();for(let K=0;K<$;K++)g.emplaceBack(x,E,v,U,j,k,G)}}function qA(s,e,i){const o=s.node;let h=0;const l=i&Fu.HasMeshoptCompression;for(const d of o.meshes){if(o.lights&&o.lightMeshIndex===h||!d.featureData)continue;d.featureArray=new wu,d.featureArray.reserve(d.featureData.length);let g=e;for(const b of d.featureData){const S=l?65535&b:b>>16&65535,m=l?b>>16&65535:65535&b,x=(15&m)<8?15&m:0,E=s.evaluatedRMEA[x],v=s.evaluatedColor[x],w=s.emissionHeightBasedParams[x];let M;if(g&&x===2&&o.lights&&(M=new wu,M.resize(10*o.lights.length)),$A(d.featureArray,S,v,E,w,d.aabb.min[2],d.aabb.max[2],M),M&&g){g=!1;const R=o.meshes[o.lightMeshIndex];R.featureArray=M,R.featureArray._trim()}}d.featureArray._trim(),h++}}function g1(s,e,i,o){const h=1<<s.z;e.lat=le((o/Mt+s.y)/h),e.lng=ce((i/Mt+s.x)/h)}Ft(gm,"Tiled3dModelBucket",{omit:["layers"]}),Ft(_1,"Tiled3dModelFeature");const HA={circle:class extends En{constructor(s,e,i,o){super(s,{layout:Wi||(Wi=new pr({"circle-sort-key":new qt(Ue.layout_circle["circle-sort-key"]),visibility:new bt(Ue.layout_circle.visibility)})),paint:Mr||(Mr=new pr({"circle-radius":new qt(Ue.paint_circle["circle-radius"]),"circle-color":new qt(Ue.paint_circle["circle-color"]),"circle-blur":new qt(Ue.paint_circle["circle-blur"]),"circle-opacity":new qt(Ue.paint_circle["circle-opacity"]),"circle-translate":new bt(Ue.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(Ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(Ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(Ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qt(Ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qt(Ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qt(Ue.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new bt(Ue.paint_circle["circle-emissive-strength"])}))},e,i,o)}createBucket(s){return new Ht(s)}queryRadius(s){const e=s;return mr("circle-radius",this,e)+mr("circle-stroke-width",this,e)+Qi(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,i,o,h,l,d,g){const b=Ni(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return X0(s,o,l,d,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,e,i){const o=Z0(this);return{config:new na(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}},heatmap:class extends En{createBucket(s){return new K0(s)}constructor(s,e,i,o){super(s,{layout:J0||(J0=new pr({visibility:new bt(Ue.layout_heatmap.visibility)})),paint:Q0||(Q0=new pr({"heatmap-radius":new qt(Ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qt(Ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(Ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ss(Ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(Ue.paint_heatmap["heatmap-opacity"])}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return mr("heatmap-radius",this,s)}queryIntersectsFeature(s,e,i,o,h,l,d,g){const b=this.paint.get("heatmap-radius").evaluate(e,i);return X0(s,o,l,d,g,!0,!0,new Se(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,e,i){return s==="heatmap"?{config:new na(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends En{constructor(s,e,i,o){super(s,{layout:ex||(ex=new pr({visibility:new bt(Ue.layout_hillshade.visibility)})),paint:tx||(tx=new pr({"hillshade-illumination-direction":new bt(Ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(Ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(Ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(Ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(Ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(Ue.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new bt(Ue.paint_hillshade["hillshade-emissive-strength"])}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}},fill:class extends En{constructor(s,e,i,o){super(s,{layout:cx||(cx=new pr({"fill-sort-key":new qt(Ue.layout_fill["fill-sort-key"]),visibility:new bt(Ue.layout_fill.visibility)})),paint:ux||(ux=new pr({"fill-antialias":new bt(Ue.paint_fill["fill-antialias"]),"fill-opacity":new qt(Ue.paint_fill["fill-opacity"]),"fill-color":new qt(Ue.paint_fill["fill-color"]),"fill-outline-color":new qt(Ue.paint_fill["fill-outline-color"]),"fill-translate":new bt(Ue.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(Ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new qt(Ue.paint_fill["fill-pattern"]),"fill-emissive-strength":new bt(Ue.paint_fill["fill-emissive-strength"]),"fill-z-offset":new qt(Ue.paint_fill["fill-z-offset"])}))},e,i,o)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(s,e,i){return{config:new na(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(s,e){super.recalculate(s,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new tg(s)}queryRadius(){return Qi(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,i,o,h,l){return!s.queryGeometry.isAboveHorizon&&ri(xi(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends En{constructor(s,e,i,o){super(s,{layout:qx||(qx=new pr({visibility:new bt(Ue["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new bt(Ue["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Hx||(Hx=new pr({"fill-extrusion-opacity":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qt(Ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new qt(Ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qt(Ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qt(Ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new qt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new qt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new qt(Ue["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new qt(Ue["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Zp(s)}queryRadius(){return Qi(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,e,i,o,h,l,d,g,b){const S=Ni(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),m=this.paint.get("fill-extrusion-height").evaluate(e,i),x=this.paint.get("fill-extrusion-base").evaluate(e,i),E=[0,0],v=g&&l.elevation,w=l.elevation?l.elevation.exaggeration():1,M=s.tile.getBucket(this);if(v&&M instanceof Zp){const k=M.centroidVertexArray,G=b+1;G<k.length&&(E[0]=k.geta_centroid_pos0(G),E[1]=k.geta_centroid_pos1(G))}if(E[0]===0&&E[1]===1)return!1;l.projection.name==="globe"&&(o=$x([o],[new Se(0,0),new Se(Mt,Mt)],s.tileID.canonical).map(k=>k.polygon).flat());const R=v?g:null,[z,U]=function(k,G,$,K,te,re,Q,de,oe,pe,Ee){return k.projection.name==="globe"?function(Ce,Pe,Re,je,De,tt,ct,Ye,Rt,At,xt){const dt=[],Wt=[],Pt=Ce.projection.upVectorScale(xt,Ce.center.lat,Ce.worldSize).metersToTile,kt=[0,0,0,1],ai=[0,0,0,1],vi=(_i,wi,Ti,nr)=>{_i[0]=wi,_i[1]=Ti,_i[2]=nr,_i[3]=1},mi=Gx();Re>0&&(Re+=mi),je+=mi;for(const _i of Pe){const wi=[],Ti=[];for(const nr of _i){const Zi=nr.x+De.x,ui=nr.y+De.y,Vi=Ce.projection.projectTilePoint(Zi,ui,xt),Gi=Ce.projection.upVector(xt,nr.x,nr.y);let hr=Re,Lr=je;if(ct){const qr=Zx(Zi,ui,Re,je,ct,Ye,Rt,At);hr+=qr.base,Lr+=qr.top}Re!==0?vi(kt,Vi.x+Gi[0]*Pt*hr,Vi.y+Gi[1]*Pt*hr,Vi.z+Gi[2]*Pt*hr):vi(kt,Vi.x,Vi.y,Vi.z),vi(ai,Vi.x+Gi[0]*Pt*Lr,Vi.y+Gi[1]*Pt*Lr,Vi.z+Gi[2]*Pt*Lr),ge.vec3.transformMat4(kt,kt,tt),ge.vec3.transformMat4(ai,ai,tt),wi.push(new lc(kt[0],kt[1],kt[2])),Ti.push(new lc(ai[0],ai[1],ai[2]))}dt.push(wi),Wt.push(Ti)}return[dt,Wt]}(k,G,$,K,te,re,Q,de,oe,pe,Ee):Q?function(Ce,Pe,Re,je,De,tt,ct,Ye,Rt){const At=[],xt=[],dt=[0,0,0,1];for(const Wt of Ce){const Pt=[],kt=[];for(const ai of Wt){const vi=ai.x+je.x,mi=ai.y+je.y,_i=Zx(vi,mi,Pe,Re,tt,ct,Ye,Rt);dt[0]=vi,dt[1]=mi,dt[2]=_i.base,dt[3]=1,ge.vec4.transformMat4(dt,dt,De),dt[3]=Math.max(dt[3],1e-5);const wi=new lc(dt[0]/dt[3],dt[1]/dt[3],dt[2]/dt[3]);dt[0]=vi,dt[1]=mi,dt[2]=_i.top,dt[3]=1,ge.vec4.transformMat4(dt,dt,De),dt[3]=Math.max(dt[3],1e-5);const Ti=new lc(dt[0]/dt[3],dt[1]/dt[3],dt[2]/dt[3]);Pt.push(wi),kt.push(Ti)}At.push(Pt),xt.push(kt)}return[At,xt]}(G,$,K,te,re,Q,de,oe,pe):function(Ce,Pe,Re,je,De){const tt=[],ct=[],Ye=De[8]*Pe,Rt=De[9]*Pe,At=De[10]*Pe,xt=De[11]*Pe,dt=De[8]*Re,Wt=De[9]*Re,Pt=De[10]*Re,kt=De[11]*Re;for(const ai of Ce){const vi=[],mi=[];for(const _i of ai){const wi=_i.x+je.x,Ti=_i.y+je.y,nr=De[0]*wi+De[4]*Ti+De[12],Zi=De[1]*wi+De[5]*Ti+De[13],ui=De[2]*wi+De[6]*Ti+De[14],Vi=De[3]*wi+De[7]*Ti+De[15],Gi=nr+Ye,hr=Zi+Rt,Lr=ui+At,qr=Math.max(Vi+xt,1e-5),Dr=nr+dt,wr=Zi+Wt,ln=ui+Pt,Zr=Math.max(Vi+kt,1e-5);vi.push(new lc(Gi/qr,hr/qr,Lr/qr)),mi.push(new lc(Dr/Zr,wr/Zr,ln/Zr))}tt.push(vi),ct.push(mi)}return[tt,ct]}(G,$,K,te,re)}(l,o,x,m,S,d,R,E,w,l.center.lat,s.tileID.canonical),j=s.queryGeometry;return function(k,G,$){let K=1/0;ri($,G)&&(K=Wx($,G[0]));for(let te=0;te<G.length;te++){const re=G[te],Q=k[te];for(let de=0;de<re.length-1;de++){const oe=re[de],pe=[oe,re[de+1],Q[de+1],Q[de],oe];St($,pe)&&(K=Math.min(K,Wx($,pe)))}}return K!==1/0&&K}(z,U,j.isPointQuery()?j.screenBounds:j.screenGeometry)}},line:class extends En{constructor(s,e,i,o){const h=nv();super(s,h,e,i,o),h.layout&&(this.layout=new Ha(h.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ul,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=(()=>{if(Cd)return Cd;const i=nv();return Cd=new XS(i.paint.properties["line-width"].specification),Cd.useIntegerZoom=!0,Cd})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new hg(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,e,i){const o=iv(this);return{config:new na(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(s){const e=s,i=sv(mr("line-width",this,e),mr("line-gap-width",this,e)),o=mr("line-offset",this,e);return i/2+Math.abs(o)+Qi(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,i,o,h,l){if(s.queryGeometry.isAboveHorizon)return!1;const d=xi(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),g=s.pixelToTileUnitsFactor/2*sv(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(o=function(S,m){const x=[],E=new Se(0,0);for(let v=0;v<S.length;v++){const w=S[v],M=[];for(let R=0;R<w.length;R++){const z=w[R],U=w[R+1],j=R===0?E:z.sub(w[R-1])._unit()._perp(),k=R===w.length-1?E:U.sub(z)._unit()._perp(),G=j._add(k)._unit();G._mult(1/(G.x*k.x+G.y*k.y)),M.push(G._mult(m)._add(z))}x.push(M)}return x}(o,b*s.pixelToTileUnitsFactor)),function(S,m,x){for(let E=0;E<m.length;E++){const v=m[E];if(S.length>=3){for(let w=0;w<v.length;w++)if(ur(S,v[w]))return!0}if(Vt(S,v,x))return!0}return!1}(d,o,g)}isTileClipped(){return!0}isDraped(s){const e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:cm,background:class extends En{constructor(s,e,i,o){super(s,{layout:jv||(jv=new pr({visibility:new bt(Ue.layout_background.visibility)})),paint:Gv||(Gv=new pr({"background-pitch-alignment":new bt(Ue.paint_background["background-pitch-alignment"]),"background-color":new bt(Ue.paint_background["background-color"]),"background-pattern":new bt(Ue.paint_background["background-pattern"]),"background-opacity":new bt(Ue.paint_background["background-opacity"]),"background-emissive-strength":new bt(Ue.paint_background["background-emissive-strength"])}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Zv,"raster-particle":e1,sky:class extends En{constructor(s,e,i,o){super(s,{layout:Kv||(Kv=new pr({visibility:new bt(Ue.layout_sky.visibility)})),paint:Jv||(Jv=new pr({"sky-type":new bt(Ue.paint_sky["sky-type"]),"sky-atmosphere-sun":new bt(Ue.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new bt(Ue.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new bt(Ue.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new bt(Ue.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ss(Ue.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new bt(Ue.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new bt(Ue.paint_sky["sky-atmosphere-color"]),"sky-opacity":new bt(Ue.paint_sky["sky-opacity"])}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),h=!o,l=s.style.light,d=l.properties.get("position");return h&&l.properties.get("anchor")==="viewport"&&ki("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Lg(d.azimuthal,90-d.polar,e):Lg(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return Lg(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends En{constructor(s,e,i,o){super(s,{paint:Qv||(Qv=new pr({}))},e,null)}},model:class extends En{constructor(s,e,i,o){super(s,{layout:u1||(u1=new pr({visibility:new bt(Ue.layout_model.visibility),"model-id":new qt(Ue.layout_model["model-id"])})),paint:h1||(h1=new pr({"model-opacity":new bt(Ue.paint_model["model-opacity"]),"model-rotation":new qt(Ue.paint_model["model-rotation"]),"model-scale":new qt(Ue.paint_model["model-scale"]),"model-translation":new qt(Ue.paint_model["model-translation"]),"model-color":new qt(Ue.paint_model["model-color"]),"model-color-mix-intensity":new qt(Ue.paint_model["model-color-mix-intensity"]),"model-type":new bt(Ue.paint_model["model-type"]),"model-cast-shadows":new bt(Ue.paint_model["model-cast-shadows"]),"model-receive-shadows":new bt(Ue.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new bt(Ue.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new qt(Ue.paint_model["model-emissive-strength"]),"model-roughness":new qt(Ue.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new qt(Ue.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new bt(Ue.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new bt(Ue.paint_model["model-front-cutoff"])}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Og(s)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof gm?Mt-1:0}queryIntersectsFeature(s,e,i,o,h,l){if(!this.modelManager)return!1;const d=this.modelManager,g=s.tile.getBucket(this);if(!(g&&g instanceof Og))return!1;const b=g;for(const S in b.instancesPerModel){const m=b.instancesPerModel[S],x=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(m.idToFeaturesIndex.hasOwnProperty(x)){const E=m.features[m.idToFeaturesIndex[x]],v=d.getModel(S,this.scope);if(!v)return!1;let w=ge.mat4.create();const M=new V(0,0),R=b.canonical;let z=Number.MAX_VALUE;for(let U=0;U<E.instancedDataCount;++U){const j=16*(E.instancedDataOffset+U),k=m.instancedDataArray.float32,G=[k[j+4],k[j+5],k[j+6]];g1(R,M,k[j],0|k[j+1]),d1(w,v,l,M,E.rotation,E.scale,G,!1,!1,!1),l.projection.name==="globe"&&(w=zg(w,l));const $=ge.mat4.multiply([],l.projMatrix,w),K=s.queryGeometry,te=s1(K.isPointQuery()?K.screenBounds:K.screenGeometry,l,$,v.aabb);te!=null&&(z=Math.min(te,z))}return z!==Number.MAX_VALUE&&z}}return!1}_handleOverridablePaintPropertyUpdate(s,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const e=this._transitionablePaint._values[s];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Us}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(s,e,i,o){const h=s.tile,l=h.getBucket(this);let d=null,g=Number.MAX_VALUE;if(!(l&&l instanceof gm))return{queryFeature:d,intersectionZ:g};const b=l.getNodesInfo()[e];if(b.hiddenByReplacement||!b.node.meshes||!i.filter(new Ar(h.tileID.overscaledZ),b.feature,h.tileID.canonical))return{queryFeature:d,intersectionZ:g};const S=b.node,m=o.calculatePosMatrix(h.tileID.toUnwrapped(),o.worldSize),x=b.evaluatedScale;let E=0;o.elevation&&S.elevation&&(E=S.elevation*o.elevation.exaggeration()),ge.mat4.translate(m,m,[(S.anchor?S.anchor[0]:0)*(x[0]-1),(S.anchor?S.anchor[1]:0)*(x[1]-1),E]),ge.mat4.scale(m,m,x),ge.mat4.multiply(m,m,S.matrix);const v=s.queryGeometry,w=v.isPointQuery()?v.screenBounds:v.screenGeometry,M=function(z){const U=ge.mat4.multiply([],m,z.matrix),j=ge.mat4.multiply(U,o.expandedFarZProjMatrix,U);for(let k=0;k<z.meshes.length;++k){const G=z.meshes[k];if(k===z.lightMeshIndex)continue;const $=s1(w,o,j,G.aabb);$!=null&&(g=Math.min($,g))}if(z.children)for(const k of z.children)M(k)};if(M(S),g===Number.MAX_VALUE)return{queryFeature:d,intersectionZ:g};const R=new V(0,0);return g1(h.tileID.canonical,R,b.node.anchor[0],b.node.anchor[1]),d={type:"Feature",geometry:{type:"Point",coordinates:[R.lng,R.lat]},properties:b.feature.properties,id:b.feature.id,state:{},layer:this.serialize()},{queryFeature:d,intersectionZ:g}}},clip:class extends En{constructor(s,e,i,o){super(s,{layout:hx||(hx=new pr({"clip-layer-types":new bt(Ue.layout_clip["clip-layer-types"]),"clip-layer-scope":new bt(Ue.layout_clip["clip-layer-scope"])})),paint:dx||(dx=new pr({}))},e,i,o)}recalculate(s,e){super.recalculate(s,e)}createBucket(s){return new fx(s)}isTileClipped(){return!0}is3D(){return!0}}};class WA{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ZA{constructor(){this.tasks={},this.taskQueue=[],en(["process"],this),this.invoker=new WA(this.process),this.nextId=0}add(e,i){const o=this.nextId++,h=function({type:l,isSymbolTile:d,zoom:g}){return g=g||0,l==="message"?0:l!=="maybePrepare"||d?l!=="parseTile"||d?l==="parseTile"&&d?300-g:l==="maybePrepare"&&d?400-g:500:200-g:100-g}(i);if(h===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:h,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const l=this.tasks[this.taskQueue[h]];l.priority<i&&(i=l.priority,e=h)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class y1{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},en(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new ZA}send(e,i,o,h,l=!1,d){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=d,this.callbacks[g]=o);const b=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!o,targetMapId:h,mustQueue:l,sourceMapId:this.mapId,data:$n(i,b)},b),{cancel:()=>{o&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const i=e.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[o];delete this.cancelCallbacks[o],h&&h.cancel()}else if(i.mustQueue||$o()){const h=this.callbacks[o],l=this.scheduler.add(()=>this.processTask(o,i),h&&h.metadata||{type:"message"});l&&(this.cancelCallbacks[o]=l)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(Qo(i.error)):o(null,Qo(i.data)))}else{const o=new Set,h=i.hasCallback?(d,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?$n(d):null,data:$n(g,o)},o)}:d=>{},l=Qo(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,l,h);else if(this.parent.getWorkerSource){const d=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,d[0],l.source,l.scope)[d[1]](l,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Nu{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=kr();const o=this.workerPool.acquire(this.id);for(let h=0;h<o.length;h++){const l=new Nu.Actor(o[h],i,this.id);l.name=`Worker ${h}`,this.actors.push(l)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){Ui(this.actors,(h,l)=>{h.send(e,i,l)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Nu.Actor=y1;class x1{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function v1(s,e,i,o){let h=0,l=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(o[d])<1e-15){if(i[d]<s[d]||i[d]>e[d])return null}else{const g=1/o[d];let b=(s[d]-i[d])*g,S=(e[d]-i[d])*g;if(b>S){const m=b;b=S,S=m}if(b>h&&(h=b),S<l&&(l=S),h>l)return null}return h}function b1(s,e,i,o,h,l,d,g,b,S,m){const x=o-s,E=h-e,v=l-i,w=d-s,M=g-e,R=b-i,z=m[1]*R-m[2]*M,U=m[2]*w-m[0]*R,j=m[0]*M-m[1]*w,k=x*z+E*U+v*j;if(Math.abs(k)<1e-15)return null;const G=1/k,$=S[0]-s,K=S[1]-e,te=S[2]-i,re=($*z+K*U+te*j)*G;if(re<0||re>1)return null;const Q=K*v-te*E,de=te*x-$*v,oe=$*E-K*x,pe=(m[0]*Q+m[1]*de+m[2]*oe)*G;return pe<0||re+pe>1?null:(w*Q+M*de+R*oe)*G}function w1(s,e,i){return(s-e)/(i-e)}function T1(s,e,i,o,h,l,d,g,b){const S=1<<i,m=l-o,x=d-h,E=(s+1)/S*m+o,v=(e+0)/S*x+h,w=(e+1)/S*x+h;g[0]=(s+0)/S*m+o,g[1]=v,b[0]=E,b[1]=w}class E1{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(l){const d=Math.ceil(Math.log2(l.dim/8)),g=[];let b=Math.ceil(Math.pow(2,d));const S=1/b,m=(v,w,M,R,z)=>{const U=R?1:0,j=(v+1)*M-U,k=w*M,G=(w+1)*M-U;z[0]=v*M,z[1]=k,z[2]=j,z[3]=G};let x=new x1(b);const E=[];for(let v=0;v<b*b;v++){m(v%b,Math.floor(v/b),S,!1,E);const w=ul(E[0],E[1],l),M=ul(E[2],E[1],l),R=ul(E[2],E[3],l),z=ul(E[0],E[3],l);x.minimums.push(Math.min(w,M,R,z)),x.maximums.push(Math.max(w,M,R,z)),x.leaves.push(1)}for(g.push(x),b/=2;b>=1;b/=2){const v=g[g.length-1];x=new x1(b);for(let w=0;w<b*b;w++){m(w%b,Math.floor(w/b),2,!0,E);const M=v.getElevation(E[0],E[1]),R=v.getElevation(E[2],E[1]),z=v.getElevation(E[2],E[3]),U=v.getElevation(E[0],E[3]),j=v.isLeaf(E[0],E[1]),k=v.isLeaf(E[2],E[1]),G=v.isLeaf(E[2],E[3]),$=v.isLeaf(E[0],E[3]),K=Math.min(M.min,R.min,z.min,U.min),te=Math.max(M.max,R.max,z.max,U.max),re=j&&k&&G&&$;x.maximums.push(te),x.minimums.push(K),x.leaves.push(te-K<=5&&re?1:0)}g.push(x)}return g}(this.dem),o=i.length-1,h=i[o];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,h,l,d,g=1){return v1([e,i,-100],[o,h,this.maximums[0]*g],l,d)}raycast(e,i,o,h,l,d,g=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,i,o,h,l,d,g);if(b==null)return null;const S=[],m=[],x=[],E=[],v=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;v.length>0;){const{idx:w,t:M,nodex:R,nodey:z,depth:U}=v.pop();if(this.leaves[w]){T1(R,z,U,e,i,o,h,x,E);const k=1<<U,G=(R+0)/k,$=(R+1)/k,K=(z+0)/k,te=(z+1)/k,re=ul(G,K,this.dem)*g,Q=ul($,K,this.dem)*g,de=ul($,te,this.dem)*g,oe=ul(G,te,this.dem)*g,pe=b1(x[0],x[1],re,E[0],x[1],Q,E[0],E[1],de,l,d),Ee=b1(E[0],E[1],de,x[0],E[1],oe,x[0],x[1],re,l,d),Ce=Math.min(pe!==null?pe:Number.MAX_VALUE,Ee!==null?Ee:Number.MAX_VALUE);if(Ce!==Number.MAX_VALUE)return Ce;{const Pe=ge.vec3.scaleAndAdd([],l,d,M);if(S1(re,Q,oe,de,w1(Pe[0],x[0],E[0]),w1(Pe[1],x[1],E[1]))>=Pe[2])return M}continue}let j=0;for(let k=0;k<this._siblingOffset.length;k++){T1((R<<1)+this._siblingOffset[k][0],(z<<1)+this._siblingOffset[k][1],U+1,e,i,o,h,x,E),x[2]=-100,E[2]=this.maximums[this.childOffsets[w]+k]*g;const G=v1(x,E,l,d);if(G!=null){const $=G;S[k]=$;let K=!1;for(let te=0;te<j&&!K;te++)$>=S[m[te]]&&(m.splice(te,0,k),K=!0);K||(m[j]=k),j++}}for(let k=0;k<j;k++){const G=m[k];v.push({idx:this.childOffsets[w]+G,t:S[G],nodex:(R<<1)+this._siblingOffset[G][0],nodey:(z<<1)+this._siblingOffset[G][1],depth:U+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,h,l){if(e[h].isLeaf(i,o)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const d=h-1,g=e[d];let b=0,S=0;for(let m=0;m<this._siblingOffset.length;m++){const x=2*i+this._siblingOffset[m][0],E=2*o+this._siblingOffset[m][1],v=g.getElevation(x,E),w=g.isLeaf(x,E),M=this._addNode(v.min,v.max,w);w&&(b|=1<<m),S||(S=M)}for(let m=0;m<this._siblingOffset.length;m++)b&1<<m||this._construct(e,2*i+this._siblingOffset[m][0],2*o+this._siblingOffset[m][1],d,S+m)}}function S1(s,e,i,o,h,l){return ii(ii(s,i,l),ii(e,o,l),h)}function ul(s,e,i){const o=i.dim,h=$e(s*o-.5,0,o-1),l=$e(e*o-.5,0,o-1),d=Math.floor(h),g=Math.floor(l),b=Math.min(d+1,o-1),S=Math.min(g+1,o-1);return S1(i.get(d,g),i.get(b,g),i.get(d,S),i.get(b,S),h-d,l-g)}const XA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function YA(s,e,i){return(256*s*256+256*e+i)/10-1e4}function KA(s,e,i){return 256*s+e+i/256-32768}class ym{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void ki(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const l=this.dim=i.height-2,d=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let b=0;b<l;b++)d[this._idx(-1,b)]=d[this._idx(0,b)],d[this._idx(l,b)]=d[this._idx(l-1,b)],d[this._idx(b,-1)]=d[this._idx(b,0)],d[this._idx(b,l)]=d[this._idx(b,l-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(l,-1)]=d[this._idx(l-1,0)],d[this._idx(-1,l)]=d[this._idx(0,l-1)],d[this._idx(l,l)]=d[this._idx(l-1,l-1)]}const g=o==="terrarium"?KA:YA;for(let b=0;b<d.length;++b){const S=4*b;this.floatView[b]=g(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=Dt.now()}_buildQuadTree(){this._tree=new E1(this)}get(e,i,o=!1){o&&(e=$e(e,-1,this.dim),i=$e(i,-1,this.dim));const h=this._idx(e,i);return this.floatView[h]}set(e,i,o){const h=this._idx(e,i),l=this.floatView[h];return this.floatView[h]=o,o-l}static getUnpackVector(e){return XA[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],h=ym.getUnpackVector(i);let l=Math.floor((e+h[3])/h[2]);return o[2]=l%256,l=Math.floor(l/256),o[1]=l%256,l=Math.floor(l/256),o[0]=l,o}getPixels(){return new nx({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,l=i*this.dim+this.dim,d=o*this.dim,g=o*this.dim+this.dim;switch(i){case-1:h=l-1;break;case 1:l=h+1}switch(o){case-1:d=g-1;break;case 1:g=d+1}const b=-i*this.dim,S=-o*this.dim;for(let m=d;m<g;m++)for(let x=h;x<l;x++){const E=4*this._idx(x,m),v=4*this._idx(x+b,m+S);this.pixels[E+0]=e.pixels[v+0],this.pixels[E+1]=e.pixels[v+1],this.pixels[E+2]=e.pixels[v+2],this.pixels[E+3]=e.pixels[v+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function JA(s,e,i){s===1?e.header_length=i.readFixed32():s===2?e.x=i.readVarint():s===3?e.y=i.readVarint():s===4?e.z=i.readVarint():s===5&&e.layers.push(function(o,h){return o.readFields(rI,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},h)}(i,i.readVarint()+i.pos))}function QA(s,e,i){s===1?(e.delta_filter=function(o,h){return o.readFields(eI,{block_size:0},h)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):s===2?(i.readVarint(),e.filter="zigzag_filter"):s===3?(i.readVarint(),e.filter="bitshuffle_filter"):s===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function eI(s,e,i){s===1&&(e.block_size=i.readVarint())}function tI(s,e,i){s===1?(i.readVarint(),e.codec="gzip_data"):s===2?(i.readVarint(),e.codec="jpeg_image"):s===3?(i.readVarint(),e.codec="webp_image"):s===4&&(i.readVarint(),e.codec="png_image")}function iI(s,e,i){s===1?e.first_byte=i.readFixed64():s===2?e.last_byte=i.readFixed64():s===3?e.filters.push(function(o,h){return o.readFields(QA,{},h)}(i,i.readVarint()+i.pos)):s===4?e.codec=function(o,h){return o.readFields(tI,{},h)}(i,i.readVarint()+i.pos):s===5?e.deprecated_offset=i.readFloat():s===6?e.deprecated_scale=i.readFloat():s===7?e.bands.push(i.readString()):s===8?e.offset=i.readDouble():s===9&&(e.scale=i.readDouble())}function rI(s,e,i){s===1?e.version=i.readVarint():s===2?e.name=i.readString():s===3?e.units=i.readString():s===4?e.tilesize=i.readVarint():s===5?e.buffer=i.readVarint():s===6?e.pixel_format=i.readVarint():s===7&&e.data_index.push(function(o,h){return o.readFields(iI,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},h)}(i,i.readVarint()+i.pos))}function nI(s,e,i){if(s===2)(function(o,h,l){o.readFields(sI,l,h)})(i,i.readVarint()+i.pos,e);else if(s===3)throw new Error("Not implemented")}function sI(s,e,i){if(s===1){let o=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)e[o++]=i.readVarint()}}Ft(ym,"DEMData"),Ft(E1,"DemMinMaxQuadTree",{omit:["dem"]});class oI{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}}function aI(s,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const h=o===1?1:0,l=o===2?1:0;for(let d=0;d<e[0];d++){const g=e[1]*d;for(let b=h;b<e[1];b++){const S=e[2]*(b+g);for(let m=l;m<e[2];m++){const x=e[3]*(m+S);for(let E=0;E<e[3];E++){const v=x+E;s[v]+=s[v-i]}}}}i*=e[o]}return s}function lI(s){for(let e=0,i=s.length;e<i;e++)s[e]=s[e]>>>1^-(1&s[e]);return s}function cI(s,e){switch(e){case"uint32":return s;case"uint16":for(let i=0;i<s.length;i+=2){const o=s[i],h=s[i+1];s[i]=(240&o)>>4|(61440&o)>>8|(240&h)<<4|61440&h,s[i+1]=15&o|(3840&o)>>4|(15&h)<<8|(3840&h)<<4}return s;case"uint8":for(let i=0;i<s.length;i+=4){const o=s[i],h=s[i+1],l=s[i+2],d=s[i+3];s[i+0]=(192&o)>>6|(192&h)>>4|(192&l)>>2|192&d,s[i+1]=(48&o)>>4|(48&h)>>2|48&l|(48&d)<<2,s[i+2]=(12&o)>>2|12&h|(12&l)<<2|(12&d)<<4,s[i+3]=3&o|(3&h)<<2|(3&l)<<4|(3&d)<<6}return s;default:throw new Error(`Invalid pixel format, "${e}"`)}}var Cs=Uint8Array,jd=Uint16Array,uI=Int32Array,A1=new Cs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),I1=new Cs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),hI=new Cs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M1=function(s,e){for(var i=new jd(31),o=0;o<31;++o)i[o]=e+=1<<s[o-1];var h=new uI(i[30]);for(o=1;o<30;++o)for(var l=i[o];l<i[o+1];++l)h[l]=l-i[o]<<5|o;return{b:i,r:h}},C1=M1(A1,2),P1=C1.b,dI=C1.r;P1[28]=258,dI[258]=28;for(var fI=M1(I1,0).b,R1=new jd(32768),$r=0;$r<32768;++$r){var Uu=(43690&$r)>>1|(21845&$r)<<1;R1[$r]=((65280&(Uu=(61680&(Uu=(52428&Uu)>>2|(13107&Uu)<<2))>>4|(3855&Uu)<<4))>>8|(255&Uu)<<8)>>1}var Gd=function(s,e,i){for(var o=s.length,h=0,l=new jd(e);h<o;++h)s[h]&&++l[s[h]-1];var d,g=new jd(e);for(h=1;h<e;++h)g[h]=g[h-1]+l[h-1]<<1;d=new jd(1<<e);var b=15-e;for(h=0;h<o;++h)if(s[h])for(var S=h<<4|s[h],m=e-s[h],x=g[s[h]-1]++<<m,E=x|(1<<m)-1;x<=E;++x)d[R1[x]>>b]=S;return d},$d=new Cs(288);for($r=0;$r<144;++$r)$d[$r]=8;for($r=144;$r<256;++$r)$d[$r]=9;for($r=256;$r<280;++$r)$d[$r]=7;for($r=280;$r<288;++$r)$d[$r]=8;var L1=new Cs(32);for($r=0;$r<32;++$r)L1[$r]=5;var pI=Gd($d,9),mI=Gd(L1,5),Ng=function(s){for(var e=s[0],i=1;i<s.length;++i)s[i]>e&&(e=s[i]);return e},uo=function(s,e,i){var o=e/8|0;return(s[o]|s[o+1]<<8)>>(7&e)&i},Ug=function(s,e){var i=e/8|0;return(s[i]|s[i+1]<<8|s[i+2]<<16)>>(7&e)},_I=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ho=function(s,e,i){var o=new Error(e||_I[s]);if(o.code=s,Error.captureStackTrace&&Error.captureStackTrace(o,ho),!i)throw o;return o},gI=new Cs(0),yI=typeof TextDecoder<"u"&&new TextDecoder;try{yI.decode(gI,{stream:!0})}catch{}const xI={gzip_data:"gzip"};class qs extends Error{constructor(e){super(e),this.name="MRTError"}}const vI={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},D1={uint32:1,uint16:2,uint8:4},bI={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Vg;class jg{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new qs(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new qs("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new qs(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const h=function(l,d){return l.readFields(JA,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new Vg(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new qs(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const l of h.layers)this.layers[l.name]=new wI(l,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let h of e.blockIndices){const l=o.dataIndex[h],d=l.first_byte-e.firstByte,g=l.last_byte-e.firstByte;if(o._blocksInProgress.has(h))continue;const b={layerName:o.name,firstByte:d,lastByte:g,pixelFormat:o.pixelFormat,blockIndex:h,blockShape:[l.bands.length].concat(o.bandShape),buffer:o.buffer,codec:l.codec.codec,filters:l.filters.map(S=>S.filter)};o._blocksInProgress.add(h),i.push(b)}return new z1(i,()=>{i.forEach(h=>o._blocksInProgress.delete(h.blockIndex))},(h,l)=>{if(i.forEach(d=>o._blocksInProgress.delete(d.blockIndex)),h)throw h;l.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class wI{constructor({version:e,name:i,units:o,tilesize:h,pixel_format:l,buffer:d,data_index:g},b){if(this.version=e,this.version!==1)throw new qs(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=h,this.buffer=d,this.pixelFormat=vI[l],this.dataIndex=g,this.bandShape=[h+2*d,h+2*d,D1[this.pixelFormat]],this._decodedBlocks=new oI(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return D1[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,h]of this.dataIndex.entries()){for(const[l,d]of h.bands.entries())if(d===e)return{bandIndex:i+l,blockIndex:o,blockBandIndex:l};i+=h.bands.length}break;case"number":for(const[o,h]of this.dataIndex.entries()){if(e>=i&&e<i+h.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=h.bands.length}break;default:throw new qs(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new qs(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,o=-1/0;const h=[],l=new Set;for(const d of e){const{blockIndex:g}=this.getBlockForBand(d);if(g<0)throw new qs(`Invalid band: ${JSON.stringify(d)}`);const b=this.dataIndex[g];h.includes(g)||h.push(g),l.add(g),i=Math.min(i,b.first_byte),o=Math.max(o,b.last_byte)}if(l.size>this.cacheSize)throw new qs(`Number of blocks to decode (${l.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e),h=this._decodedBlocks.get(i.toString());if(!h)throw new qs(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const l=this.dataIndex[i],d=this.bandShape.reduce((S,m)=>S*m,1),g=o*d,b=h.subarray(g,g+d);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:l.offset!==0?l.offset:l.deprecated_offset,scale:l.scale!==0?l.scale:l.deprecated_scale}}}jg.setPbf=function(s){Vg=s};class z1{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}jg.performDecoding=function(s,e){const i=new Uint8Array(s);return Promise.all(e.tasks.map(o=>{const{layerName:h,firstByte:l,lastByte:d,pixelFormat:g,blockShape:b,blockIndex:S,filters:m,codec:x}=o,E=i.subarray(l,d+1),v=new Uint32Array(b[0]*b[1]*b[2]);let w;if(x!=="gzip_data")throw new qs(`Unhandled codec: ${x}`);return w=function(M,R){if(!globalThis.DecompressionStream&&R==="gzip_data")return Promise.resolve(((k=function(K){K[0]==31&&K[1]==139&&K[2]==8||ho(6,"invalid gzip data");var te=K[3],re=10;4&te&&(re+=2+(K[10]|K[11]<<8));for(var Q=(te>>3&1)+(te>>4&1);Q>0;Q-=!K[re++]);return re+(2&te)}(j=M))+8>j.length&&ho(6,"invalid gzip data"),function(K,te,re,Q){var de=K.length;if(!de||te.f&&!te.l)return re||new Cs(0);var oe=!re,pe=oe||te.i!=2,Ee=te.i;oe&&(re=new Cs(3*de));var Ce,Pe,Re=function(hl){var fc=re.length;if(hl>fc){var Kd=new Cs(Math.max(2*fc,hl));Kd.set(re),re=Kd}},je=te.f||0,De=te.p||0,tt=te.b||0,ct=te.l,Ye=te.d,Rt=te.m,At=te.n,xt=8*de;do{if(!ct){je=uo(K,De,1);var dt=uo(K,De+1,3);if(De+=3,!dt){var Wt=K[(ui=4+((De+7)/8|0))-4]|K[ui-3]<<8,Pt=ui+Wt;if(Pt>de){Ee&&ho(0);break}pe&&Re(tt+Wt),re.set(K.subarray(ui,Pt),tt),te.b=tt+=Wt,te.p=De=8*Pt,te.f=je;continue}if(dt==1)ct=pI,Ye=mI,Rt=9,At=5;else if(dt==2){var kt=uo(K,De,31)+257,ai=uo(K,De+10,15)+4,vi=kt+uo(K,De+5,31)+1;De+=14;for(var mi=new Cs(vi),_i=new Cs(19),wi=0;wi<ai;++wi)_i[hI[wi]]=uo(K,De+3*wi,7);De+=3*ai;var Ti=Ng(_i),nr=(1<<Ti)-1,Zi=Gd(_i,Ti);for(wi=0;wi<vi;){var ui,Vi=Zi[uo(K,De,nr)];if(De+=15&Vi,(ui=Vi>>4)<16)mi[wi++]=ui;else{var Gi=0,hr=0;for(ui==16?(hr=3+uo(K,De,3),De+=2,Gi=mi[wi-1]):ui==17?(hr=3+uo(K,De,7),De+=3):ui==18&&(hr=11+uo(K,De,127),De+=7);hr--;)mi[wi++]=Gi}}var Lr=mi.subarray(0,kt),qr=mi.subarray(kt);Rt=Ng(Lr),At=Ng(qr),ct=Gd(Lr,Rt),Ye=Gd(qr,At)}else ho(1);if(De>xt){Ee&&ho(0);break}}pe&&Re(tt+131072);for(var Dr=(1<<Rt)-1,wr=(1<<At)-1,ln=De;;ln=De){var Zr=(Gi=ct[Ug(K,De)&Dr])>>4;if((De+=15&Gi)>xt){Ee&&ho(0);break}if(Gi||ho(2),Zr<256)re[tt++]=Zr;else{if(Zr==256){ln=De,ct=null;break}var xn=Zr-254;Zr>264&&(xn=uo(K,De,(1<<(po=A1[wi=Zr-257]))-1)+P1[wi],De+=po);var cr=Ye[Ug(K,De)&wr],ss=cr>>4;if(cr||ho(3),De+=15&cr,qr=fI[ss],ss>3){var po=I1[ss];qr+=Ug(K,De)&(1<<po)-1,De+=po}if(De>xt){Ee&&ho(0);break}pe&&Re(tt+131072);var Hs=tt+xn;if(tt<qr){var Ws=0-qr,dc=Math.min(qr,Hs);for(Ws+tt<0&&ho(3);tt<dc;++tt)re[tt]=(void 0)[Ws+tt]}for(;tt<Hs;++tt)re[tt]=re[tt-qr]}}te.l=ct,te.p=ln,te.b=tt,te.f=je,ct&&(je=1,te.m=Rt,te.d=Ye,te.n=At)}while(!je);return tt!=re.length&&oe?(Ce=re,((Pe=tt)==null||Pe>Ce.length)&&(Pe=Ce.length),new Cs(Ce.subarray(0,Pe))):re.subarray(0,tt)}(j.subarray(k,-8),{i:2},new Cs(((z=j)[(U=z.length)-4]|z[U-3]<<8|z[U-2]<<16|z[U-1]<<24)>>>0))));var z,U,j,k;const G=xI[R];if(!G)throw new Error(`Unhandled codec: ${R}`);const $=new globalThis.DecompressionStream(G);return new Response(new Blob([M]).stream().pipeThrough($)).arrayBuffer().then(K=>new Uint8Array(K))}(E,x).then(M=>(function(R,z){R.readFields(nI,z)}(new Vg(M),v),new bI[g](v.buffer))),w.then(M=>{for(let R=m.length-1;R>=0;R--)switch(m[R]){case"delta_filter":aI(M,b);break;case"zigzag_filter":lI(M);break;case"bitshuffle_filter":cI(M,g);break;default:throw new qs(`Unhandled filter "${m[R]}"`)}return{layerName:h,blockIndex:S,data:M}}).catch(M=>{throw M})}))},Ft(z1,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var qd={workerUrl:"",workerClass:null,workerParams:void 0};const Gg="mapboxgl_preloaded_worker_pool";class Hd{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Hd.workerCount;)this.workers.push(qd.workerClass!=null?new qd.workerClass:new self.Worker(qd.workerUrl,qd.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Gg]}numActive(){return Object.keys(this.active).length}}let Wd;function xm(){return Wd||(Wd=new Hd),Wd}Hd.workerCount=2;let Zd,$g,fo,Vu,qg,ju=null;function O1(){return $o()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:$g||we.DRACO_URL}function k1(){if($o()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Vu)return Vu;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Vu=WebAssembly.validate(s)?we.MESHOPT_SIMD_URL:we.MESHOPT_URL,Vu}const vm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},TI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Xd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function F1(s,e,i){const o=i.json.bufferViews.length,h=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:h,byteLength:s.byteLength},i.buffers[h]=s}const Hg="KHR_draco_mesh_compression";function EI(s,e){const i=s.extensions&&s.extensions[Hg];if(!i)return;const o=new fo.Decoder,h=V1(e,i.bufferView),l=new fo.Mesh;if(!o.DecodeArrayToMesh(h,h.byteLength,l))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[s.indices],g=vm[d.componentType],b=d.count*g.BYTES_PER_ELEMENT,S=fo._malloc(b);g===Uint16Array?o.GetTrianglesUInt16Array(l,b,S):o.GetTrianglesUInt32Array(l,b,S),F1(fo.memory.buffer.slice(S,S+b),d,e),fo._free(S);for(const m of Object.keys(i.attributes)){const x=o.GetAttributeByUniqueId(l,i.attributes[m]),E=e.json.accessors[s.attributes[m]],v=TI[E.componentType],w=E.count*Xd[E.type]*vm[E.componentType].BYTES_PER_ELEMENT,M=fo._malloc(w);o.GetAttributeDataArrayForAllPoints(l,x,fo[v],w,M),F1(fo.memory.buffer.slice(M,M+w),E,e),fo._free(M)}o.destroy(),l.destroy(),delete s.extensions[Hg]}const bm="EXT_meshopt_compression";function SI(s,e){if(!s.extensions||!s.extensions[bm])return;const i=s.extensions[bm],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);qg.decodeGltfBuffer(h,i.count,i.byteStride,o,i.mode,i.filter),s.buffer=e.buffers.length,s.byteOffset=0,e.buffers[s.buffer]=h.buffer,delete s.extensions[bm]}const B1=1179937895,N1=new TextDecoder("utf8");function U1(s,e){return new URL(s,e).href}function AI(s,e,i,o){return fetch(U1(s.uri,o)).then(h=>h.arrayBuffer()).then(h=>{e.buffers[i]=h})}function V1(s,e){const i=s.json.bufferViews[e];return new Uint8Array(s.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function II(s,e,i,o){if(s.uri){const h=U1(s.uri,o);return fetch(h).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[i]=l})}if(s.bufferView!==void 0){const h=V1(e,s.bufferView),l=new Blob([h],{type:s.mimeType});return createImageBitmap(l).then(d=>{e.images[i]=d})}}function j1(s,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(s,e,1)[0]===B1){const m=new Uint32Array(s,e);let x=2;const E=(m[x++]>>2)-3,v=m[x++]>>2;if(x++,o.json=JSON.parse(N1.decode(m.subarray(x,x+v))),x+=v,x<E){const w=m[x++];x++;const M=e+(x<<2);o.buffers[0]=s.slice(M,M+w)}}else o.json=JSON.parse(N1.decode(new Uint8Array(s,e)));const{buffers:h,images:l,meshes:d,extensionsUsed:g,bufferViews:b}=o.json;let S=Promise.resolve();if(h){const m=[];for(let x=0;x<h.length;x++){const E=h[x];E.uri?m.push(AI(E,o,x,i)):o.buffers[x]||(o.buffers[x]=null)}S=Promise.all(m)}return S.then(()=>{const m=[],x=g&&g.includes(Hg),E=g&&g.includes(bm);if(x&&m.push(function(){if(!fo)return Zd??(Zd=function(v){let w,M=null;function R(){w=new Uint8Array(M.buffer)}function z(){throw new Error("Unexpected Draco error.")}const U={a:{a:z,d:function(j,k,G){return w.copyWithin(j,k,k+G)},c:function(j){const k=w.length,G=Math.max(j>>>0,Math.ceil(1.2*k)),$=Math.ceil((G-k)/65536);try{return M.grow($),R(),!0}catch{return!1}},b:z}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(v,U):v.then(j=>j.arrayBuffer()).then(j=>WebAssembly.instantiate(j,U))).then(j=>{const{Rb:k,Qb:G,P:$,T:K,X:te,Ja:re,La:Q,Qa:de,Va:oe,Wa:pe,eb:Ee,jb:Ce,f:Pe,e:Re,yb:je,zb:De,Ab:tt,Bb:ct,Db:Ye,Gb:Rt}=j.instance.exports;M=Re;const At=(()=>{let xt=0,dt=0,Wt=0,Pt=0;return kt=>{Wt&&(k(Pt),k(xt),dt+=Wt,Wt=xt=0),xt||(dt+=128,xt=G(dt));const ai=kt.length+7&-8;let vi=xt;ai>=dt&&(Wt=ai,vi=Pt=G(ai));for(let mi=0;mi<kt.length;mi++)w[vi+mi]=kt[mi];return vi}})();return R(),Pe(),{memory:Re,_free:k,_malloc:G,Mesh:class{constructor(){this.ptr=$()}destroy(){K(this.ptr)}},Decoder:class{constructor(){this.ptr=re()}destroy(){Ce(this.ptr)}DecodeArrayToMesh(xt,dt,Wt){const Pt=At(xt),kt=Q(this.ptr,Pt,dt,Wt.ptr);return!!te(kt)}GetAttributeByUniqueId(xt,dt){return{ptr:de(this.ptr,xt.ptr,dt)}}GetTrianglesUInt16Array(xt,dt,Wt){oe(this.ptr,xt.ptr,dt,Wt)}GetTrianglesUInt32Array(xt,dt,Wt){pe(this.ptr,xt.ptr,dt,Wt)}GetAttributeDataArrayForAllPoints(xt,dt,Wt,Pt,kt){Ee(this.ptr,xt.ptr,dt.ptr,Wt,Pt,kt)}},DT_INT8:je(),DT_UINT8:De(),DT_INT16:tt(),DT_UINT16:ct(),DT_UINT32:Ye(),DT_FLOAT32:Rt()}})}(fetch(O1())),Zd.then(v=>{fo=v,Zd=void 0}))}()),E&&m.push(function(){if(qg)return;const v=function(w){let M;const R=WebAssembly.instantiateStreaming(w,{}).then(j=>{M=j.instance,M.exports.__wasm_call_ctors()}),z={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},U={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:R,supported:!0,decodeGltfBuffer(j,k,G,$,K,te){(function(re,Q,de,oe,pe,Ee,Ce){const Pe=re.exports.sbrk,Re=oe+3&-4,je=Pe(Re*pe),De=Pe(Ee.length),tt=new Uint8Array(re.exports.memory.buffer);tt.set(Ee,De);const ct=Q(je,oe,pe,De,Ee.length);if(ct===0&&Ce&&Ce(je,Re,pe),de.set(tt.subarray(je,je+oe*pe)),Pe(je-Pe(0)),ct!==0)throw new Error(`Malformed buffer data: ${ct}`)})(M,M.exports[U[K]],j,k,G,$,M.exports[z[te]])}}}(fetch(k1()));return v.ready.then(()=>{qg=v})}()),l)for(let v=0;v<l.length;v++)m.push(II(l[v],o,v,i));return(m.length?Promise.all(m):Promise.resolve()).then(()=>{if(x&&d)for(const{primitives:v}of d)for(const w of v)EI(w,o);if(E&&d&&b)for(const v of b)SI(v,o);return o})})}function hc(s,e){const i=s.json.bufferViews[e.bufferView],o=vm[e.componentType];return new o(s.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Xd[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:Xd[e.type]))}function Wg(s,e,i,o){const h=vm[e.componentType],l=function(m){switch(m){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),d=s.json.bufferViews[e.bufferView],g=d.byteStride?d.byteStride/h.BYTES_PER_ELEMENT:Xd[e.type],b=i.float32,S=b.length/i.capacity;for(let m=0,x=0;m<e.count*g;m+=g,x+=S)for(let E=0;E<S;E++)b[x+E]=o[m+E]*l;i._trim()}function MI(s,e,i){const o=s.indices,h=s.attributes,l={};l.indexArray=new fn;const d=e.json.accessors[o],g=d.count/3;l.indexArray.reserve(g);const b=hc(e,d);for(let E=0;E<g;E++)l.indexArray.emplaceBack(b[3*E],b[3*E+1],b[3*E+2]);l.indexArray._trim(),l.vertexArray=new Po;const S=e.json.accessors[h.POSITION];l.vertexArray.reserve(S.count);const m=hc(e,S);for(let E=0;E<S.count;E++)l.vertexArray.emplaceBack(m[3*E],m[3*E+1],m[3*E+2]);if(l.vertexArray._trim(),l.aabb=new lr(S.min,S.max),l.centroid=function(E,v){const w=[0,0,0],M=E.length;if(M>0){for(let R=0;R<M;R++){const z=3*E[R];w[0]+=v[z],w[1]+=v[z+1],w[2]+=v[z+2]}w[0]/=M,w[1]/=M,w[2]/=M}return w}(b,m),h.COLOR_0!==void 0){const E=e.json.accessors[h.COLOR_0],v=Xd[E.type],w=hc(e,E);l.colorArray=v===3?new Po:new ro,l.colorArray.resize(E.count),Wg(e,E,l.colorArray,w)}if(h.NORMAL!==void 0){l.normalArray=new Po;const E=e.json.accessors[h.NORMAL];l.normalArray.resize(E.count);const v=hc(e,E);Wg(e,E,l.normalArray,v)}if(h.TEXCOORD_0!==void 0&&i.length>0){l.texcoordArray=new tc;const E=e.json.accessors[h.TEXCOORD_0];l.texcoordArray.resize(E.count);const v=hc(e,E);Wg(e,E,l.texcoordArray,v)}if(h._FEATURE_ID_RGBA4444!==void 0){const E=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=hc(e,E))}h._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(hc(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const x=s.material;return l.material=function(E,v){const{emissiveFactor:w=[0,0,0],alphaMode:M="OPAQUE",alphaCutoff:R=.5,normalTexture:z,occlusionTexture:U,emissiveTexture:j,doubleSided:k}=E,{baseColorFactor:G=[1,1,1,1],metallicFactor:$=1,roughnessFactor:K=1,baseColorTexture:te,metallicRoughnessTexture:re}=E.pbrMetallicRoughness||{},Q=U?v[U.index]:void 0;if(U&&U.extensions&&U.extensions.KHR_texture_transform&&Q){const de=U.extensions.KHR_texture_transform;Q.offsetScale=[de.offset[0],de.offset[1],de.scale[0],de.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Hi(...G),metallicFactor:$,roughnessFactor:K,baseColorTexture:te?v[te.index]:void 0,metallicRoughnessTexture:re?v[re.index]:void 0},doubleSided:k,emissiveFactor:w,alphaMode:M,alphaCutoff:R,normalTexture:z?v[z.index]:void 0,occlusionTexture:Q,emissionTexture:j?v[j.index]:void 0,defined:E.defined===void 0}}(x!==void 0?e.json.materials[x]:{defined:!1},i),l}function G1(s,e,i){const{matrix:o,rotation:h,translation:l,scale:d,mesh:g,extras:b,children:S}=s,m={};if(m.matrix=o||ge.mat4.fromRotationTranslationScale([],h||[0,0,0,1],l||[0,0,0],d||[1,1,1]),g!==void 0){m.meshes=i[g];const x=m.anchor=[0,0];for(const E of m.meshes){const{min:v,max:w}=E.aabb;x[0]+=v[0]+w[0],x[1]+=v[1]+w[1]}x[0]=Math.floor(x[0]/m.meshes.length/2),x[1]=Math.floor(x[1]/m.meshes.length/2)}if(b&&(b.id&&(m.id=b.id),b.lights&&(m.lights=function(x){if(!x.length)return[];const E=function(z){const U=atob(z),j=new Uint8Array(U.length);for(let k=0;k<U.length;k++)j[k]=U.codePointAt(k);return j}(x),v=[],w=E.length/24,M=new Uint16Array(E.buffer),R=new Float32Array(E.buffer);for(let z=0;z<w;z++){const U=M[2*z*6]/30,j=M[2*z*6+1]/30,k=M[2*z*6+10]/100,G=R[6*z+1],$=R[6*z+2],K=R[6*z+3],te=R[6*z+4],re=K-G,Q=te-$,de=Math.hypot(re,Q);v.push({pos:[G+.5*re,$+.5*Q,j],normal:[Q/de,-re/de,0],width:de,height:U,depth:k,points:[G,$,K,te]})}return v}(b.lights))),S){const x=[];for(const E of S)x.push(G1(e.json.nodes[E],e,i));m.children=x}return m}function CI(s){if(s.vertices.length===0||s.indices.length===0)return null;const e=new ig(s.vertices,s.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:e,min:i,max:o}}function PI(s){if(!s.extras||!s.extras.ground)return null;const e=s.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const d of i){if(!Array.isArray(d)||d.length!==2)continue;const g=d[0],b=d[1];typeof g=="number"&&typeof b=="number"&&o.push(new Se(g,b))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let h=0;for(let d=0;d<o.length;d++){const g=o[d],b=o[(d+1)%o.length],S=o[(d+2)%o.length];h+=(g.x-b.x)*(S.y-b.y)-(S.x-b.x)*(g.y-b.y)}h>0&&o.reverse();const l=bd(o.flatMap(d=>[d.x,d.y]),[]);return l.length===0?null:{vertices:o,indices:l}}function RI(s,e){const i=[],o=[];let h=0;const l=[];for(const d of s){h=i.length;const g=d.vertexArray.float32,b=d.indexArray.uint16;for(let S=0;S<d.vertexArray.length;S++)l[0]=g[3*S+0],l[1]=g[3*S+1],l[2]=g[3*S+2],ge.vec3.transformMat4(l,l,e),i.push(new Se(l[0],l[1]));for(let S=0;S<3*d.indexArray.length;S++)o.push(b[S]+h)}if(o.length%3!=0)return null;for(let d=0;d<o.length;d+=3){const g=i[o[d+0]],b=i[o[d+1]],S=i[o[d+2]];(g.x-b.x)*(S.y-b.y)-(S.x-b.x)*(g.y-b.y)>0&&([o[d+1],o[d+2]]=[o[d+2],o[d+1]])}return{vertices:i,indices:o}}function $1(s){const e=function(b,S){const m=[],x=WebGL2RenderingContext;if(b.json.textures)for(const E of b.json.textures){const v={magFilter:x.LINEAR,minFilter:x.NEAREST,wrapS:x.REPEAT,wrapT:x.REPEAT};E.sampler!==void 0&&Object.assign(v,b.json.samplers[E.sampler]),m.push({image:S[E.source],sampler:v,uploaded:!1})}return m}(s,s.images),i=function(b,S){const m=[];for(const x of b.json.meshes){const E=[];for(const v of x.primitives)E.push(MI(v,b,S));m.push(E)}return m}(s,e),{scenes:o,scene:h,nodes:l}=s.json,d=o?o[h||0].nodes:l,g=[];for(const b of d)g.push(G1(l[b],s,i));return function(b,S,m){const x={},E=new Set;for(let v=0;v<b.length;v++){const w=m[S[v]];if(!w.extras)continue;const M=w.extras["mapbox:footprint:version"],R=w.extras["mapbox:footprint:id"];(M||R)&&E.add(v),M==="1.0.0"&&R&&(x[R]=v)}for(let v=0;v<b.length;v++){if(E.has(v))continue;const w=b[v],M=m[S[v]];if(!M.extras)continue;let R=null;w.id in x&&(R=RI(b[x[w.id]].meshes,w.matrix)),R||(R=PI(M)),R&&(w.footprint=CI(R))}if(E.size>0){const v=Array.from(E.values()).sort((w,M)=>w-M);for(let w=v.length-1;w>=0;w--)b.splice(v[w],1)}}(g,d,s.json.nodes),g}function LI(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const e=s.vertexArray.float32,i=s.aabb.min[0]-1,o=s.aabb.min[1]-1,h=cc/(s.aabb.max[0]-i+2),l=cc/(s.aabb.max[1]-o+2);for(let d=0;d<e.length;d+=3){const g=e[d+2],b=(e[d+0]-i)*h|0,S=(e[d+1]-o)*l|0;g>s.heightmap[S*cc+b]&&(s.heightmap[S*cc+b]=g)}}function DI(s,e){const i={};i.indexArray=new fn,i.indexArray.reserve(4*s.length),i.vertexArray=new Po,i.vertexArray.reserve(10*s.length),i.colorArray=new ro,i.vertexArray.reserve(10*s.length);let o=0;for(const d of s){const g=Math.min(10,Math.max(4,1.3*d.height))*e,b=[-d.normal[1],d.normal[0],0],S=Math.min(.29,.1*d.width/d.depth),m=d.width-2*d.depth*e*(S+.01),x=ge.vec3.scaleAndAdd([],d.pos,b,m/2),E=ge.vec3.scaleAndAdd([],d.pos,b,-m/2),v=[x[0],x[1],x[2]+d.height],w=[E[0],E[1],E[2]+d.height],M=ge.vec3.scaleAndAdd([],d.normal,b,S);ge.vec3.scale(M,M,g);const R=ge.vec3.scaleAndAdd([],d.normal,b,-S);ge.vec3.scale(R,R,g),ge.vec3.add(M,x,M),ge.vec3.add(R,E,R),x[2]+=.1,E[2]+=.1,i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(x[0],x[1],x[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(v[0],v[1],v[2]),i.vertexArray.emplaceBack(w[0],w[1],w[2]),i.vertexArray.emplaceBack(x[0],x[1],x[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]);const z=m/g/2;i.colorArray.emplaceBack(-z-S,-1,z,.8),i.colorArray.emplaceBack(z+S,-1,z,.8),i.colorArray.emplaceBack(-z,0,z,1.3),i.colorArray.emplaceBack(z,0,z,1.3),i.colorArray.emplaceBack(z+S,-.8,z,.7),i.colorArray.emplaceBack(z+S,-.8,z,.7),i.colorArray.emplaceBack(0,0,z,1.3),i.colorArray.emplaceBack(0,0,z,1.3),i.colorArray.emplaceBack(z+S,-1.2,z,.8),i.colorArray.emplaceBack(z+S,-1.2,z,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const h={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=Hi.white,h.pbrMetallicRoughness=l,i.material=h,i.aabb=new lr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class q1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const zI=["id","tile","layer","source","sourceLayer","state"];class H1{constructor(e,i,o,h,l){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=h,this.properties=e.properties,this.id=l}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of zI)this[i]!==void 0&&(e[i]=this[i]);return e}}class W1{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Jo(Mt,16,0),this.featureIndexArray=new Mp,this.promoteId=i,this.is3DTile=!1}insert(e,i,o,h,l,d=0,g=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,l,d);const S=this.grid;for(let m=0;m<i.length;m++){const x=i[m],E=[1/0,1/0,-1/0,-1/0];for(let v=0;v<x.length;v++){const w=x[v];E[0]=Math.min(E[0],w.x),E[1]=Math.min(E[1],w.y),E[2]=Math.max(E[2],w.x),E[3]=Math.max(E[3],w.y)}g!==0&&(E[0]-=g,E[1]-=g,E[2]+=g,E[3]+=g),E[0]<Mt&&E[1]<Mt&&E[2]>=0&&E[3]>=0&&S.insert(b,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ru.VectorTile(new Yp(this.rawTileData)).layers,this.sourceLayerCoder=new q1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,o,h){this.loadVTLayers();const l=e.params||{},d=As(l.filter),g=e.tileResult,b=e.transform,S=g.bufferedTilespaceBounds,m=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(w,M,R,z)=>hs(g.bufferedTilespaceGeometry,w,M,R,z));m.sort(OI);let x=null;b.elevation&&m.length>0&&(x=Bu.create(b.elevation,this.tileID));const E={};let v;for(let w=0;w<m.length;w++){const M=m[w];if(M===v)continue;v=M;const R=this.featureIndexArray.get(M);let z=null;if(this.is3DTile){const U=this.bucketLayerIDs[0][0],j=i[U];if(j.type!=="model")continue;const{queryFeature:k,intersectionZ:G}=j.queryIntersectsMatchingFeature(g,R.featureIndex,d,b);k&&this.appendToResult(E,U,R.featureIndex,k,G)}else this.loadMatchingFeature(E,R,d,l.layers,l.availableImages,i,o,h,(U,j,k,G=0)=>(z||(z=yt(U,this.tileID.canonical,e.tileTransform)),j.queryIntersectsFeature(g,U,k,z,this.z,e.transform,e.pixelPosMatrix,x,G)))}return E}loadMatchingFeature(e,i,o,h,l,d,g,b,S){const{featureIndex:m,bucketIndex:x,sourceLayerIndex:E,layoutVertexArrayOffset:v}=i,w=this.bucketLayerIDs[x];if(h&&!function(U,j){for(let k=0;k<U.length;k++)if(j.indexOf(U[k])>=0)return!0;return!1}(h,w))return;const M=this.sourceLayerCoder.decode(E),R=this.vtLayers[M].feature(m);if(o.needGeometry){const U=vt(R,!0);if(!o.filter(new Ar(this.tileID.overscaledZ),U,this.tileID.canonical))return}else if(!o.filter(new Ar(this.tileID.overscaledZ),R))return;const z=this.getId(R,M);for(let U=0;U<w.length;U++){const j=w[U];if(h&&h.indexOf(j)<0)continue;const k=d[j];if(!k)continue;let G={};z!==void 0&&b&&(G=b.getState(k.sourceLayer||"_geojsonTileLayer",z));const $=!S||S(R,k,G,v);if(!$)continue;const K=new H1(R,this.z,this.x,this.y,z),te=Si({},g[j]);te.paint=Z1(te.paint,k.paint,R,G,l),te.layout=Z1(te.layout,k.layout,R,G,l),K.layer=te,this.appendToResult(e,j,m,K,$)}}appendToResult(e,i,o,h,l){let d=e[i];d===void 0&&(d=e[i]=[]),d.push({featureIndex:o,feature:h,intersectionZ:l})}lookupSymbolFeatures(e,i,o,h,l,d,g,b){const S={};this.loadVTLayers();const m=As(l);for(const x of e)this.loadMatchingFeature(S,{bucketIndex:o,sourceLayerIndex:h,featureIndex:x,layoutVertexArrayOffset:0},m,d,g,b,i);return S}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(o),l=this.vtFeatures[h];if(l[i])return l[i];const d=this.vtLayers[h].feature(i);return l[i]=d,d}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];h!=null&&(o=e.properties[h]),typeof o=="boolean"&&(o=Number(o))}return o}}function Z1(s,e,i,o,h){return zs(s,(l,d)=>{const g=e instanceof Ha?e.get(d):null;return g&&g.evaluate?g.evaluate(i,o,h):g})}function OI(s,e){return e-s}Ft(W1,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const X1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Zg{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const l=X1[15&o];if(!l)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new Zg(g,d,l,e)}constructor(e,i=64,o=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=X1.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-g%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+g+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Xg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:g}=this,b=[0,l.length-1,0],S=[];for(;b.length;){const m=b.pop()||0,x=b.pop()||0,E=b.pop()||0;if(x-E<=g){for(let R=E;R<=x;R++){const z=d[2*R],U=d[2*R+1];z>=e&&z<=o&&U>=i&&U<=h&&S.push(l[R])}continue}const v=E+x>>1,w=d[2*v],M=d[2*v+1];w>=e&&w<=o&&M>=i&&M<=h&&S.push(l[v]),(m===0?e<=w:i<=M)&&(b.push(E),b.push(v-1),b.push(1-m)),(m===0?o>=w:h>=M)&&(b.push(v+1),b.push(x),b.push(1-m))}return S}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:l,nodeSize:d}=this,g=[0,h.length-1,0],b=[],S=o*o;for(;g.length;){const m=g.pop()||0,x=g.pop()||0,E=g.pop()||0;if(x-E<=d){for(let R=E;R<=x;R++)K1(l[2*R],l[2*R+1],e,i)<=S&&b.push(h[R]);continue}const v=E+x>>1,w=l[2*v],M=l[2*v+1];K1(w,M,e,i)<=S&&b.push(h[v]),(m===0?e-o<=w:i-o<=M)&&(g.push(E),g.push(v-1),g.push(1-m)),(m===0?e+o>=w:i+o>=M)&&(g.push(v+1),g.push(x),g.push(1-m))}return b}}function Xg(s,e,i,o,h,l){if(h-o<=i)return;const d=o+h>>1;Y1(s,e,d,o,h,l),Xg(s,e,i,o,d-1,1-l),Xg(s,e,i,d+1,h,1-l)}function Y1(s,e,i,o,h,l){for(;h>o;){if(h-o>600){const S=h-o+1,m=i-o+1,x=Math.log(S),E=.5*Math.exp(2*x/3),v=.5*Math.sqrt(x*E*(S-E)/S)*(m-S/2<0?-1:1);Y1(s,e,i,Math.max(o,Math.floor(i-m*E/S+v)),Math.min(h,Math.floor(i+(S-m)*E/S+v)),l)}const d=e[2*i+l];let g=o,b=h;for(Yd(s,e,o,i),e[2*h+l]>d&&Yd(s,e,o,h);g<b;){for(Yd(s,e,g,b),g++,b--;e[2*g+l]<d;)g++;for(;e[2*b+l]>d;)b--}e[2*o+l]===d?Yd(s,e,o,b):(b++,Yd(s,e,b,h)),b<=i&&(o=b+1),i<=b&&(h=b-1)}}function Yd(s,e,i,o){Yg(s,i,o),Yg(e,2*i,2*o),Yg(e,2*i+1,2*o+1)}function Yg(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}function K1(s,e,i,o){const h=s-i,l=e-o;return h*h+l*l}n.$=yp,n.A=class extends mm{},n.B=Zo,n.C=Ea,n.D=Yl,n.E=Ta,n.F=Hh,n.G=ru,n.H=cp,n.I=xg,n.J=ou,n.K=mu,n.L=pp,n.M=Hl,n.N=Xc,n.O=Nl,n.P=Se,n.Q=Bl,n.R=va,n.S=Gn,n.T=Rg,n.U=yh,n.V=mm,n.W=id,n.X=nu,n.Y=qh,n.Z=function(s){const e=s.value;let i=[];if(!e)return i;const o=Zo(e);return o!=="string"?(i=i.concat([new mm(s.key,e,`string expected, "${o}" found`)]),i):(a1(e,!0)||(i=i.concat([new mm(s.key,e,`invalid url "${e}"`)])),i)},n._=Ue,n.a=function(s){return we.API_CDN_URL_REGEX.test(s)},n.a$=hd,n.a0=pr,n.a1=bt,n.a2=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return Kn(s.expression.evaluate(e))}interpolate(s,e,i){return{x:ii(s.x,e.x,i),y:ii(s.y,e.y,i),z:ii(s.z,e.z,i),azimuthal:ii(s.azimuthal,e.azimuthal,i),polar:ii(s.polar,e.polar,i)}}},n.a3=Ar,n.a4=Us,n.a5=ze,n.a6=ge,n.a7=Xt,n.a8=Ha,n.a9=rl,n.aA=ar,n.aB=Zv,n.aC=e1,n.aD=Wv,n.aE=function(s,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<s.length;o++){const h=document.createElement("source");us(s[o])||(i.crossOrigin="Anonymous"),h.src=s[o],i.appendChild(h)}return{cancel:()=>{}}},n.aF=um,n.aG=function(s){return fetch(s).then(e=>e.arrayBuffer()).then(e=>j1(e,0,s))},n.aH=$1,n.aI=class{constructor(s,e,i,o){this.id=s,this.position=e!=null?new V(e[0],e[1]):new V(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new lr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,e){if(ge.mat4.multiply(s.matrix,e,s.matrix),s.meshes)for(const i of s.meshes){const o=lr.applyTransformFast(i.aabb,s.matrix);this.aabb.encapsulate(o)}if(s.children)for(const i of s.children)this._applyTransformations(i,s.matrix)}computeBoundsAndApplyParent(){const s=ge.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,s)}computeModelMatrix(s,e,i,o,h,l,d=!1){d1(this.matrix,this,s.transform,this.position,e,i,o,h,l,d)}upload(s){if(!this.uploaded){for(const e of this.nodes)kg(e,s);for(const e of this.nodes)_m(e);this.uploaded=!0}}destroy(){for(const s of this.nodes)Fg(s)}},n.aJ=en,n.aK=Od,n.aL=ce,n.aM=le,n.aN=Co,n.aO=fn,n.aP=kr,n.aQ=Su,n.aR=lm,n.aS=function(){qn.isLoading()||qn.isLoaded()||Qh()!=="deferred"||ed()},n.aT=As,n.aU=vt,n.aV=H1,n.aW=Al,n.aX=hg,n.aY=tg,n.aZ=yt,n.a_=Mo,n.aa=ii,n.ab=Mt,n.ac=Ll,n.ad=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return function([i,o]){const h=Kn([1,i,o]);return{x:h.x,y:h.y,z:h.z}}(s.expression.evaluate(e))}interpolate(s,e,i){return{x:ii(s.x,e.x,i),y:ii(s.y,e.y,i),z:ii(s.z,e.z,i)}}},n.ae=function(s,e,i=0,o=!0){const h=new Se(i,i),l=s.sub(h),d=e.add(h),g=[l,new Se(d.x,l.y),d,new Se(l.x,d.y)];return o&&g.push(l.clone()),g},n.af=function(s,e){const i=[];for(let o=0;o<s.length;o++){const h=li(o-1,-1,s.length-1),l=li(o+1,-1,s.length-1),d=s[o],g=s[l],b=s[h].sub(d).unit(),S=g.sub(d).unit(),m=S.angleWithSep(b.x,b.y),x=b.add(S).unit().mult(-1*e/Math.sin(m/2));i.push(d.add(x))}return i},n.ag=Dv,n.ah=hs,n.ai=function(s,e,i=0){return ge.vec3.fromValues(((e.x-i)*s.scale-s.x)*Mt,(e.y*s.scale-s.y)*Mt,me(e.z,e.y))},n.aj=ao,n.ak=Qx,n.al=function(s){let e=1/0,i=1/0,o=-1/0,h=-1/0;for(const l of s)e=Math.min(e,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),h=Math.max(h,l.y);return{min:new Se(e,i),max:new Se(o,h)}},n.am=ie,n.an=ur,n.ao=lt,n.ap=$e,n.aq=t,n.ar=function(s,e){const i={};for(let o=0;o<e.length;o++){const h=e[o];h in s&&(i[h]=s[h])}return i},n.as=q,n.at=se,n.au=class{constructor(s){this.entries={},this.scheduler=s}request(s,e,i,o){const h=this.entries[s]=this.entries[s]||{callbacks:[]};if(h.result){const[l,d]=h.result;return this.scheduler?this.scheduler.add(()=>{o(l,d)},e):o(l,d),()=>{}}return h.callbacks.push(o),h.cancel||(h.cancel=i((l,d)=>{h.result=[l,d];for(const g of h.callbacks)this.scheduler?this.scheduler.add(()=>{g(l,d)},e):g(l,d);setTimeout(()=>delete this.entries[s],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(l=>l!==o),h.callbacks.length||(h.cancel(),delete this.entries[s]))}}},n.av=wp,n.aw=function(s,e,i){const o=JSON.stringify(s.request);return s.data&&(this.deduped.entries[o]={result:[null,s.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},h=>{const l=ba(s.request,(d,g,b,S)=>{d?h(d):g&&h(null,{vectorTile:i?void 0:new Ru.VectorTile(new Yp(g)),rawData:g,cacheControl:b,expires:S})});return()=>{l.cancel(),h()}},e)},n.ax=function(s){Xr++,Xr>qi&&(s.getActor().send("enforceCacheSizeLimit",di),Xr=0)},n.ay=Lt,n.az=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},n.b=function(s){return we.API_FONTS_REGEX.test(s)},n.b$=function(s){const{x:e,y:i}=s.point,{lng:o,lat:h}=s._center;return q0(e,i,s.worldSize,o,h)},n.b0=fs,n.b1=Ir,n.b2=bd,n.b3=Mg,n.b4=function(s,e){const i=rl(e.zoom);if(i===0)return zo(s);const o=kp(s),h=H_(o),l=ie(o.getWest())*e.worldSize,d=ie(o.getEast())*e.worldSize,g=se(o.getNorth())*e.worldSize,b=se(o.getSouth())*e.worldSize,S=[l,g,0],m=[d,g,0],x=[l,b,0],E=[d,b,0],v=ge.mat4.invert([],e.globeMatrix);return ge.vec3.transformMat4(S,S,v),ge.vec3.transformMat4(m,m,v),ge.vec3.transformMat4(x,x,v),ge.vec3.transformMat4(E,E,v),h[0]=oa(h[0],x,i),h[1]=oa(h[1],E,i),h[2]=oa(h[2],m,i),h[3]=oa(h[3],S,i),lr.fromPoints(h)},n.b5=Bp,n.b6=xd,n.b7=oa,n.b8=xu,n.b9=Hn,n.bA=li,n.bB=_e,n.bC=qo,n.bD=ee,n.bE=function(s,e,i){s[4*e+0]=i[0],s[4*e+1]=i[1],s[4*e+2]=i[2],s[4*e+3]=i[3]},n.bF=sc,n.bG=Vs,n.bH=md,n.bI=Sn,n.bJ=ra,n.bK=V,n.bL=Bv,n.bM=Kr,n.bN=il,n.bO=i1,n.bP=nn,n.bQ=j0,n.bR=function(s,e,i,o,h,l,d,g,b){if(b.name==="globe")return j0(s,e,new nn(i,o,h),!1);const S=Od({z:i,x:o,y:h},b);return new lr([(l+S.x/S.scale)*e,e*(S.y/S.scale),d],[(l+S.x2/S.scale)*e,e*(S.y2/S.scale),g])},n.bS=function(s,e,i){let o=0;for(let h=0;h<2;++h)s[h]>0&&(o+=(s[h]-0)*(s[h]-0)),e[h]<0&&(o+=(0-e[h])*(0-e[h]));return o},n.bT=fe,n.bU=u,n.bV=function(s){const e=ge.mat4.identity(new Float64Array(16));ge.mat4.multiply(e,s.pixelMatrix,s.globeMatrix);const i=[0,A,0],o=[0,C,0];return ge.vec3.transformMat4(i,i,e),ge.vec3.transformMat4(o,o,e),[i[0]>0&&i[0]<=s.width&&i[1]>0&&i[1]<=s.height&&!X_(s,new V(s.center.lat,90)),o[0]>0&&o[0]<=s.width&&o[1]>0&&o[1]<=s.height&&!X_(s,new V(s.center.lat,-90))]},n.bW=function(s,e){const{scale:i}=s.tileTransform,o=i*Mt/(s.tileSize*Math.pow(2,e.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return ge.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},n.bX=fm,n.bY=t1,n.bZ=function(s){const e=t1(s,!0);return ge.mat2.invert([],[e[0],e[1],e[4],e[5]])},n.b_=Do,n.ba=jg,n.bb=Yp,n.bc=ba,n.bd=function(s){const e=[];for(const i in s)e.push(s[i]);return e},n.be=function(s,e){const i=[];for(const o in s)o in e||i.push(o);return i},n.bf=Ui,n.bg=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bh=Ct,n.bi=function(s,e){const{x:i,y:o}=s.point,h=q0(i,o,s.worldSize/s._pixelsPerMercatorPixel,0,0);return ge.mat4.multiply(h,h,W_(zo(e)))},n.bj=Lu,n.bk=Ms,n.bl=Xp,n.bm=function(s,e,i,o,h){const l=5*e+2;s.float32[l+0]=i,s.float32[l+1]=o,s.float32[l+2]=h},n.bn=am,n.bo=wv,n.bp=St,n.bq=yn,n.br=Ex,n.bs=o1,n.bt=Cx,n.bu=Px,n.bv=wg,n.bw=Cv,n.bx=yg,n.by=Zg,n.bz=Hi,n.c=Le,n.c$=On,n.c0=Ze,n.c1=zn,n.c2=r,n.c3=function(s){const e=Math.round((s+45+360)%360/90)%4;return pt[e]},n.c4=45,n.c5=X,n.c6=Mu,n.c7=function(s,e,i){const o=Math.sqrt(s*s+e*e+i*i),h=o>0?Math.acos(i/o)*ve:0;let l=s!==0||e!==0?Math.atan2(-e,-s)*ve+90:0;return l<0&&(l+=360),[o,l,h]},n.c8=be,n.c9=lr,n.cA=function(s){const e=fe-5;s=$e(s,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(_e(s))),3);return Math.round(i*(y.length-1))},n.cB=function(s,e,i,o){const h=e.getNorth(),l=e.getSouth(),d=e.getWest(),g=e.getEast(),b=1<<s.z,S=g-d,m=h-l,x=S/_,E=-m/y[i],v=[0,x,0,E,0,0,h,d,0];if(s.z>0){const w=180/o;ge.mat3.multiply(v,v,[w/S+1,0,0,0,w/m+1,0,-.5*w/x,.5*w/E,1])}return v[2]=b,v[5]=s.x,v[8]=s.y,v},n.cC=zo,n.cD=function(s,e,i){const o=ge.mat4.identity(new Float64Array(16)),h=(e/(1<<s)-.5)*Math.PI*2;return ge.mat4.rotateY(o,i.globeMatrix,h),Float32Array.from(o)},n.cE=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,h=Math.floor(s.x),l=Math.floor((s.x-h)*o),d=Math.floor(s.y*o),g=this.findDEMTileFor(new ar(i,h,i,l,d));return!(!g||!g.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||s.y<0||s.y>1)return e;const h=o.getSource().maxzoom,l=1<<h,d=Math.floor(s.x),g=s.x-d,b=new ar(h,d,h,Math.floor(g*l),Math.floor(s.y*l)),S=this.findDEMTileFor(b);if(!S||!S.dem)return e;const m=S.dem,x=1<<S.tileID.canonical.z,E=(g*x-S.tileID.canonical.x)*m.dim,v=(s.y*x-S.tileID.canonical.y)*m.dim,w=Math.floor(E),M=Math.floor(v);return(i?this.exaggeration():1)*ii(ii(m.get(w,M),m.get(w,M+1),v-M),ii(m.get(w+1,M),m.get(w+1,M+1),v-M),E-w)}getAtTileOffset(s,e,i){const o=1<<s.canonical.z;return this.getAtPointOrZero(new ze(s.wrap+(s.canonical.x+e/Mt)/o,(s.canonical.y+i/Mt)/o))}getAtTileOffsetFunc(s,e,i,o){return h=>{const l=this.getAtTileOffset(s,h.x,h.y),d=o.upVector(s.canonical,h.x,h.y),g=o.upVectorScale(s.canonical,e,i).metersToTile;return ge.vec3.scale(d,d,l*g),d}}getForTilePoints(s,e,i,o){if(this.isUsingMockSource())return!1;const h=Bu.create(this,s,o);return!!h&&(e.forEach(l=>{l[2]=this.exaggeration()*h.getElevationAt(l[0],l[1],i)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,h=1<<s.canonical.z-o.canonical.z;let l=s.canonical.x/h-o.canonical.x,d=s.canonical.y/h-o.canonical.y,g=0;for(let b=0;b<s.canonical.z-o.canonical.z&&!i.leaves[g];b++){l*=2,d*=2;const S=2*Math.floor(d)+Math.floor(l);g=i.childOffsets[g]+S,l%=1,d%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const h of s){const l=this.getMinMaxForTile(h.tileID);l&&(i=Math.min(i,l.min),o=Math.max(o,l.max),e=!0)}return e?{min:i,max:o}:null}},n.cF=nx,n.cG=sa,n.cH=function(s,e){return[Math.pow(s[0],2.2)*e,Math.pow(s[1],2.2)*e,Math.pow(s[2],2.2)*e]},n.cI=$0,n.cJ=he,n.cK=J,n.cL=256,n.cM=function(s,e){const i=[0,0,0],o=Bp(zo(e.canonical));return ge.vec3.transformMat4(i,i,o),ge.vec3.transformMat4(i,i,s),i},n.cN=s=>({u_camera_to_center_distance:new Sn(s),u_extrude_scale:new gd(s),u_device_pixel_ratio:new Sn(s),u_matrix:new sc(s),u_inv_rot_matrix:new sc(s),u_merc_center:new Vs(s),u_tile_id:new md(s),u_zoom_transition:new Sn(s),u_up_dir:new md(s),u_emissive_strength:new Sn(s)}),n.cO=s=>({u_matrix:new sc(s),u_pixels_to_tile_units:new gd(s),u_device_pixel_ratio:new Sn(s),u_units_to_pixels:new Vs(s),u_dash_image:new ra(s),u_gradient_image:new ra(s),u_image_height:new Sn(s),u_texsize:new Vs(s),u_tile_units_to_pixels:new Sn(s),u_alpha_discard_threshold:new Sn(s),u_trim_offset:new Vs(s),u_trim_fade_range:new Vs(s),u_trim_color:new Mu(s),u_emissive_strength:new Sn(s)}),n.cP=s=>({u_matrix:new sc(s),u_texsize:new Vs(s),u_pixels_to_tile_units:new gd(s),u_device_pixel_ratio:new Sn(s),u_image:new ra(s),u_units_to_pixels:new Vs(s),u_tile_units_to_pixels:new Sn(s),u_alpha_discard_threshold:new Sn(s),u_trim_offset:new Vs(s)}),n.cQ=Dn,n.cR=rA,n.cS=nA,n.cT=Z0,n.cU=(s,e,i,o,h,l)=>{const d=s.transform,g=d.projection.name==="globe";let b;if(l.paint.get("circle-pitch-alignment")==="map")if(g){const m=$0(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;b=Float32Array.from([m,0,0,m])}else b=d.calculatePixelsToTileUnitsMatrix(i);else b=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(d.projection),u_matrix:s.translatePosMatrix(e.projMatrix,i,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Dt.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:aS,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(g){S.u_inv_rot_matrix=o,S.u_merc_center=h,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=rl(d.zoom);const m=h[0]*Mt,x=h[1]*Mt;S.u_up_dir=d.projection.upVector(new nn(0,0,0),m,x)}return S},n.cV=iv,n.cW=(s,e,i,o,h,l)=>{const d=s.transform;return{u_matrix:tv(s,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:ev(e,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:l}},n.cX=(s,e,i,o,h,l,d)=>{const g=s.transform,b=g.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:tv(s,e,i,o),u_pixels_to_tile_units:b,u_device_pixel_ratio:l,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:rv(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ev(e,s.transform),u_alpha_discard_threshold:0,u_trim_offset:d,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength")}},n.cY=hn,n.cZ=vd,n.c_=Gx,n.ca=Kn,n.cb=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},n.cc=function(s){return s({pluginStatus:an,pluginURL:Io}),Jh.on("pluginStateChange",s),s},n.cd=Nu,n.ce=xm,n.cf=zu,n.cg=vg,n.ch=fh,n.ci=gp,n.cj=hi,n.ck=Vn,n.cl=jr,n.cm=function(s){const e=s.indexOf(Za);return e>=0?s.slice(0,e):s},n.cn=function(s){return s.indexOf(Za)>=0},n.co=function(s){const e=s.indexOf(Za);return e>=0?s.slice(e+1):""},n.cp=function(s){const e=[],i=s.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},n.cq=function(s,e,i,o){return s.type==="custom"?new OA(s,e):new HA[s.type](s,e,i,o)},n.cr=tn,n.cs=Jh,n.ct=Cl,n.cu=_d,n.cv=class extends oo{constructor(s){super(s),this.current=N_}set(s,e,i){if(this.fetchUniformLocation(s,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},n.cw=It,n.cx=function(s,e,i){const o=rl(i.zoom),h=s.style.map._antialias,l=e.options.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return o===0&&!h&&!l},n.cy=function(s){const e=s.pixelsPerMeter,i=e/ee(1,s.center.lat),o=ge.mat4.identity(new Float64Array(16));return ge.mat4.translate(o,o,[s.point.x,s.point.y,0]),ge.mat4.scale(o,o,[i,i,e]),Float32Array.from(o)},n.cz=kp,n.d=function(s){return we.API_TILEJSON_REGEX.test(s)},n.d$=ne,n.d0=Zp,n.d1=sl,n.d2=450,n.d3=7,n.d4=zA,n.d5=Bi,n.d6=Tu,n.d7=256,n.d8=W_,n.d9=Po,n.dA=H0,n.dB=function(s){const e=[0,0,0],i=ge.mat4.identity(new Float64Array(16));return ge.mat4.multiply(i,s.pixelMatrix,s.globeMatrix),ge.vec3.transformMat4(e,e,i),new Se(e[0],e[1])},n.dC=function(s,e,i=!1){if(an===Zl||an===Xl||an===fu)throw new Error("setRTLTextPlugin cannot be called multiple times.");Io=Dt.resolveURL(s),an=Zl,$a=e,Kh(),i||ed()},n.dD=Qh,n.dE=function(){xm().acquire(Gg)},n.dF=function(){const s=Wd;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(Gg),Wd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.dG=Hd,n.dH=function(s){const e=yr();if(!e)return;const i=e.delete(fi);s&&i.catch(s).then(()=>s())},n.dI=qd,n.dJ=O1,n.dK=function(s){$g=Dt.resolveURL(s),ju||(ju=new Nu(xm(),new Ta)),ju.broadcast("setDracoUrl",$g)},n.dL=k1,n.dM=function(s){Vu=Dt.resolveURL(s),ju||(ju=new Nu(xm(),new Ta)),ju.broadcast("setMeshoptUrl",Vu)},n.dN=Ft,n.dO=nl,n.dP=co,n.dQ=q1,n.dR=W1,n.dS=Xx,n.dT=zs,n.dU=Ev,n.dV=function(s,e,i,o,h,l,d,g,b,S,m){s.createArrays(),s.tilePixelRatio=Mt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const x=s.layers[0].layout,E=s.layers[0]._unevaluatedLayout._values,v={};if(s.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:U}=s.textSizeData;v.compositeTextSizes=[E["text-size"].possiblyEvaluate(new Ar(z),g),E["text-size"].possiblyEvaluate(new Ar(U),g)]}if(s.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:U}=s.iconSizeData;v.compositeIconSizes=[E["icon-size"].possiblyEvaluate(new Ar(z),g),E["icon-size"].possiblyEvaluate(new Ar(U),g)]}v.layoutTextSize=E["text-size"].possiblyEvaluate(new Ar(b+1),g),v.layoutIconSize=E["icon-size"].possiblyEvaluate(new Ar(b+1),g),v.textMaxSize=E["text-size"].possiblyEvaluate(new Ar(18),g);const w=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point",M=x.get("text-size");let R=!1;for(const z of s.features)if(z.icon&&z.icon.nameSecondary){R=!0;break}for(const z of s.features){const U=x.get("text-font").evaluate(z,{},g).join(","),j=M.evaluate(z,{},g),k=v.layoutTextSize.evaluate(z,{},g),G=(v.layoutIconSize.evaluate(z,{},g),{horizontal:{},vertical:void 0}),$=z.text;let K,te=[0,0];if($){const de=$.toString(),oe=x.get("text-letter-spacing").evaluate(z,{},g)*yn,pe=x.get("text-line-height").evaluate(z,{},g)*yn,Ee=I_(de)?oe:0,Ce=x.get("text-anchor").evaluate(z,{},g),Pe=x.get("text-variable-anchor");if(!Pe){const ct=x.get("text-radial-offset").evaluate(z,{},g);te=ct?Cv(Ce,[ct*yn,bg]):x.get("text-offset").evaluate(z,{},g).map(Ye=>Ye*yn)}let Re=w?"center":x.get("text-justify").evaluate(z,{},g);const je=x.get("symbol-placement")==="point",De=je?x.get("text-max-width").evaluate(z,{},g)*yn:1/0,tt=ct=>{s.allowVerticalPlacement&&uu(de)&&(G.vertical=gg($,e,i,h,U,De,pe,Ce,ct,Ee,te,Ms.vertical,!0,k,j))};if(!w&&Pe){const ct=Re==="auto"?Pe.map(Rt=>wg(Rt)):[Re];let Ye=!1;for(let Rt=0;Rt<ct.length;Rt++){const At=ct[Rt];if(!G.horizontal[At])if(Ye)G.horizontal[At]=G.horizontal[0];else{const xt=gg($,e,i,h,U,De,pe,"center",At,Ee,te,Ms.horizontal,!1,k,j);xt&&(G.horizontal[At]=xt,Ye=xt.positionedLines.length===1)}}tt("left")}else{if(Re==="auto"&&(Re=wg(Ce)),je||x.get("text-writing-mode").indexOf("horizontal")>=0||!uu(de)){const ct=gg($,e,i,h,U,De,pe,Ce,Re,Ee,te,Ms.horizontal,!1,k,j);ct&&(G.horizontal[Re]=ct)}tt(je?"left":Re)}}let re=!1;if(z.icon&&z.icon.namePrimary){const de=o[z.icon.namePrimary];de&&(K=pA(h[z.icon.namePrimary],z.icon.nameSecondary?h[z.icon.nameSecondary]:void 0,x.get("icon-offset").evaluate(z,{},g),x.get("icon-anchor").evaluate(z,{},g)),re=de.sdf,s.sdfIcons===void 0?s.sdfIcons=de.sdf:s.sdfIcons!==de.sdf&&ki("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(de.pixelRatio!==s.pixelRatio||x.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const Q=Rv(G.horizontal)||G.vertical;s.iconsInText||(s.iconsInText=!!Q&&Q.iconsInText),(Q||K)&&bA(s,z,G,K,o,v,k,0,te,re,d,g,S,m,R)}l&&s.generateCollisionDebugBuffers(b,s.collisionBoxArray)},n.dW=Ru,n.dX=ym,n.dY=ke,n.dZ=vx,n.d_=cv,n.da=so,n.db=ud,n.dc=function(s,e,i,o,h){return $e((s-e)/(i-e)*(h-o)+o,o,h)},n.dd=iu,n.de=Ie,n.df=class{constructor(s,e,i,o){this.context=s,this.format=o,this.size=i,this.texture=s.gl.createTexture();const[h,l,d]=this.size,{gl:g}=s;g.bindTexture(g.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),g.texImage3D(g.TEXTURE_3D,0,this.format,h,l,d,0,Cg(this.format),Pg(this.format),e.data)}bind(s,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),s!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,s),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,s),this.minFilter=s),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},n.dg=zg,n.dh=[1,1,1],n.di=Bu,n.dj=Fu,n.dk=Ro,n.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Se(1/0,1/0),max:new Se(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,e=!1){const i=Ax(new Se(0,0),new Se(Mt,Mt),s),o=[];if(e&&!og(i,this._globalClipBounds))return o;for(const h of this._activeRegions){if(h.hiddenByOverlap||!og(i,h))continue;const l=PS(h.min,h.max,s);o.push({min:l.min,max:l.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return o}setSources(s){this._setSources(s.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(o).buckets[e.layer];h&&h.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(s){const e=s.getFootprints();if(e.length===0)return;const i=s.getOrder(),o=s.getClipMask(),h=s.getClipScope();for(const l of e){if(!l.footprint)continue;const d=Ax(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint,order:i,clipMask:o,clipScope:h})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Hp(e.min,i.min)||Hp(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,h){const l=(d,g)=>d+g;return o.length-h.length||o.reduce(l,"").localeCompare(h.reduce(l,""))}(e.clipScope,i.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let e=0;for(;!s&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];s=i.priority!==o.priority||!Sx(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!Ct(i.clipScope,o.clipScope),++e}}if(s){++this._updateTime;for(const i of this._activeRegions)i.order!==qp&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const h=o[i].priority;for(;i<o.length&&o[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let h=i;const l=i;for(;h!==o;){const d=this._activeRegions[h];d.hiddenByOverlap=!1;for(let g=0;g<l;g++){const b=this._activeRegions[g];if(!b.hiddenByOverlap&&d.order===qp&&og(d,b)&&(d.hiddenByOverlap=Mx(d.footprint,d.tileId,b.footprint,b.tileId),d.hiddenByOverlap))break}++h}i=o,o=e(i)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=s.length-1;e>=0;e--)this._addSource(s[e]);this._computeReplacement()}},n.dm=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,e){const i=new Mo,o=new fn,h=[],l=s+1+2,d=e[0]+1,g=e[0]+1+(1+e.length),b=(S,m,x)=>{let E=S===l-1?S-2:S===0?S:S-1;return E+=x?24575:0,[E,m]};for(let S=0;S<l;++S)i.emplaceBack(...b(S,0,!0));for(let S=0;S<d;++S)for(let m=0;m<l;++m)i.emplaceBack(...b(m,S,(m===0||m===l-1)&&!0));for(let S=0;S<e.length;++S){const m=e[S];for(let x=0;x<l;++x)i.emplaceBack(...b(x,m,!0))}for(let S=0;S<e.length;++S){const m=o.length,x=e[S]+1+2,E=new fn;for(let M=0;M<x-1;M++){const R=M===x-2,z=R?l*(g-e.length+S-M):l;for(let U=0;U<l-1;U++){const j=M*l+U;M===0||R||U===0||U===l-2?(E.emplaceBack(j+1,j,j+z),E.emplaceBack(j+z,j+z+1,j+1)):(o.emplaceBack(j+1,j,j+z),o.emplaceBack(j+z,j+z+1,j+1))}}const v=Ir.simpleSegment(0,m,i.length,o.length-m);for(let M=0;M<E.uint16.length;M+=3)o.emplaceBack(E.uint16[M],E.uint16[M+1],E.uint16[M+2]);const w=Ir.simpleSegment(0,m,i.length,o.length-m);h.push({withoutSkirts:v,withSkirts:w})}return{vertices:i,indices:o,segments:h}}_createGrid(s){const e=this._fillGridMeshWithLods(_,y);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,fs.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new fn;for(let d=0;d<=_;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const i=new so,o=new so,h=new so,l=new so;this._poleSegments=[];for(let d=0,g=0;d<r;d++){const b=360/(1<<d);i.emplaceBack(0,-t,0,.5,0),o.emplaceBack(0,-t,0,.5,1),h.emplaceBack(0,-t,0,.5,.5),l.emplaceBack(0,-t,0,.5,.5);for(let S=0;S<=_;S++){let m=S/_,x=0;const E=ii(0,b,m),[v,w,M]=L(sS,oS,E,t);i.emplaceBack(v,w,M,m,x),o.emplaceBack(v,w,M,m,1-x);const R=_e(E);m=.5+.5*Math.sin(R),x=.5+.5*Math.cos(R),h.emplaceBack(v,w,M,m,x),l.emplaceBack(v,w,M,m,1-x)}this._poleSegments.push(Ir.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(i,ns,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(o,ns,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(h,ns,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(l,ns,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},n.dn=qp,n.dp=Ut,n.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.dr=Ge,n.ds=Te,n.dt=D,n.du=function([s,e,i]){const o=Math.hypot(s,e,i),h=Math.atan2(s,i),l=.5*Math.PI-Math.acos(-e/o);return new V(Ze(h),Ze(l))},n.dv=Dg,n.dw=F,n.dx=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!function(i){if(Il==null){const o=i.navigator?i.navigator.userAgent:null;Il=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Il}(s)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.dy=function(s,e){di=s,qi=e},n.dz=X_,n.e=we,n.e0=function(s){let e=0;if(new Uint32Array(s,0,1)[0]!==B1){const i=new Uint32Array(s,0,7),[,,o,h,l,d]=i;e=i.byteLength+h+l+d+l,(o!==s.byteLength||e>=s.byteLength)&&ki("Invalid b3dm header information.")}return j1(s,e)},n.e1=function(s,e){const i=$1(s);for(const o of i){for(const h of o.meshes)LI(h);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(DI(o.lights,e)))}return i},n.e2=gm,n.e3=y1,n.e4=qn,n.e5=function(s){Wr(),gi!=null&&gi.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-s;o++)e.delete(i[o])})})},n.f=function(s){return s.indexOf("mapbox:")===0},n.g=function(s,e){return Cl(Si(s,{method:"GET"}),e)},n.h=xe,n.i=function(s){return we.API_STYLE_REGEX.test(s)&&!Le(s)},n.j=function(s){return decodeURIComponent(atob(s).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.k=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},n.l=Si,n.m=dn,n.n=function(s,e){return Cl(Si(s,{type:"json"}),e)},n.o=ks,n.p=function(s,e){return Cl(Si(s,{method:"POST"}),e)},n.q=Dt,n.r=kn,n.s=function(s){try{const e=self[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=Rl,n.u=function(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},n.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},n.w=ki,n.x=bo,n.y=2,n.z=Tv}),N(["./shared"],function(n){function ne(We){const Y=We?We.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function ae(We){if(typeof We=="number"||typeof We=="boolean"||typeof We=="string"||We==null)return JSON.stringify(We);if(Array.isArray(We)){let J="[";for(const he of We)J+=`${ae(he)},`;return`${J}]`}let Y="{";for(const J of Object.keys(We).sort())Y+=`${J}:${ae(We[J])},`;return`${Y}}`}function ue(We){let Y="";for(const J of n.bg)Y+=`/${ae(We[J])}`;return Y}class Me{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,J){this._layerConfigs={},this._layers={},this.update(Y,[],J)}update(Y,J,he){this._options=he;for(const xe of Y)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=n.cq(xe,this.scope,null,this._options)).compileFilter(he),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of J)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const we=function(xe,Le){const qe={};for(let He=0;He<xe.length;He++){const rt=Le&&Le[xe[He].id]||ue(xe[He]);Le&&(Le[xe[He].id]=rt);let et=qe[rt];et||(et=qe[rt]=[]),et.push(xe[He])}const Fe=[];for(const He in qe)Fe.push(qe[He]);return Fe}(n.bd(this._layerConfigs),this.keyCache);for(const xe of we){const Le=xe.map(gt=>this._layers[gt.id]),qe=Le[0];if(qe.visibility==="none")continue;const Fe=qe.source||"";let He=this.familiesBySource[Fe];He||(He=this.familiesBySource[Fe]={});const rt=qe.sourceLayer||"_geojsonTileLayer";let et=He[rt];et||(et=He[rt]=[]),et.push(Le)}}}const Be=1*n.dP;class st{constructor(Y){const J={},he=[];for(const qe in Y){const Fe=Y[qe],He=J[qe]={};for(const rt in Fe.glyphs){const et=Fe.glyphs[+rt];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const gt=et.metrics.localGlyph?Be:1,Lt={x:0,y:0,w:et.bitmap.width+2*gt,h:et.bitmap.height+2*gt};he.push(Lt),He[rt]=Lt}}const{w:we,h:xe}=n.z(he),Le=new n.dO({width:we||1,height:xe||1});for(const qe in Y){const Fe=Y[qe];for(const He in Fe.glyphs){const rt=Fe.glyphs[+He];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const et=J[qe][He],gt=rt.metrics.localGlyph?Be:1;n.dO.copy(rt.bitmap,Le,{x:0,y:0},{x:et.x+gt,y:et.y+gt},rt.bitmap)}}this.image=Le,this.positions=J}}n.dN(st,"GlyphAtlas");class Qe{constructor(Y){this.tileID=new n.aA(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=n.aK(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep}parse(Y,J,he,we,xe){this.status="parsing",this.data=Y,this.collisionBoxArray=new n.aQ;const Le=new n.dQ(Object.keys(Y.layers).sort()),qe=new n.dR(this.tileID,this.promoteId);qe.bucketLayerIDs=[];const Fe={},He=new n.dS(256,256),rt={featureIndex:qe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:He,availableImages:he,brightness:this.brightness},et=J.familiesBySource[this.source];for(const di in et){const qi=Y.layers[di];if(!qi)continue;let Ji=!1,gi=!1,Xi=!1;for(const Xr of et[di])Xr[0].type==="symbol"?Ji=!0:gi=!0,Xr[0].is3D()&&Xr[0].type!=="model"&&(Xi=!0);if(this.extraShadowCaster&&!Xi||this.isSymbolTile===!0&&!Ji||this.isSymbolTile===!1&&!gi)continue;qi.version===1&&n.w(`Vector tile source "${this.source}" layer "${di}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yr=Le.encode(di),Wr=[];for(let Xr=0;Xr<qi.length;Xr++){const dn=qi.feature(Xr),xs=qe.getId(dn,di);Wr.push({feature:dn,id:xs,index:Xr,sourceLayerIndex:yr})}for(const Xr of et[di]){const dn=Xr[0];(!this.extraShadowCaster||dn.is3D()&&dn.type!=="model")&&(this.isSymbolTile!==void 0&&dn.type==="symbol"!==this.isSymbolTile||dn.minzoom&&this.zoom<Math.floor(dn.minzoom)||dn.maxzoom&&this.zoom>=dn.maxzoom||dn.visibility!=="none"&&(Xe(Xr,this.zoom,rt.brightness,he),(Fe[dn.id]=dn.createBucket({index:qe.bucketLayerIDs.length,layers:Xr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Wr,rt,this.tileID.canonical,this.tileTransform),qe.bucketLayerIDs.push(Xr.map(xs=>xs.id))))}}let gt,Lt,Dt,ci;He.trim();const hi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},fi=()=>{if(gt)return this.status="done",xe(gt);if(this.extraShadowCaster)this.status="done",xe(null,{buckets:n.bd(Fe).filter(di=>!di.isEmpty()),featureIndex:qe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:rt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Lt&&Dt&&ci){const di=new st(Lt),qi=new n.dU(Dt,ci,this.lut);for(const Ji in Fe){const gi=Fe[Ji];gi instanceof n.aR?(Xe(gi.layers,this.zoom,rt.brightness,he),n.dV(gi,Lt,di.positions,Dt,qi.iconPositions,this.showCollisionBoxes,he,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):gi.hasPattern&&(gi instanceof n.aX||gi instanceof n.aY||gi instanceof n.d0)&&(Xe(gi.layers,this.zoom,rt.brightness,he),gi.addFeatures(rt,this.tileID.canonical,qi.patternPositions,he,this.tileTransform,this.brightness))}this.status="done",xe(null,{buckets:n.bd(Fe).filter(Ji=>!Ji.isEmpty()),featureIndex:qe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:di.image,lineAtlas:He,imageAtlas:qi,brightness:rt.brightness})}};if(!this.extraShadowCaster){const di=n.dT(rt.glyphDependencies,gi=>Object.keys(gi).map(Number));Object.keys(di).length?we.send("getGlyphs",{uid:this.uid,stacks:di,scope:this.scope},(gi,Xi)=>{gt||(gt=gi,Lt=Xi,fi())},void 0,!1,hi):Lt={};const qi=Object.keys(rt.iconDependencies);qi.length?we.send("getImages",{icons:qi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(gi,Xi)=>{gt||(gt=gi,Dt=Xi,fi())},void 0,!1,hi):Dt={};const Ji=Object.keys(rt.patternDependencies);Ji.length?we.send("getImages",{icons:Ji,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(gi,Xi)=>{gt||(gt=gi,ci=Xi,fi())},void 0,!1,hi):ci={}}fi()}}function Xe(We,Y,J,he){const we=new n.a3(Y,{brightness:J});for(const xe of We)xe.recalculate(we,he)}class Ne extends n.E{constructor(Y,J,he,we,xe,Le){super(),this.actor=Y,this.layerIndex=J,this.availableImages=he,this.loadVectorData=xe||n.aw,this.loading={},this.loaded={},this.deduped=new n.au(Y.scheduler),this.isSpriteLoaded=we,this.scheduler=Y.scheduler,this.brightness=Le}loadTile(Y,J){const he=Y.uid,we=Y&&Y.request,xe=we&&we.collectResourceTiming,Le=this.loading[he]=new Qe(Y);Le.abort=this.loadVectorData(Y,(qe,Fe)=>{const He=!this.loading[he];if(delete this.loading[he],He||qe||!Fe)return Le.status="done",He||(this.loaded[he]=Le),J(qe);const rt=Fe.rawData,et={};Fe.expires&&(et.expires=Fe.expires),Fe.cacheControl&&(et.cacheControl=Fe.cacheControl),Le.vectorTile=Fe.vectorTile||new n.dW.VectorTile(new n.bb(rt));const gt=()=>{Le.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.actor,(Lt,Dt)=>{if(Lt||!Dt)return J(Lt);const ci={};if(xe){const hi=ne(we);hi.length>0&&(ci.resourceTiming=JSON.parse(JSON.stringify(hi)))}J(null,n.l({rawTileData:rt.slice(0)},Dt,et,ci))})};this.isSpriteLoaded?gt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(gt,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):gt()}),this.loaded=this.loaded||{},this.loaded[he]=Le})}reloadTile(Y,J){const he=this.loaded,we=Y.uid;if(he&&he[we]){const xe=he[we];xe.showCollisionBoxes=Y.showCollisionBoxes,xe.projection=Y.projection,xe.brightness=Y.brightness,xe.tileTransform=n.aK(Y.tileID.canonical,Y.projection),xe.extraShadowCaster=Y.extraShadowCaster,xe.lut=Y.lut;const Le=(qe,Fe)=>{const He=xe.reloadCallback;He&&(delete xe.reloadCallback,xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor,He)),J(qe,Fe)};xe.status==="parsing"?xe.reloadCallback=Le:xe.status==="done"&&(xe.vectorTile?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor,Le):Le())}else J(null,void 0)}abortTile(Y,J){const he=Y.uid,we=this.loading[he];we&&(we.abort&&we.abort(),delete this.loading[he]),J()}removeTile(Y,J){const he=this.loaded,we=Y.uid;he&&he[we]&&delete he[we],J()}}class Ve{loadTile(Y,J){const{uid:he,encoding:we,rawImageData:xe,padding:Le}=Y,qe=ImageBitmap&&xe instanceof ImageBitmap?this.getImageData(xe,Le):xe;J(null,new n.dX(he,qe,we,Le<1))}getImageData(Y,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const he=this.offscreenCanvasContext.getImageData(-J,-J,Y.width+2*J,Y.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}n.ba.setPbf(n.bb);class ht{decodeRasterArray({task:Y,buffer:J},he){n.ba.performDecoding(J,Y).then(we=>{he(null,we)},we=>{he(we)})}}const nt=n.dW.VectorTileFeature.prototype.toGeoJSON;class ft{constructor(Y){this._feature=Y,this.extent=n.ab,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const J of this._feature.geometry)Y.push([new n.P(J[0],J[1])]);return Y}{const Y=[];for(const J of this._feature.geometry){const he=[];for(const we of J)he.push(new n.P(we[0],we[1]));Y.push(he)}return Y}}toGeoJSON(Y,J,he){return nt.call(this,Y,J,he)}}class Bt{constructor(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.ab,this.length=Y.length,this._features=Y}feature(Y){return new ft(this._features[Y])}}const Et=64/4096,zt=128;class zi{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],J){for(const he of Y){const we=he.id;if(we==null)continue;let xe=this.features.get(we);xe&&this.updateCache(xe,J),he.geometry?(xe=$t(he),this.updateCache(xe,J),this.features.set(we,xe)):this.features.delete(we),this.updateCache(xe,J)}}updateCache(Y,J){for(const{canonical:he,uid:we}of Object.values(J)){const{z:xe,x:Le,y:qe}=he;or(Y,Math.pow(2,xe),Le,qe)&&delete J[we]}}getTile(Y,J,he){const we=Math.pow(2,Y),xe=[];for(const Le of this.features.values())or(Le,we,J,he)&&xe.push(Mn(Le,we,J,he));return{features:xe}}getFeatures(){return[...this.features.values()]}}function or({minX:We,minY:Y,maxX:J,maxY:he},we,xe,Le){return We<(xe+1+Et)/we&&Y<(Le+1+Et)/we&&J>(xe-Et)/we&&he>(Le-Et)/we}function $t(We){const{id:Y,geometry:J,properties:he}=We;if(!J)return;if(J.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:we,coordinates:xe}=J,Le={id:Y,type:1,geometry:[],tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},qe=Le.geometry;if(we==="Point")jt(xe,qe,Le);else if(we==="MultiPoint")for(const Fe of xe)jt(Fe,qe,Le);else if(we==="LineString")Le.type=2,Pr(xe,qe,Le);else if(we==="MultiLineString")Le.type=2,un(xe,qe,Le);else if(we==="Polygon")Le.type=3,un(xe,qe,Le,!0);else{if(we!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Le.type=3;for(const Fe of xe)un(Fe,qe,Le,!0)}return Le}function jt([We,Y],J,he){const we=n.am(We);let xe=n.at(Y);xe=xe<0?0:xe>1?1:xe,J.push(we,xe),he.minX=Math.min(he.minX,we),he.minY=Math.min(he.minY,xe),he.maxX=Math.max(he.maxX,we),he.maxY=Math.max(he.maxY,xe)}function Pr(We,Y,J,he=!1,we=!1){const xe=[];for(const Le of We)jt(Le,xe,J);Y.push(xe),he&&function(Le,qe){let Fe=0;for(let He=0,rt=Le.length,et=rt-2;He<rt;et=He,He+=2)Fe+=(Le[He]-Le[et])*(Le[He+1]+Le[et+1]);if(Fe>0===qe)for(let He=0,rt=Le.length;He<rt/2;He+=2){const et=Le[He],gt=Le[He+1];Le[He]=Le[rt-2-He],Le[He+1]=Le[rt-1-He],Le[rt-2-He]=et,Le[rt-1-He]=gt}}(xe,we)}function un(We,Y,J,he=!1){for(let we=0;we<We.length;we++)Pr(We[we],Y,J,he,we===0)}function Mn(We,Y,J,he){const{id:we,type:xe,geometry:Le,tags:qe}=We,Fe=[];if(xe===1)(function(He,rt,et,gt,Lt){for(let Dt=0;Dt<He.length;Dt+=2){const ci=Math.round(n.ab*(He[Dt+0]*rt-et)),hi=Math.round(n.ab*(He[Dt+1]*rt-gt));Lt.push([ci,hi])}})(Le,Y,J,he,Fe);else for(const He of Le)Jt(He,Y,J,he,Fe);return{id:we,type:xe,geometry:Fe,tags:qe}}function Jt(We,Y,J,he,we){const xe=-zt,Le=n.ab+zt;let qe;for(let Fe=0;Fe<We.length-2;Fe+=2){let He=Math.round(n.ab*(We[Fe+0]*Y-J)),rt=Math.round(n.ab*(We[Fe+1]*Y-he)),et=Math.round(n.ab*(We[Fe+2]*Y-J)),gt=Math.round(n.ab*(We[Fe+3]*Y-he));const Lt=et-He,Dt=gt-rt;He<xe&&et<xe||(He<xe?(rt+=Math.round(Dt*((xe-He)/Lt)),He=xe):et<xe&&(gt=rt+Math.round(Dt*((xe-He)/Lt)),et=xe),rt<xe&&gt<xe||(rt<xe?(He+=Math.round(Lt*((xe-rt)/Dt)),rt=xe):gt<xe&&(et=He+Math.round(Lt*((xe-rt)/Dt)),gt=xe),He>=Le&&et>=Le||(He>=Le?(rt+=Math.round(Dt*((Le-He)/Lt)),He=Le):et>=Le&&(gt=rt+Math.round(Dt*((Le-He)/Lt)),et=Le),rt>=Le&&gt>=Le||(rt>=Le?(He+=Math.round(Lt*((Le-rt)/Dt)),rt=Le):gt>=Le&&(et=He+Math.round(Lt*((Le-rt)/Dt)),gt=Le),qe&&He===qe[qe.length-1][0]&&rt===qe[qe.length-1][1]||(qe=[[He,rt]],we.push(qe)),qe.push([et,gt])))))}}var Ii,Oi,Sr,ei={exports:{}},Vr=function(){if(Sr)return ei.exports;Sr=1;var We=n.d_(),Y=function(){if(Oi)return Ii;Oi=1;var rt=n.dY(),et=n.dZ().VectorTileFeature;function gt(Dt,ci){this.options=ci||{},this.features=Dt,this.length=Dt.length}function Lt(Dt,ci){this.id=typeof Dt.id=="number"?Dt.id:void 0,this.type=Dt.type,this.rawGeometry=Dt.type===1?[Dt.geometry]:Dt.geometry,this.properties=Dt.tags,this.extent=ci||4096}return Ii=gt,gt.prototype.feature=function(Dt){return new Lt(this.features[Dt],this.options.extent)},Lt.prototype.loadGeometry=function(){var Dt=this.rawGeometry;this.geometry=[];for(var ci=0;ci<Dt.length;ci++){for(var hi=Dt[ci],fi=[],di=0;di<hi.length;di++)fi.push(new rt(hi[di][0],hi[di][1]));this.geometry.push(fi)}return this.geometry},Lt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Dt=this.geometry,ci=1/0,hi=-1/0,fi=1/0,di=-1/0,qi=0;qi<Dt.length;qi++)for(var Ji=Dt[qi],gi=0;gi<Ji.length;gi++){var Xi=Ji[gi];ci=Math.min(ci,Xi.x),hi=Math.max(hi,Xi.x),fi=Math.min(fi,Xi.y),di=Math.max(di,Xi.y)}return[ci,fi,hi,di]},Lt.prototype.toGeoJSON=et.prototype.toGeoJSON,Ii}();function J(rt){var et=new We;return function(gt,Lt){for(var Dt in gt.layers)Lt.writeMessage(3,he,gt.layers[Dt])}(rt,et),et.finish()}function he(rt,et){var gt;et.writeVarintField(15,rt.version||1),et.writeStringField(1,rt.name||""),et.writeVarintField(5,rt.extent||4096);var Lt={keys:[],values:[],keycache:{},valuecache:{}};for(gt=0;gt<rt.length;gt++)Lt.feature=rt.feature(gt),et.writeMessage(2,we,Lt);var Dt=Lt.keys;for(gt=0;gt<Dt.length;gt++)et.writeStringField(3,Dt[gt]);var ci=Lt.values;for(gt=0;gt<ci.length;gt++)et.writeMessage(4,He,ci[gt])}function we(rt,et){var gt=rt.feature;gt.id!==void 0&&et.writeVarintField(1,gt.id),et.writeMessage(2,xe,rt),et.writeVarintField(3,gt.type),et.writeMessage(4,Fe,gt)}function xe(rt,et){var gt=rt.feature,Lt=rt.keys,Dt=rt.values,ci=rt.keycache,hi=rt.valuecache;for(var fi in gt.properties){var di=gt.properties[fi],qi=ci[fi];if(di!==null){qi===void 0&&(Lt.push(fi),ci[fi]=qi=Lt.length-1),et.writeVarint(qi);var Ji=typeof di;Ji!=="string"&&Ji!=="boolean"&&Ji!=="number"&&(di=JSON.stringify(di));var gi=Ji+":"+di,Xi=hi[gi];Xi===void 0&&(Dt.push(di),hi[gi]=Xi=Dt.length-1),et.writeVarint(Xi)}}}function Le(rt,et){return(et<<3)+(7&rt)}function qe(rt){return rt<<1^rt>>31}function Fe(rt,et){for(var gt=rt.loadGeometry(),Lt=rt.type,Dt=0,ci=0,hi=gt.length,fi=0;fi<hi;fi++){var di=gt[fi],qi=1;Lt===1&&(qi=di.length),et.writeVarint(Le(1,qi));for(var Ji=Lt===3?di.length-1:di.length,gi=0;gi<Ji;gi++){gi===1&&Lt!==1&&et.writeVarint(Le(2,Ji-1));var Xi=di[gi].x-Dt,yr=di[gi].y-ci;et.writeVarint(qe(Xi)),et.writeVarint(qe(yr)),Dt+=Xi,ci+=yr}Lt===3&&et.writeVarint(Le(7,1))}}function He(rt,et){var gt=typeof rt;gt==="string"?et.writeStringField(1,rt):gt==="boolean"?et.writeBooleanField(7,rt):gt==="number"&&(rt%1!=0?et.writeDoubleField(3,rt):rt<0?et.writeSVarintField(6,rt):et.writeVarintField(5,rt))}return ei.exports=J,ei.exports.fromVectorTileJs=J,ei.exports.fromGeojsonVt=function(rt,et){et=et||{};var gt={};for(var Lt in rt)gt[Lt]=new Y(rt[Lt].features,et),gt[Lt].name=Lt,gt[Lt].version=et.version,gt[Lt].extent=et.extent;return J({layers:gt})},ei.exports.GeoJSONWrapper=Y,ei.exports}(),Or=n.d$(Vr);const _n={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:We=>We},ti=Math.fround||(Yn=new Float32Array(1),We=>(Yn[0]=+We,Yn[0]));var Yn;const gr=3,Tt=5,Kt=6;class Zt{constructor(Y){this.options=Object.assign(Object.create(_n),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:J,minZoom:he,maxZoom:we}=this.options;J&&console.time("total time");const xe=`prepare ${Y.length} points`;J&&console.time(xe),this.points=Y;const Le=[];for(let Fe=0;Fe<Y.length;Fe++){const He=Y[Fe];if(!He.geometry)continue;const[rt,et]=He.geometry.coordinates,gt=ti(Ki(rt)),Lt=ti(Ae(et));Le.push(gt,Lt,1/0,Fe,-1,1),this.options.reduce&&Le.push(0)}let qe=this.trees[we+1]=this._createTree(Le);J&&console.timeEnd(xe);for(let Fe=we;Fe>=he;Fe--){const He=+Date.now();qe=this.trees[Fe]=this._createTree(this._cluster(qe,Fe)),J&&console.log("z%d: %d clusters in %dms",Fe,qe.numItems,+Date.now()-He)}return J&&console.timeEnd("total time"),this}getClusters(Y,J){let he=((Y[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,Y[1]));let xe=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)he=-180,xe=180;else if(he>xe){const et=this.getClusters([he,we,180,Le],J),gt=this.getClusters([-180,we,xe,Le],J);return et.concat(gt)}const qe=this.trees[this._limitZoom(J)],Fe=qe.range(Ki(he),Ae(Le),Ki(xe),Ae(we)),He=qe.data,rt=[];for(const et of Fe){const gt=this.stride*et;rt.push(He[gt+Tt]>1?ni(He,gt,this.clusterProps):this.points[He[gt+gr]])}return rt}getChildren(Y){const J=this._getOriginId(Y),he=this._getOriginZoom(Y),we="No cluster with the specified id.",xe=this.trees[he];if(!xe)throw new Error(we);const Le=xe.data;if(J*this.stride>=Le.length)throw new Error(we);const qe=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Fe=xe.within(Le[J*this.stride],Le[J*this.stride+1],qe),He=[];for(const rt of Fe){const et=rt*this.stride;Le[et+4]===Y&&He.push(Le[et+Tt]>1?ni(Le,et,this.clusterProps):this.points[Le[et+gr]])}if(He.length===0)throw new Error(we);return He}getLeaves(Y,J,he){const we=[];return this._appendLeaves(we,Y,J=J||10,he=he||0,0),we}getTile(Y,J,he){const we=this.trees[this._limitZoom(Y)],xe=Math.pow(2,Y),{extent:Le,radius:qe}=this.options,Fe=qe/Le,He=(he-Fe)/xe,rt=(he+1+Fe)/xe,et={features:[]};return this._addTileFeatures(we.range((J-Fe)/xe,He,(J+1+Fe)/xe,rt),we.data,J,he,xe,et),J===0&&this._addTileFeatures(we.range(1-Fe/xe,He,1,rt),we.data,xe,he,xe,et),J===xe-1&&this._addTileFeatures(we.range(0,He,Fe/xe,rt),we.data,-1,he,xe,et),et.features.length?et:null}getClusterExpansionZoom(Y){let J=this._getOriginZoom(Y)-1;for(;J<=this.options.maxZoom;){const he=this.getChildren(Y);if(J++,he.length!==1)break;Y=he[0].properties.cluster_id}return J}_appendLeaves(Y,J,he,we,xe){const Le=this.getChildren(J);for(const qe of Le){const Fe=qe.properties;if(Fe&&Fe.cluster?xe+Fe.point_count<=we?xe+=Fe.point_count:xe=this._appendLeaves(Y,Fe.cluster_id,he,we,xe):xe<we?xe++:Y.push(qe),Y.length===he)break}return xe}_createTree(Y){const J=new n.by(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<Y.length;he+=this.stride)J.add(Y[he],Y[he+1]);return J.finish(),J.data=Y,J}_addTileFeatures(Y,J,he,we,xe,Le){for(const qe of Y){const Fe=qe*this.stride,He=J[Fe+Tt]>1;let rt,et,gt;if(He)rt=ge(J,Fe,this.clusterProps),et=J[Fe],gt=J[Fe+1];else{const ci=this.points[J[Fe+gr]];rt=ci.properties;const[hi,fi]=ci.geometry.coordinates;et=Ki(hi),gt=Ae(fi)}const Lt={type:1,geometry:[[Math.round(this.options.extent*(et*xe-he)),Math.round(this.options.extent*(gt*xe-we))]],tags:rt};let Dt;Dt=He||this.options.generateId?J[Fe+gr]:this.points[J[Fe+gr]].id,Dt!==void 0&&(Lt.id=Dt),Le.features.push(Lt)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,J){const{radius:he,extent:we,reduce:xe,minPoints:Le}=this.options,qe=he/(we*Math.pow(2,J)),Fe=Y.data,He=[],rt=this.stride;for(let et=0;et<Fe.length;et+=rt){if(Fe[et+2]<=J)continue;Fe[et+2]=J;const gt=Fe[et],Lt=Fe[et+1],Dt=Y.within(Fe[et],Fe[et+1],qe),ci=Fe[et+Tt];let hi=ci;for(const fi of Dt){const di=fi*rt;Fe[di+2]>J&&(hi+=Fe[di+Tt])}if(hi>ci&&hi>=Le){let fi,di=gt*ci,qi=Lt*ci,Ji=-1;const gi=(et/rt<<5)+(J+1)+this.points.length;for(const Xi of Dt){const yr=Xi*rt;if(Fe[yr+2]<=J)continue;Fe[yr+2]=J;const Wr=Fe[yr+Tt];di+=Fe[yr]*Wr,qi+=Fe[yr+1]*Wr,Fe[yr+4]=gi,xe&&(fi||(fi=this._map(Fe,et,!0),Ji=this.clusterProps.length,this.clusterProps.push(fi)),xe(fi,this._map(Fe,yr)))}Fe[et+4]=gi,He.push(di/hi,qi/hi,1/0,gi,-1,hi),xe&&He.push(Ji)}else{for(let fi=0;fi<rt;fi++)He.push(Fe[et+fi]);if(hi>1)for(const fi of Dt){const di=fi*rt;if(!(Fe[di+2]<=J)){Fe[di+2]=J;for(let qi=0;qi<rt;qi++)He.push(Fe[di+qi])}}}}return He}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,J,he){if(Y[J+Tt]>1){const Le=this.clusterProps[Y[J+Kt]];return he?Object.assign({},Le):Le}const we=this.points[Y[J+gr]].properties,xe=this.options.map(we);return he&&xe===we?Object.assign({},xe):xe}}function ni(We,Y,J){return{type:"Feature",id:We[Y+gr],properties:ge(We,Y,J),geometry:{type:"Point",coordinates:[(he=We[Y],360*(he-.5)),ke(We[Y+1])]}};var he}function ge(We,Y,J){const he=We[Y+Tt],we=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,xe=We[Y+Kt],Le=xe===-1?{}:Object.assign({},J[xe]);return Object.assign(Le,{cluster:!0,cluster_id:We[Y+gr],point_count:he,point_count_abbreviated:we})}function Ki(We){return We/360+.5}function Ae(We){const Y=Math.sin(We*Math.PI/180),J=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return J<0?0:J>1?1:J}function ke(We){const Y=(180-360*We)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function Se(We,Y,J,he){let we=he;const xe=Y+(J-Y>>1);let Le,qe=J-Y;const Fe=We[Y],He=We[Y+1],rt=We[J],et=We[J+1];for(let gt=Y+3;gt<J;gt+=3){const Lt=Ct(We[gt],We[gt+1],Fe,He,rt,et);if(Lt>we)Le=gt,we=Lt;else if(Lt===we){const Dt=Math.abs(gt-xe);Dt<qe&&(Le=gt,qe=Dt)}}we>he&&(Le-Y>3&&Se(We,Y,Le,he),We[Le+2]=we,J-Le>3&&Se(We,Le,J,he))}function Ct(We,Y,J,he,we,xe){let Le=we-J,qe=xe-he;if(Le!==0||qe!==0){const Fe=((We-J)*Le+(Y-he)*qe)/(Le*Le+qe*qe);Fe>1?(J=we,he=xe):Fe>0&&(J+=Le*Fe,he+=qe*Fe)}return Le=We-J,qe=Y-he,Le*Le+qe*qe}function _t(We,Y,J,he){const we={id:We??null,type:Y,geometry:J,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")ve(we,J);else if(Y==="Polygon")ve(we,J[0]);else if(Y==="MultiLineString")for(const xe of J)ve(we,xe);else if(Y==="MultiPolygon")for(const xe of J)ve(we,xe[0]);return we}function ve(We,Y){for(let J=0;J<Y.length;J+=3)We.minX=Math.min(We.minX,Y[J]),We.minY=Math.min(We.minY,Y[J+1]),We.maxX=Math.max(We.maxX,Y[J]),We.maxY=Math.max(We.maxY,Y[J+1])}function _e(We,Y,J,he){if(!Y.geometry)return;const we=Y.geometry.coordinates;if(we&&we.length===0)return;const xe=Y.geometry.type,Le=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let qe=[],Fe=Y.id;if(J.promoteId?Fe=Y.properties[J.promoteId]:J.generateId&&(Fe=he||0),xe==="Point")Ze(we,qe);else if(xe==="MultiPoint")for(const He of we)Ze(He,qe);else if(xe==="LineString")pt(we,qe,Le,!1);else if(xe==="MultiLineString"){if(J.lineMetrics){for(const He of we)qe=[],pt(He,qe,Le,!1),We.push(_t(Fe,"LineString",qe,Y.properties));return}It(we,qe,Le,!1)}else if(xe==="Polygon")It(we,qe,Le,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const He of Y.geometry.geometries)_e(We,{id:Fe,geometry:He,properties:Y.properties},J,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const He of we){const rt=[];It(He,rt,Le,!0),qe.push(rt)}}We.push(_t(Fe,xe,qe,Y.properties))}function Ze(We,Y){Y.push(Ut(We[0]),Ge(We[1]),0)}function pt(We,Y,J,he){let we,xe,Le=0;for(let Fe=0;Fe<We.length;Fe++){const He=Ut(We[Fe][0]),rt=Ge(We[Fe][1]);Y.push(He,rt,0),Fe>0&&(Le+=he?(we*rt-He*xe)/2:Math.sqrt(Math.pow(He-we,2)+Math.pow(rt-xe,2))),we=He,xe=rt}const qe=Y.length-3;Y[2]=1,Se(Y,0,qe,J),Y[qe+2]=1,Y.size=Math.abs(Le),Y.start=0,Y.end=Y.size}function It(We,Y,J,he){for(let we=0;we<We.length;we++){const xe=[];pt(We[we],xe,J,he),Y.push(xe)}}function Ut(We){return We/360+.5}function Ge(We){const Y=Math.sin(We*Math.PI/180),J=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return J<0?0:J>1?1:J}function $e(We,Y,J,he,we,xe,Le,qe){if(he/=Y,xe>=(J/=Y)&&Le<he)return We;if(Le<J||xe>=he)return null;const Fe=[];for(const He of We){const rt=He.geometry;let et=He.type;const gt=we===0?He.minX:He.minY,Lt=we===0?He.maxX:He.maxY;if(gt>=J&&Lt<he){Fe.push(He);continue}if(Lt<J||gt>=he)continue;let Dt=[];if(et==="Point"||et==="MultiPoint")Xt(rt,Dt,J,he,we);else if(et==="LineString")li(rt,Dt,J,he,we,!1,qe.lineMetrics);else if(et==="MultiLineString")Si(rt,Dt,J,he,we,!1);else if(et==="Polygon")Si(rt,Dt,J,he,we,!0);else if(et==="MultiPolygon")for(const ci of rt){const hi=[];Si(ci,hi,J,he,we,!0),hi.length&&Dt.push(hi)}if(Dt.length){if(qe.lineMetrics&&et==="LineString"){for(const ci of Dt)Fe.push(_t(He.id,et,ci,He.tags));continue}et!=="LineString"&&et!=="MultiLineString"||(Dt.length===1?(et="LineString",Dt=Dt[0]):et="MultiLineString"),et!=="Point"&&et!=="MultiPoint"||(et=Dt.length===3?"Point":"MultiPoint"),Fe.push(_t(He.id,et,Dt,He.tags))}}return Fe.length?Fe:null}function Xt(We,Y,J,he,we){for(let xe=0;xe<We.length;xe+=3){const Le=We[xe+we];Le>=J&&Le<=he&&sr(Y,We[xe],We[xe+1],We[xe+2])}}function li(We,Y,J,he,we,xe,Le){let qe=Ui(We);const Fe=we===0?kr:hn;let He,rt,et=We.start;for(let hi=0;hi<We.length-3;hi+=3){const fi=We[hi],di=We[hi+1],qi=We[hi+2],Ji=We[hi+3],gi=We[hi+4],Xi=we===0?fi:di,yr=we===0?Ji:gi;let Wr=!1;Le&&(He=Math.sqrt(Math.pow(fi-Ji,2)+Math.pow(di-gi,2))),Xi<J?yr>J&&(rt=Fe(qe,fi,di,Ji,gi,J),Le&&(qe.start=et+He*rt)):Xi>he?yr<he&&(rt=Fe(qe,fi,di,Ji,gi,he),Le&&(qe.start=et+He*rt)):sr(qe,fi,di,qi),yr<J&&Xi>=J&&(rt=Fe(qe,fi,di,Ji,gi,J),Wr=!0),yr>he&&Xi<=he&&(rt=Fe(qe,fi,di,Ji,gi,he),Wr=!0),!xe&&Wr&&(Le&&(qe.end=et+He*rt),Y.push(qe),qe=Ui(We)),Le&&(et+=He)}let gt=We.length-3;const Lt=We[gt],Dt=We[gt+1],ci=we===0?Lt:Dt;ci>=J&&ci<=he&&sr(qe,Lt,Dt,We[gt+2]),gt=qe.length-3,xe&&gt>=3&&(qe[gt]!==qe[0]||qe[gt+1]!==qe[1])&&sr(qe,qe[0],qe[1],qe[2]),qe.length&&Y.push(qe)}function Ui(We){const Y=[];return Y.size=We.size,Y.start=We.start,Y.end=We.end,Y}function Si(We,Y,J,he,we,xe){for(const Le of We)li(Le,Y,J,he,we,xe,!1)}function sr(We,Y,J,he){We.push(Y,J,he)}function kr(We,Y,J,he,we,xe){const Le=(xe-Y)/(he-Y);return sr(We,xe,J+(we-J)*Le,1),Le}function hn(We,Y,J,he,we,xe){const Le=(xe-J)/(we-J);return sr(We,Y+(he-Y)*Le,xe,1),Le}function en(We,Y){const J=[];for(let he=0;he<We.length;he++){const we=We[he],xe=we.type;let Le;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Le=Cn(we.geometry,Y);else if(xe==="MultiLineString"||xe==="Polygon"){Le=[];for(const qe of we.geometry)Le.push(Cn(qe,Y))}else if(xe==="MultiPolygon"){Le=[];for(const qe of we.geometry){const Fe=[];for(const He of qe)Fe.push(Cn(He,Y));Le.push(Fe)}}J.push(_t(we.id,xe,Le,we.tags))}return J}function Cn(We,Y){const J=[];J.size=We.size,We.start!==void 0&&(J.start=We.start,J.end=We.end);for(let he=0;he<We.length;he+=3)J.push(We[he]+Y,We[he+1],We[he+2]);return J}function zs(We,Y){if(We.transformed)return We;const J=1<<We.z,he=We.x,we=We.y;for(const xe of We.features){const Le=xe.geometry,qe=xe.type;if(xe.geometry=[],qe===1)for(let Fe=0;Fe<Le.length;Fe+=2)xe.geometry.push(tn(Le[Fe],Le[Fe+1],Y,J,he,we));else for(let Fe=0;Fe<Le.length;Fe++){const He=[];for(let rt=0;rt<Le[Fe].length;rt+=2)He.push(tn(Le[Fe][rt],Le[Fe][rt+1],Y,J,he,we));xe.geometry.push(He)}}return We.transformed=!0,We}function tn(We,Y,J,he,we,xe){return[Math.round(J*(We*he-we)),Math.round(J*(Y*he-xe))]}function jr(We,Y,J,he,we){const xe=Y===we.maxZoom?0:we.tolerance/((1<<Y)*we.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:We.length,source:null,x:J,y:he,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const qe of We)vo(Le,qe,xe,we);return Le}function vo(We,Y,J,he){const we=Y.geometry,xe=Y.type,Le=[];if(We.minX=Math.min(We.minX,Y.minX),We.minY=Math.min(We.minY,Y.minY),We.maxX=Math.max(We.maxX,Y.maxX),We.maxY=Math.max(We.maxY,Y.maxY),xe==="Point"||xe==="MultiPoint")for(let qe=0;qe<we.length;qe+=3)Le.push(we[qe],we[qe+1]),We.numPoints++,We.numSimplified++;else if(xe==="LineString")ki(Le,we,We,J,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let qe=0;qe<we.length;qe++)ki(Le,we[qe],We,J,xe==="Polygon",qe===0);else if(xe==="MultiPolygon")for(let qe=0;qe<we.length;qe++){const Fe=we[qe];for(let He=0;He<Fe.length;He++)ki(Le,Fe[He],We,J,!0,He===0)}if(Le.length){let qe=Y.tags||null;if(xe==="LineString"&&he.lineMetrics){qe={};for(const He in Y.tags)qe[He]=Y.tags[He];qe.mapbox_clip_start=we.start/we.size,qe.mapbox_clip_end=we.end/we.size}const Fe={geometry:Le,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:qe};Y.id!==null&&(Fe.id=Y.id),We.features.push(Fe)}}function ki(We,Y,J,he,we,xe){const Le=he*he;if(he>0&&Y.size<(we?Le:he))return void(J.numPoints+=Y.length/3);const qe=[];for(let Fe=0;Fe<Y.length;Fe+=3)(he===0||Y[Fe+2]>Le)&&(J.numSimplified++,qe.push(Y[Fe],Y[Fe+1])),J.numPoints++;we&&function(Fe,He){let rt=0;for(let et=0,gt=Fe.length,Lt=gt-2;et<gt;Lt=et,et+=2)rt+=(Fe[et]-Fe[Lt])*(Fe[et+1]+Fe[Lt+1]);if(rt>0===He)for(let et=0,gt=Fe.length;et<gt/2;et+=2){const Lt=Fe[et],Dt=Fe[et+1];Fe[et]=Fe[gt-2-et],Fe[et+1]=Fe[gt-1-et],Fe[gt-2-et]=Lt,Fe[gt-1-et]=Dt}}(qe,xe),We.push(qe)}const Os={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Cc{constructor(Y,J){const he=(J=this.options=function(xe,Le){for(const qe in Le)xe[qe]=Le[qe];return xe}(Object.create(Os),J)).debug;if(he&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let we=function(xe,Le){const qe=[];if(xe.type==="FeatureCollection")for(let Fe=0;Fe<xe.features.length;Fe++)_e(qe,xe.features[Fe],Le,Fe);else _e(qe,xe.type==="Feature"?xe:{geometry:xe},Le);return qe}(Y,J);this.tiles={},this.tileCoords=[],he&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),we=function(xe,Le){const qe=Le.buffer/Le.extent;let Fe=xe;const He=$e(xe,1,-1-qe,qe,0,-1,2,Le),rt=$e(xe,1,1-qe,2+qe,0,-1,2,Le);return(He||rt)&&(Fe=$e(xe,1,-qe,1+qe,0,-1,2,Le)||[],He&&(Fe=en(He,1).concat(Fe)),rt&&(Fe=Fe.concat(en(rt,-1)))),Fe}(we,J),we.length&&this.splitTile(we,0,0,0),he&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,J,he,we,xe,Le,qe){const Fe=[Y,J,he,we],He=this.options,rt=He.debug;for(;Fe.length;){we=Fe.pop(),he=Fe.pop(),J=Fe.pop(),Y=Fe.pop();const et=1<<J,gt=Kn(J,he,we);let Lt=this.tiles[gt];if(!Lt&&(rt>1&&console.time("creation"),Lt=this.tiles[gt]=jr(Y,J,he,we,He),this.tileCoords.push({z:J,x:he,y:we}),rt)){rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,he,we,Lt.numFeatures,Lt.numPoints,Lt.numSimplified),console.timeEnd("creation"));const Wr=`z${J}`;this.stats[Wr]=(this.stats[Wr]||0)+1,this.total++}if(Lt.source=Y,xe==null){if(J===He.indexMaxZoom||Lt.numPoints<=He.indexMaxPoints)continue}else{if(J===He.maxZoom||J===xe)continue;if(xe!=null){const Wr=xe-J;if(he!==Le>>Wr||we!==qe>>Wr)continue}}if(Lt.source=null,Y.length===0)continue;rt>1&&console.time("clipping");const Dt=.5*He.buffer/He.extent,ci=.5-Dt,hi=.5+Dt,fi=1+Dt;let di=null,qi=null,Ji=null,gi=null,Xi=$e(Y,et,he-Dt,he+hi,0,Lt.minX,Lt.maxX,He),yr=$e(Y,et,he+ci,he+fi,0,Lt.minX,Lt.maxX,He);Y=null,Xi&&(di=$e(Xi,et,we-Dt,we+hi,1,Lt.minY,Lt.maxY,He),qi=$e(Xi,et,we+ci,we+fi,1,Lt.minY,Lt.maxY,He),Xi=null),yr&&(Ji=$e(yr,et,we-Dt,we+hi,1,Lt.minY,Lt.maxY,He),gi=$e(yr,et,we+ci,we+fi,1,Lt.minY,Lt.maxY,He),yr=null),rt>1&&console.timeEnd("clipping"),Fe.push(di||[],J+1,2*he,2*we),Fe.push(qi||[],J+1,2*he,2*we+1),Fe.push(Ji||[],J+1,2*he+1,2*we),Fe.push(gi||[],J+1,2*he+1,2*we+1)}}getTile(Y,J,he){Y=+Y,J=+J,he=+he;const we=this.options,{extent:xe,debug:Le}=we;if(Y<0||Y>24)return null;const qe=1<<Y,Fe=Kn(Y,J=J+qe&qe-1,he);if(this.tiles[Fe])return zs(this.tiles[Fe],xe);Le>1&&console.log("drilling down to z%d-%d-%d",Y,J,he);let He,rt=Y,et=J,gt=he;for(;!He&&rt>0;)rt--,et>>=1,gt>>=1,He=this.tiles[Kn(rt,et,gt)];return He&&He.source?(Le>1&&(console.log("found parent tile z%d-%d-%d",rt,et,gt),console.time("drilling down")),this.splitTile(He.source,rt,et,gt,Y,J,he),Le>1&&console.timeEnd("drilling down"),this.tiles[Fe]?zs(this.tiles[Fe],xe):null):null}}function Kn(We,Y,J){return 32*((1<<We)*J+Y)+We}function $o(We,Y){const J=We.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);const he=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!he)return void Y(null,null);const we=new Bt(he.features);let xe=Or(we);xe.byteOffset===0&&xe.byteLength===xe.buffer.byteLength||(xe=new Uint8Array(xe)),Y(null,{vectorTile:we,rawData:xe.buffer})}class Al extends Ne{constructor(Y,J,he,we,xe,Le){super(Y,J,he,we,$o,Le),xe&&(this.loadGeoJSON=xe),this._dynamicIndex=new zi}loadData(Y,J){const he=Y&&Y.request,we=he&&he.collectResourceTiming;this.loadGeoJSON(Y,(xe,Le)=>{if(xe||!Le)return J(xe);if(typeof Le!="object")return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){const Fe=n.M(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Fe.result==="error")throw new Error(Fe.value.map(He=>`${He.key}: ${He.message}`).join(", "));Le.features=Le.features.filter(He=>Fe.value.evaluate({zoom:0},He))}Y.dynamic?(Le.type==="Feature"&&(Le={type:"FeatureCollection",features:[Le]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Le.features,this.loaded),Y.cluster&&(Le.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new Zt(function({superclusterOptions:Fe,clusterProperties:He}){if(!He||!Fe)return Fe;const rt={},et={},gt={accumulated:null,zoom:0},Lt={properties:null},Dt=Object.keys(He);for(const ci of Dt){const[hi,fi]=He[ci],di=n.M(fi),qi=n.M(typeof hi=="string"?[hi,["accumulated"],["get",ci]]:hi);rt[ci]=di.value,et[ci]=qi.value}return Fe.map=ci=>{Lt.properties=ci;const hi={};for(const fi of Dt)hi[fi]=rt[fi].evaluate(gt,Lt);return hi},Fe.reduce=(ci,hi)=>{Lt.properties=hi;for(const fi of Dt)gt.accumulated=ci[fi],ci[fi]=et[fi].evaluate(gt,Lt)},Fe}(Y)).load(Le.features):Y.dynamic?this._dynamicIndex:function(Fe,He){return new Cc(Fe,He)}(Le,Y.geojsonVtOptions)}catch(Fe){return J(Fe)}const qe={};if(we){const Fe=ne(he);Fe&&(qe.resourceTiming={},qe.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Fe)))}J(null,qe)}})}reloadTile(Y,J){const he=this.loaded;return he&&he[Y.uid]?Y.partial?J(null,void 0):super.reloadTile(Y,J):this.loadTile(Y,J)}loadGeoJSON(Y,J){if(Y.request)n.n(Y.request,J);else{if(typeof Y.data!="string")return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return J(null,JSON.parse(Y.data))}catch{return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(he){J(he)}}getClusterChildren(Y,J){try{J(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(he){J(he)}}getClusterLeaves(Y,J){try{J(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(he){J(he)}}}class ya{constructor(Y,J){this.tileID=new n.aA(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=J}parse(Y,J,he,we){this.status="parsing";const xe=new n.aA(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),Le={},qe=J.familiesBySource[he.source],Fe=new n.dR(xe,he.promoteId);return Fe.bucketLayerIDs=[],Fe.is3DTile=!0,n.e0(Y).then(He=>{if(!He)return we(new Error("Could not parse tile"));const rt=n.e1(He,1/n.c8(he.tileID.canonical)),et=He.json.extensionsUsed&&He.json.extensionsUsed.includes("MAPBOX_mesh_features")||He.json.asset.extras&&He.json.asset.extras.MAPBOX_mesh_features,gt=He.json.extensionsUsed&&He.json.extensionsUsed.includes("EXT_meshopt_compression"),Lt=new n.a3(this.zoom,{brightness:this.brightness});for(const Dt in qe)for(const ci of qe[Dt]){const hi=ci[0];Fe.bucketLayerIDs.push(ci.map(di=>di.id)),hi.recalculate(Lt,[]);const fi=new n.e2(rt,xe,et,gt,this.brightness,Fe);et||(fi.needsUpload=!0),Le[hi.fqid]=fi,fi.evaluate(hi)}this.status="done",we(null,{buckets:Le,featureIndex:Fe})}).catch(He=>we(new Error(He.message)))}}class Il{constructor(Y,J,he,we,xe,Le){this.actor=Y,this.layerIndex=J,this.brightness=Le,this.loading={},this.loaded={}}loadTile(Y,J){const he=Y.uid,we=this.loading[he]=new ya(Y,this.brightness);n.bc(Y.request,(xe,Le)=>{const qe=!this.loading[he];return delete this.loading[he],qe||xe?(we.status="done",qe||(this.loaded[he]=we),J(xe)):Le&&Le.byteLength!==0?void we.parse(Le,this.layerIndex,Y,(Fe,He)=>{we.status="done",this.loaded=this.loaded||{},this.loaded[he]=we,Fe||!He?J(Fe):J(null,He)}):(we.status="done",this.loaded[he]=we,J())})}reloadTile(Y,J){const he=this.loaded,we=Y.uid;if(he&&he[we]){const xe=he[we];xe.projection=Y.projection,xe.brightness=Y.brightness;const Le=(qe,Fe)=>{xe.reloadCallback&&(delete xe.reloadCallback,this.loadTile(Y,J)),J(qe,Fe)};xe.status==="parsing"?xe.reloadCallback=Le:xe.status==="done"&&this.loadTile(Y,J)}}abortTile(Y,J){const he=Y.uid;this.loading[he]&&delete this.loading[he],J()}removeTile(Y,J){const he=this.loaded,we=Y.uid;he&&he[we]&&delete he[we],J()}}class qo{constructor(Y){this.self=Y,this.actor=new n.e3(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.bL({name:"mercator"}),this.workerSourceTypes={vector:Ne,geojson:Al,"batched-model":Il},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(J,he)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=he},this.self.registerRTLTextPlugin=J=>{if(n.e4.isParsed())throw new Error("RTL text plugin already registered.");n.e4.applyArabicShaping=J.applyArabicShaping,n.e4.processBidirectionalText=J.processBidirectionalText,n.e4.processStyledBidirectionalText=J.processStyledBidirectionalText}}clearCaches(Y,J,he){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y],delete this.rasterArrayWorkerSource,he()}checkIfReady(Y,J,he){he()}setReferrer(Y,J){this.referrer=J}spriteLoaded(Y,{scope:J,isLoaded:he}){if(this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.isSpriteLoaded[Y][J]=he,this.workerSources[Y]&&this.workerSources[Y][J])for(const we in this.workerSources[Y][J]){const xe=this.workerSources[Y][J][we];for(const Le in xe){const qe=xe[Le];qe instanceof Ne&&(qe.isSpriteLoaded=he,qe.fire(new n.x("isSpriteLoaded")))}}}setImages(Y,{scope:J,images:he},we){if(this.availableImages[Y]||(this.availableImages[Y]={}),this.availableImages[Y][J]=he,this.workerSources[Y]&&this.workerSources[Y][J]){for(const xe in this.workerSources[Y][J]){const Le=this.workerSources[Y][J][xe];for(const qe in Le)Le[qe].availableImages=he}we()}else we()}setProjection(Y,J){this.projections[Y]=n.bL(J)}setBrightness(Y,J,he){this.brightness=J,he()}setLayers(Y,J,he){this.getLayerIndex(Y,J.scope).replace(J.layers,J.options),he()}updateLayers(Y,J,he){this.getLayerIndex(Y,J.scope).update(J.layers,J.removedIds,J.options),he()}loadTile(Y,J,he){J.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,J.type,J.source,J.scope).loadTile(J,he)}loadDEMTile(Y,J,he){this.getDEMWorkerSource(Y,J.source,J.scope).loadTile(J,he)}decodeRasterArray(Y,J,he){this.getRasterArrayWorkerSource().decodeRasterArray(J,he)}reloadTile(Y,J,he){J.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,J.type,J.source,J.scope).reloadTile(J,he)}abortTile(Y,J,he){this.getWorkerSource(Y,J.type,J.source,J.scope).abortTile(J,he)}removeTile(Y,J,he){this.getWorkerSource(Y,J.type,J.source,J.scope).removeTile(J,he)}removeSource(Y,J,he){if(!(this.workerSources[Y]&&this.workerSources[Y][J.scope]&&this.workerSources[Y][J.scope][J.type]&&this.workerSources[Y][J.scope][J.type][J.source]))return;const we=this.workerSources[Y][J.scope][J.type][J.source];delete this.workerSources[Y][J.scope][J.type][J.source],we.removeSource!==void 0?we.removeSource(J,he):he()}loadWorkerSource(Y,J,he){try{this.self.importScripts(J.url),he()}catch(we){he(we.toString())}}syncRTLPluginState(Y,J,he){try{n.e4.setState(J);const we=n.e4.getPluginURL();if(n.e4.isLoaded()&&!n.e4.isParsed()&&we!=null){this.self.importScripts(we);const xe=n.e4.isParsed();he(xe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${we}`),xe)}}catch(we){he(we.toString())}}setDracoUrl(Y,J){this.dracoUrl=J}getAvailableImages(Y,J){this.availableImages[Y]||(this.availableImages[Y]={});let he=this.availableImages[Y][J];return he||(he=[]),he}getLayerIndex(Y,J){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let he=this.layerIndexes[Y][J];return he||(he=this.layerIndexes[Y][J]=new Me,he.scope=J),he}getWorkerSource(Y,J,he,we){return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][we]||(this.workerSources[Y][we]={}),this.workerSources[Y][we][J]||(this.workerSources[Y][we][J]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.workerSources[Y][we][J][he]||(this.workerSources[Y][we][J][he]=new this.workerSourceTypes[J]({send:(xe,Le,qe,Fe,He,rt)=>{this.actor.send(xe,Le,qe,Y,He,rt)},scheduler:this.actor.scheduler},this.getLayerIndex(Y,we),this.getAvailableImages(Y,we),this.isSpriteLoaded[Y][we],void 0,this.brightness)),this.workerSources[Y][we][J][he]}getDEMWorkerSource(Y,J,he){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][he]||(this.demWorkerSources[Y][he]={}),this.demWorkerSources[Y][he][J]||(this.demWorkerSources[Y][he][J]=new Ve),this.demWorkerSources[Y][he][J]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new ht),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Y,J){n.e5(J)}getWorkerPerformanceMetrics(Y,J,he){he(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new qo(self)),qo}),N(["./shared"],function(n){var ne="3.7.0";const ae={create:"create",load:"load",fullLoad:"fullLoad"},ue={mark(c){performance.mark(c)},measure(c,t,r){performance.measure(c,t,r)}};function Me(c){const t=c.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var Be,st={},Qe=function(){if(Be)return st;function c(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,y,A=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(A);try{y=new Worker(C),_=!0}catch{_=!1}return y&&y.terminate(),URL.revokeObjectURL(C),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var y=_.getContext("2d");if(!y)return!1;var A=y.getImageData(0,0,1,1);return A&&A.width===_.width}()?(r[p=u&&u.failIfMajorPerformanceCaveat]===void 0&&(r[p]=function(_){var y,A=function(C){var L=document.createElement("canvas"),D=Object.create(c.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=C,L.getContext("webgl2",D)}(_);if(!A)return!1;try{y=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!y||A.isContextLost())&&(A.shaderSource(y,"void main() {}"),A.compileShader(y),A.getShaderParameter(y,A.COMPILE_STATUS)===!0)}(p)),r[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}Be=1,st.supported=c,st.notSupportedReason=t;var r={};return c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},st}();function Xe(c,t,r){const u=document.createElement(c);return t!=null&&(u.className=t),r&&r.appendChild(u),u}function Ne(c,t,r){const u=document.createElementNS("http://www.w3.org/2000/svg",c);for(const p of Object.keys(t))u.setAttributeNS(null,p,String(t[p]));return r&&r.appendChild(u),u}const Ve=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ht=Ve&&Ve.userSelect!==void 0?"userSelect":"WebkitUserSelect";let nt;function ft(){Ve&&ht&&(nt=Ve[ht],Ve[ht]="none")}function Bt(){Ve&&ht&&(Ve[ht]=nt)}function Et(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",Et,!0)}function zt(){window.addEventListener("click",Et,!0),window.setTimeout(()=>{window.removeEventListener("click",Et,!0)},0)}function zi(c,t){const r=c.getBoundingClientRect();return jt(c,r,t)}function or(c,t){const r=c.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(jt(c,r,t[p]));return u}function $t(c){return window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function jt(c,t,r){const u=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new n.P((r.clientX-t.left)*u,(r.clientY-t.top)*u)}const Pr="01",un="NO_ACCESS_TOKEN";class Mn{constructor(t,r,u){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=function(){let r="";for(let u=0;u<10;u++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Pr,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!n.f(t))return t;const u=Ii(t);return u.params.push(`sdk=js-${ne}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!n.f(t))return t;const u=Ii(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeModelURL(t,r){if(!n.f(t))return t;const u=Ii(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeSourceURL(t,r,u,p){if(!n.f(t))return t;const _=Ii(t);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),u&&_.params.push(`language=${u}`),p&&_.params.push(`worldview=${p}`),this._makeAPIURL(_,this._customAccessToken||r)}normalizeSpriteURL(t,r,u,p){const _=Ii(t);return n.f(t)?(_.path=`/styles/v1${_.path}/sprite${r}${u}`,this._makeAPIURL(_,this._customAccessToken||p)):(_.path+=`${r}${u}`,Oi(_))}normalizeTileURL(t,r,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.f(t))return t;const p=Ii(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||u&&p.authority!=="raster"&&u===512?"@2x":""}${n.m.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${n.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${n.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${n.e.TILE_URL_VERSION}${p.path}`);const _=this._customAccessToken||function(y){for(const A of y){const C=A.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(p.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,_)}canonicalizeTileURL(t,r){const u=Ii(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let p="mapbox://";u.path.match(/^\/raster\/v1\//)?p+=`raster/${u.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${u.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${u.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let _=u.params;return r&&(_=_.filter(y=>!y.match(/^access_token=/))),_.length&&(p+=`?${_.join("&")}`),p}canonicalizeTileset(t,r){const u=!!r&&n.f(r),p=[];for(const _ of t.tiles||[])n.h(_)?p.push(this.canonicalizeTileURL(_,u)):p.push(_);return p}_makeAPIURL(t,r){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=Ii(n.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return Oi(t);if(r=r||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(_=>_.indexOf("access_token")===-1),t.params.push(`access_token=${r||""}`),Oi(t)}}const Jt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ii(c){const t=c.match(Jt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Oi(c){const t=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${t}`}const Sr="mapbox.eventData";function ei(c){if(!c)return null;const t=c.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.j(t[1]))}catch{return null}}class Vr{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=ei(n.e.ACCESS_TOKEN);let u="";return u=r&&r.u?n.k(r.u):n.e.ACCESS_TOKEN||"",t?`${Sr}.${t}:${u}`:`${Sr}:${u}`}fetchEventData(){const t=n.s("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const p=localStorage.getItem(r);p&&(this.eventData=JSON.parse(p));const _=localStorage.getItem(u);_&&(this.anonId=_)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){const t=n.s("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.anonId;if(t&&p)try{localStorage.setItem(u,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,u,p){if(!n.e.EVENTS_URL)return;const _=Ii(n.e.EVENTS_URL);_.params.push(`access_token=${p||n.e.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(t).toISOString()},A=r?n.l(y,r):y,C={url:Oi(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=n.p(C,L=>{this.pendingRequest=null,u(L),this.saveEventData(),this.processRequests(p)})}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const Or=new class extends Vr{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(c)&&c.some(r=>n.f(r)||n.h(r))&&this.queueRequest(Date.now(),t)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=ei(n.e.ACCESS_TOKEN),r=t?t.u:n.e.ACCESS_TOKEN;let u=r!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),y=new Date(p),A=(p-this.eventData.lastSuccess)/864e5;u=u||A>=1||A<-1||_.getDate()!==y.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ne,skuId:Pr,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=p,this.eventData.tokenU=r)},c):this.processRequests()}},_n=Or.postTurnstileEvent.bind(Or),ti=new class extends Vr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,t,r,u){this.skuToken=t,this.errorCb=u,n.e.EVENTS_URL&&(r||n.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(un)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ne,skuId:Pr,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c))}remove(){this.errorCb=null}},Yn=ti.postMapLoadEvent.bind(ti),gr=new class extends Vr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(c){let t=this.mapInstanceIdMap.get(c);return t||(t=n.u(),this.mapInstanceIdMap.set(c,t)),t}getEventId(c){const t=this.eventIdPerMapInstanceMap.get(c)||0;return this.eventIdPerMapInstanceMap.set(c,t+1),t}postStyleLoadEvent(c,t){const{map:r,style:u,importedStyles:p}=t;if(!n.e.EVENTS_URL||!c&&!n.e.ACCESS_TOKEN)return;const _=this.getMapInstanceId(r),y={mapInstanceId:_,eventId:this.getEventId(_),style:u};p.length&&(y.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:y},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,()=>{},c)}},Tt=gr.postStyleLoadEvent.bind(gr),Kt=new class extends Vr{constructor(){super("gljs.performance")}postPerformanceEvent(c,t){n.e.EVENTS_URL&&(c||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),u=function(p){const _=performance.getEntriesByType("resource"),y=performance.getEntriesByType("mark"),A=function(V){const q={};if(V){for(const W in V)if(W!=="other")for(const Z of V[W]){const X=`${W}ResolveRangeMin`,ie=`${W}ResolveRangeMax`,se=`${W}RequestCount`,ee=`${W}RequestCachedCount`;q[X]=Math.min(q[X]||1/0,Z.startTime),q[ie]=Math.max(q[ie]||-1/0,Z.responseEnd);const ce=le=>{q[le]===void 0&&(q[le]=0),++q[le]};Z.transferSize!==void 0&&Z.transferSize===0&&ce(ee),ce(se)}}return q}(function(V,q){const W={};if(V)for(const Z of V){const X=q(Z);W[X]===void 0&&(W[X]=[]),W[X].push(Z)}return W}(_,Me)),C=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=L?L.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},B=(V,q,W)=>{W!=null&&V.push({name:q,value:W.toString()})};for(const V in A)B(F.counters,V,A[V]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(B(F.counters,"interactionRangeMin",p.interactionRange[0]),B(F.counters,"interactionRangeMax",p.interactionRange[1])),y)for(const V of Object.keys(ae)){const q=ae[V],W=y.find(Z=>Z.name===q);W&&B(F.counters,q,W.startTime)}return B(F.counters,"visibilityHidden",p.visibilityHidden),B(F.attributes,"style",function(V){if(V)for(const q of V){const W=q.name.split("?")[0];if(n.i(W)){const Z=W.split("/").slice(-2);if(Z.length===2)return`mapbox://styles/${Z[0]}/${Z[1]}`}}}(_)),B(F.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),B(F.attributes,"fogEnabled",p.fogEnabled?"true":"false"),B(F.attributes,"projection",p.projection),B(F.attributes,"zoom",p.zoom),B(F.metadata,"devicePixelRatio",C),B(F.metadata,"connectionEffectiveType",D),B(F.metadata,"navigatorUserAgent",navigator.userAgent),B(F.metadata,"screenWidth",window.screen.width),B(F.metadata,"screenHeight",window.screen.height),B(F.metadata,"windowWidth",window.innerWidth),B(F.metadata,"windowHeight",window.innerHeight),B(F.metadata,"mapWidth",p.width/C),B(F.metadata,"mapHeight",p.height/C),B(F.metadata,"webglRenderer",p.renderer),B(F.metadata,"webglVendor",p.vendor),B(F.metadata,"sdkVersion",ne),B(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(r);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,()=>{},c)}},Zt=Kt.postPerformanceEvent.bind(Kt),ni=new class extends Vr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,t,r,u){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const p=Ii(n.e.API_URL+n.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||n.e.ACCESS_TOKEN||""}`);const _={url:Oi(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(_,y=>{this.pendingRequest=null,r(y),this.saveEventData(),this.processRequests(u)})}getSessionAPI(c,t,r,u){this.skuToken=t,this.errorCb=u,n.e.SESSION_PATH&&n.e.API_URL&&(r||n.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(un)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c)}remove(){this.errorCb=null}},ge=ni.getSessionAPI.bind(ni),Ki=new Set;function Ae(c,t){t?Ki.add(c):Ki.delete(c)}class ke{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,r){this._updatedSourceCaches[t]=r,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id),this.setDirty()}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Se(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ct extends n.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new n.r({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,r){if(this.loaded[r]!==t&&(this.loaded[r]=t,t)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,r,p);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images[r][t]}addImage(t,r,u){this._validate(t,u)&&(this.images[r][t]=u)}_validate(t,r){let u=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(r.content,r)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,r){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||r<p[1])return!1;u=p[1]}return!0}_validateContent(t,r){return!(t&&(t.length!==4||t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,r,u){u.version=this.images[r][t].version+1,this.images[r][t]=u,this.updatedImages[r][t]=!0}removeImage(t,r){const u=this.images[r][t];delete this.images[r][t],delete this.patterns[r][t],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,r,u){let p=!0;const _=!!this.loaded[r];if(!_)for(const y of t)this.images[r][y]||(p=!1);_||p?this._notify(t,r,u):this.requestors.push({ids:t,scope:r,callback:u})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,r,u){const p={};for(const _ of t){this.images[r][_]||this.fire(new n.x("styleimagemissing",{id:_}));const y=this.images[r][_];y?p[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:n.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,p)}getPixelSize(t){const{width:r,height:u}=this.atlasImage[t];return{width:r,height:u}}getPattern(t,r,u){const p=this.patterns[r][t],_=this.getImage(t,r);if(!_)return null;if(p&&p.position.version===_.version)return p.position;if(p)p.position.version=_.version;else{const y={w:_.data.width+2*n.y,h:_.data.height+2*n.y,x:0,y:0},A=new n.I(y,_,n.y);this.patterns[r][t]={bin:y,position:A}}return this._updatePatternAtlas(r,u),this.patterns[r][t].position}bind(t,r){const u=t.gl;let p=this.atlasTexture[r];p?this.dirty&&(p.update(this.atlasImage[r]),this.dirty=!1):(p=new n.T(t,this.atlasImage[r],u.RGBA8),this.atlasTexture[r]=p),p.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const u=[];for(const A in this.patterns[t])u.push(this.patterns[t][A].bin);const{w:p,h:_}=n.z(u),y=this.atlasImage[t];y.resize({width:p||1,height:_||1});for(const A in this.patterns[t]){const{bin:C,position:L}=this.patterns[t][A];let D=L.padding;const F=C.x+D,B=C.y+D,V=this.images[t][A].data,q=V.width,W=V.height;D=D>1?D-1:D,n.r.copy(V,y,{x:0,y:0},{x:F,y:B},{width:q,height:W},r),n.r.copy(V,y,{x:0,y:W-D},{x:F,y:B-D},{width:q,height:D},r),n.r.copy(V,y,{x:0,y:0},{x:F,y:B+W},{width:q,height:D},r),n.r.copy(V,y,{x:q-D,y:0},{x:F-D,y:B},{width:D,height:W},r),n.r.copy(V,y,{x:0,y:0},{x:F+q,y:B},{width:D,height:W},r),n.r.copy(V,y,{x:q-D,y:W-D},{x:F-D,y:B-D},{width:D,height:D},r),n.r.copy(V,y,{x:0,y:W-D},{x:F+q,y:B-D},{width:D,height:D},r),n.r.copy(V,y,{x:0,y:0},{x:F+q,y:B+W},{width:D,height:D},r),n.r.copy(V,y,{x:q-D,y:0},{x:F-D,y:B+W},{width:D,height:D},r)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,r){for(const u of t){if(this.callbackDispatchedThisFrame[r][u])continue;this.callbackDispatchedThisFrame[r][u]=!0;const p=this.images[r][u];Se(p)&&this.updateImage(u,r,p)}}}function _t(c){const t=c.key,r=c.value,u=c.valueSpec||{},p=c.objectElementValidators||{},_=c.style,y=c.styleSpec;let A=[];const C=n.B(r);if(C!=="object")return[new n.V(t,r,`object expected, ${C} found`)];for(const L in r){const D=L.split(".")[0];let F;p[D]?F=p[D]:u[D]?F=ki:p["*"]?F=p["*"]:u["*"]&&(F=ki),F?A=A.concat(F({key:(t&&`${t}.`)+L,value:r[L],valueSpec:u[D]||u["*"],style:_,styleSpec:y,object:r,objectKey:L},r)):A.push(new n.A(t,r[L],`unknown property "${L}"`))}for(const L in u)p[L]||u[L].required&&u[L].default===void 0&&r[L]===void 0&&A.push(new n.V(t,r,`missing required property "${L}"`));return A}function ve(c){const t=c.value,r=c.valueSpec,u=c.style,p=c.styleSpec,_=c.key,y=c.arrayElementValidator||ki;if(n.B(t)!=="array")return[new n.V(_,t,`array expected, ${n.B(t)} found`)];if(r.length&&t.length!==r.length)return[new n.V(_,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new n.V(_,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let A={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};p.$version<7&&(A.function=r.function),n.B(r.value)==="object"&&(A=r.value);let C=[];for(let L=0;L<t.length;L++)C=C.concat(y({array:t,arrayIndex:L,value:t[L],valueSpec:A,style:u,styleSpec:p,key:`${_}[${L}]`},!0));return C}function _e(c){const t=c.key,r=c.value,u=c.valueSpec;let p=n.B(r);if(p==="number"&&r!=r&&(p="NaN"),p!=="number")return[new n.V(t,r,`number expected, ${p} found`)];if("minimum"in u){let _=u.minimum;if(n.B(u.minimum)==="array"&&(_=u.minimum[c.arrayIndex]),r<_)return[new n.V(t,r,`${r} is less than the minimum value ${_}`)]}if("maximum"in u){let _=u.maximum;if(n.B(u.maximum)==="array"&&(_=u.maximum[c.arrayIndex]),r>_)return[new n.V(t,r,`${r} is greater than the maximum value ${_}`)]}return[]}function Ze(c){const t=c.valueSpec,r=n.D(c.value.type);let u,p,_,y={};const A=r!=="categorical"&&c.value.property===void 0,C=!A,L=n.B(c.value.stops)==="array"&&n.B(c.value.stops[0])==="array"&&n.B(c.value.stops[0][0])==="object",D=_t({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(V){if(r==="identity")return[new n.V(V.key,V.value,'identity function may not have a "stops" property')];let q=[];const W=V.value;return q=q.concat(ve({key:V.key,value:W,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:F})),n.B(W)==="array"&&W.length===0&&q.push(new n.V(V.key,W,"array must have at least one stop")),q},default:function(V){return ki({key:V.key,value:V.value,valueSpec:t,style:V.style,styleSpec:V.styleSpec})}}});return r==="identity"&&A&&D.push(new n.V(c.key,c.value,'missing required property "property"')),r==="identity"||c.value.stops||D.push(new n.V(c.key,c.value,'missing required property "stops"')),r==="exponential"&&c.valueSpec.expression&&!n.F(c.valueSpec)&&D.push(new n.V(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(C&&!n.G(c.valueSpec)?D.push(new n.V(c.key,c.value,"property functions not supported")):A&&!n.H(c.valueSpec)&&D.push(new n.V(c.key,c.value,"zoom functions not supported"))),r!=="categorical"&&!L||c.value.property!==void 0||D.push(new n.V(c.key,c.value,'"property" property is required')),D;function F(V){let q=[];const W=V.value,Z=V.key;if(n.B(W)!=="array")return[new n.V(Z,W,`array expected, ${n.B(W)} found`)];if(W.length!==2)return[new n.V(Z,W,`array length 2 expected, length ${W.length} found`)];if(L){if(n.B(W[0])!=="object")return[new n.V(Z,W,`object expected, ${n.B(W[0])} found`)];if(W[0].zoom===void 0)return[new n.V(Z,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new n.V(Z,W,"object stop key must have value")];const X=n.D(W[0].zoom);if(typeof X!="number")return[new n.V(Z,W[0].zoom,"stop zoom values must be numbers")];if(_&&_>X)return[new n.V(Z,W[0].zoom,"stop zoom values must appear in ascending order")];X!==_&&(_=X,p=void 0,y={}),q=q.concat(_t({key:`${Z}[0]`,value:W[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:_e,value:B}}))}else q=q.concat(B({key:`${Z}[0]`,value:W[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},W));return n.J(n.K(W[1]))?q.concat([new n.V(`${Z}[1]`,W[1],"expressions are not allowed in function stops.")]):q.concat(ki({key:`${Z}[1]`,value:W[1],valueSpec:t,style:V.style,styleSpec:V.styleSpec}))}function B(V,q){const W=n.B(V.value),Z=n.D(V.value),X=V.value!==null?V.value:q;if(u){if(W!==u)return[new n.V(V.key,X,`${W} stop domain type must match previous stop domain type ${u}`)]}else u=W;if(W!=="number"&&W!=="string"&&W!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new n.V(V.key,X,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&r!=="categorical"){let ie=`number expected, ${W} found`;return n.G(t)&&r===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(V.key,X,ie)]}return r!=="categorical"||W!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?r!=="categorical"&&W==="number"&&typeof Z=="number"&&typeof p=="number"&&p!==void 0&&Z<p?[new n.V(V.key,X,"stop domain values must appear in ascending order")]:(p=Z,r==="categorical"&&Z in y?[new n.V(V.key,X,"stop domain values must be unique")]:(y[Z]=!0,[])):[new n.V(V.key,X,`integer expected, found ${String(Z)}`)]}}function pt(c){const t=(c.expressionContext==="property"?n.L:n.M)(n.K(c.value),c.valueSpec);if(t.result==="error")return t.value.map(u=>new n.V(`${c.key}${u.key}`,c.value,u.message));const r=t.value.expression||t.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!r.outputDefined())return[new n.V(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!n.N(r))return[new n.V(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return It(r,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!n.O(r,["zoom","feature-state"]))return[new n.V(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!n.Q(r))return[new n.V(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function It(c,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)r.delete(p);if(r.size===0)return[];const u=[];return c instanceof n.S&&r.has(c.name)?[new n.V(t.key,t.value,`["${c.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(c.eachChild(p=>{u.push(...It(p,t))}),u)}function Ut(c){const t=c.key,r=c.value,u=c.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(n.D(r))===-1&&p.push(new n.V(t,r,`expected one of [${u.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(u.values).indexOf(n.D(r))===-1&&p.push(new n.V(t,r,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function Ge(c){return n.W(n.K(c.value))?pt(n.C({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):$e(c)}function $e(c){const t=c.value,r=c.key;if(n.B(t)!=="array")return[new n.V(r,t,`array expected, ${n.B(t)} found`)];const u=c.styleSpec;let p,_=[];if(t.length<1)return[new n.V(r,t,"filter array must have at least 1 element")];switch(_=_.concat(Ut({key:`${r}[0]`,value:t[0],valueSpec:u.filter_operator,style:c.style,styleSpec:c.styleSpec})),n.D(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.D(t[1])==="$type"&&_.push(new n.V(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new n.V(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=n.B(t[1]),p!=="string"&&_.push(new n.V(`${r}[1]`,t[1],`string expected, ${p} found`)));for(let y=2;y<t.length;y++)p=n.B(t[y]),n.D(t[1])==="$type"?_=_.concat(Ut({key:`${r}[${y}]`,value:t[y],valueSpec:u.geometry_type,style:c.style,styleSpec:c.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new n.V(`${r}[${y}]`,t[y],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)_=_.concat($e({key:`${r}[${y}]`,value:t[y],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":p=n.B(t[1]),t.length!==2?_.push(new n.V(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new n.V(`${r}[1]`,t[1],`string expected, ${p} found`))}return _}function Xt(c,t){const r=c.key,u=c.style,p=c.layer,_=c.styleSpec,y=c.value,A=c.objectKey,C=_[`${t}_${c.layerType}`];if(!C)return[];const L=A.match(/^(.*)-transition$/);if(t==="paint"&&L&&C[L[1]]&&C[L[1]].transition)return ki({key:r,value:y,valueSpec:_.transition,style:u,styleSpec:_});const D=c.valueSpec||C[A];if(!D)return[new n.A(r,y,`unknown property "${A}"`)];let F;if(n.B(y)==="string"&&n.G(D)&&!D.tokens&&(F=/^{([^}]+)}$/.exec(y))){const V=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new n.V(r,y,`"${A}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}const B=[];if(c.layerType==="symbol")A!=="text-field"||!u||u.glyphs||u.imports||B.push(new n.V(r,y,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&n.X(n.K(y))&&n.D(y.type)==="identity"&&B.push(new n.V(r,y,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&n.G(D)&&(n.Y(D)||n.H(D))){const V=n.L(n.K(y),D),q=V.value.expression||V.value._styleExpression.expression;q&&!n.O(q,["measure-light"])&&(A==="model-emissive-strength"&&n.Q(q)&&n.N(q)||B.push(new n.V(r,y,`${A} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return B.concat(ki({key:c.key,value:y,valueSpec:D,style:u,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:A}))}function li(c){return Xt(c,"paint")}function Ui(c){return Xt(c,"layout")}function Si(c){let t=[];const r=c.value,u=c.key,p=c.style,_=c.styleSpec;r.type||r.ref||t.push(new n.V(u,r,'either "type" or "ref" is required'));let y=n.D(r.type);const A=n.D(r.ref);if(r.id){const C=n.D(r.id);for(let L=0;L<c.arrayIndex;L++){const D=p.layers[L];n.D(D.id)===C&&t.push(new n.V(u,r.id,`duplicate layer id "${r.id}", previously used at line ${D.id.__line__}`))}}if("ref"in r){let C;["type","source","source-layer","filter","layout"].forEach(L=>{L in r&&t.push(new n.V(u,r[L],`"${L}" is prohibited for ref layers`))}),p.layers.forEach(L=>{n.D(L.id)===A&&(C=L)}),C?C.ref?t.push(new n.V(u,r.ref,"ref cannot reference another ref layer")):y=n.D(C.type):typeof A=="string"&&t.push(new n.V(u,r.ref,`ref layer "${A}" not found`))}else if(y!=="background"&&y!=="sky"&&y!=="slot")if(r.source){const C=p.sources&&p.sources[r.source],L=C&&n.D(C.type);C?L==="vector"&&y==="raster"?t.push(new n.V(u,r.source,`layer "${r.id}" requires a raster source`)):L==="raster"&&y!=="raster"?t.push(new n.V(u,r.source,`layer "${r.id}" requires a vector source`)):L!=="vector"||r["source-layer"]?L==="raster-dem"&&y!=="hillshade"?t.push(new n.V(u,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(y)?y!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||L==="geojson"&&C.lineMetrics?y==="raster-particle"&&L!=="raster-array"&&t.push(new n.V(u,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):t.push(new n.V(u,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new n.V(u,r.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(u,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new n.V(u,r.source,`source "${r.source}" not found`))}else t.push(new n.V(u,r,'missing required property "source"'));return t=t.concat(_t({key:u,value:r,valueSpec:_.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ki({key:`${u}.type`,value:r.type,valueSpec:_.layer.type,style:c.style,styleSpec:c.styleSpec,object:r,objectKey:"type"}),filter:C=>Ge(n.C({layerType:y},C)),layout:C=>_t({layer:r,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":L=>Ui(n.C({layerType:y},L))}}),paint:C=>_t({layer:r,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":L=>li(n.C({layerType:y,layer:r},L))}})}})),t}function sr(c){const t=c.value,r=c.key,u=n.B(t);return u!=="string"?[new n.V(r,t,`string expected, ${u} found`)]:[]}const kr={promoteId:function({key:c,value:t}){if(n.B(t)==="string")return sr({key:c,value:t});{const r=[];for(const u in t)r.push(...sr({key:`${c}.${u}`,value:t[u]}));return r}}};function hn(c){const t=c.value,r=c.key,u=c.styleSpec,p=c.style;if(!t.type)return[new n.V(r,t,'"type" is required')];const _=n.D(t.type);let y=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&(t.url||t.tiles||y.push(new n.A(r,t,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return y=y.concat(_t({key:r,value:t,valueSpec:u[`source_${_.replace("-","_")}`],style:c.style,styleSpec:u,objectElementValidators:kr})),y;case"geojson":if(y=_t({key:r,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:kr}),t.cluster)for(const A in t.clusterProperties){const[C,L]=t.clusterProperties[A],D=typeof C=="string"?[C,["accumulated"],["get",A]]:C;y.push(...pt({key:`${r}.${A}.map`,value:L,expressionContext:"cluster-map"})),y.push(...pt({key:`${r}.${A}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return y;case"video":return _t({key:r,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return _t({key:r,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new n.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ut({key:`${r}.type`,value:t.type,valueSpec:{values:en(u)},style:p,styleSpec:u})}}function en(c){return c.source.reduce((t,r)=>{const u=c[r];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function Cn(c){const t=c.value,r=c.styleSpec,u=r.light,p=c.style;let _=[];const y=n.B(t);if(t===void 0)return _;if(y!=="object")return _=_.concat([new n.V("light",t,`object expected, ${y} found`)]),_;for(const A in t){const C=A.match(/^(.*)-transition$/);_=_.concat(C&&u[C[1]]&&u[C[1]].transition?ki({key:A,value:t[A],valueSpec:r.transition,style:p,styleSpec:r}):u[A]?ki({key:A,value:t[A],valueSpec:u[A],style:p,styleSpec:r}):[new n.V(A,t[A],`unknown property "${A}"`)])}return _}function zs(c){const t=c.value;let r=[];if(!t)return r;const u=n.B(t);if(u!=="object")return r=r.concat([new n.V("light-3d",t,`object expected, ${u} found`)]),r;const p=c.styleSpec,_=p["light-3d"],y=c.key,A=c.style,C=c.style.lights;for(const F of["type","id"])if(!(F in t))return r=r.concat([new n.V("light-3d",t,`missing property ${F} on light`)]),r;if(t.type&&C)for(let F=0;F<c.arrayIndex;F++){const B=n.D(t.type),V=C[F];n.D(V.type)===B&&r.push(new n.V(y,t.id,`duplicate light type "${t.type}", previously defined at line ${V.id.__line__}`))}const L=`properties_light_${t.type}`;if(!(L in p))return r=r.concat([new n.V("light-3d",t,`Invalid light type ${t.type}`)]),r;const D=p[L];for(const F in t)if(F==="properties"){const B=t[F],V=n.B(B);if(V!=="object")return r=r.concat([new n.V("properties",B,`object expected, ${V} found`)]),r;for(const q in B)r=r.concat(D[q]?ki({key:q,value:B[q],valueSpec:D[q],style:A,styleSpec:p}):[new n.A(c.key,B[q],`unknown property "${q}"`)])}else{const B=F.match(/^(.*)-transition$/);r=r.concat(B&&_[B[1]]&&_[B[1]].transition?ki({key:F,value:t[F],valueSpec:p.transition,style:A,styleSpec:p}):_[F]?ki({key:F,value:t[F],valueSpec:_[F],style:A,styleSpec:p}):[new n.A(F,t[F],`unknown property "${F}"`)])}return r}function tn(c){const t=c.value,r=c.key,u=c.style,p=c.styleSpec,_=p.terrain;let y=[];const A=n.B(t);if(t===void 0||A==="null")return y;if(A!=="object")return y=y.concat([new n.V("terrain",t,`object expected, ${A} found`)]),y;for(const C in t){const L=C.match(/^(.*)-transition$/);y=y.concat(L&&_[L[1]]&&_[L[1]].transition?ki({key:C,value:t[C],valueSpec:p.transition,style:u,styleSpec:p}):_[C]?ki({key:C,value:t[C],valueSpec:_[C],style:u,styleSpec:p}):[new n.A(C,t[C],`unknown property "${C}"`)])}if(t.source){const C=u.sources&&u.sources[t.source],L=C&&n.D(C.type);C?L!=="raster-dem"&&y.push(new n.V(r,t.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):y.push(new n.V(r,t.source,`source "${t.source}" not found`))}else y.push(new n.V(r,t,'terrain is missing required property "source"'));return y}function jr(c){const t=c.value,r=c.style,u=c.styleSpec,p=u.fog;let _=[];const y=n.B(t);if(t===void 0)return _;if(y!=="object")return _=_.concat([new n.V("fog",t,`object expected, ${y} found`)]),_;for(const A in t){const C=A.match(/^(.*)-transition$/);_=_.concat(C&&p[C[1]]&&p[C[1]].transition?ki({key:A,value:t[A],valueSpec:u.transition,style:r,styleSpec:u}):p[A]?ki({key:A,value:t[A],valueSpec:p[A],style:r,styleSpec:u}):[new n.A(A,t[A],`unknown property "${A}"`)])}return _}const vo={"*":()=>[],array:ve,boolean:function(c){const t=c.value,r=c.key,u=n.B(t);return u!=="boolean"?[new n.V(r,t,`boolean expected, ${u} found`)]:[]},number:_e,color:function(c){const t=c.key,r=c.value,u=n.B(r);return u!=="string"?[new n.V(t,r,`color expected, ${u} found`)]:n.U.parseCSSColor(r)===null?[new n.V(t,r,`color expected, "${r}" found`)]:[]},enum:Ut,filter:Ge,function:Ze,layer:Si,object:_t,source:hn,model:n.Z,light:Cn,"light-3d":zs,terrain:tn,fog:jr,string:sr,formatted:function(c){return sr(c).length===0?[]:pt(c)},resolvedImage:function(c){return sr(c).length===0?[]:pt(c)},projection:function(c){const t=c.value,r=c.styleSpec,u=r.projection,p=c.style;let _=[];const y=n.B(t);if(y==="object")for(const A in t)_=_.concat(ki({key:A,value:t[A],valueSpec:u[A],style:p,styleSpec:r}));else y!=="string"&&(_=_.concat([new n.V("projection",t,`object or string expected, ${y} found`)]));return _},import:function(c){const{value:t,styleSpec:r}=c,{data:u,...p}=t;Object.defineProperty(p,"__line__",{value:t.__line__,enumerable:!1});let _=_t(n.C({},c,{value:p,valueSpec:r.import}));return n.D(p.id)===""&&_.push(new n.V(`${c.key}.id`,p,"import id can't be an empty string")),u&&(_=_.concat(Cc(u,r,{key:`${c.key}.data`}))),_}};function ki(c,t=!1){const r=c.value,u=c.valueSpec,p=c.styleSpec;if(u.expression&&n.X(n.D(r)))return Ze(c);if(u.expression&&n.J(n.K(r)))return pt(c);if(u.type&&vo[u.type]){const _=vo[u.type](c);return t===!0&&_.length>0&&n.B(c.value)==="array"?pt(c):_}return _t(n.C({},c,{valueSpec:u.type?p[u.type]:u}))}function Os(c){const t=c.value,r=c.key,u=sr(c);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new n.V(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new n.V(r,t,'"glyphs" url must include a "{range}" token'))),u}function Cc(c,t=n._,r={}){return ki({key:r.key||"",value:c,valueSpec:t.$root,styleSpec:t,style:c,objectElementValidators:{glyphs:Os,"*":()=>[]}})}function Kn(c,t=n._){return xe(Cc(c,t))}const $o=c=>xe(hn(c)),Al=c=>xe(Cn(c)),ya=c=>xe(zs(c)),Il=c=>xe(tn(c)),qo=c=>xe(jr(c)),We=c=>xe(Si(c)),Y=c=>xe(Ge(c)),J=c=>xe(li(c)),he=c=>xe(Ui(c)),we=c=>xe(n.Z(c));function xe(c){return c.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function Le(c,t){let r=!1;if(t&&t.length)for(const u of t)u instanceof n.A?n.w(u.message):(c.fire(new n.t(new Error(u.message))),r=!0);return r}let qe;class Fe extends n.E{constructor(t,r="flat"){super(),this._transitionable=new n.$(qe||(qe=new n.a0({anchor:new n.a1(n._.light.anchor),position:new n.a2(n._.light.position),color:new n.a1(n._.light.color),intensity:new n.a1(n._.light.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,u={}){this._validate(Al,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,u){return(!u||u.validate!==!1)&&Le(this,t.call(Kn,n.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}const He=new n.a0({source:new n.a1(n._.terrain.source),exaggeration:new n.a1(n._.terrain.exaggeration)});let rt=class extends n.E{constructor(c,t,r,u){super(),this.scope=r,this._transitionable=new n.$(He,r,u),this._transitionable.setTransitionOrValue(c,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(c,t){this._transitionable.setTransitionOrValue(c,t)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new n.a3(c)).get("exaggeration")}isZoomDependent(){const c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof n.a4}};const et=45,gt=65,Lt=.05;function Dt(c,t,r,u){const p=n.a7(et,gt,r),[_,y]=ci(c,u);let A=1-Math.min(1,Math.exp((t-_)/(y-_)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*p*c.alpha}function ci(c,t){const r=.5/Math.tan(.5*t);return[c.range[0]+r,c.range[1]+r]}function hi(c,t,r,u,p){const _=n.a6.vec3.transformMat4([],[t,r,u],p.mercatorFogMatrix);return Dt(c,n.a6.vec3.length(_),p.pitch,p._fov)}function fi(c,t,r,u,p,_,y){const A=[[r,u,0],[p,u,0],[p,_,0],[r,_,0]];let C=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const D of A){const F=n.a6.vec3.transformMat4([],D,t),B=n.a6.vec3.length(F);C=Math.min(C,B),L=Math.max(L,B)}return[Dt(c,C,y.pitch,y._fov),Dt(c,L,y.pitch,y._fov)]}const di=new n.a0({range:new n.a1(n._.fog.range),color:new n.a1(n._.fog.color),"high-color":new n.a1(n._.fog["high-color"]),"space-color":new n.a1(n._.fog["space-color"]),"horizon-blend":new n.a1(n._.fog["horizon-blend"]),"star-intensity":new n.a1(n._.fog["star-intensity"]),"vertical-range":new n.a1(n._.fog["vertical-range"])});class qi extends n.E{constructor(t,r,u,p){super(),this._transitionable=new n.$(di,u,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new n.a8(di),this.scope=u}get state(){const t=this._transform,r=t.projection.name==="globe",u=n.a9(t.zoom),p=this.properties.get("range"),_=[.5,3];return{range:r?[n.aa(_[0],p[0],u),n.aa(_[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r,u={}){if(this._validate(qo,t,u))return;const p=n.l({},t);for(const _ of Object.keys(n._.fog))p[_]===void 0&&(p[_]=n._.fog[_].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.a7(et,gt,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(u,p,_){const y=n.a5.fromLngLat(p),A=_.elevation?_.elevation.getAtPointOrZero(y):0;return hi(u,y.x,y.y,A,_)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return fi(this.state,r,0,0,n.ab,n.ab,this._transform)}getOpacityForBounds(t,r,u,p,_){return this._transform.projection.supportsFog?fi(this.state,t,r,u,p,_,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?ci(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const u of r){const p=t.points[u];let _;if(p[2]>=0)_=p;else{const y=t.points[u-4];_=n.ac(y,p,y[2]/(y[2]-p[2]))}if(hi(this.state,_[0],_[1],0,this._transform)>=Lt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,u){return(!u||u.validate!==!1)&&Le(this,t.call(Kn,n.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}class Ji extends n.E{constructor(t,r,u,p){super(),this.scope=u,this._options=t,this.properties=new n.a8(r),this._transitionable=new n.$(r,u,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let gi,Xi;class yr{constructor(t,r,u,p){this.screenBounds=t,this.cameraPoint=r,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,r){let u,p;if(t instanceof n.P||typeof t[0]=="number"){const _=n.P.convert(t);u=[_],p=r.isPointAboveHorizon(_)}else{const _=n.P.convert(t[0]),y=n.P.convert(t[1]);u=[_,y],p=n.ae(_,y).every(A=>r.isPointAboveHorizon(A))}return new yr(u,r.getCameraPoint(),p,r)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],p=n.ae(r,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(p[3]=this.cameraPoint)),n.af(p,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],p=n.ae(r,u,t),_=this.cameraPoint.clone();switch(3*((_.y>r.y)+(_.y>u.y))+((_.x>r.x)+(_.x>u.x))){case 0:p[0]=_,p[4]=_.clone();break;case 1:p.splice(1,0,_);break;case 2:p[1]=_;break;case 3:p.splice(4,0,_);break;case 5:p.splice(2,0,_);break;case 6:p[3]=_;break;case 7:p.splice(3,0,_);break;case 8:p[2]=_}return p}containsTile(t,r,u,p=0){const _=t.queryPadding/r._pixelsPerMercatorPixel+1,y=u?this._bufferedCameraMercator(_,r):this._bufferedScreenMercator(_,r);let A=t.tileID.wrap+(y.unwrapped?p:0);const C=y.polygon.map(Z=>n.ag(t.tileTransform,Z,A));if(!n.ah(C,0,0,n.ab,n.ab))return;A=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const L=this.screenGeometryMercator.polygon.map(Z=>n.ai(t.tileTransform,Z,A)),D=L.map(Z=>new n.P(Z[0],Z[1])),F=r.getFreeCameraOptions().position||new n.a5(0,0,0),B=n.ai(t.tileTransform,F,A),V=L.map(Z=>{const X=n.a6.vec3.sub(Z,Z,B);return n.a6.vec3.normalize(X,X),new n.aj(B,X)}),q=n.ak(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:V,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(W=n.al(C),W.min.x=n.ap(W.min.x,0,n.ab),W.min.y=n.ap(W.min.y,0,n.ab),W.max.x=n.ap(W.max.x,0,n.ab),W.max.y=n.ap(W.max.y,0,n.ab),W),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:q};var W}_bufferedScreenMercator(t,r){const u=dn(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=r.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map(_=>r.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,r){const u=dn(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=r.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map(_=>r.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(t,r){const u=function(_,y){const A=n.a6.mat4.multiply([],y.pixelMatrix,y.globeMatrix),C=[0,-n.aq,0,1],L=[0,n.aq,0,1],D=[0,0,0,1];n.a6.vec4.transformMat4(C,C,A),n.a6.vec4.transformMat4(L,L,A),n.a6.vec4.transformMat4(D,D,A);const F=new n.P(C[0]/C[3],C[1]/C[3]),B=new n.P(L[0]/L[3],L[1]/L[3]),V=n.an(_,F)&&C[3]<D[3],q=n.an(_,B)&&L[3]<D[3];if(!V&&!q)return null;const W=function(me,fe,ye){for(let Ie=1;Ie<me.length;Ie++){const Te=Xr(fe.pointCoordinate3D(me[Ie-1]).x),be=Xr(fe.pointCoordinate3D(me[Ie]).x);if(ye<0){if(Te<be)return{idx:Ie,t:-Te/(be-1-Te)}}else if(be<Te)return{idx:Ie,t:(1-Te)/(be+1-Te)}}return null}(_,y,V?-1:1);if(!W)return null;const{idx:Z,t:X}=W;let ie=Z>1?Wr(_.slice(0,Z),y):[],se=Z<_.length?Wr(_.slice(Z),y):[];ie=ie.map(me=>new n.P(Xr(me.x),me.y)),se=se.map(me=>new n.P(Xr(me.x),me.y));const ee=[...ie];ee.length===0&&ee.push(se[se.length-1]);const ce=n.aa(ee[ee.length-1].y,(se.length===0?ie[0]:se[0]).y,X);let le;return le=V?[new n.P(0,ce),new n.P(0,0),new n.P(1,0),new n.P(1,ce)]:[new n.P(1,ce),new n.P(1,1),new n.P(0,1),new n.P(0,ce)],ee.push(...le),se.length===0?ee.push(ie[0]):ee.push(...se),{polygon:ee.map(me=>new n.a5(me.x,me.y)),unwrapped:!1}}(t,r);if(u)return u;const p=function(_,y){let A=!1,C=-1/0,L=0;for(let F=0;F<_.length-1;F++)_[F].x>C&&(C=_[F].x,L=F);for(let F=0;F<_.length-1;F++){const B=(L+F)%(_.length-1),V=_[B],q=_[B+1];Math.abs(V.x-q.x)>.5&&(V.x<q.x?(V.x+=1,B===0&&(_[_.length-1].x+=1)):(q.x+=1,B+1===_.length-1&&(_[0].x+=1)),A=!0)}const D=n.am(y.center.lng);return A&&D<Math.abs(D-1)&&_.forEach(F=>{F.x-=1}),{polygon:_,unwrapped:A}}(Wr(t,r).map(_=>new n.P(Xr(_.x),_.y)),r);return{polygon:p.polygon.map(_=>new n.a5(_.x,_.y)),unwrapped:p.unwrapped}}}function Wr(c,t){return n.ao(c,r=>{const u=t.pointCoordinate3D(r);r.x=u.x,r.y=u.y},1/256)}function Xr(c){return c<0?1+c%1:c%1}function dn(c){return 100*c|0}function xs(c,t,r,u,p){const _=function(A,C){if(A)return p(A);if(C){if(c.url&&C.tiles&&c.tiles&&delete c.tiles,C.variants){if(!Array.isArray(C.variants))return p(new Error("variants must be an array"));for(const D of C.variants){if(D==null||typeof D!="object"||D.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(D.capabilities))return p(new Error("capabilities must be an array"));if(D.capabilities.length===1&&D.capabilities[0]==="meshopt"){C=n.l(C,D);break}}}const L=n.ar(n.l(C,c),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(L.vectorLayers=C.vector_layers,L.vectorLayerIds=L.vectorLayers.map(D=>D.id)),C.raster_layers&&(L.rasterLayers=C.raster_layers,L.rasterLayerIds=L.rasterLayers.map(D=>D.id)),L.tiles=t.canonicalizeTileset(L,c.url),p(null,L)}},y=function(A,C,L){if(!A)return null;if(!C&&!L)return A;L=L||A.worldview_default;const D=Object.values(A.language||{});if(D.length===0)return null;const F=Object.values(A.worldview||{});if(F.length===0)return null;const B=D.every(q=>q===C),V=F.every(q=>q===L);return B&&V?A:C in(A.language_options||{})||L in(A.worldview_options||{})?null:A.language_options&&A.worldview_options?A:null}(c.data,r,u);return y?n.q.frame(()=>_(null,y)):c.url?n.n(t.transformRequest(t.normalizeSourceURL(c.url,null,r,u),n.R.Source),_):n.q.frame(()=>{const{data:A,...C}=c;_(null,C)})}class Qs{constructor(t,r,u){this.bounds=n.as.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),u=Math.floor(n.am(this.bounds.getWest())*r),p=Math.floor(n.at(this.bounds.getNorth())*r),_=Math.ceil(n.am(this.bounds.getEast())*r),y=Math.ceil(n.at(this.bounds.getSouth())*r);return t.x>=u&&t.x<_&&t.y>=p&&t.y<y}}class Pc extends n.E{constructor(t,r,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.l(this,n.ar(r,["url","scheme","tileSize","promoteId"])),this._options=n.l({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new n.au}load(t){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=xs(this._options,this.map._requestManager,r,u,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new n.t(p))):_&&(n.l(this,_),_.bounds&&(this.tileBounds=new Qs(_.bounds,this.minzoom,this.maxzoom)),_n(_.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),t&&t(p)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}loadTile(t,r){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),p=this.map._requestManager.transformRequest(u,n.R.Tile),_=this.map.style?this.map.style.getLut(this.scope):null,y={request:p,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,lut:_?{image:_.image.clone()}:null,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(y.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",y,A.bind(this));else if(t.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",y,A.bind(this),void 0,!0);else{const C=n.aw.call({deduped:this._deduped},y,(L,D)=>{L||!D?A.call(this,L):(y.data={cacheControl:D.cacheControl,expires:D.expires,rawData:D.rawData.slice(0)},t.actor&&t.actor.send("loadTile",y,A.bind(this),void 0,!0))},!0);t.request={cancel:C}}function A(C,L){return delete t.request,t.aborted?r(null):C&&C.status!==404?r(C):(L&&L.resourceTiming&&(t.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&t.setExpiryData(L),t.loadVectorData(L,this.map.painter),n.ax(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ml extends n.E{constructor(t,r,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.l({type:"raster"},r),n.l(this,n.ar(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._tileJSONRequest=xs(this._options,this.map._requestManager,null,null,(r,u)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new n.t(r)):u&&(n.l(this,u),u.bounds&&(this.tileBounds=new Qs(u.bounds,this.minzoom,this.maxzoom)),_n(u.tiles),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const u=n.q.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=n.o(this.map._requestManager.transformRequest(p,n.R.Tile),(_,y,A,C)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):_?(t.state="errored",r(_)):y?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:A,expires:C}),t.setTexture(y,this.map.painter),t.state="loaded",n.ax(this.dispatcher),void r(null)):r(null)))}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r&&r()}unloadTile(t,r){t.texture&&t.texture instanceof n.T?(t.destroy(!0),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xa extends Ml{constructor(t,r,u,p){super(t,r,u,p),this.type="raster-array",this.maxzoom=22,this._options=n.l({type:"raster-array"},r)}triggerRepaint(t){const r=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);r&&r.enabled&&u&&r._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,r){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,n.R.Tile);t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(_,y,A,C)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(_)return _.code===20?void 0:(t.state="errored",r(_));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:A,expires:C}),t.state="empty",r(null)})}unloadTile(t,r){const u=t.texture;u&&u instanceof n.T?(t.destroy(!0),this.map.painter.saveTileTexture(u)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,r,u){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(r,u,(p,_)=>{if(p)return t.state="errored",this.fire(new n.t(p)),void this.triggerRepaint(t);_&&(t.setTexture(_,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const r=this.rasterLayers.find(({id:_})=>_===t),u=r&&r.fields,p=u&&u.bands&&u.bands;return p?p[0]:0}getTextureDescriptor(t,r,u){if(!t)return;const p=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let _=null;r instanceof n.aB?_=r.paint.get("raster-array-band"):r instanceof n.aC&&(_=r.paint.get("raster-particle-array-band"));const y=_||this.getInitialBand(p);if(y!=null)if(t.textureDescriptor){if(!t.updateNeeded(p,y)||u)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,p,y)}}const Rc={vector:Pc,raster:Ml,"raster-dem":class extends Ml{constructor(c,t,r,u){super(c,t,r,u),this.type="raster-dem",this.maxzoom=22,this._options=n.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,_){p&&(c.state="errored",t(p)),_&&(c.dem=_,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=n.o(this.map._requestManager.transformRequest(r,n.R.Tile),(function(p,_,y,A){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(p)c.state="errored",t(p);else if(_){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:y,expires:A});const C=ImageBitmap&&_ instanceof ImageBitmap&&n.ay(),L=1-(_.width-n.az(_.width))/2;L<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const D=C?_:n.q.getImageData(_,L),F={uid:c.uid,coord:c.tileID,source:this.id,scope:this.scope,rawImageData:D,encoding:this.encoding,padding:L};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",F,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){const t=c.canonical,r=Math.pow(2,t.z),u=(t.x-1+r)%r,p=t.x===0?c.wrap-1:c.wrap,_=(t.x+1+r)%r,y=t.x+1===r?c.wrap+1:c.wrap,A={};return A[new n.aA(c.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},A[new n.aA(c.overscaledZ,y,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(A[new n.aA(c.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},A[new n.aA(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},A[new n.aA(c.overscaledZ,y,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<r&&(A[new n.aA(c.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},A[new n.aA(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},A[new n.aA(c.overscaledZ,y,t.z,_,t.y+1).key]={backfilled:!1}),A}},"raster-array":xa,geojson:class extends n.E{constructor(c,t,r,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(u),this._data=t.data,this._options=n.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=n.ab/this.tileSize;this.workerOptions=n.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:n.ab,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.ab,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){if(!this._options.dynamic)return this.fire(new n.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof c!="string"&&(c.type==="Feature"&&(c={type:"FeatureCollection",features:[c]}),c.type!=="FeatureCollection"))return this.fire(new n.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof c!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const r of this._data.features)t.set(r.id,r);for(const r of c.features)t.set(r.id,r);this._data.features=[...t.values()]}else this._data=c;return this._updateWorkerData(!0),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterLeaves(c,t,r,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:t,offset:r},u),this}_updateWorkerData(c=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.x("dataloading",{dataType:"source"})),this._loaded=!1;const t=n.l({append:c},this.workerOptions);t.scope=this.scope;const r=this._data;typeof r=="string"?(t.request=this.map._requestManager.transformRequest(n.q.resolveURL(r),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,p)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new n.t(u));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),c&&(this._partialReload=!0),this.fire(new n.x("data",_)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(c),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,t){const r=c.actor?"reloadTile":"loadTile";c.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,p=this._partialReload,_={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:u?{image:u.image.clone()}:null,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:p};c.request=this.actor.send(r,_,(y,A)=>p&&!A?(c.state="loaded",t(null)):(delete c.request,c.destroy(),c.aborted?t(null):y?t(y):(c.loadVectorData(A,this.map.painter,r==="reloadTile"),t(null))),void 0,r==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c,t){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(c){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aD{constructor(c,t,r,u){super(c,t,r,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aE(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new n.t(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new n.t(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(c,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aD,model:class extends n.E{constructor(c,t,r,u){super(),this.id=c,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const c=[];for(const t in this._options.models){const r=this._options.models[t],u=n.aG(this.map._requestManager.transformRequest(r.uri,n.R.Model).url).then(p=>{if(!p)return;const _=n.aH(p),y=new n.aI(t,r.position,r.orientation,_);y.computeBoundsAndApplyParent(),this.models.push(y)}).catch(p=>{this.fire(new n.t(new Error(`Could not load model ${t} from ${r.uri}: ${p.message}`)))});c.push(u)}return Promise.allSettled(c).then(()=>{this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new n.t(new Error(`Could not load models: ${t.message}`)))})}onAdd(c){this.map=c,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(c,t){}serialize(){return{type:"model"}}},"batched-model":class extends n.E{constructor(c,t,r,u){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(c){this.map=c,this.load()}load(c){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=xs(this._options,this.map._requestManager,t,r,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new n.t(u))):p&&(n.l(this,p),p.bounds&&(this.tileBounds=new Qs(p.bounds,this.minzoom,this.maxzoom)),_n(p.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(r,n.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=t;else{if(c.buckets){const _=Object.values(c.buckets);for(const y of _)y.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",u,p.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",u,p.bind(this),void 0,!0);function p(_,y){return c.aborted?t(null):_&&_.status!==404?t(_):(y&&(y.resourceTiming&&(c.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&c.setExpiryData(y),c.buckets={...c.buckets,...y.buckets},y.featureIndex&&(c.latestFeatureIndex=y.featureIndex)),c.state="loaded",void t(null))}}serialize(){return n.l({},this._options)}},canvas:class extends n.aD{constructor(c,t,r,u){super(c,t,r,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(_=>typeof _!="number"))||this.fire(new n.t(new n.V(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.t(new n.V(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.t(new n.V(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.t(new n.V(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.t(new n.V(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(c){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof n.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends n.E{constructor(c,t,r,u){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Qs(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),n.l(this,n.ar(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this.map=c,this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:r,z:u}=c.canonical;return this._implementation.hasTile({x:t,y:r,z:u})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:r,y:u,z:p}=c.tileID.canonical,_=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:r,y:u,z:p},{signal:_.signal})).then((function(y){return delete c.request,c.aborted?(c.state="unloaded",t(null)):y===void 0?(c.state="errored",t(null)):y===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null)):function(A){return A instanceof ImageData||A instanceof HTMLCanvasElement||A instanceof ImageBitmap||A instanceof HTMLImageElement}(y)?(this.loadTileData(c,y),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(y=>{y.code!==20&&(c.state="errored",t(y))}),c.request.cancel=()=>_.abort()}loadTileData(c,t){c.setTexture(t,this.map.painter)}unloadTile(c,t){if(c.texture&&c.texture instanceof n.T?(c.destroy(!0),c.texture&&c.texture instanceof n.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){const{x:r,y:u,z:p}=c.tileID.canonical;this._implementation.unloadTile({x:r,y:u,z:p})}t&&t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){const c=n.av(this.id,this.scope);this.map.style.clearSource(c)}_update(){this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}}},va=function(c,t,r,u){const p=new Rc[t.type](c,t,r,u);if(p.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${p.id}`);return n.aJ(["load","abort","unload","serialize","prepare"],p),p};function dh(c,t){const r=n.a6.mat4.identity([]);return n.a6.mat4.scale(r,r,[.5*c.width,.5*-c.height,1]),n.a6.mat4.translate(r,r,[1,-1,0]),n.a6.mat4.multiply(r,r,c.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(r)}function fh(c,t,r,u,p,_,y,A=!1){const C=c.tilesIn(u,y,A);C.sort(ba);const L=[];for(const F of C)L.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(t,r,c._state,F,p,_,dh(c.transform,F.tile.tileID),A)});const D=function(F){const B={},V={};for(const q of F){const W=q.queryResults,Z=q.wrappedTileID,X=V[Z]=V[Z]||{};for(const ie in W){const se=W[ie],ee=X[ie]=X[ie]||{},ce=B[ie]=B[ie]||[];for(const le of se)ee[le.featureIndex]||(ee[le.featureIndex]=!0,ce.push(le))}}return B}(L);for(const F in D)D[F].forEach(B=>{const V=B.feature,q=V.layer;q&&q.type!=="background"&&q.type!=="sky"&&q.type!=="slot"&&(V.source=q.source,q["source-layer"]&&(V.sourceLayer=q["source-layer"]),V.state=V.id!==void 0?c.getFeatureState(q["source-layer"],V.id):{})});return D}function Cl(c,t){const r=c.getRenderableIds().map(_=>c.getTileByID(_)),u=[],p={};for(let _=0;_<r.length;_++){const y=r[_],A=y.tileID.canonical.key;p[A]||(p[A]=!0,y.querySourceFeatures(u,t))}return u}function ba(c,t){const r=c.tileID,u=t.tileID;return r.overscaledZ-u.overscaledZ||r.canonical.y-u.canonical.y||r.wrap-u.wrap||r.canonical.x-u.canonical.x}const us=32,vs=33,bs=new Uint16Array(8184);for(let c=0;c<2046;c++){let t=c+2,r=0,u=0,p=0,_=0,y=0,A=0;for(1&t?p=_=y=us:r=u=A=us;(t>>=1)>1;){const L=r+p>>1,D=u+_>>1;1&t?(p=r,_=u,r=y,u=A):(r=p,u=_,p=y,_=A),y=L,A=D}const C=4*c;bs[C+0]=r,bs[C+1]=u,bs[C+2]=p,bs[C+3]=_}const Un=new Uint16Array(2178),ks=new Uint8Array(1089),Pl=new Uint16Array(1089);function ph(c){return c===0?-.03125:c===32?.03125:0}const mh={type:2,extent:n.ab,loadGeometry:()=>[[new n.P(0,0),new n.P(n.ab+1,0),new n.P(n.ab+1,n.ab+1),new n.P(0,n.ab+1),new n.P(0,0)]]};class Fs{constructor(t,r,u,p,_){this.tileID=t,this.uid=n.aP(),this.uses=0,this.tileSize=r,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(t){const r=t+this.timeAdded;r<n.q.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aK(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(p,_){const y={};if(!_)return y;for(const A of p){const C=A.layerIds.map(L=>_.getLayer(L)).filter(Boolean);if(C.length!==0){A.layers=C,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(L=>C.filter(D=>D.id===L)[0]));for(const L of C)y[L.fqid]=A}}return y}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof n.aR){if(this.hasSymbolBuckets=!0,!u)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof n.aR&&_.hasRTLText){this.hasRTLText=!0,n.aS();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p],y=r.style.getOwnLayer(p);if(!y)continue;const A=y.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,A)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.aQ}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(t)}const r=t.gl,u=this.imageAtlas;if(u&&!u.uploaded){const p=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new n.T(t,u.image,r.RGBA8,{useMipmap:p}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(t,r,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=r.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this._lastUpdatedBrightness=p,this.updateBuckets(r)))}queryRenderedFeatures(t,r,u,p,_,y,A,C){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:A,transform:y,params:_,tileTransform:this.tileTransform},t,r,u):{}}querySourceFeatures(t,r){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),_=r?r.sourceLayer:"",y=p._geojsonTileLayer||p[_];if(!y)return;const A=n.aT(r&&r.filter),{z:C,x:L,y:D}=this.tileID.canonical,F={z:C,x:L,y:D};for(let B=0;B<y.length;B++){const V=y.feature(B);if(A.needGeometry){const Z=n.aU(V,!0);if(!A.filter(new n.a3(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!A.filter(new n.a3(this.tileID.overscaledZ),V))continue;const q=u.getId(V,_),W=new n.aV(V,C,L,D,q);W.tile=F,t.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const u=n.aW(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(r)if(this.expirationTime<r)p=!0;else{const _=this.expirationTime-r;_?this.expirationTime=u+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0&&r&&this.updateBuckets(r)}updateBuckets(t){if(!this.latestFeatureIndex)return;const r=this.latestFeatureIndex.loadVTLayers(),u=t.style.listImages(),p=t.style.getBrightness();for(const _ in this.buckets){if(!t.style.hasLayer(_))continue;const y=this.buckets[_],A=y.layers[0].sourceLayer||"_geojsonTileLayer",C=r[A],L=t.style.getOwnSourceCache(y.layers[0].source);let D={};L&&(D=L._state.getState(A,void 0)),y.update(D,C,u,this.imageAtlas&&this.imageAtlas.patternPositions||{},p),(y instanceof n.aX||y instanceof n.aY)&&t._terrain&&t._terrain.enabled&&L&&y.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(L.id,this.tileID);const F=t&&t.style&&t.style.getOwnLayer(_);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.q.now()+t}setTexture(t,r){const u=r.context,p=u.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(u,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,r){const u={};for(const p of r)u[p]=!0;this.dependencies[t]=u}hasDependency(t,r){for(const u of t){const p=this.dependencies[u];if(p){for(const _ of r)if(p[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const u=n.aZ(mh,this.tileID.canonical,this.tileTransform)[0],p=new n.a_,_=new n.a$;for(let y=0;y<u.length;y++){const{x:A,y:C}=u[y];p.emplaceBack(A,C),_.emplaceBack(y)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(p,n.b0.members),this._tileDebugSegments=n.b1.simpleSegment(0,0,p.length,_.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const u=n.aZ(mh,this.tileID.canonical,this.tileTransform)[0];let p,_;if(this.isRaster){const y=function(A,C){const L=n.aK(A,C),D=Math.pow(2,A.z);for(let Z=0;Z<vs;Z++)for(let X=0;X<vs;X++){const ie=n.aL((A.x+(X+ph(X))/us)/D),se=n.aM((A.y+(Z+ph(Z))/us)/D),ee=C.project(ie,se),ce=Z*vs+X;Un[2*ce+0]=Math.round((ee.x*L.scale-L.x)*n.ab),Un[2*ce+1]=Math.round((ee.y*L.scale-L.y)*n.ab)}ks.fill(0),Pl.fill(0);for(let Z=2045;Z>=0;Z--){const X=4*Z,ie=bs[X+0],se=bs[X+1],ee=bs[X+2],ce=bs[X+3],le=ie+ee>>1,me=se+ce>>1,fe=le+me-se,ye=me+ie-le,Ie=se*vs+ie,Te=ce*vs+ee,be=me*vs+le,ze=Math.hypot((Un[2*Ie+0]+Un[2*Te+0])/2-Un[2*be+0],(Un[2*Ie+1]+Un[2*Te+1])/2-Un[2*be+1])>=16;ks[be]=ks[be]||(ze?1:0),Z<1022&&(ks[be]=ks[be]||ks[(se+ye>>1)*vs+(ie+fe>>1)]||ks[(ce+ye>>1)*vs+(ee+fe>>1)])}const F=new n.aN,B=new n.aO;let V=0;function q(Z,X){const ie=X*vs+Z;return Pl[ie]===0&&(F.emplaceBack(Un[2*ie+0],Un[2*ie+1],Z*n.ab/us,X*n.ab/us),Pl[ie]=++V),Pl[ie]-1}function W(Z,X,ie,se,ee,ce){const le=Z+ie>>1,me=X+se>>1;if(Math.abs(Z-ee)+Math.abs(X-ce)>1&&ks[me*vs+le])W(ee,ce,Z,X,le,me),W(ie,se,ee,ce,le,me);else{const fe=q(Z,X),ye=q(ie,se),Ie=q(ee,ce);B.emplaceBack(fe,ye,Ie)}}return W(0,0,us,us,us,0),W(us,us,0,0,0,us),{vertices:F,indices:B}}(this.tileID.canonical,r);p=y.vertices,_=y.indices}else{p=new n.aN,_=new n.aO;for(const{x:A,y:C}of u)p.emplaceBack(A,C,0,0);const y=n.b2(p.int16,void 0,4);for(let A=0;A<y.length;A+=3)_.emplaceBack(y[A],y[A+1],y[A+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,n.b3.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=n.b1.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugBuffers(t,r){const u=r.projection;if(!u||u.name!=="globe"||r.freezeTileCoverage)return;const p=this.tileID.canonical,_=n.b4(p,r),y=n.b5(_),A=n.a9(r.zoom);let C;A>0&&(C=n.a6.mat4.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,r,y,C,A),this._makeGlobeTileDebugTextBuffer(t,p,r,y,C,A)}_globePoint(t,r,u,p,_,y,A){let C=n.b6(t,r,u);if(y){const L=1<<u.z,D=n.am(p.center.lng),F=n.at(p.center.lat),B=(u.x+.5)/L-D;let V=0;B>.5?V=-1:B<-.5&&(V=1);let q=(t/n.ab+u.x)/L+V,W=(r/n.ab+u.y)/L;q=(q-D)*p._pixelsPerMercatorPixel+D,W=(W-F)*p._pixelsPerMercatorPixel+F;const Z=[q*p.worldSize,W*p.worldSize,0];n.a6.vec3.transformMat4(Z,Z,y),C=n.b7(C,Z,A)}return n.a6.vec3.transformMat4(C,C,_)}_makeGlobeTileDebugBorderBuffer(t,r,u,p,_,y){const A=new n.a_,C=new n.a$,L=new n.b8,D=(B,V,q,W,Z)=>{const X=(q-B)/(Z-1),ie=(W-V)/(Z-1),se=A.length;for(let ee=0;ee<Z;ee++){const ce=B+ee*X,le=V+ee*ie;A.emplaceBack(ce,le);const me=this._globePoint(ce,le,r,u,p,_,y);L.emplaceBack(me[0],me[1],me[2]),C.emplaceBack(se+ee)}},F=n.ab;D(0,0,F,0,16),D(F,0,F,F,16),D(F,F,0,F,16),D(0,F,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(C),this._tileDebugBuffer=t.createVertexBuffer(A,n.b0.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(L,n.b9.members),this._tileDebugSegments=n.b1.simpleSegment(0,0,A.length,C.length)}_makeGlobeTileDebugTextBuffer(t,r,u,p,_,y){const A=n.ab/4,C=new n.a_,L=new n.aO,D=new n.b8,F=25;L.reserve(32),C.reserve(F),D.reserve(F);const B=(V,q)=>F*V+q;for(let V=0;V<F;V++){const q=V*A;for(let W=0;W<F;W++){const Z=W*A;C.emplaceBack(Z,q);const X=this._globePoint(Z,q,r,u,p,_,y);D.emplaceBack(X[0],X[1],X[2])}}for(let V=0;V<4;V++)for(let q=0;q<4;q++){const W=B(V,q),Z=B(V,q+1),X=B(V+1,q),ie=B(V+1,q+1);L.emplaceBack(W,Z,X),L.emplaceBack(X,Z,ie)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(L),this._tileDebugTextBuffer=t.createVertexBuffer(C,n.b0.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(D,n.b9.members),this._tileDebugTextSegments=n.b1.simpleSegment(0,0,F,32)}destroy(t=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.ba.setPbf(n.bb);class Lc extends Fs{constructor(t,r,u,p,_){super(t,r,u,p,_),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,r){const u=r.context,p=u.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t,{premultiply:!1}):this.texture=new n.T(u,t,p.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,r){const u=this._mrt=new n.ba(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.bc(p,(_,y,A,C)=>{if(_)r(_);else try{const L=u.getHeaderLength(y);if(L>t)return void(this.request=this.fetchHeader(L,r));u.parseHeader(y),this._isHeaderLoaded=!0;let D=0;for(const F of Object.values(u.layers))D=Math.max(D,F.dataIndex[F.dataIndex.length-1].last_byte);y.byteLength>=D&&(this.entireBuffer=y),r(null,this.entireBuffer||y,A,C)}catch(L){r(L)}}),this.request}fetchBand(t,r,u){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void u(new Error("Tile header is not ready"));const _=this.actor;if(!_)return void u(new Error("Can't fetch tile band without an actor"));let y;const A=(F,B)=>{y.complete(F,B),F?u(F):(this.updateTextureDescriptor(t,r),u(null,this.textureDescriptor&&this.textureDescriptor.img))},C=(F,B)=>{if(F)return u(F);const V=_.send("decodeRasterArray",{buffer:B,task:y},A,void 0,!0);this._workQueue.push(()=>{V&&V.cancel(),y.cancel()})},L=p.getLayer(t);if(!L)return void u(new Error(`Unknown sourceLayer "${t}"`));if(L.hasDataForBand(r))return this.updateTextureDescriptor(t,r),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const D=L.getDataRange([r]);if(y=p.createDecodingTask(D),!y||y.tasks.length)if(this.flushQueues(),this.entireBuffer)C(null,this.entireBuffer.slice(D.firstByte,D.lastByte+1));else{const F=Object.assign({},this.requestParams,{headers:{Range:`bytes=${D.firstByte}-${D.lastByte}`}}),B=n.bc(F,C);this._fetchQueue.push(()=>{B.cancel(),y.cancel()})}else u(null)}updateNeeded(t,r){return(!this.textureDescriptor||this.textureDescriptor.band!==r||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,r){if(!this._mrt)return;const u=this._mrt.getLayer(t);if(!u||!u.hasBand(r)||!u.hasDataForBand(r))return;const{bytes:p,tileSize:_,buffer:y,offset:A,scale:C}=u.getBandView(r),L=_+2*y,D={data:p,width:L,height:L},F=this.texture;F&&F instanceof n.T&&F.update(D,{premultiply:!1}),this.textureDescriptor={layer:t,band:r,img:D,buffer:y,offset:A,tileSize:_,format:u.pixelFormat,mix:[C,256*C,65536*C,16777216*C]}}}class Df{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:r,timeout:void 0};if(u!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},u)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const u=t.wrapped().key,p=r===void 0?0:this.data[u].indexOf(r),_=this.data[u][p];return this.data[u].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(_.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||r.push(p);for(const u of r)this.remove(u.value.tileID,u)}}class p_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,u){const p=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},n.l(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==p&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const _ in this.state[t][p])u[_]||(this.deletedStates[t][p][_]=null)}else for(const _ in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][_]===null&&delete this.deletedStates[t][p][_]}removeFeatureState(t,r,u){if(this.deletedStates[t]===null)return;const p=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&r!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,r){const u=this.state[t]||{},p=this.stateChanges[t]||{},_=this.deletedStates[t];if(_===null)return{};if(r!==void 0){const A=String(r),C=n.l({},u[A],p[A]);if(_){const L=_[r];if(L===null)return{};for(const D in L)delete C[D]}return C}const y=n.l({},u,p);if(_)for(const A in _)delete y[A];return y}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const y in this.stateChanges[p])this.state[p][y]||(this.state[p][y]={}),n.l(this.state[p][y],this.stateChanges[p][y]),_[y]=this.state[p][y];u[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const y in this.state[p])_[y]={},this.state[p][y]={};else for(const y in this.deletedStates[p]){if(this.deletedStates[p][y]===null)this.state[p][y]={};else if(this.state[p][y])for(const A of Object.keys(this.deletedStates[p][y]))delete this.state[p][y][A];_[y]=this.state[p][y]}u[p]=u[p]||{},n.l(u[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].setFeatureState(u,r)}}class Vn extends n.E{constructor(t,r,u){super(),this.id=t,this._onlySymbols=u,r.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new Df(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new p_,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const u=this._tiles[r];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return n.bd(this._tiles).map(t=>t.tileID).sort(bo).map(t=>t.key)}getRenderableIds(t,r){const u=[];for(const p in this._tiles)this._isIdRenderable(+p,t,r)&&u.push(this._tiles[p]);return t?u.sort((p,_)=>{const y=p.tileID,A=_.tileID,C=new n.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),L=new n.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-A.overscaledZ||L.y-C.y||L.x-C.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(bo).map(p=>p.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=r),this._loadTile(u,this._tileLoaded.bind(this,u,t,r)))}_tileLoaded(t,r,u,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new n.t(p,{tile:t}));else{if(this._source.fire(new n.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=n.q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new n.x("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let p=0;p<r.length;p++){const _=r[p];if(t.neighboringTiles&&t.neighboringTiles[_]){const y=this.getTileByID(_);u(t,y),u(y,t)}}function u(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let y=_.tileID.canonical.x-p.tileID.canonical.x;const A=_.tileID.canonical.y-p.tileID.canonical.y,C=Math.pow(2,p.tileID.canonical.z),L=_.tileID.key;y===0&&A===0||Math.abs(A)>1||(Math.abs(y)>1&&(Math.abs(y+C)===1?y+=C:Math.abs(y-C)===1&&(y-=C)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,y,A),p.neighboringTiles&&p.neighboringTiles[L]&&(p.neighboringTiles[L].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,u,p){for(const _ in this._tiles){let y=this._tiles[_];if(p[_]||!y.hasData()||y.tileID.overscaledZ<=r||y.tileID.overscaledZ>u)continue;let A=y.tileID;for(;y&&y.tileID.overscaledZ>r+1;){const L=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[L.key],y&&y.hasData()&&(A=L)}let C=A;for(;C.overscaledZ>r;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]){p[A.key]=A;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=r?u:null}for(let u=t.overscaledZ-1;u>=r;u--){const p=t.scaledTo(u),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const u=Math.ceil(t.width/r)+1,p=Math.ceil(t.height/r)+1,_=Math.floor(u*p*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(A)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const u={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),u[_.tileID.key]=_}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,r,u,p){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const _=this._source.type==="batched-model";let y;if(this.used||this.usedForTerrain){if(this._source.tileID)y=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(L=>new n.aA(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y));else if(this.tileCoverLift!==0){const L=t.clone();L.tileCoverLift=this.tileCoverLift,y=L.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.minzoom<=1&&t.projection.name==="globe"&&(y.push(new n.aA(1,0,1,0,0)),y.push(new n.aA(1,0,1,1,0)),y.push(new n.aA(1,0,1,0,1)),y.push(new n.aA(1,0,1,1,1)))}else if(y=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.hasTile){const L=this._source.hasTile.bind(this._source);y=y.filter(D=>L(D))}}else y=[];if(y.length>0&&this.castsShadows&&p&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Rl(this._source.type)){const L=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),D=Math.min(L,this._source.maxzoom);if(_){const F=t.extendTileCover(y,D);for(const B of F)y.push(B)}else{const F=t.extendTileCover(y,D,p);for(const B of F)this._shadowCasterTiles[B.key]=!0,y.push(B)}}const A=this._updateRetainedTiles(y);if(Rl(this._source.type)&&y.length!==0){const L={},D={},F=Object.keys(A);for(const V of F){const q=A[V],W=this._tiles[V];if(!W||W.fadeEndTime&&W.fadeEndTime<=n.q.now())continue;const Z=this.findLoadedParent(q,Math.max(q.overscaledZ-Vn.maxOverzooming,this._source.minzoom));Z&&(this._addTile(Z.tileID),L[Z.tileID.key]=Z.tileID),D[V]=q}const B=y[y.length-1].overscaledZ;for(const V in this._tiles){const q=this._tiles[V];if(A[V]||!q.hasData())continue;let W=q.tileID;for(;W.overscaledZ>B;){W=W.scaledTo(W.overscaledZ-1);const Z=this._tiles[W.key];if(Z&&Z.hasData()&&D[W.key]){A[V]=q.tileID;break}}}for(const V in L)A[V]||(this._coveredTiles[V]=!0,A[V]=L[V])}for(const L in A)this._tiles[L].clearFadeHold();const C=n.be(this._tiles,A);for(const L of C){const D=this._tiles[L];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+L)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const u={},p=t.reduce((L,D)=>Math.min(L,D.overscaledZ),1/0),_=t[0].overscaledZ,y=Math.max(_-Vn.maxOverzooming,this._source.minzoom),A=Math.max(_+Vn.maxUnderzooming,this._source.minzoom),C={};for(const L of t){const D=this._addTile(L);r[L.key]=L,D.hasData()||p<this._source.maxzoom&&(C[L.key]=L)}this._retainLoadedChildren(C,p,A,r);for(const L of t){let D=this._tiles[L.key];if(D.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const B=L.children(this._source.maxzoom)[0],V=this.getTile(B);if(V&&V.hasData()){r[B.key]=B;continue}}else{const B=L.children(this._source.maxzoom);if(r[B[0].key]&&r[B[1].key]&&r[B[2].key]&&r[B[3].key])continue}let F=D.wasRequested();for(let B=L.overscaledZ-1;B>=y;--B){const V=L.scaledTo(B);if(u[V.key]||(u[V.key]=!0,D=this.getTile(V),!D&&F&&(D=this._addTile(V)),D&&(r[V.key]=V,F=D.wasRequested(),D.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}r.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(_),u)break;p=_}for(const _ of r)this._loadedParentTiles[_]=u}}_addTile(t){let r=this._tiles[t.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const u=!!r;if(!u){const p=this.map?this.map.painter:null,_=this._source.tileSize*t.overscaleFactor();r=this._source.type==="raster-array"?new Lc(t,_,this.transform.tileZoom,p,this._isRaster):new Fs(t,_,this.transform.tileZoom,p,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r?(r.uses++,this._tiles[t.key]=r,u||this._source.fire(new n.x("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=r.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,u){const p=[],_=this.transform;if(!_)return p;const y=_.projection.name==="globe",A=n.am(_.center.lng);for(const C in this._tiles){const L=this._tiles[C];if(u&&L.clearQueryDebugViz(),L.holdingForFade())continue;let D;if(y){const F=L.tileID.canonical;if(F.z===0){const B=[Math.abs(n.ap(A,...wa(F,-1))-A),Math.abs(n.ap(A,...wa(F,1))-A)];D=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(n.ap(A,...wa(F,-1))-A),Math.abs(n.ap(A,...wa(F,0))-A),Math.abs(n.ap(A,...wa(F,1))-A)];D=[B.indexOf(Math.min(...B))-1]}}else D=[0];for(const F of D){const B=t.containsTile(L,_,r,F);B&&p.push(B)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const u=this.getRenderableIds(t,r).map(_=>this._tiles[_].tileID),p=this.transform.projection.name==="globe";for(const _ of u)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=p?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return u}sortCoordinatesByDistance(t){const r=t.slice(),u=this.transform._camera.position,p=this.transform._camera.forward(),_={};for(const y of r){const A=1/(1<<y.canonical.z);_[y.key]=((y.canonical.x+.5)*A+y.wrap-u[0])*p[0]+((y.canonical.y+.5)*A-u[1])*p[1]-u[2]*p[2]}return r.sort((y,A)=>_[y.key]-_[A.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(Rl(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(t,r,u){this._state.updateState(t=t||"_geojsonTileLayer",r,u)}removeFeatureState(t,r,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,u)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,u){const p=this._tiles[t];p&&p.setDependencies(r,u)}reloadTilesForDependencies(t,r){for(const u in this._tiles)this._tiles[u].hasDependency(t,r)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,r))}_preloadTiles(t,r){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(t,r))};return void this._source.on("data",C)}const u=new Map,p=Array.isArray(t)?t:[t],_=this.map.painter.terrain,y=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const C of p){const L=C.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of L)u.set(D.key,D);this.usedForTerrain&&C.updateElevation(!1)}const A=Array.from(u.values());n.bf(A,(C,L)=>{const D=new Fs(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,F=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),L(F,D)})},r)}}function bo(c,t){const r=Math.abs(2*c.wrap)-+(c.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||u-r||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function Rl(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function wa(c,t){const r=1<<c.z;return[c.x/r+t,(c.x+1)/r+t]}Vn.maxOverzooming=10,Vn.maxUnderzooming=3;class _h{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,r=!1;for(const u in this.style._mergedLayers){const p=this.style._mergedLayers[u];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:t,visibilityChanged:r});else if(p.type==="model"){const _=this.style.getLayerSource(p);_&&_.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:r})}}}onNewFrame(t){this.layersGotHidden=!1;for(const r of this.layers){const u=r.layer;let p=!1;u.type==="fill-extrusion"?p=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(p=!u.isHidden(t)&&u.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!p&&r.visible,r.visible=p}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(const p of this.layers){const _=p.layer,y=this.style.getLayerSourceCache(_);let A=1;_.type==="fill-extrusion"&&(A=p.visible?_.paint.get("fill-extrusion-vertical-scale"):0);let C=y?y.getTile(r):null;if(!C&&y&&r.canonical.z>y.getSource().minzoom){let L=r.scaledTo(Math.min(y.getSource().maxzoom,r.overscaledZ-1));for(;L.overscaledZ>=y.getSource().minzoom&&(C=y.getTile(L),!C&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:C?C.getBucket(_):null,tileID:C?C.tileID:r,verticalScale:A})}t.hasAnyZOffset=!1;let u=!1;for(let p=0;p<t.symbolInstances.length;p++){const _=t.symbolInstances.get(p),y=_.zOffset,A=this._getHeightAtTileOffset(r,_.tileAnchorX,_.tileAnchorY);_.zOffset=A!==Number.NEGATIVE_INFINITY?A:y,u||y===_.zOffset||(u=!0),t.hasAnyZOffset||_.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,u,p){let _=r,y=u;if(t.canonical.z!==p.canonical.z){const A=p.canonical,C=1/(1<<t.canonical.z-A.z);_=(r+t.canonical.x*n.ab)*C-A.x*n.ab|0,y=(u+t.canonical.y*n.ab)*C-A.y*n.ab|0}return{tileX:_,tileY:y}}_getHeightAtTileOffset(t,r,u){let p,_;for(let y=0;y<this.layers.length;++y){if(this.layers[y].layer.type!=="fill-extrusion")continue;const{bucket:A,tileID:C,verticalScale:L}=this.currentBuildingBuckets[y];if(!A)continue;const{tileX:D,tileY:F}=this._mapCoordToOverlappingTile(t,r,u,C),B=A.getHeightAtTileCoord(D,F);B&&B.height!==void 0&&(B.hidden?p=B.height:_=Math.max(B.height*L,_||0))}if(_!==void 0)return _;for(let y=0;y<this.layers.length;++y){const A=this.layers[y];if(A.layer.type!=="model"||!A.visible)continue;const{bucket:C,tileID:L}=this.currentBuildingBuckets[y];if(!C)continue;const{tileX:D,tileY:F}=this._mapCoordToOverlappingTile(t,r,u,L),B=C.getHeightAtTileCoord(D,F);if(B&&!B.hidden)return B.height===void 0&&p!==void 0?Math.min(B.maxHeight,p)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ta(c,t){const r={};for(const u in c)u!=="ref"&&(r[u]=c[u]);return n.bg.forEach(u=>{u in t&&(r[u]=t[u])}),r}function gh(c){c=c.slice();const t=Object.create(null);for(let r=0;r<c.length;r++)t[c[r].id]=c[r];for(let r=0;r<c.length;r++)"ref"in c[r]&&(c[r]=Ta(c[r],t[c[r].ref]));return c}const Fi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function yh(c,t,r){r.push({command:Fi.addSource,args:[c,t[c]]})}function Hi(c,t,r){t.push({command:Fi.removeSource,args:[c]}),r[c]=!0}function m_(c,t,r,u){Hi(c,r,u),yh(c,t,r)}function ii(c,t,r){let u;for(u in c[r])if(c[r].hasOwnProperty(u)&&u!=="data"&&!n.bh(c[r][u],t[r][u]))return!1;for(u in t[r])if(t[r].hasOwnProperty(u)&&u!=="data"&&!n.bh(c[r][u],t[r][u]))return!1;return!0}function Ll(c,t,r,u,p,_){let y;for(y in t=t||{},c=c||{})c.hasOwnProperty(y)&&(n.bh(c[y],t[y])||r.push({command:_,args:[u,y,t[y],p]}));for(y in t)t.hasOwnProperty(y)&&!c.hasOwnProperty(y)&&(n.bh(c[y],t[y])||r.push({command:_,args:[u,y,t[y],p]}))}function Ho(c){return c.id}function Ea(c,t){return c[t.id]=t,c}class Bs{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.ap(t,0,1);let r=1,u=this._distances[r];const p=t*this.paddedLength+this.padding;for(;u<p&&r<this._distances.length;)u=this._distances[++r];const _=r-1,y=this._distances[_],A=u-y,C=A>0?(p-y)/A:0;return this.points[_].mult(1-C).add(this.points[r].mult(C))}}class Dc{constructor(t,r,u){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(r/u);for(let y=0;y<this.xCellCount*this.yCellCount;y++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,u,p,_){this._forEachCell(r,u,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(t,r,u,p){this._forEachCell(r-p,u-p,r+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,r,u,p,_,y){this.boxCells[_].push(y)}_insertCircleCell(t,r,u,p,_,y){this.circleCells[_].push(y)}_query(t,r,u,p,_,y){if(u<0||t>this.width||p<0||r>this.height)return!_&&[];const A=[];if(t<=0&&r<=0&&this.width<=u&&this.height<=p){if(_)return!0;for(let C=0;C<this.boxKeys.length;C++)A.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const L=this.circles[3*C],D=this.circles[3*C+1],F=this.circles[3*C+2];A.push({key:this.circleKeys[C],x1:L-F,y1:D-F,x2:L+F,y2:D+F})}return y?A.filter(y):A}return this._forEachCell(t,r,u,p,this._queryCell,A,{hitTest:_,seenUids:{box:{},circle:{}}},y),_?A.length>0:A}_queryCircle(t,r,u,p,_){const y=t-u,A=t+u,C=r-u,L=r+u;if(A<0||y>this.width||L<0||C>this.height)return!p&&[];const D=[];return this._forEachCell(y,C,A,L,this._queryCellCircle,D,{hitTest:p,circle:{x:t,y:r,radius:u},seenUids:{box:{},circle:{}}},_),p?D.length>0:D}query(t,r,u,p,_){return this._query(t,r,u,p,!1,_)}hitTest(t,r,u,p,_){return this._query(t,r,u,p,!0,_)}hitTestCircle(t,r,u,p){return this._queryCircle(t,r,u,!0,p)}_queryCell(t,r,u,p,_,y,A,C){const L=A.seenUids,D=this.boxCells[_];if(D!==null){const B=this.bboxes;for(const V of D)if(!L.box[V]){L.box[V]=!0;const q=4*V;if(t<=B[q+2]&&r<=B[q+3]&&u>=B[q+0]&&p>=B[q+1]&&(!C||C(this.boxKeys[V]))){if(A.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[V],x1:B[q],y1:B[q+1],x2:B[q+2],y2:B[q+3]})}}}const F=this.circleCells[_];if(F!==null){const B=this.circles;for(const V of F)if(!L.circle[V]){L.circle[V]=!0;const q=3*V;if(this._circleAndRectCollide(B[q],B[q+1],B[q+2],t,r,u,p)&&(!C||C(this.circleKeys[V]))){if(A.hitTest)return y.push(!0),!0;{const W=B[q],Z=B[q+1],X=B[q+2];y.push({key:this.circleKeys[V],x1:W-X,y1:Z-X,x2:W+X,y2:Z+X})}}}}}_queryCellCircle(t,r,u,p,_,y,A,C){const L=A.circle,D=A.seenUids,F=this.boxCells[_];if(F!==null){const V=this.bboxes;for(const q of F)if(!D.box[q]){D.box[q]=!0;const W=4*q;if(this._circleAndRectCollide(L.x,L.y,L.radius,V[W+0],V[W+1],V[W+2],V[W+3])&&(!C||C(this.boxKeys[q])))return y.push(!0),!0}}const B=this.circleCells[_];if(B!==null){const V=this.circles;for(const q of B)if(!D.circle[q]){D.circle[q]=!0;const W=3*q;if(this._circlesCollide(V[W],V[W+1],V[W+2],L.x,L.y,L.radius)&&(!C||C(this.circleKeys[q])))return y.push(!0),!0}}}_forEachCell(t,r,u,p,_,y,A,C){const L=this._convertToXCellCoord(t),D=this._convertToYCellCoord(r),F=this._convertToXCellCoord(u),B=this._convertToYCellCoord(p);for(let V=L;V<=F;V++)for(let q=D;q<=B;q++)if(_.call(this,t,r,u,p,this.xCellCount*q+V,y,A,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,u,p,_,y){const A=p-t,C=_-r,L=u+y;return L*L>A*A+C*C}_circleAndRectCollide(t,r,u,p,_,y,A){const C=(y-p)/2,L=Math.abs(t-(p+C));if(L>C+u)return!1;const D=(A-_)/2,F=Math.abs(r-(_+D));if(F>D+u)return!1;if(L<=C||F<=D)return!0;const B=L-C,V=F-D;return B*B+V*V<=u*u}}const ws={unknown:0,flipRequired:1,flipNotRequired:2},Nt=Math.tan(85*Math.PI/180);function Ci(c,t,r,u,p,_,y){const A=n.a6.mat4.create();if(r)if(_.name==="globe"){const C=n.bi(p,t);n.a6.mat4.multiply(A,A,C)}else{const C=n.a6.mat2.invert([],y);A[0]=C[0],A[1]=C[1],A[4]=C[2],A[5]=C[3],u||n.a6.mat4.rotateZ(A,A,p.angle)}else n.a6.mat4.multiply(A,p.labelPlaneMatrix,c);return A}function Pi(c,t,r,u,p,_,y){const A=Ci(c,t,r,u,p,_,y);return _.name==="globe"&&r||(A[2]=A[6]=A[10]=A[14]=0),A}function jn(c,t,r,u,p,_,y){if(r){if(_.name==="globe"){const A=Ci(c,t,r,u,p,_,y);return n.a6.mat4.invert(A,A),n.a6.mat4.multiply(A,c,A),A}{const A=n.a6.mat4.clone(c),C=n.a6.mat4.identity([]);return C[0]=y[0],C[1]=y[1],C[4]=y[2],C[5]=y[3],n.a6.mat4.multiply(A,A,C),u||n.a6.mat4.rotateZ(A,A,-p.angle),A}}return p.glCoordMatrix}function wn(c,t,r,u){const p=[c,t,r,1];r?n.a6.vec4.transformMat4(p,p,u):Oc(p,p,u);const _=p[3];return p[0]/=_,p[1]/=_,p[2]/=_,p}function Di(c,t){return Math.min(.5+c/t*.5,1.5)}function zc(c,t){const r=c[0]/c[3],u=c[1]/c[3];return r>=-t[0]&&r<=t[0]&&u>=-t[1]&&u<=t[1]}function Sa(c,t,r,u,p,_,y,A,C,L){const D=r.transform,F=u?c.textSizeData:c.iconSizeData,B=n.bj(F,r.transform.zoom),V=D.projection.name==="globe",q=[256/r.width*2+1,256/r.height*2+1],W=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;W.clear();let Z=null;V&&(Z=u?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const X=c.lineVertexArray,ie=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,se=r.transform.width/r.transform.height;let ee,ce=!1;for(let le=0;le<ie.length;le++){const me=ie.get(le),{numGlyphs:fe,writingMode:ye}=me;if(ye!==n.bk.vertical||ce||ee===n.bk.horizontal||(ce=!0),ee=ye,(me.hidden||ye===n.bk.vertical)&&!ce){Ns(fe,W);continue}ce=!1;const Ie=new n.P(me.tileAnchorX,me.tileAnchorY);let{x:Te,y:be,z:ze}=D.projection.projectTilePoint(Ie.x,Ie.y,L.canonical);if(C){const[at,ut,Ht]=C(Ie);Te+=at,be+=ut,ze+=Ht}const Je=[Te,be,ze,1];if(n.a6.vec4.transformMat4(Je,Je,t),!zc(Je,q)){Ns(fe,W);continue}const lt=Je[3],Ke=Di(r.transform.getCameraToCenterDistance(D.projection),lt),mt=n.bl(F,B,me),Oe=y?mt/Ke:mt*Ke,ot=wn(Te,be,ze,p);if(ot[3]<=0){Ns(fe,W);continue}let it={};const yt=y?null:C,vt=Rr(me,Oe,!1,A,t,p,_,c.glyphOffsetArray,X,W,Z,ot,Ie,it,se,yt,D.projection,L,y);ce=vt.useVertical,yt&&vt.needsFlipping&&(it={}),(vt.notEnoughRoom||ce||vt.needsFlipping&&Rr(me,Oe,!0,A,t,p,_,c.glyphOffsetArray,X,W,Z,ot,Ie,it,se,yt,D.projection,L,y).notEnoughRoom)&&Ns(fe,W)}u?(c.text.dynamicLayoutVertexBuffer.updateData(W),Z&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(Z)):(c.icon.dynamicLayoutVertexBuffer.updateData(W),Z&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(Z))}function Aa(c,t,r,u,p,_,y,A,C,L,D,F,B,V,q,W){const{lineStartIndex:Z,glyphStartIndex:X,segment:ie}=A,se=X+A.numGlyphs,ee=Z+A.lineLength,ce=t.getoffsetX(X),le=t.getoffsetX(se-1),me=Ma(c*ce,r,u,p,_,y,ie,Z,ee,C,L,D,F,B,!0,V,q,W);if(!me)return null;const fe=Ma(c*le,r,u,p,_,y,ie,Z,ee,C,L,D,F,B,!0,V,q,W);return fe?{first:me,last:fe}:null}function Pn(c,t,r,u){return c===n.bk.horizontal&&Math.abs(u)>Math.abs(r)?{useVertical:!0}:c===n.bk.vertical?u>0?{needsFlipping:!0}:null:t!==ws.unknown&&function(p,_){return p===0||Math.abs(_/p)>Nt}(r,u)?t===ws.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function Rr(c,t,r,u,p,_,y,A,C,L,D,F,B,V,q,W,Z,X,ie){const se=t/24,ee=c.lineOffsetX*se,ce=c.lineOffsetY*se,{lineStartIndex:le,glyphStartIndex:me,numGlyphs:fe,segment:ye,writingMode:Ie,flipState:Te}=c,be=le+c.lineLength,ze=Je=>{if(D){const[Oe,ot,it]=Je.up,yt=L.length;n.bm(D,yt+0,Oe,ot,it),n.bm(D,yt+1,Oe,ot,it),n.bm(D,yt+2,Oe,ot,it),n.bm(D,yt+3,Oe,ot,it)}const[lt,Ke,mt]=Je.point;n.bn(L,lt,Ke,mt,Je.angle)};if(fe>1){const Je=Aa(se,A,ee,ce,r,F,B,c,C,_,V,W,!1,Z,X,ie);if(!Je)return{notEnoughRoom:!0};if(u&&!r){let[lt,Ke,mt]=Je.first.point,[Oe,ot,it]=Je.last.point;[lt,Ke]=wn(lt,Ke,mt,y),[Oe,ot]=wn(Oe,ot,it,y);const yt=Pn(Ie,Te,(Oe-lt)*q,ot-Ke);if(c.flipState=yt&&yt.needsFlipping?ws.flipRequired:ws.flipNotRequired,yt)return yt}ze(Je.first);for(let lt=me+1;lt<me+fe-1;lt++){const Ke=Ma(se*A.getoffsetX(lt),ee,ce,r,F,B,ye,le,be,C,_,V,W,!1,!1,Z,X,ie);if(!Ke)return L.length-=4*(lt-me),{notEnoughRoom:!0};ze(Ke)}ze(Je.last)}else{if(u&&!r){const lt=wn(B.x,B.y,0,p),Ke=le+ye+1,mt=new n.P(C.getx(Ke),C.gety(Ke)),Oe=wn(mt.x,mt.y,0,p),ot=Oe[3]>0?Oe:Ia(B,mt,lt,1,p,void 0,Z,X.canonical),it=Pn(Ie,Te,(ot[0]-lt[0])*q,ot[1]-lt[1]);if(c.flipState=it&&it.needsFlipping?ws.flipRequired:ws.flipNotRequired,it)return it}const Je=Ma(se*A.getoffsetX(me),ee,ce,r,F,B,ye,le,be,C,_,V,W,!1,!1,Z,X,ie);if(!Je)return{notEnoughRoom:!0};ze(Je)}return{}}function zf(c,t,r,u,p){const{x:_,y,z:A}=u.projectTilePoint(c.x,c.y,t);if(!p)return wn(_,y,A,r);const[C,L,D]=p(c);return wn(_+C,y+L,A+D,r)}function Ia(c,t,r,u,p,_,y,A){const C=zf(c.sub(t)._unit()._add(c),A,p,y,_);return n.a6.vec3.sub(C,r,C),n.a6.vec3.normalize(C,C),n.a6.vec3.scaleAndAdd(C,r,C,u)}function Ma(c,t,r,u,p,_,y,A,C,L,D,F,B,V,q,W,Z,X){const ie=u?c-t:c+t;let se=ie>0?1:-1,ee=0;u&&(se*=-1,ee=Math.PI),se<0&&(ee+=Math.PI);let ce=A+y+(se>0?0:1)|0,le=p,me=p,fe=0,ye=0;const Ie=Math.abs(ie),Te=[],be=[];let ze=_,Je=ze;const lt=()=>Ia(Je,ze,me,Ie-fe+1,D,B,W,Z.canonical);for(;fe+ye<=Ie;){if(ce+=se,ce<A||ce>=C)return null;if(me=le,Je=ze,Te.push(me),V&&be.push(Je),ze=new n.P(L.getx(ce),L.gety(ce)),le=F[ce],!le){const ut=zf(ze,Z.canonical,D,W,B);le=ut[3]>0?F[ce]=ut:lt()}fe+=ye,ye=n.a6.vec3.distance(me,le)}q&&B&&(F[ce]&&(le=lt(),ye=n.a6.vec3.distance(me,le)),F[ce]=le);const Ke=(Ie-fe)/ye,mt=ze.sub(Je)._mult(Ke)._add(Je),Oe=n.a6.vec3.sub([],le,me),ot=n.a6.vec3.scaleAndAdd([],me,Oe,Ke);let it=[0,0,1],yt=Oe[0],vt=Oe[1];if(X&&(it=W.upVector(Z.canonical,mt.x,mt.y),it[0]!==0||it[1]!==0||it[2]!==1)){const ut=[it[2],0,-it[0]],Ht=n.a6.vec3.cross([],it,ut);n.a6.vec3.normalize(ut,ut),n.a6.vec3.normalize(Ht,Ht),yt=n.a6.vec3.dot(Oe,ut),vt=n.a6.vec3.dot(Oe,Ht)}if(r){const ut=n.a6.vec3.cross([],it,Oe);n.a6.vec3.normalize(ut,ut),n.a6.vec3.scaleAndAdd(ot,ot,ut,r*se)}const at=ee+Math.atan2(vt,yt);return Te.push(ot),V&&be.push(mt),{point:ot,angle:at,path:Te,tilePath:be,up:it}}function Ns(c,t){const r=t.length,u=r+4*c;t.resize(u),t.float32.fill(-1/0,4*r,4*u)}function Oc(c,t,r){const u=t[0],p=t[1];return c[0]=r[0]*u+r[4]*p+r[12],c[1]=r[1]*u+r[5]*p+r[13],c[3]=r[3]*u+r[7]*p+r[15],c}const Jn=100;class Tn{constructor(t,r,u=new Dc(t.width+200,t.height+200,25),p=new Dc(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Jn,this.screenBottomBoundary=t.height+Jn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,u,p,_,y,A,C){let L=u.projectedAnchorX,D=u.projectedAnchorY,F=u.projectedAnchorZ;const B=u.elevation,V=u.tileID,q=t.getProjection();if(B&&V){const[le,me,fe]=q.upVector(V.canonical,u.tileAnchorX,u.tileAnchorY),ye=q.upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=le*B*ye,D+=me*B*ye,F+=fe*B*ye}const W=this.projectAndGetPerspectiveRatio(A,L,D,F,u.tileID,q.name==="globe"||!!B||this.transform.pitch>0,q),Z=y*W.perspectiveRatio,X=(u.x1*r+p.x-u.padding)*Z+W.point.x,ie=(u.y1*r+p.y-u.padding)*Z+W.point.y,se=(u.x2*r+p.x+u.padding)*Z+W.point.x,ee=(u.y2*r+p.y+u.padding)*Z+W.point.y,ce=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(X,ie,se,ee)||!_&&this.grid.hitTest(X,ie,se,ee,C)||ce?{box:[],offscreen:!1,occluded:W.occluded}:{box:[X,ie,se,ee],offscreen:this.isOffscreen(X,ie,se,ee),occluded:!1}}placeCollisionCircles(t,r,u,p,_,y,A,C,L,D,F,B,V,q,W){const Z=[],X=this.transform.elevation,ie=t.getProjection(),se=X?X.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,ie):null,ee=new n.P(u.tileAnchorX,u.tileAnchorY);let{x:ce,y:le,z:me}=ie.projectTilePoint(ee.x,ee.y,W.canonical);if(se){const[mt,Oe,ot]=se(ee);ce+=mt,le+=Oe,me+=ot}const fe=ie.name==="globe",ye=this.projectAndGetPerspectiveRatio(A,ce,le,me,W,fe||!!X||this.transform.pitch>0,ie),{perspectiveRatio:Ie}=ye,Te=(F?y/Ie:y*Ie)/n.bq,be=wn(ce,le,me,C),ze=ye.signedDistanceFromCamera>0?Aa(Te,_,u.lineOffsetX*Te,u.lineOffsetY*Te,!1,be,ee,u,p,C,{},X&&!F?se:null,F&&!!X,ie,W,F):null;let Je=!1,lt=!1,Ke=!0;if(ze&&!ye.occluded){const mt=.5*V*Ie+q,Oe=new n.P(-100,-100),ot=new n.P(this.screenRightBoundary,this.screenBottomBoundary),it=new Bs,{first:yt,last:vt}=ze,at=yt.path.length;let ut=[];for(let Ot=at-1;Ot>=1;Ot--)ut.push(yt.path[Ot]);for(let Ot=1;Ot<vt.path.length;Ot++)ut.push(vt.path[Ot]);const Ht=2.5*mt;L&&(ut=ut.map(([Ot,ri,Vt],Qt)=>(se&&!fe&&(Vt=se(Qt<at-1?yt.tilePath[at-1-Qt]:vt.tilePath[Qt-at+2])[2]),wn(Ot,ri,Vt,L))),ut.some(Ot=>Ot[3]<=0)&&(ut=[]));let St=[];if(ut.length>0){let Ot=1/0,ri=-1/0,Vt=1/0,Qt=-1/0;for(const bi of ut)Ot=Math.min(Ot,bi[0]),Vt=Math.min(Vt,bi[1]),ri=Math.max(ri,bi[0]),Qt=Math.max(Qt,bi[1]);ri>=Oe.x&&Ot<=ot.x&&Qt>=Oe.y&&Vt<=ot.y&&(St=[ut.map(bi=>new n.P(bi[0],bi[1]))],(Ot<Oe.x||ri>ot.x||Vt<Oe.y||Qt>ot.y)&&(St=n.bo(St,Oe.x,Oe.y,ot.x,ot.y)))}for(const Ot of St){it.reset(Ot,.25*mt);let ri=0;ri=it.length<=.5*mt?1:Math.ceil(it.paddedLength/Ht)+1;for(let Vt=0;Vt<ri;Vt++){const Qt=Vt/Math.max(ri-1,1),bi=it.lerp(Qt),yi=bi.x+Jn,Yi=bi.y+Jn;Z.push(yi,Yi,mt,0);const rr=yi-mt,ur=Yi-mt,hs=yi+mt,Fr=Yi+mt;if(Ke=Ke&&this.isOffscreen(rr,ur,hs,Fr),lt=lt||this.isInsideGrid(rr,ur,hs,Fr),!r&&this.grid.hitTestCircle(yi,Yi,mt,B)&&(Je=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Je,occluded:!1}}}}return{circles:!D&&Je||!lt?[]:Z,offscreen:Ke,collisionDetected:Je,occluded:ye.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let u=1/0,p=1/0,_=-1/0,y=-1/0;for(const D of t){const F=new n.P(D.x+Jn,D.y+Jn);u=Math.min(u,F.x),p=Math.min(p,F.y),_=Math.max(_,F.x),y=Math.max(y,F.y),r.push(F)}const A=this.grid.query(u,p,_,y).concat(this.ignoredGrid.query(u,p,_,y)),C={},L={};for(const D of A){const F=D.key;if(C[F.bucketInstanceId]===void 0&&(C[F.bucketInstanceId]={}),C[F.bucketInstanceId][F.featureIndex])continue;const B=[new n.P(D.x1,D.y1),new n.P(D.x2,D.y1),new n.P(D.x2,D.y2),new n.P(D.x1,D.y2)];n.bp(r,B)&&(C[F.bucketInstanceId][F.featureIndex]=!0,L[F.bucketInstanceId]===void 0&&(L[F.bucketInstanceId]=[]),L[F.bucketInstanceId].push(F.featureIndex))}return L}insertCollisionBox(t,r,u,p,_){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,u,p,_){const y=r?this.ignoredGrid:this.grid,A={bucketInstanceId:u,featureIndex:p,collisionGroupID:_};for(let C=0;C<t.length;C+=4)y.insertCircle(A,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,r,u,p,_,y,A){const C=[r,u,p,1];let L=!1;p||this.transform.pitch>0?(n.a6.vec4.transformMat4(C,C,t),this.fogState&&_&&A.name!=="globe"&&(L=function(B,V,q,W,Z,X){const ie=X.calculateFogTileMatrix(Z),se=[V,q,W];return n.a6.vec3.transformMat4(se,se,ie),Dt(B,n.a6.vec3.length(se),X.pitch,X._fov)}(this.fogState,r,u,p,_.toUnwrapped(),this.transform)>.9)):Oc(C,C,t);const D=C[3];return{point:new n.P((C[0]/D+1)/2*this.transform.width+Jn,(-C[1]/D+1)/2*this.transform.height+Jn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/D*.5,1.5),signedDistanceFromCamera:D,occluded:y&&C[2]>D||L}}isOffscreen(t,r,u,p){return u<Jn||t>=this.screenRightBoundary||p<Jn||r>this.screenBottomBoundary}isInsideGrid(t,r,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=n.a6.mat4.identity([]);return n.a6.mat4.translate(t,t,[-100,-100,0]),t}}function Rn(c,t,r){const u=t.createTileMatrix(c,c.worldSize,r.toUnwrapped());return n.a6.mat4.multiply(new Float32Array(16),c.projMatrix,u)}function Of(c,t,r){if(t.projection.name===r.projection.name)return c.projMatrix;const u=r.clone();return u.setProjection(t.projection),Rn(u,t.getProjection(),c)}function wo(c,t,r){return t.name===r.projection.name?c.projMatrix:Rn(r,t,c)}class Gr{constructor(t,r,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Ln{constructor(t,r,u,p,_,y=!1){this.text=new Gr(t?t.text:null,r,u,_),this.icon=new Gr(t?t.icon:null,r,p,_),this.clipped=y}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ts{constructor(t,r,u,p=!1){this.text=t,this.icon=r,this.skipFade=u,this.clipped=p}}class rn{constructor(){this.invProjMatrix=n.a6.mat4.create(),this.viewportMatrix=n.a6.mat4.create(),this.circles=[]}}class xh{constructor(t,r,u,p,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=_}}class Es{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:u=>u.collisionGroupID===r}}return this.collisionGroups[t]}}function Ca(c,t,r,u,p){const{horizontalAlign:_,verticalAlign:y}=n.bx(c),A=-(_-.5)*t,C=-(y-.5)*r,L=n.bw(c,u);return new n.P(A+L[0]*p,C+L[1]*p)}function Wo(c,t,r,u,p){const _=new n.P(c,t);return r&&_._rotate(u?p:-p),_}class Zo{constructor(t,r,u,p,_,y){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Tn(this.transform,_),this.buildingIndex=y,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new Es(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,u,p){const _=u.getBucket(r),y=u.latestFeatureIndex;if(!_||!y||r.fqid!==_.layerIds[0])return;const A=_.layers[0].layout,C=_.layers[0].paint,L=u.collisionBoxArray,D=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),F=u.tileSize/n.ab,B=u.tileID.toUnwrapped();this.transform.setProjection(_.projection);const V=(q=u.tileID,W=_.getProjection(),Z=this.transform,W.name===this.projection?Z.calculateProjMatrix(q.toUnwrapped()):Rn(Z,W,q));var q,W,Z;const X=A.get("text-pitch-alignment")==="map",ie=A.get("text-rotation-alignment")==="map";r.compileFilter();const se=r.dynamicFilter(),ee=r.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(u),le=Pi(V,u.tileID.canonical,X,ie,this.transform,_.getProjection(),ce);let me=null;if(X){const Ie=jn(V,u.tileID.canonical,X,ie,this.transform,_.getProjection(),ce);me=n.a6.mat4.multiply([],this.transform.labelPlaneMatrix,Ie)}let fe=null;se&&u.latestFeatureIndex&&(fe={unwrappedTileID:B,dynamicFilter:se,dynamicFilterNeedsFeature:ee}),this.retainedQueryData[_.bucketInstanceId]=new xh(_.bucketInstanceId,y,_.sourceLayerIndex,_.index,u.tileID);const ye={bucket:_,layout:A,paint:C,posMatrix:V,textLabelPlaneMatrix:le,labelToScreenMatrix:me,clippingData:fe,scale:D,textPixelRatio:F,holdingForFade:u.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:n.bj(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:n.bj(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(p)for(const Ie of _.sortKeyRanges){const{sortKey:Te,symbolInstanceStart:be,symbolInstanceEnd:ze}=Ie;t.push({sortKey:Te,symbolInstanceStart:be,symbolInstanceEnd:ze,parameters:ye})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(t,r,u,p,_,y,A,C,L,D,F,B,V,q,W,Z,X,ie){const{textOffset0:se,textOffset1:ee,crossTileID:ce}=B,le=[se,ee],me=Ca(t,u,p,le,_),fe=this.collisionIndex.placeCollisionBox(q,_,r,Wo(me.x,me.y,y,A,this.transform.angle),F,C,L,D.predicate);if(Z){const ye=q.getSymbolInstanceIconSize(ie,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,ye,Z,Wo(me.x,me.y,y,A,this.transform.angle),F,C,L,D.predicate).box.length===0)return}if(fe.box.length>0){let ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[ce]&&this.prevPlacement.placements[ce]&&this.prevPlacement.placements[ce].text&&(ye=this.prevPlacement.variableOffsets[ce].anchor),this.variableOffsets[ce]={textOffset:le,width:u,height:p,anchor:t,textScale:_,prevAnchor:ye},this.markUsedJustification(q,t,B,W),q.allowVerticalPlacement&&(this.markUsedOrientation(q,W,B),this.placedOrientations[ce]=W),{shift:me,placedGlyphBoxes:fe}}}placeLayerBucketPart(t,r,u,p){const{bucket:_,layout:y,paint:A,posMatrix:C,textLabelPlaneMatrix:L,labelToScreenMatrix:D,clippingData:F,textPixelRatio:B,holdingForFade:V,collisionBoxArray:q,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:Z,collisionGroup:X,latestFeatureIndex:ie}=t.parameters,se=y.get("text-optional"),ee=y.get("icon-optional"),ce=y.get("text-allow-overlap"),le=y.get("icon-allow-overlap"),me=y.get("text-rotation-alignment")==="map",fe=y.get("text-pitch-alignment")==="map",ye=y.get("symbol-z-elevate"),Ie=A.get("symbol-z-offset"),Te=A.get("symbol-elevation-reference")==="sea";this.transform.setProjection(_.projection);let be=ce&&(le||!_.hasIconData()||ee),ze=le&&(ce||!_.hasTextData()||se);const Je=!Ie.isConstant();!_.collisionArrays&&q&&_.deserializeCollisionBoxes(q),u&&p&&_.updateCollisionDebugBuffers(this.transform.zoom,q);const lt=(Ke,mt,Oe)=>{const{crossTileID:ot,numVerticalGlyphVertices:it}=Ke;let yt=null;if(F&&F.dynamicFilterNeedsFeature||Je){const xi=this.retainedQueryData[_.bucketInstanceId];yt=ie.loadFeature({featureIndex:Ke.featureIndex,bucketIndex:xi.bucketIndex,sourceLayerIndex:xi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(F&&!(0,F.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},yt,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new n.P(Ke.tileAnchorX,Ke.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[ot]=new Ts(!1,!1,!1,!0),void r.add(ot);const vt=Ie.evaluate(yt,{});if(r.has(ot))return;if(V)return void(this.placements[ot]=new Ts(!1,!1,!1));let at=!1,ut=!1,Ht=!0,St=!1,Ot=!1,ri=null,Vt={box:null,offscreen:null,occluded:null},Qt={box:null,offscreen:null,occluded:null},bi=null,yi=null,Yi=null,rr=0,ur=0,hs=0;Oe.textFeatureIndex?rr=Oe.textFeatureIndex:Ke.useRuntimeCollisionCircles&&(rr=Ke.featureIndex),Oe.verticalTextFeatureIndex&&(ur=Oe.verticalTextFeatureIndex);const Fr=xi=>{xi.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const Ni=this.transform.elevation;xi.elevation=Te?vt:vt+(Ni?Ni.getAtTileOffset(xi.tileID,xi.tileAnchorX,xi.tileAnchorY):0),xi.elevation+=Ke.zOffset},Ai=Oe.textBox;if(Ai){Fr(Ai);const xi=Wi=>{let Mr=n.bk.horizontal;if(_.allowVerticalPlacement&&!Wi&&this.prevPlacement){const Br=this.prevPlacement.placedOrientations[ot];Br&&(this.placedOrientations[ot]=Br,Mr=Br,this.markUsedOrientation(_,Mr,Ke))}return Mr},Ni=(Wi,Mr)=>{if(_.allowVerticalPlacement&&it>0&&Oe.verticalTextBox){for(const Br of _.writingModes)if(Br===n.bk.vertical?(Vt=Mr(),Qt=Vt):Vt=Wi(),Vt&&Vt.box&&Vt.box.length)break}else Vt=Wi()};if(y.get("text-variable-anchor")){let Wi=y.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ot]){const Li=this.prevPlacement.variableOffsets[ot];Wi.indexOf(Li.anchor)>0&&(Wi=Wi.filter(Yr=>Yr!==Li.anchor),Wi.unshift(Li.anchor))}const Mr=(Li,Yr,nn)=>{const Kr=_.getSymbolInstanceTextSize(W,Ke,this.transform.zoom,mt),ar=(Li.x2-Li.x1)*Kr+2*Li.padding,zn=(Li.y2-Li.y1)*Kr+2*Li.padding,On=Ke.hasIconTextFit&&!le?Yr:null;On&&Fr(On);let ds={box:[],offscreen:!1,occluded:!1};const ns=ce?2*Wi.length:Wi.length;for(let Hn=0;Hn<ns;++Hn){const fs=this.attemptAnchorPlacement(Wi[Hn%Wi.length],Li,ar,zn,Kr,me,fe,B,C,X,Hn>=Wi.length,Ke,mt,_,nn,On,W,Z);if(fs&&(ds=fs.placedGlyphBoxes,ds&&ds.box&&ds.box.length)){at=!0,ri=fs.shift;break}}return ds};Ni(()=>Mr(Ai,Oe.iconBox,n.bk.horizontal),()=>{const Li=Oe.verticalTextBox;return Li&&Fr(Li),_.allowVerticalPlacement&&!(Vt&&Vt.box&&Vt.box.length)&&it>0&&Li?Mr(Li,Oe.verticalIconBox,n.bk.vertical):{box:null,offscreen:null,occluded:null}}),Vt&&(at=Vt.box,Ht=Vt.offscreen,St=Vt.occluded);const Br=xi(!(!Vt||!Vt.box));if(!at&&this.prevPlacement){const Li=this.prevPlacement.variableOffsets[ot];Li&&(this.variableOffsets[ot]=Li,this.markUsedJustification(_,Li.anchor,Ke,Br))}}else{const Wi=(Mr,Br)=>{const Li=_.getSymbolInstanceTextSize(W,Ke,this.transform.zoom,mt),Yr=this.collisionIndex.placeCollisionBox(_,Li,Mr,new n.P(0,0),ce,B,C,X.predicate);return Yr&&Yr.box&&Yr.box.length&&(this.markUsedOrientation(_,Br,Ke),this.placedOrientations[ot]=Br),Yr};Ni(()=>Wi(Ai,n.bk.horizontal),()=>{const Mr=Oe.verticalTextBox;return _.allowVerticalPlacement&&it>0&&Mr?(Fr(Mr),Wi(Mr,n.bk.vertical)):{box:null,offscreen:null,occluded:null}}),xi(!!(Vt&&Vt.box&&Vt.box.length))}}if(bi=Vt,at=bi&&bi.box&&bi.box.length>0,Ht=bi&&bi.offscreen,St=bi&&bi.occluded,Ke.useRuntimeCollisionCircles){const xi=_.text.placedSymbolArray.get(Ke.centerJustifiedTextSymbolIndex>=0?Ke.centerJustifiedTextSymbolIndex:Ke.verticalPlacedTextSymbolIndex),Ni=n.bl(_.textSizeData,W,xi),Wi=y.get("text-padding");yi=this.collisionIndex.placeCollisionCircles(_,ce,xi,_.lineVertexArray,_.glyphOffsetArray,Ni,C,L,D,u,fe,X.predicate,Ke.collisionCircleDiameter*Ni/n.bq,Wi,this.retainedQueryData[_.bucketInstanceId].tileID),at=ce||yi.circles.length>0&&!yi.collisionDetected,Ht=Ht&&yi.offscreen,St=yi.occluded}if(Oe.iconFeatureIndex&&(hs=Oe.iconFeatureIndex),Oe.iconBox){const xi=Ni=>{Fr(Ni);const Wi=Ke.hasIconTextFit&&ri?Wo(ri.x,ri.y,me,fe,this.transform.angle):new n.P(0,0),Mr=_.getSymbolInstanceIconSize(Z,this.transform.zoom,Ke.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,Mr,Ni,Wi,le,B,C,X.predicate)};Qt&&Qt.box&&Qt.box.length&&Oe.verticalIconBox?(Yi=xi(Oe.verticalIconBox),ut=Yi.box.length>0):(Yi=xi(Oe.iconBox),ut=Yi.box.length>0),Ht=Ht&&Yi.offscreen,Ot=Yi.occluded}const tr=se||Ke.numHorizontalGlyphVertices===0&&it===0,mr=ee||Ke.numIconVertices===0;if(tr||mr?mr?tr||(ut=ut&&at):at=ut&&at:ut=at=ut&&at,at&&bi&&bi.box&&this.collisionIndex.insertCollisionBox(bi.box,y.get("text-ignore-placement"),_.bucketInstanceId,Qt&&Qt.box&&ur?ur:rr,X.ID),ut&&Yi&&this.collisionIndex.insertCollisionBox(Yi.box,y.get("icon-ignore-placement"),_.bucketInstanceId,hs,X.ID),yi&&(at&&this.collisionIndex.insertCollisionCircles(yi.circles,y.get("text-ignore-placement"),_.bucketInstanceId,rr,X.ID),u)){const xi=_.bucketInstanceId;let Ni=this.collisionCircleArrays[xi];Ni===void 0&&(Ni=this.collisionCircleArrays[xi]=new rn);for(let Wi=0;Wi<yi.circles.length;Wi+=4)Ni.circles.push(yi.circles[Wi+0]),Ni.circles.push(yi.circles[Wi+1]),Ni.circles.push(yi.circles[Wi+2]),Ni.circles.push(yi.collisionDetected?1:0)}const Qi=_.projection.name!=="globe";be=be&&(Qi||!St),ze=ze&&(Qi||!Ot),this.placements[ot]=new Ts(at||be,ut||ze,Ht||_.justReloaded),r.add(ot)};if(ye&&this.buildingIndex&&(this.buildingIndex.updateZOffset(_,this.retainedQueryData[_.bucketInstanceId].tileID),_.updateZOffset()),_.sortFeaturesByY){const Ke=_.getSortedSymbolIndexes(this.transform.angle);for(let mt=Ke.length-1;mt>=0;--mt){const Oe=Ke[mt];lt(_.symbolInstances.get(Oe),Oe,_.collisionArrays[Oe])}_.hasAnyZOffset&&n.w(`${_.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(_.hasAnyZOffset){const Ke=_.getSortedIndexesByZOffset();for(let mt=0;mt<Ke.length;++mt){const Oe=Ke[mt];lt(_.symbolInstances.get(Oe),Oe,_.collisionArrays[Oe])}}else for(let Ke=t.symbolInstanceStart;Ke<t.symbolInstanceEnd;Ke++)lt(_.symbolInstances.get(Ke),Ke,_.collisionArrays[Ke]);if(u&&_.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[_.bucketInstanceId];n.a6.mat4.invert(Ke.invProjMatrix,C),Ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,r,u,p){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:y,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:C,crossTileID:L}=u,D=n.bv(r),F=p===n.bk.vertical?C:D==="left"?_:D==="center"?y:D==="right"?A:-1;_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=F>=0&&_!==F?0:L),y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=F>=0&&y!==F?0:L),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=F>=0&&A!==F?0:L),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=F>=0&&C!==F?0:L)}markUsedOrientation(t,r,u){const p=r===n.bk.horizontal||r===n.bk.horizontalOnly?r:0,_=r===n.bk.vertical?r:0,{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:L}=u,D=t.text.placedSymbolArray;y>=0&&(D.get(y).placedOrientation=p),A>=0&&(D.get(A).placedOrientation=p),C>=0&&(D.get(C).placedOrientation=p),L>=0&&(D.get(L).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let u=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const p=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},y=r?r.variableOffsets:{},A=r?r.placedOrientations:{};for(const C in this.placements){const L=this.placements[C],D=_[C];D?(this.opacities[C]=new Ln(D,p,L.text,L.icon,null,L.clipped),u=u||L.text!==D.text.placed||L.icon!==D.icon.placed):(this.opacities[C]=new Ln(null,p,L.text,L.icon,L.skipFade,L.clipped),u=u||L.text||L.icon)}for(const C in _){const L=_[C];if(!this.opacities[C]){const D=new Ln(L,p,!1,!1);D.isHidden()||(this.opacities[C]=D,u=u||L.text.placed||L.icon.placed)}}for(const C in y)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=y[C]);for(const C in A)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=A[C]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r,u,p){const _=new Set;for(const y of r){const A=y.getBucket(t);A&&y.latestFeatureIndex&&t.fqid===A.layerIds[0]&&(this.updateBucketOpacities(A,_,y,y.collisionBoxArray,u,p,y.tileID,t.scope),A.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(A,y.tileID),A.updateZOffset()))}}updateBucketOpacities(t,r,u,p,_,y,A,C){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const L=t.layers[0].layout,D=t.layers[0].paint,F=!!t.layers[0].dynamicFilter(),B=new Ln(null,0,!1,!1,!0),V=L.get("text-allow-overlap"),q=L.get("icon-allow-overlap"),W=L.get("text-variable-anchor"),Z=L.get("text-rotation-alignment")==="map",X=L.get("text-pitch-alignment")==="map",ie=D.get("symbol-z-offset"),se=D.get("symbol-elevation-reference")==="sea",ee=!ie.isConstant(),ce=new Ln(null,0,V&&(q||!t.hasIconData()||L.get("icon-optional")),q&&(V||!t.hasTextData()||L.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const le=(fe,ye,Ie)=>{for(let Te=0;Te<ye/4;Te++)fe.opacityVertexArray.emplaceBack(Ie)};let me=0;y&&t.updateReplacement(A,y);for(let fe=0;fe<t.symbolInstances.length;fe++){const ye=t.symbolInstances.get(fe),{numHorizontalGlyphVertices:Ie,numVerticalGlyphVertices:Te,crossTileID:be,numIconVertices:ze,tileAnchorX:Je,tileAnchorY:lt}=ye;let Ke=null;if(ye&&ee){const St=this.retainedQueryData[t.bucketInstanceId];Ke=u.latestFeatureIndex.loadFeature({featureIndex:ye.featureIndex,bucketIndex:St.bucketIndex,sourceLayerIndex:St.sourceLayerIndex,layoutVertexArrayOffset:0})}const mt=ie.evaluate(Ke,{}),Oe=r.has(be);let ot=this.opacities[be];Oe?ot=B:ot||(ot=ce,this.opacities[be]=ot),r.add(be);const it=Ie>0||Te>0,yt=ze>0,vt=this.placedOrientations[be],at=vt===n.bk.vertical,ut=vt===n.bk.horizontal||vt===n.bk.horizontalOnly;!it&&!yt||ot.isHidden()||me++;let Ht=!1;if((it||yt)&&y)for(const St of t.activeReplacements){if(n.br(St,_,n.bs.Symbol,C)||St.min.x>Je||Je>St.max.x||St.min.y>lt||lt>St.max.y)continue;const Ot=n.bt(Je,lt,A.canonical,St.footprintTileId.canonical);if(Ht=n.bu(Ot,St.footprint),Ht)break}if(it){const St=Ht?Ra:Pa(ot.text);le(t.text,Ie,at?Ra:St),le(t.text,Te,ut?Ra:St);const Ot=ot.text.isHidden(),{leftJustifiedTextSymbolIndex:ri,centerJustifiedTextSymbolIndex:Vt,rightJustifiedTextSymbolIndex:Qt,verticalPlacedTextSymbolIndex:bi}=ye,yi=t.text.placedSymbolArray,Yi=Ot||at?1:0;ri>=0&&(yi.get(ri).hidden=Yi),Vt>=0&&(yi.get(Vt).hidden=Yi),Qt>=0&&(yi.get(Qt).hidden=Yi),bi>=0&&(yi.get(bi).hidden=Ot||ut?1:0);const rr=this.variableOffsets[be];rr&&this.markUsedJustification(t,rr.anchor,ye,vt);const ur=this.placedOrientations[be];ur&&(this.markUsedJustification(t,"left",ye,ur),this.markUsedOrientation(t,ur,ye))}if(yt){const St=Ht?Ra:Pa(ot.icon),{placedIconSymbolIndex:Ot,verticalPlacedIconSymbolIndex:ri}=ye,Vt=t.icon.placedSymbolArray,Qt=ot.icon.isHidden()?1:0;Ot>=0&&(le(t.icon,ze,at?Ra:St),Vt.get(Ot).hidden=Qt),ri>=0&&(le(t.icon,ye.numVerticalIconVertices,ut?Ra:St),Vt.get(ri).hidden=Qt)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const St=t.collisionArrays[fe];if(St){let Ot=new n.P(0,0),ri=!0;if(St.textBox||St.verticalTextBox){if(W){const Qt=this.variableOffsets[be];Qt?(Ot=Ca(Qt.anchor,Qt.width,Qt.height,Qt.textOffset,Qt.textScale),Z&&Ot._rotate(X?this.transform.angle:-this.transform.angle)):ri=!1}F&&(ri=!ot.clipped),St.textBox&&kc(t.textCollisionBox.collisionVertexArray,ot.text.placed,!ri||at,mt,se,Ot.x,Ot.y),St.verticalTextBox&&kc(t.textCollisionBox.collisionVertexArray,ot.text.placed,!ri||ut,mt,se,Ot.x,Ot.y)}const Vt=ri&&!!(!ut&&St.verticalIconBox);St.iconBox&&kc(t.iconCollisionBox.collisionVertexArray,ot.icon.placed,Vt,mt,se,ye.hasIconTextFit?Ot.x:0,ye.hasIconTextFit?Ot.y:0),St.verticalIconBox&&kc(t.iconCollisionBox.collisionVertexArray,ot.icon.placed,!Vt,mt,se,ye.hasIconTextFit?Ot.x:0,ye.hasIconTextFit?Ot.y:0)}}}if(t.fullyClipped=me===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const fe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=fe.invProjMatrix,t.placementViewportMatrix=fe.viewportMatrix,t.collisionCircleArray=fe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const u=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function kc(c,t,r,u,p,_,y){c.emplaceBack(t?1:0,r?1:0,_||0,y||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,y||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,y||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,y||0,u,p?1:0)}const eo=Math.pow(2,25),__=Math.pow(2,24),kf=Math.pow(2,17),Gn=Math.pow(2,16),g_=Math.pow(2,9),Fc=Math.pow(2,8),Ff=Math.pow(2,1);function Pa(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,r=Math.floor(127*c.opacity);return r*eo+t*__+r*kf+t*Gn+r*g_+t*Fc+r*Ff+t}const Ra=0;class y_{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,u,p,_){const y=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(y,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((A,C)=>A.sortKey-C.sortKey));this._currentPartIndex<y.length;){const A=y[this._currentPartIndex];if(r.placeLayerBucketPart(A,this._seenCrossTileIDs,u,A.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class Dl{constructor(t,r,u,p,_,y,A,C,L){this.placement=new Zo(t,_,y,A,C,L),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,r,u,p){const _=n.q.now(),y=()=>{const A=n.q.now()-_;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=r[t[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=C)&&(!A.maxzoom||A.maxzoom>C)){const L=A,D=L.layout.get("symbol-z-elevate"),F=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,B=L.layout.get("symbol-z-order"),V=B==="viewport-y"||B==="auto"&&!(B!=="viewport-y"&&F),q=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),W=V&&q,Z=this._inProgressLayer=this._inProgressLayer||new y_(L),X=n.av(A.source,A.scope);if(Z.continuePlacement(D||W?p[X]:u[X],this.placement,this._showCollisionBoxes,A,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Xo=512/n.ab/2;class x_{constructor(t,r,u){this.tileID=t,this.bucketInstanceId=u,this.index=new n.by(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*n.ab,_=t.canonical.y*n.ab;for(let y=0;y<r.length;y++){const{key:A,crossTileID:C,tileAnchorX:L,tileAnchorY:D}=r.get(y),F=Math.floor((p+L)*Xo),B=Math.floor((_+D)*Xo);this.index.add(F,B),this.keys.push(A),this.crossTileIDs.push(C)}this.index.finish()}findMatches(t,r,u){const p=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),_=Xo/Math.pow(2,r.canonical.z-this.tileID.canonical.z),y=r.canonical.x*n.ab,A=r.canonical.y*n.ab;for(let C=0;C<t.length;C++){const L=t.get(C);if(L.crossTileID)continue;const{key:D,tileAnchorX:F,tileAnchorY:B}=L,V=Math.floor((y+F)*_),q=Math.floor((A+B)*_),W=this.index.range(V-p,q-p,V+p,q+p);for(const Z of W){const X=this.crossTileIDs[Z];if(this.keys[Z]===D&&!u.has(X)){u.add(X),L.crossTileID=X;break}}}}}class La{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Bf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const u in this.indexes){const p=this.indexes[u],_={};for(const y in p){const A=p[y];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+r),_[A.tileID.key]=A}this.indexes[u]=_}this.lng=t}addBucket(t,r,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const y=this.indexes[_];if(Number(_)>t.overscaledZ)for(const A in y){const C=y[A];C.tileID.isChildOf(t)&&C.findMatches(r.symbolInstances,t,p)}else{const A=y[t.scaledTo(Number(_)).key];A&&A.findMatches(r.symbolInstances,t,p)}}for(let _=0;_<r.symbolInstances.length;_++){const y=r.symbolInstances.get(_);y.crossTileID||(y.crossTileID=u.generate(),p.add(y.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new x_(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const u of r.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let r=!1;for(const u in this.indexes){const p=this.indexes[u];for(const _ in p)t[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[_]),delete p[_],r=!0)}return r}}class Bc{constructor(){this.layerIndexes={},this.crossTileIDs=new La,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,u,p){let _=this.layerIndexes[t.fqid];_===void 0&&(_=this.layerIndexes[t.fqid]=new Bf);let y=!1;const A={};p.name!=="globe"&&_.handleWrapJump(u);for(const C of r){const L=C.getBucket(t);L&&t.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(C.tileID,L,this.crossTileIDs)&&(y=!0),A[L.bucketInstanceId]=!0)}return _.removeStaleBuckets(A)&&(y=!0),y}pruneUnusedLayers(t){const r={};t.forEach(u=>{r[u]=!0});for(const u in this.layerIndexes)r[u]||delete this.layerIndexes[u]}}const Qn=771;class Ei{constructor(t,r,u,p){this.blendFunction=t,this.blendColor=r,this.mask=u,this.blendEquation=p}}Ei.Replace=[1,0,1,0],Ei.disabled=new Ei(Ei.Replace,n.bz.transparent,[!1,!1,!1,!1]),Ei.unblended=new Ei(Ei.Replace,n.bz.transparent,[!0,!0,!0,!0]),Ei.alphaBlended=new Ei([1,Qn,1,Qn],n.bz.transparent,[!0,!0,!0,!0]),Ei.alphaBlendedNonPremultiplied=new Ei([770,Qn,770,Qn],n.bz.transparent,[!0,!0,!0,!0]),Ei.multiply=new Ei([774,0,774,0],n.bz.transparent,[!0,!0,!0,!0]);class Yt{constructor(t,r,u){this.func=t,this.mask=r,this.range=u}}Yt.ReadOnly=!1,Yt.ReadWrite=!0,Yt.disabled=new Yt(519,Yt.ReadOnly,[0,1]);const vh=7680;class pi{constructor(t,r,u,p,_,y){this.test=t,this.ref=r,this.mask=u,this.fail=p,this.depthFail=_,this.pass=y}}pi.disabled=new pi({func:519,mask:0},0,0,vh,vh,vh);const bh=1029,zl=2305;class oi{constructor(t,r,u){this.enable=t,this.mode=r,this.frontFace=u}}function wh(c,t){const r=n.bC(c,3);n.a6.mat4.fromQuat(c,t),n.bE(c,3,r)}function Nc(c,t){const r=n.a6.quat.identity([]);return n.a6.quat.rotateZ(r,r,-t),n.a6.quat.rotateX(r,r,-c),r}function Th(c,t){const r=[c[0],c[1],0],u=[t[0],t[1],0];if(n.a6.vec3.length(r)>=1e-15){const y=n.a6.vec3.normalize([],r);n.a6.vec3.scale(u,y,n.a6.vec3.dot(u,y)),t[0]=u[0],t[1]=u[1]}const p=n.a6.vec3.cross([],t,c);if(n.a6.vec3.len(p)<1e-15)return null;const _=Math.atan2(-p[1],p[0]);return Nc(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),_)}oi.disabled=new oi(!1,bh,zl),oi.backCCW=new oi(!0,bh,zl),oi.backCW=new oi(!0,bh,2304),oi.frontCW=new oi(!0,1028,2304),oi.frontCCW=new oi(!0,1028,zl);class To{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof n.a5?t:new n.a5(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=n.bA(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const u=this.position,p=this._elevation?this._elevation.getAtPointOrZero(n.a5.fromLngLat(t)):0,_=n.a5.fromLngLat(t,p),y=[_.x-u.x,_.y-u.y,_.z-u.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=Th(y,r)}setPitchBearing(t,r){this.orientation=Nc(n.bB(t),n.bB(-r))}}class Yo{constructor(t,r){this._transform=n.a6.mat4.identity([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new n.a5(t[0],t[1],t[2])}get position(){const t=n.bC(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&n.bE(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.a6.quat.identity([]),t&&wh(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=Nc(t,r),wh(this._transform,this._orientation)}forward(){const t=n.bC(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=n.bC(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=n.bC(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const u=new Float64Array(16);return n.a6.mat4.invert(u,this.getWorldToCamera(t,r)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,u){const p=this.position;n.a6.vec3.scale(p,p,-t);const _=new Float64Array(16);return n.a6.mat4.fromScaling(_,[u,u,u]),n.a6.mat4.translate(_,_,p),_[10]*=r,_}getWorldToCamera(t,r){const u=new Float64Array(16),p=new Float64Array(4),_=this.position;return n.a6.quat.conjugate(p,this._orientation),n.a6.vec3.scale(_,_,-t),n.a6.mat4.fromQuat(u,p),n.a6.mat4.translate(u,u,_),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=r,u[9]*=r,u[10]*=r,u[11]*=r,u}getCameraToClipPerspective(t,r,u,p){const _=new Float64Array(16);return n.a6.mat4.perspective(_,t,r,u,p),_}getCameraToClipOrthographic(t,r,u,p,_,y){const A=new Float64Array(16);return n.a6.mat4.ortho(A,t,r,u,p,_,y),A}getDistanceToElevation(t,r=!1){const u=t===0?0:n.bD(t,r?n.aM(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new Yo([...this.position],[...this.orientation])}}const gn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Uc{constructor(t=0,r=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=u,this.right=p}interpolate(t,r,u){return r.top!=null&&t.top!=null&&(this.top=n.aa(t.top,r.top,u)),r.bottom!=null&&t.bottom!=null&&(this.bottom=n.aa(t.bottom,r.bottom,u)),r.left!=null&&t.left!=null&&(this.left=n.aa(t.left,r.left,u)),r.right!=null&&t.right!=null&&(this.right=n.aa(t.right,r.right,u)),this}getCenter(t,r){const u=n.ap((this.left+t-this.right)/2,0,t),p=n.ap((this.top+r-this.bottom)/2,0,r);return new n.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Uc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Da=(c,t,r)=>(1-r)*c+r*t,za=c=>c*c*c*c*c;class Vc{constructor(t,r,u,p,_,y,A){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(y),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new n.bK(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Uc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Yo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new Vc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,r=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return n.ar(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=n.bL(this.projectionOptions);const u=this.getProjection(),p=!n.bh(r,u);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.bL({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.bD(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bA(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=n.a6.mat2.create(),n.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=n.ap(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.bB(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,_=0;for(let y=0;y<r.length;y++){const A=new n.P(r[y][0]*this.width,u+r[y][1]*(this.height-u)),C=t.pointCoordinate(A);if(!C)continue;const L=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);p+=C[3]*L,_+=L}return _===0?NaN:p/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*r,p=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),y=Math.max(p-u,_);this._setZoom(this._zoomFromMercatorZ(y))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const p=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,u));return n.ap(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!n.a6.quat.exactEquals(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];n.a6.vec3.exactEquals(u,this._camera.position)||(this._setCameraPosition(u),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new To;return r.position=new n.a5(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!n.a6.quat.length(t))return!1;n.a6.quat.normalize(t,t);const r=n.a6.vec3.transformQuat([],[0,0,-1],t),u=n.a6.vec3.transformQuat([],[0,-1,0],t);if(u[2]<0)return!1;const p=Th(r,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=n.ap(t[2],p/u,p/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,u){this._unmodified=!1,this._edgeInsets.interpolate(t,r,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new n.bM(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new n.P(0,0)),p=this.pointCoordinate(new n.P(this.width,0)),_=this.pointCoordinate(new n.P(this.width,this.height)),y=this.pointCoordinate(new n.P(0,this.height)),A=Math.floor(Math.min(u.x,p.x,_.x,y.x)),C=Math.floor(Math.max(u.x,p.x,_.x,y.x)),L=1;for(let D=A-L;D<=C+L;D++)D!==0&&r.push(new n.bM(D,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,u){let p=[];const _=u!==void 0,y=!_;if(y&&this.zoom<r||_&&u[0]===0&&u[1]===0)return p;const A=new Set,C=(D,F,B,V,q)=>{const W=n.c1(F,D,B,V,q);A.has(W)||(p.push(new n.aA(D,F,B,V,q)),A.add(W))};for(let D=0;D<t.length;D++){const F=t[D];if(y&&F.canonical.z!==r)continue;const B=F.canonical,V=F.overscaledZ,q=F.wrap,W=1<<B.z,Z=B.x+1<W,X=B.x>0,ie=B.y+1<W,se=B.y>0,ee=F.wrap-(X?0:1),ce=F.wrap+(Z?0:1),le=X?B.x-1:W-1,me=Z?B.x+1:0;if(_)u[0]<0?(C(V,ce,B.z,me,B.y),u[1]<0&&ie&&(C(V,q,B.z,B.x,B.y+1),C(V,ce,B.z,me,B.y+1)),u[1]>0&&se&&(C(V,q,B.z,B.x,B.y-1),C(V,ce,B.z,me,B.y-1))):u[0]>0?(C(V,ee,B.z,le,B.y),u[1]<0&&ie&&(C(V,q,B.z,B.x,B.y+1),C(V,ee,B.z,le,B.y+1)),u[1]>0&&se&&(C(V,q,B.z,B.x,B.y-1),C(V,ee,B.z,le,B.y-1))):u[1]<0&&ie?C(V,q,B.z,B.x,B.y+1):se&&C(V,q,B.z,B.x,B.y-1);else{const fe=F.visibleQuadrants;1&fe&&(C(V,ee,B.z,le,B.y),se&&(C(V,q,B.z,B.x,B.y-1),C(V,ee,B.z,le,B.y-1))),2&fe&&(C(V,ce,B.z,me,B.y),se&&(C(V,q,B.z,B.x,B.y-1),C(V,ce,B.z,me,B.y-1))),4&fe&&(C(V,ee,B.z,le,B.y),ie&&(C(V,q,B.z,B.x,B.y+1),C(V,ee,B.z,le,B.y+1))),8&fe&&(C(V,ce,B.z,me,B.y),ie&&(C(V,q,B.z,B.x,B.y+1),C(V,ce,B.z,me,B.y+1)))}}const L=[];for(const D of p)p.some(F=>D.isChildOf(F))||L.push(D);if(p=L.filter(D=>!t.some(F=>!!(D.overscaledZ<r&&F.isChildOf(D))||D.equals(F)||D.isChildOf(F))),y){const D=1<<r,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[D*F.x,D*F.y],V=4,q=V*V;p=p.filter(W=>{const Z=W.canonical.x+.5-B[0],X=W.canonical.y+.5-B[1];return Z*Z+X*X<q})}return p}coveringTiles(t){let r=this.coveringZoomLevel(t);const u=r,p=this.elevation&&this.elevation.exaggeration(),_=p&&!t.isTerrainDEM,y=this.projection.name==="mercator";if(t.minzoom!==void 0&&r<t.minzoom)return[];t.maxzoom!==void 0&&r>t.maxzoom&&(r=t.maxzoom);const A=this.locationCoordinate(this.center),C=this.center.lat,L=1<<r,D=[L*A.x,L*A.y,0],F=this.projection.name==="globe",B=!F,V=n.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,B),q=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=L*n.bD(1,this.center.lat),Z=this._camera.position[2]/n.bD(1,this.center.lat),X=[L*q.x,L*q.y,Z*(B?1:W)],ie=F||p,se=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ee=this.isLODDisabled(!0)?r:0;let ce;if(this._elevation&&t.isTerrainDEM)ce=1e4*this._elevation.exaggeration();else if(this._elevation){const Oe=this._elevation.getMinMaxForVisibleTiles();ce=Oe?Oe.max:this._centerAltitude}else ce=this._centerAltitude;const le=t.isTerrainDEM?-ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,me=this.projection.isReprojectedInTileSpace?n.bO(this):1,fe=Oe=>{const it=new n.a5(Oe.x+25e-6,Oe.y,Oe.z),yt=new n.a5(Oe.x,Oe.y+25e-6,Oe.z),vt=Oe.toLngLat(),at=it.toLngLat(),ut=yt.toLngLat(),Ht=this.locationCoordinate(vt),St=this.locationCoordinate(at),Ot=this.locationCoordinate(ut),ri=Math.hypot(St.x-Ht.x,St.y-Ht.y),Vt=Math.hypot(Ot.x-Ht.x,Ot.y-Ht.y);return Math.sqrt(ri*Vt)*me/25e-6},ye=Oe=>{const ot=ce,it=le;return{aabb:n.bR(this,L,0,0,0,Oe,it,ot,this.projection),zoom:0,x:0,y:0,minZ:it,maxZ:ot,wrap:Oe,fullyVisible:!1}},Ie=[];let Te=[];const be=r,ze=t.reparseOverscaled?u:r,Je=(Z-this._centerAltitude)*W,lt=Oe=>{if(!this._elevation||!Oe.tileID||!y)return;const ot=this._elevation.getMinMaxForTile(Oe.tileID),it=Oe.aabb;ot?(it.min[2]=ot.min,it.max[2]=ot.max,it.center[2]=(it.min[2]+it.max[2])/2):(Oe.shouldSplit=mt(Oe),Oe.shouldSplit||(it.min[2]=it.max[2]=it.center[2]=this._centerAltitude))},Ke=(Oe,ot)=>{if(.707*ot<Oe)return 1;const it=ot/Oe;return it/(1.4144271570014144+(Math.pow(1.1,it-1.4144271570014144+1)-1)/(1.1-1)-1)},mt=Oe=>{if(Oe.zoom<ee)return!0;if(Oe.zoom===be)return!1;if(Oe.shouldSplit!=null)return Oe.shouldSplit;const ot=Oe.aabb.distanceX(X),it=Oe.aabb.distanceY(X);let yt=Je,vt=1;if(F){yt=Oe.aabb.distanceZ(X);const Vt=Math.pow(2,Oe.zoom),Qt=n.aM((Oe.y+1)/Vt),bi=n.aM(Oe.y/Vt),yi=Math.min(Math.max(C,Qt),bi),Yi=n.c5(yi)/n.c5(C);if(vt=yi===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Yi/this._mercatorScaleRatio),this.zoom<=n.c2&&Oe.zoom===be-1&&Yi>=.9)return!0}else if(_&&(yt=Oe.aabb.distanceZ(X)*W),this.projection.isReprojectedInTileSpace&&u<=5){const Vt=Math.pow(2,Oe.zoom),Qt=fe(new n.a5((Oe.x+.5)/Vt,(Oe.y+.5)/Vt));vt=Qt>.85?1:Qt}if(!y){const Vt=Math.sqrt(ot*ot+it*it+yt*yt);let Qt=(1<<be-Oe.zoom)*se*vt;return Qt*=Ke(Math.max(yt,Je),Vt),Vt<Qt}let at=Number.MAX_VALUE,ut=0;const Ht=Oe.aabb.getCorners(),St=[];for(const Vt of Ht){n.a6.vec3.sub(St,Vt,X),F||(_?St[2]*=W:St[2]=Je);const Qt=n.a6.vec3.dot(St,this._camera.forward());Qt<at&&(at=Qt,ut=Math.abs(St[2]))}let Ot=(1<<be-Oe.zoom)*se*vt;if(Ot*=Ke(Math.max(ut,Je),at),at<Ot)return!0;const ri=Oe.aabb.closestPoint(D);return ri[0]===D[0]&&ri[1]===D[1]};if(this.renderWorldCopies)for(let Oe=1;Oe<=3;Oe++)Ie.push(ye(-Oe)),Ie.push(ye(Oe));for(Ie.push(ye(0));Ie.length>0;){const Oe=Ie.pop(),ot=Oe.x,it=Oe.y;let yt=Oe.fullyVisible;const vt=()=>this.projection.name==="globe"&&(Oe.y===0||Oe.y===(1<<Oe.zoom)-1);if(!yt){let at=ie?Oe.aabb.intersects(V):Oe.aabb.intersectsFlat(V);if(at===0&&vt()){const ut=new n.bP(Oe.zoom,ot,it);at=n.bQ(this,L,ut,!0).intersects(V)}if(at===0)continue;yt=at===2}if(Oe.zoom!==be&&mt(Oe))for(let at=0;at<4;at++){const ut=(ot<<1)+at%2,Ht=(it<<1)+(at>>1),St={aabb:y?Oe.aabb.quadrant(at):n.bR(this,L,Oe.zoom+1,ut,Ht,Oe.wrap,Oe.minZ,Oe.maxZ,this.projection),zoom:Oe.zoom+1,x:ut,y:Ht,wrap:Oe.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:Oe.minZ,maxZ:Oe.maxZ};_&&!F&&(St.tileID=new n.aA(Oe.zoom+1===be?ze:Oe.zoom+1,Oe.wrap,Oe.zoom+1,ut,Ht),lt(St)),Ie.push(St)}else{const at=Oe.zoom===be?ze:Oe.zoom;if(t.minzoom&&t.minzoom>at)continue;let ut=0;if(!yt){let ri=ie?Oe.aabb.intersectsPrecise(V):Oe.aabb.intersectsPreciseFlat(V);if(ri===0&&vt()){const Vt=new n.bP(Oe.zoom,ot,it);ri=n.bQ(this,L,Vt,!0).intersectsPrecise(V)}if(ri===0)continue;if(t.calculateQuadrantVisibility)if(V.containsPoint(Oe.aabb.center))ut=15;else for(let Vt=0;Vt<4;Vt++)Oe.aabb.quadrant(Vt).intersects(V)!==0&&(ut|=1<<Vt)}const Ht=D[0]-(.5+ot+(Oe.wrap<<Oe.zoom))*(1<<r-Oe.zoom),St=D[1]-.5-it,Ot=Oe.tileID?Oe.tileID:new n.aA(at,Oe.wrap,Oe.zoom,ot,it);t.calculateQuadrantVisibility&&(Ot.visibleQuadrants=ut),Te.push({tileID:Ot,distanceSq:Ht*Ht+St*St})}}if(this.fogCullDistSq){const Oe=this.fogCullDistSq,ot=this.horizonLineFromTop();Te=Te.filter(it=>{const yt=[0,0,0,1],vt=[n.ab,n.ab,0,1],at=this.calculateFogTileMatrix(it.tileID.toUnwrapped());n.a6.vec4.transformMat4(yt,yt,at),n.a6.vec4.transformMat4(vt,vt,at);const ut=n.a6.vec4.min([],yt,vt),Ht=n.a6.vec4.max([],yt,vt),St=n.bS(ut,Ht);if(St===0)return!0;let Ot=!1;const ri=this._elevation;if(ri&&St>Oe&&ot!==0){const Vt=this.calculateProjMatrix(it.tileID.toUnwrapped());let Qt;t.isTerrainDEM||(Qt=ri.getMinMaxForTile(it.tileID)),Qt||(Qt={min:le,max:ce});const bi=n.c3(this.rotation),yi=[bi[0]*n.ab,bi[1]*n.ab,Qt.max];n.a6.vec3.transformMat4(yi,yi,Vt),Ot=(1-yi[1])*this.height*.5<ot}return St<Oe||Ot})}return Te.sort((Oe,ot)=>Oe.distanceSq-ot.distanceSq).map(Oe=>Oe.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=n.ap(t.lat,-n.bT,n.bT),u=this.projection.project(t.lng,r);return new n.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.bD(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let u,p;const _=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;u=(r.x-_.x)/A,p=(r.y-_.y)/A}else{const A=this.pointCoordinate(r),C=this.pointCoordinate(_);u=A.x-C.x,p=A.y-C.y}const y=this.locationCoordinate(t);this.setLocation(new n.a5(y.x-u,y.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,r){const u=r?n.bD(r,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new n.a5(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const u=r??this._centerAltitude,p=[t.x,t.y,0,1],_=[t.x,t.y,1,1];n.a6.vec4.transformMat4(p,p,this.pixelMatrixInverse),n.a6.vec4.transformMat4(_,_,this.pixelMatrixInverse);const y=_[3];n.a6.vec4.scale(p,p,1/p[3]),n.a6.vec4.scale(_,_,1/y);const A=p[2],C=_[2];return{p0:p,p1:_,t:A===C?0:(u-A)/(C-A)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return n.a6.vec4.transformMat4(r,r,this.pixelMatrixInverse),n.a6.vec4.transformMat4(u,u,this.pixelMatrixInverse),n.a6.vec4.scale(r,r,1/r[3]),n.a6.vec4.scale(u,u,1/u[3]),r[2]=n.bD(r[2],this._center.lat)*this.worldSize,u[2]=n.bD(u[2],this._center.lat)*this.worldSize,n.a6.vec4.scale(r,r,1/this.worldSize),n.a6.vec4.scale(u,u,1/this.worldSize),new n.aj([r[0],r[1],r[2]],n.a6.vec3.normalize([],n.a6.vec3.sub([],u,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:u,t:p}=t,_=n.bD(r[2],this._center.lat),y=n.bD(u[2],this._center.lat);return new n.a5(n.aa(r[0],u[0],p)/this.worldSize,n.aa(r[1],u[1],p)/this.worldSize,n.aa(_,y,p))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let r=this.projection.pointCoordinate3D(this,t.x,t.y);if(r)return new n.a5(r[0],r[1],r[2]);let u=0,p=this.horizonLineFromTop();if(t.y>p)return this.pointCoordinate(t);const _=.02*p,y=t.clone();for(let A=0;A<10&&p-u>_;A++){y.y=n.aa(u,p,.66);const C=this.projection.pointCoordinate3D(this,y.x,y.y);C?(p=y.y,r=C):u=y.y}return r?new n.a5(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.bU)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const u=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return n.a6.vec4.transformMat4(p,p,this.pixelMatrix),p[3]>0?new n.P(p[0]/p[3],p[1]/p[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,_=this.pointLocation3D(new n.P(r,t)),y=this.pointLocation3D(new n.P(p,t)),A=this.pointLocation3D(new n.P(p,u)),C=this.pointLocation3D(new n.P(r,u));let L=Math.min(_.lng,y.lng,A.lng,C.lng),D=Math.max(_.lng,y.lng,A.lng,C.lng),F=Math.min(_.lat,y.lat,A.lat,C.lat),B=Math.max(_.lat,y.lat,A.lat,C.lat);const V=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,W=(Z,X,ie,se,ee)=>{const ce=(Z+ie)/2,le=(X+se)/2,me=new n.P(ce,le),{lng:fe,lat:ye}=this.pointLocation3D(me),Ie=Math.max(0,L-fe,F-ye,fe-D,ye-B);L=Math.min(L,fe),D=Math.max(D,fe),F=Math.min(F,ye),B=Math.max(B,ye),(ee<q||Ie>V)&&(W(Z,X,ce,le,ee+1),W(ce,le,ie,se,ee+1))};if(W(r,t,p,t,1),W(p,t,p,u,1),W(p,u,r,u,1),W(r,u,r,t,1),this.projection.name==="globe"){const[Z,X]=n.bV(this);Z?(B=90,D=180,L=-180):X&&(F=-90,D=180,L=-180)}return new n.as(new n.bK(L,F),new n.bK(D,B))}_getBoundsRectangular(t,r){const{top:u,left:p}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,A=new n.P(p,u),C=new n.P(y,u),L=new n.P(y,_),D=new n.P(p,_);let F=this.pointCoordinate(A,t),B=this.pointCoordinate(C,t);const V=this.pointCoordinate(L,r),q=this.pointCoordinate(D,r),W=(Z,X)=>(X.y-Z.y)/(X.x-Z.x);return F.y>1&&B.y>=0?F=new n.a5((1-q.y)/W(q,F)+q.x,1):F.y<0&&B.y<=1&&(F=new n.a5(-q.y/W(q,F)+q.x,0)),B.y>1&&F.y>=0?B=new n.a5((1-V.y)/W(V,B)+V.x,1):B.y<0&&F.y<=1&&(B=new n.a5(-V.y/W(V,B)+V.x,0)),new n.as().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce((u,p)=>{if(p.dem){const _=p.dem.tree;u.min=Math.min(u.min,_.minimums[0]),u.max=Math.max(u.max,_.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.bT,this.maxLat=n.bT,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.am(this.minLng)*this.tileSize,this.worldMaxX=n.am(this.maxLng)*this.tileSize,this.worldMinY=n.at(this.maxLat)*this.tileSize,this.worldMaxY=n.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,u=this._distanceTileDataCache;if(u[r])return u[r];const p=t.canonical,_=1/this.height,y=this.cameraWorldSize,A=y/this.zoomScale(p.z),C=(p.x+Math.pow(2,p.z)*t.wrap)*A,L=p.y*A,D=this.point;D.x*=y/this.worldSize,D.y*=y/this.worldSize;const F=this.angle,B=Math.sin(-F),V=-Math.cos(-F);return u[r]={bearing:[B,V],center:[(D.x-C)*_,(D.y-L)*_],scale:A/n.ab*_},u[r]}calculateFogTileMatrix(t){const r=t.key,u=this._fogTileMatrixCache;if(u[r])return u[r];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.a6.mat4.multiply(p,this.worldToFogMatrix,p),u[r]=new Float32Array(p),u[r]}calculateProjMatrix(t,r=!1,u=!1){const p=t.key;let _;if(_=u?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,_[p])return _[p];const y=this.calculatePosMatrix(t,this.worldSize);let A;return A=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,n.a6.mat4.multiply(y,A,y),_[p]=new Float32Array(y),_[p]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[r])return u[r];const p=n.bW(t,this);return u[r]=p,u[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,r=n.a6.mat4.fromScaling([],[t,t,t]);return n.a6.mat4.multiply(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const r=n.bD(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(r),p=this._camera.forward(),_=n.bD(1,this._center.lat);u[2]/=_,p[2]/=_,n.a6.vec3.normalize(p,p);const y=t.raycast(u,p,t.exaggeration());if(y){const A=n.a6.vec3.scaleAndAdd([],u,p,y),C=new n.a5(A[0],A[1],n.bD(A[2],n.aM(A[1]))),L=(C.z+n.a6.vec3.length([C.x-u[0],C.y-u[1],C.z-u[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,u=n.bD(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),_=r.getAtPointOrZero(new n.a5(...p)),y=this.pixelsPerMeter/this.worldSize*_,A=this._minimumHeightOverTerrain(),C=p[2]-y;if(C<=A)if(C<0||t){const L=this.locationCoordinate(this._center,this._centerAltitude),D=[p[0],p[1],L.z-p[2]],F=n.a6.vec3.length(D);D[2]-=(A-C)/this._pixelsPerMercatorPixel;const B=n.a6.vec3.length(D);if(B===0)return;n.a6.vec3.scale(D,D,F/B*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],L.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=n.ap(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=n.ap(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const r=this._unmodified,{x:u,y:p}=this.point;let _=0,y=u,A=p;const C=this.width/2,L=this.height/2,D=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(p-L<D&&(A=D+L),p+L>F&&(A=F-L),F-D<this.height&&(_=Math.max(_,this.height/(F-D)),A=(F+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,q=this.worldSize/2-(B+V)/2;y=(u+q+this.worldSize)%this.worldSize-q,y-C<B&&(y=B+C),y+C>V&&(y=V-C),V-B<this.width&&(_=Math.max(_,this.width/(V-B)),y=(V+B)/2)}y===u&&A===p||(this.center=this.unproject(new n.P(y,A))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.bD(1,this.center.lat)/n.bD(1,n.c4));const p=n.bX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?u:1,y=this._camera.getWorldToCamera(this.worldSize,_);let A;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-t.x/this.width,C[9]=2*t.y/this.height,this.isOrthographic){let ye=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ie=ye*this.aspect,Te=-Ie,be=-ye;Ie-=t.x,Te-=t.x,ye+=t.y,be+=t.y,A=this._camera.getCameraToClipOrthographic(Te,Ie,be,ye,this._nearZ,this._farZ),((ze,Je,lt,Ke)=>{for(let mt=0;mt<16;mt++)ze[mt]=Da(Je[mt],lt[mt],Ke)})(A,A,C,za(this.pitch>=15?1:this.pitch/15))}else A=C;const L=n.a6.mat4.mul([],C,y);let D=n.a6.mat4.mul([],A,y);if(this.projection.isReprojectedInTileSpace){const ye=this.locationCoordinate(this.center),Ie=n.a6.mat4.identity([]);n.a6.mat4.translate(Ie,Ie,[ye.x*this.worldSize,ye.y*this.worldSize,0]),n.a6.mat4.multiply(Ie,Ie,n.bY(this)),n.a6.mat4.translate(Ie,Ie,[-ye.x*this.worldSize,-ye.y*this.worldSize,0]),n.a6.mat4.multiply(D,D,Ie),n.a6.mat4.multiply(L,L,Ie),this.inverseAdjustmentMatrix=n.bZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.a6.mat4.scale([],D,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=D,this.invProjMatrix=n.a6.mat4.invert(new Float64Array(16),this.projMatrix),r){const ye=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ye[8]=2*-t.x/this.width,ye[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.a6.mat4.mul([],ye,y)}else this.expandedFarZProjMatrix=this.projMatrix;const F=n.a6.mat4.invert([],A);this.frustumCorners=n.b_.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const B=new Float32Array(16);n.a6.mat4.identity(B),n.a6.mat4.scale(B,B,[1,-1,1]),n.a6.mat4.rotateX(B,B,this._pitch),n.a6.mat4.rotateZ(B,B,this.angle);const V=n.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.a6.mat4.clone(V);const q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-t.x/this.width,V[9]=2*(t.y+q)/this.height,this.skyboxMatrix=n.a6.mat4.multiply(B,V,B);const W=this.point,Z=W.x,X=W.y,ie=this.width%2/2,se=this.height%2/2,ee=Math.cos(this.angle),ce=Math.sin(this.angle),le=Z-Math.round(Z)+ee*ie+ce*se,me=X-Math.round(X)+ee*se+ce*ie,fe=new Float64Array(D);if(n.a6.mat4.translate(fe,fe,[le>.5?le-1:le,me>.5?me-1:me,0]),this.alignedProjMatrix=fe,D=n.a6.mat4.create(),n.a6.mat4.scale(D,D,[this.width/2,-this.height/2,1]),n.a6.mat4.translate(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=n.a6.mat4.create(),n.a6.mat4.scale(D,D,[1,-1,1]),n.a6.mat4.translate(D,D,[-1,-1,0]),n.a6.mat4.scale(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=n.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},D=n.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.b$(this);const ye=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.a6.vec3.transformMat4(ye,ye,y),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,_=[t,t,r];n.a6.vec3.scale(_,_,p),n.a6.vec3.scale(u,u,-1),n.a6.vec3.multiply(u,u,_);const y=n.a6.mat4.create();n.a6.mat4.translate(y,y,u),n.a6.mat4.scale(y,y,_),this.mercatorFogMatrix=y,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,p)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*_,p.y/this.worldSize-u[1]*_,t/this.worldSize*this._centerAltitude-u[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=t[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(_=Math.min((r-u)/p,1)),this._camera.position=n.a6.vec3.scaleAndAdd([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),_=n.bD(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,y=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.bB(this._maxPitch)),A=Math.max((t[2]-_)/Math.cos(u),y),C=this._zoomFromMercatorZ(A);n.a6.vec3.scaleAndAdd(t,t,r,A),this._pitch=n.ap(u,n.bB(this.minPitch),n.bB(this.maxPitch)),this.angle=n.bA(p,-Math.PI,Math.PI),this._setZoom(n.ap(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.a5(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,u=n.bU,p=0,_=1/0;for(;u-r>1e-6&&u>r;){const y=r+.5*(u-r),A=this.tileSize*Math.pow(2,y),C=this.getCameraToCenterDistance(this.projection,y,A),L=this.scaleZoom(C/(t*this.tileSize)),D=Math.abs(y-L);D<_&&(_=D,p=y),y<L?r=y:u=y}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const u=Math.min(t.x,r.x),p=Math.max(t.x,r.x),_=Math.min(t.y,r.y),y=Math.max(t.y,r.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new n.P(u,_),new n.P(p,y),new n.P(u,y),new n.P(p,_)],C=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const D of A){const F=this.pointRayIntersection(D);if(F.t<0)return!0;const B=this.rayIntersectionCoordinate(F);if(B.x<C||B.y<0||B.x>L||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.c0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,r){const u=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+r;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([r,u,p],_){const y=[r,u,p,1];n.a6.vec4.transformMat4(y,y,_);const A=y[3]=Math.max(y[3],1e-6);return y[0]/=A,y[1]/=A,y[2]/=A,y}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,r=this.zoom,u=this.worldSize){const p=n.bX(t,r,this.width,this.height,1024),_=t.pixelSpaceConversion(this.center.lat,u,p);let y=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(y=Da(1,y,za(this.pitch>=15?1:this.pitch/15))),y}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.a6.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return n.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const to=(c,t)=>{if(t>0&&c.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=c.transform,u=Math.max(Math.abs(r._zoom-(c.minCutoffZoom-1)),1),p=r.isLODDisabled(!1)?n.a7(60,45,r.pitch):n.a7(30,15,r.pitch),_=r._farZ-r._nearZ,y=t*r.height,A=((1-(C=p))*r.cameraToCenterDistance+C*(r._farZ+y))*u;var C;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(A-r._nearZ)/_,(A-y-r._nearZ)/_]}}},br={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Eh{constructor(t,r){this.aabb=t,this.lastCascade=r}}class Mt{add(t,r){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],r.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],r.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],r.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],r.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],r.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],r.max[2])):this.receivers[t.key]=new Eh(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,u){const p=n.c9.fromPoints(t.points);let _=0;for(const y in this.receivers){const A=this.receivers[y];if(!A||!p.intersectsAabb(A.aabb))continue;A.aabb.min=p.closestPoint(A.aabb.min),A.aabb.max=p.closestPoint(A.aabb.max);const C=A.aabb.getCorners();for(let L=0;L<u.length;L++){let D=!0;for(const F of C){const B=[F[0]*r,F[1]*r,F[2]];if(n.a6.vec3.transformMat4(B,B,u[L].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){D=!1;break}}if(A.lastCascade=L,_=Math.max(_,L),D)break}}return _+1}}class Nf{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Mt,this._depthMode=new Yt(t.context.gl.LEQUAL,Yt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(br,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(br,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(br,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const p=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||p<=0||(this._shadowLayerCount=u.style.order.reduce((q,W)=>{const Z=u.style._mergedLayers[W];return q+(Z.hasShadowPass()&&!Z.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const _=u.context,y=br.shadowMapResolution,A=br.shadowMapResolution;if(this._cascades.length===0||br.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<br.cascadeCount;++q){const W=u._shadowMapDebug,Z=_.gl,X=_.createFramebuffer(y,A,W,"texture"),ie=new n.T(_,{width:y,height:A,data:null},Z.DEPTH_COMPONENT16);if(X.depthAttachment.set(ie.texture),W){const se=new n.T(_,{width:y,height:A,data:null},Z.RGBA8);X.colorAttachment.set(se.texture)}this._cascades.push({framebuffer:X,texture:ie,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.bN,scale:0})}}this.shadowDirection=jc(r);let C=0;if(t.elevation){const q=t.elevation,W=[1e4,-1e4];q.visibleDemTiles.filter(Z=>Z.dem).forEach(Z=>{const X=Z.dem.tree;W[0]=Math.min(W[0],X.minimums[0]),W[1]=Math.max(W[1],X.maximums[0])}),W[0]!==1e4&&(C=(W[1]-W[0])*q.exaggeration())}const L=1.5*t.cameraToCenterDistance,D=3*L,F=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){const W=this._cascades[q];let Z=t.height/50,X=1;br.cascadeCount===1?X=D:q===0?X=L:(Z=L,X=D);const[ie,se]=$c(t,this.shadowDirection,Z,X,br.shadowMapResolution,C);W.scale=t.scale,W.matrix=ie,W.boundingSphereRadius=se,n.a6.mat4.invert(F,W.matrix),W.frustum=n.bN.fromInvProjectionMatrix(F,1,0,!0),W.far=X}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/br.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=br.shadowMapResolution,this._uniformValues.u_shadowmap_0=gn.ShadowMap0,this._uniformValues.u_shadowmap_1=gn.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const V=u.transform.elevation;for(const q of this._groundShadowTiles){let W={min:0,max:0};if(V){const Z=V.getMinMaxForTile(q);Z&&(W=Z)}this.addShadowReceiver(q.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this.enabled)return;const u=this.painter,p=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),p.viewport.set([0,0,br.shadowMapResolution,br.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){u.currentShadowCascade=_,p.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),p.clear({color:n.bz.white,depth:1});for(const y of t.order){const A=t._mergedLayers[y];if(!A.hasShadowPass()||A.isHidden(u.transform.zoom))continue;const C=t.getLayerSourceCache(A),L=C?r[C.id]:void 0;(A.type==="model"||L&&L.length)&&u.renderLayer(u,C,A,L)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,r=t.style,u=t.context,p=r.directionalLight,_=r.ambientLight;if(!p||!_)return;const y=[],A=to(t,t.longestCutoffRange);A.shouldRenderCutoff&&y.push("RENDER_CUTOFF");const C=Gc(r,p,_),L=new Yt(u.gl.LEQUAL,Yt.ReadOnly,t.depthRangeFor3D);for(const D of this._groundShadowTiles){const F=D.toUnwrapped(),B=t.isTileAffectedByFog(D),V=t.getOrCreateProgram("groundShadow",{defines:y,overrideFog:B});this.setupShadows(F,V),t.uploadCommonUniforms(u,V,F,null,A);const q={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:C};V.draw(t,u.gl.TRIANGLES,L,pi.disabled,Ei.multiply,oi.disabled,q,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ei.unblended:Ei.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,u=r.calculatePosMatrix(t,r.worldSize);return n.a6.mat4.multiply(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return n.a6.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,u,p=0){if(!this.enabled)return;const _=this.painter.transform,y=this.painter.context,A=y.gl,C=this._uniformValues,L=new Float64Array(16),D=_.calculatePosMatrix(t,_.worldSize);for(let F=0;F<this._cascades.length;F++)n.a6.mat4.multiply(L,this._cascades[F].matrix,D),C[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),y.activeTexture.set(A.TEXTURE0+gn.ShadowMap0+F),this._cascades[F].texture.bind(A.NEAREST,A.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){const F=n.c8(t.canonical),B=2/_.tileSize*n.ab/br.shadowMapResolution,V=B*this._cascades[0].boundingSphereRadius,q=B*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(u==="vector-tile"?1:3)/Math.pow(2,p-t.canonical.z-(1-_.zoom+Math.floor(_.zoom)));C.u_shadow_normal_offset=[F,V*W,q*W],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(y,C)}setupShadowsFromMatrix(t,r,u=!1){if(!this.enabled)return;const p=this.painter.context,_=p.gl,y=this._uniformValues,A=new Float64Array(16);for(let C=0;C<br.cascadeCount;C++)n.a6.mat4.multiply(A,this._cascades[C].matrix,t),y[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),p.activeTexture.set(_.TEXTURE0+gn.ShadowMap0+C),this._cascades[C].texture.bind(_.NEAREST,_.CLAMP_TO_EDGE);if(this.useNormalOffset=u,u){const C=br.normalOffset;y.u_shadow_normal_offset=[1,C,C],y.u_shadow_bias=[6e-5,.0012,.012]}else y.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(p,y)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,u,p){if(p[2]>=0)return{};const _=function(C,L,D){const F=D/(1<<C.canonical.z);return new n.c9([C.canonical.x*F+C.wrap*D,C.canonical.y*F+C.wrap*D,0],[(C.canonical.x+1)*F+C.wrap*D,(C.canonical.y+1)*F+C.wrap*D,L])}(t,r,u).getCorners(),y=r/-p[2];p[0]<0?(n.a6.vec3.add(_[0],_[0],[p[0]*y,0,0]),n.a6.vec3.add(_[3],_[3],[p[0]*y,0,0])):p[0]>0&&(n.a6.vec3.add(_[1],_[1],[p[0]*y,0,0]),n.a6.vec3.add(_[2],_[2],[p[0]*y,0,0])),p[1]<0?(n.a6.vec3.add(_[0],_[0],[0,p[1]*y,0]),n.a6.vec3.add(_[1],_[1],[0,p[1]*y,0])):p[1]>0&&(n.a6.vec3.add(_[2],_[2],[0,p[1]*y,0]),n.a6.vec3.add(_[3],_[3],[0,p[1]*y,0]));const A={};return A.vertices=_,A.planes=[Oa(_[1],_[0],_[4]),Oa(_[2],_[1],_[5]),Oa(_[3],_[2],_[6]),Oa(_[0],_[3],_[7])],A}addShadowReceiver(t,r,u){this._receivers.add(t,n.c9.fromTileIdAndHeight(t,r,u))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function Oa(c,t,r){const u=n.a6.vec3.sub([],r,t),p=n.a6.vec3.sub([],c,t),_=n.a6.vec3.cross([],u,p),y=n.a6.vec3.length(_);return y===0?[0,0,1,0]:(n.a6.vec3.scale(_,_,1/y),[_[0],_[1],_[2],-n.a6.vec3.dot(_,t)])}function jc(c){const t=c.properties.get("direction"),r=n.c7(t.x,t.y,t.z);r[2]=n.ap(r[2],0,75);const u=n.ca([r[0],r[1],r[2]]);return n.a6.vec3.fromValues(u.x,u.y,u.z)}function Gc(c,t,r){const u=t.properties.get("color"),p=t.properties.get("intensity"),_=t.properties.get("direction"),y=[_.x,_.y,_.z],A=r.properties.get("color"),C=r.properties.get("intensity"),L=Math.max(n.a6.vec3.dot([0,0,1],y),0),D=[0,0,0];n.a6.vec3.scale(D,A.toRenderColor(c.getLut(t.scope)).toArray01Linear().slice(0,3),C);const F=[0,0,0];return n.a6.vec3.scale(F,u.toRenderColor(c.getLut(r.scope)).toArray01Linear().slice(0,3),L*p),n.cb([D[0]>0?D[0]/(D[0]+F[0]):0,D[1]>0?D[1]/(D[1]+F[1]):0,D[2]>0?D[2]/(D[2]+F[2]):0])}function $c(c,t,r,u,p,_){const y=c.zoom,A=c.scale,C=c.worldSize,L=1/C,D=c.aspect,F=Math.sqrt(1+D*D)*Math.tan(.5*c.fovX),B=F*F,V=u-r,q=u+r;let W,Z;B>V/q?(W=u,Z=u*F):(W=.5*q*(1+B),Z=.5*Math.sqrt(V*V+2*(u*u+r*r)*B+q*q*B*B));const X=c.projection.pixelsPerMeter(c.center.lat,C),ie=c._camera.getCameraToWorldMercator(),se=[0,0,-W*L];n.a6.vec3.transformMat4(se,se,ie);let ee=Z*L;const ce=c._edgeInsets;if(!(ce.left===0&&ce.top===0&&ce.right===0&&ce.bottom===0||ce.left===ce.right&&ce.top===ce.bottom)){const yt=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?X:1),vt=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,r,u);vt[8]=2*-c.centerOffset.x/c.width,vt[9]=2*c.centerOffset.y/c.height;const at=new Float64Array(16);n.a6.mat4.mul(at,vt,yt);const ut=new Float64Array(16);n.a6.mat4.invert(ut,at);const Ht=n.bN.fromInvProjectionMatrix(ut,C,y,!0);for(const St of Ht.points){const Ot=((le=St)[0]/=A,le[1]/=A,le[2]=n.bD(le[2],c._center.lat),le);ee=Math.max(ee,n.a6.vec3.len(n.a6.vec3.subtract([],se,Ot)))}}var le;ee*=p/(p-1);const me=Math.acos(t[2]),fe=Math.atan2(-t[0],-t[1]),ye=new Yo;ye.position=se,ye.setPitchBearing(me,fe);const Ie=ye.getWorldToCamera(C,X),Te=ee*C,be=Math.min(c._mercatorZfromZoom(17)*C*-2,-2*Te),ze=ye.getCameraToClipOrthographic(-Te,Te,-Te,Te,be,(Te+_*X)/t[2]),Je=new Float64Array(16);n.a6.mat4.multiply(Je,ze,Ie);const lt=n.a6.vec3.fromValues(Math.floor(1e6*se[0])/1e6*C,Math.floor(1e6*se[1])/1e6*C,0),Ke=.5*p,mt=[0,0,0];n.a6.vec3.transformMat4(mt,lt,Je),n.a6.vec3.scale(mt,mt,Ke);const Oe=[Math.floor(mt[0]),Math.floor(mt[1]),Math.floor(mt[2])],ot=[0,0,0];n.a6.vec3.sub(ot,mt,Oe),n.a6.vec3.scale(ot,ot,-1/Ke);const it=new Float64Array(16);return n.a6.mat4.identity(it),n.a6.mat4.translate(it,it,ot),n.a6.mat4.multiply(Je,it,Je),[Je,Te]}class io extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,r){return n.aG(this.requestManager.transformRequest(r,n.R.Model).url).then(u=>{if(!u)return;const p=n.aH(u),_=new n.aI(t,void 0,void 0,p);return _.computeBoundsAndApplyParent(),_}).catch(u=>{if(u&&u.status===404)return null;this.fire(new n.t(new Error(`Could not load model ${t} from ${r}: ${u.message}`)))})}load(t,r){this.models[r]||(this.models[r]={});const u=Object.keys(t);this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+u.length;const p=[];for(const _ of u)p.push(this.loadModel(_,t[_]));Promise.allSettled(p).then(_=>{for(let y=0;y<_.length;y++){const{status:A,value:C}=_[y];A==="fulfilled"&&C&&(this.models[r][u[y]]={model:C,numReferences:1})}this.numModelsLoading[r]-=u.length,this.fire(new n.x("data",{dataType:"style"}))}).catch(_=>{this.fire(new n.t(new Error(`Could not load models: ${_.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r){return!!this.getModel(t,r)}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]?this.models[r][t].model:void 0}addModel(t,r,u){this.models[u]||(this.models[u]={}),this.hasModel(t,u)&&this.models[u][t].numReferences++,this.load({[t]:this.requestManager.normalizeModelURL(r)},u)}addModels(t,r){this.models[r]||(this.models[r]={});const u={};for(const p in t)this.models[r][p]={},u[p]=this.requestManager.normalizeModelURL(t[p]);this.load(u,r)}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={});const u={};for(const p of t)this.hasModel(p,r)?this.models[r][p].numReferences++:u[p]=this.requestManager.normalizeModelURL(p);this.load(u,r)}removeModel(t,r){if(this.models[r]&&this.models[r][t]&&(this.models[r][t].numReferences--,this.models[r][t].numReferences===0)){const u=this.models[r][t].model;delete this.models[r][t],u.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const u in this.models[r])this.models[r][u].model&&this.models[r][u].model.upload(t.context)}}const Sh=new n.a0({data:new n.a1(n._.colorTheme.data)}),es=(c,t)=>Le(c,t&&t.filter(r=>r.identifier!=="source.canvas")),qc=n.ar(Fi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),ka=n.ar(Fi,["setCenter","setZoom","setBearing","setPitch"]),Uf={version:8,layers:[],sources:{}},Vf={duration:300,delay:0};class ts extends n.E{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=n.l({},Vf),this._buildingIndex=new _h(this),this.crossTileSymbolIndex=new Bc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new ke,this.dispatcher=r.dispatcher?r.dispatcher:new n.cd(n.ce(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new Ct,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new n.cf(t._requestManager,r.localFontFamily?n.cg.all:r.localIdeographFontFamily?n.cg.ideographs:n.cg.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new io(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._config=r.config,this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",n.ch());const u=this;this._rtlTextPluginCallback=ts.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(_,y)=>{if(n.ci(_),y&&y.every(A=>A))for(const A in u._sourceCaches){const C=u._sourceCaches[A],L=C.getSource().type;L!=="vector"&&L!=="geojson"||C.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const _=this.getOwnSource(p.sourceId);if(_&&_.vectorLayerIds)for(const y in this._layers){const A=this._layers[y];A.source===_.id&&this._validateLayer(A)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.f(t))return t;const r=n.cj(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch{return r}return r}return`json://${n.ck(JSON.stringify(t))}`}_diffStyle(t,r,u){this.globalId=this._getGlobalId(t);const p=(_,y)=>{try{y(null,this.setState(_,u))}catch(A){y(A,!1)}};if(typeof t=="string"){const _=this.map._requestManager.normalizeStyleURL(t),y=this.map._requestManager.transformRequest(_,n.R.Style);n.n(y,(A,C)=>{A?this.fire(new n.t(A)):C&&p(C,r)})}else typeof t=="object"&&p(t,r)}loadURL(t,r={}){this.fire(new n.x("dataloading",{dataType:"style"}));const u=typeof r.validate=="boolean"?r.validate:!n.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,u);const _=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.n(_,(y,A)=>{if(this._request=null,y)this.fire(new n.t(y));else if(A)return this.importsCache.set(t,A),this._load(A,u)})}loadJSON(t,r={}){this.fire(new n.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.q.frame(()=>{this._request=null,this._load(t,r.validate!==!1)})}loadEmpty(){this.fire(new n.x("dataloading",{dataType:"style"})),this._load(Uf,!1)}_loadImports(t,r,u){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const _ of t){const y=this._createFragmentStyle(_),A=new Promise(D=>{y.once("style.import.load",D),y.once("error",D)}).then(()=>this.mergeAll());if(p.push(A),this.resolvedImports.has(_.url)){y.loadEmpty();continue}const C=_.data||this.importsCache.get(_.url);C?(y.loadJSON(C,{validate:r}),this._isInternalStyle(C)&&(y.globalId=null)):_.url?y.loadURL(_.url,{validate:r}):y.loadEmpty();const L={style:y,id:_.id,config:_.config};if(u){const D=this.fragments.findIndex(({id:F})=>F===u);this.fragments=this.fragments.slice(0,D).concat(L).concat(this.fragments.slice(D))}else this.fragments.push(L)}return Promise.allSettled(p)}getImportGlobalIds(t=this,r=new Set){for(const u of t.fragments)u.style.globalId&&r.add(u.style.globalId),this.getImportGlobalIds(u.style,r);return[...r.values()]}_createFragmentStyle(t){const r=this.scope?n.av(t.id,this.scope):t.id;let u;const p=this._initialConfig&&this._initialConfig[r];(t.config||p)&&(u=n.l({},t.config,p));const _=new ts(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,r){const u=t.schema;if(this._isInternalStyle(t)){const y=n.l({},Uf,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(y,r)}if(this.updateConfig(this._config,u),r&&es(this,Kn(t)))return;this._loaded=!0,this.stylesheet=n.cl(t);const p=()=>{for(const L in t.sources)this.addSource(L,t.sources[L],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const y=gh(this.stylesheet.layers);if(this._order=y.map(L=>L.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new Fe(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Fe(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const L of y){const D=n.cq(L,this.scope,this._styleColorTheme.lut,this.options);D.configDependencies.size!==0&&this._configDependentLayers.add(D.fqid),D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D,this._serializedLayers[D.id]=D.serialize();const F=this.getOwnLayerSourceCache(D),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&D.canCastShadows()&&B&&(F.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const A=this.stylesheet.terrain;A&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(A,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.x("data",{dataType:"style"}));const C=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then(()=>{this._reloadImports(),this.fire(new n.x(C?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.x(C?"style.load":"style.import.load")))},_=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=_,_){const y=this._evaluateColorThemeData(_);this._loadColorTheme(y).then(()=>{p()}).catch(A=>{n.w(`Couldn't load color theme from the stylesheet: ${A}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,r,u,p,_,y,A,C;const L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(t=D.light),D.stylesheet.lights)for(const F of D.stylesheet.lights)F.type==="ambient"&&D.ambientLight!=null&&(r=D.ambientLight),F.type==="directional"&&D.directionalLight!=null&&(u=D.directionalLight);p=this._prioritizeTerrain(p,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(_=D.fog),D.stylesheet.camera!=null&&(C=D.stylesheet.camera),D.stylesheet.projection!=null&&(y=D.stylesheet.projection),D.stylesheet.transition!=null&&(A=D.stylesheet.transition),L[D.scope]=D._styleColorTheme}}),this.light=t,this.ambientLight=r,this.directionalLight=u,this.fog=_,this._styleColorThemeForScope=L,p===null?delete this.terrain:this.terrain=p,this.camera=C||{"camera-projection":"perspective"},this.projection=y||{name:"mercator"},this.transition=n.l({},Vf,A),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const r=u=>{for(const p of u.fragments)r(p.style);t(u)};r(this)}_prioritizeTerrain(t,r,u){const p=t&&t.drapeRenderMode===0;return u===null?r&&r.drapeRenderMode===0?r:p?t:null:r!=null&&(!t||p||r&&r.drapeRenderMode===1)?r:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(r=>{t=this._prioritizeTerrain(t,r.terrain,r.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(r=>{r.stylesheet.projection!=null&&(t=r.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},u={};this.forEachFragmentStyle(p=>{for(const _ in p._sourceCaches){const y=n.av(_,p.scope);t[y]=p._sourceCaches[_]}for(const _ in p._otherSourceCaches){const y=n.av(_,p.scope);r[y]=p._otherSourceCaches[_]}for(const _ in p._symbolSourceCaches){const y=n.av(_,p.scope);u[y]=p._symbolSourceCaches[_]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},r=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(_=>{for(const y of _._order){const A=_._layers[y];if(A.type==="slot"){const C=n.cm(y);if(t[C])continue;t[C]=[]}A.slot&&t[A.slot]?t[A.slot].push(A):r.push(A)}}),this._mergedOrder=[];const p=(_=[])=>{for(const y of _)if(y.type==="slot"){const A=n.cm(y.id);t[A]&&p(t[A]),this._mergedSlots.push(A)}else{const A=n.av(y.id,y.scope);this._mergedOrder.push(A),u[A]=y,y.is3D()&&(this._has3DLayers=!0),y.type==="circle"&&(this._hasCircleLayers=!0),y.type==="symbol"&&(this._hasSymbolLayers=!0),y.type==="clip"&&(this._clipLayerPresent=!0)}};p(r),this._mergedOrder.sort((_,y)=>{const A=u[_],C=u[y];return A.hasInitialOcclusionOpacityProperties?C.is3D()?1:0:A.is3D()&&C.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=n.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(r,u,p){const _=n.l({},u);for(const A of Object.keys(n._.colorTheme))_[A]===void 0&&(_[A]=n._.colorTheme[A].default);const y=new n.$(Sh,r,new Map(p));return y.setTransitionOrValue(_,p),y.untransitioned().possiblyEvaluate(new n.a3(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,p)=>{const _="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let y=t;y.startsWith(_)||(y=_+y);const A="mapbox-reserved-lut",C=new Image;C.src=y,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void u();this._styleColorTheme.lutLoading=!1;const{width:L,height:D,data:F}=n.q.getImageData(C);if(D>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==D*D)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(A)&&this.removeImage(A),this.addImage(A,{data:new n.r({width:L,height:D},F),pixelRatio:1,sdf:!1,version:0});const B=this.imageManager.getImage(A,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},u()):p(new Error("Missing LUT image."))}})}getLut(t){const r=this._styleColorThemeForScope[t];return r?r.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(r,u,p){let _,y,A;const C=n.q.devicePixelRatio>1?"@2x":"";let L=n.n(u.transformRequest(u.normalizeSpriteURL(r,C,".json"),n.R.SpriteJSON),(B,V)=>{L=null,A||(A=B,_=V,F())}),D=n.o(u.transformRequest(u.normalizeSpriteURL(r,C,".png"),n.R.SpriteImage),(B,V)=>{D=null,A||(A=B,y=V,F())});function F(){if(A)p(A);else if(_&&y){const B=n.q.getImageData(y),V={};for(const q in _){const{width:W,height:Z,x:X,y:ie,sdf:se,pixelRatio:ee,stretchX:ce,stretchY:le,content:me}=_[q],fe=new n.r({width:W,height:Z});n.r.copy(B,fe,{x:X,y:ie},{x:0,y:0},{width:W,height:Z},null),V[q]={data:fe,pixelRatio:ee,sdf:se,stretchX:ce,stretchY:le,content:me}}p(null,V)}}return{cancel(){L&&(L.cancel(),L=null),D&&(D.cancel(),D=null)}}}(t,this.map._requestManager,(r,u)=>{if(this._spriteRequest=null,r)this.fire(new n.t(r));else if(u)for(const p in u)this.imageManager.addImage(p,this.scope,u[p]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.x("data",{dataType:"style"}))})}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const u=t.sourceLayer;u&&(r.type==="geojson"||r.vectorLayerIds&&r.vectorLayerIds.indexOf(u)===-1)&&this.fire(new n.t(new Error(`Source layer "${u}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,r)=>{const u=this.fragments[r];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const r in this._sourceCaches){const u=this._sourceCaches[r].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const r=[];for(const u of t){const p=this._layers[u];p&&p.type!=="custom"&&r.push(p.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new n.t(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new n.t(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,r){const u=this.map.painter;if(u)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const _=t.getProgramIds();if(_)for(const y of _){const A=t.getDefaultProgramParams(y,r.zoom,this._styleColorTheme.lut);A&&(u.style=this,this.fog&&(u._fogVisible=!0,A.overrideFog=!0,u.getOrCreateProgram(y,A)),u._fogVisible=!1,A.overrideFog=!1,u.getOrCreateProgram(y,A),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(A.overrideRtt=!0,u.getOrCreateProgram(y,A)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r));const u=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const y=this._changes.getLayerUpdatesByScope();for(const A in y){const{updatedIds:C,removedIds:L}=y[A];(C||L)&&(this._updateWorkerLayers(A,C,L),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const _={};for(const y in this._mergedSourceCaches){const A=this._mergedSourceCaches[y];_[y]=A.used,A.used=!1,A.tileCoverLift=0}for(const y of this._mergedOrder){const A=this._mergedLayers[y];if(A.recalculate(t,this._availableImages),!A.isHidden(t.zoom)){const C=this.getLayerSourceCache(A);C&&(C.used=!0,C.tileCoverLift=Math.max(C.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,t)}):this.precompilePrograms(A,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();for(const y in _){const A=this._mergedSourceCaches[y];_[y]!==A.used&&A.getSource().fire(new n.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new n.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const r in this._sourceCaches)this._sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,r,u){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:r?p._serializeLayers(r):[],scope:t,removedIds:u||[],options:p.options})}setState(t,r){if(this._checkLoaded(),es(this,Kn(t)))return!1;(t=n.cl(t)).layers=gh(t.layers);const u=function(y,A){if(!y)return[{command:Fi.setStyle,args:[A]}];let C=[];try{if(!n.bh(y.version,A.version))return[{command:Fi.setStyle,args:[A]}];if(n.bh(y.center,A.center)||C.push({command:Fi.setCenter,args:[A.center]}),n.bh(y.zoom,A.zoom)||C.push({command:Fi.setZoom,args:[A.zoom]}),n.bh(y.bearing,A.bearing)||C.push({command:Fi.setBearing,args:[A.bearing]}),n.bh(y.pitch,A.pitch)||C.push({command:Fi.setPitch,args:[A.pitch]}),n.bh(y.sprite,A.sprite)||C.push({command:Fi.setSprite,args:[A.sprite]}),n.bh(y.glyphs,A.glyphs)||C.push({command:Fi.setGlyphs,args:[A.glyphs]}),n.bh(y.imports,A.imports)||function(V=[],q=[],W){q=q||[];const Z=(V=V||[]).map(Ho),X=q.map(Ho),ie=V.reduce(Ea,{}),se=q.reduce(Ea,{}),ee=Z.slice();let ce,le,me,fe;for(ce=0,le=0;ce<Z.length;ce++)me=Z[ce],se.hasOwnProperty(me)?le++:(W.push({command:Fi.removeImport,args:[me]}),ee.splice(ee.indexOf(me,le),1));for(ce=0,le=0;ce<X.length;ce++)me=X[X.length-1-ce],ee[ee.length-1-ce]!==me&&(ie.hasOwnProperty(me)?(W.push({command:Fi.removeImport,args:[me]}),ee.splice(ee.lastIndexOf(me,ee.length-le),1)):le++,fe=ee[ee.length-ce],W.push({command:Fi.addImport,args:[se[me],fe]}),ee.splice(ee.length-ce,0,me));for(const ye of q){const Ie=ie[ye.id];Ie&&!n.bh(Ie,ye)&&W.push({command:Fi.updateImport,args:[ye.id,ye]})}}(y.imports,A.imports,C),n.bh(y.transition,A.transition)||C.push({command:Fi.setTransition,args:[A.transition]}),n.bh(y.light,A.light)||C.push({command:Fi.setLight,args:[A.light]}),n.bh(y.fog,A.fog)||C.push({command:Fi.setFog,args:[A.fog]}),n.bh(y.projection,A.projection)||C.push({command:Fi.setProjection,args:[A.projection]}),n.bh(y.lights,A.lights)||C.push({command:Fi.setLights,args:[A.lights]}),n.bh(y.camera,A.camera)||C.push({command:Fi.setCamera,args:[A.camera]}),!n.bh(y["color-theme"],A["color-theme"]))return[{command:Fi.setStyle,args:[A]}];const L={},D=[];(function(V,q,W,Z){let X;for(X in q=q||{},V=V||{})V.hasOwnProperty(X)&&(q.hasOwnProperty(X)||Hi(X,W,Z));for(X in q){if(!q.hasOwnProperty(X))continue;const ie=q[X];V.hasOwnProperty(X)?n.bh(V[X],ie)||(V[X].type==="geojson"&&ie.type==="geojson"&&ii(V,q,X)?W.push({command:Fi.setGeoJSONSourceData,args:[X,ie.data]}):m_(X,q,W,Z)):yh(X,q,W)}})(y.sources,A.sources,D,L);const F=[];y.layers&&y.layers.forEach(V=>{V.source&&L[V.source]?C.push({command:Fi.removeLayer,args:[V.id]}):F.push(V)});let B=y.terrain;B&&L[B.source]&&(C.push({command:Fi.setTerrain,args:[void 0]}),B=void 0),C=C.concat(D),n.bh(B,A.terrain)||C.push({command:Fi.setTerrain,args:[A.terrain]}),function(V,q,W){q=q||[];const Z=(V=V||[]).map(Ho),X=q.map(Ho),ie=V.reduce(Ea,{}),se=q.reduce(Ea,{}),ee=Z.slice(),ce=Object.create(null);let le,me,fe,ye,Ie,Te,be;for(le=0,me=0;le<Z.length;le++)fe=Z[le],se.hasOwnProperty(fe)?me++:(W.push({command:Fi.removeLayer,args:[fe]}),ee.splice(ee.indexOf(fe,me),1));for(le=0,me=0;le<X.length;le++)fe=X[X.length-1-le],ee[ee.length-1-le]!==fe&&(ie.hasOwnProperty(fe)?(W.push({command:Fi.removeLayer,args:[fe]}),ee.splice(ee.lastIndexOf(fe,ee.length-me),1)):me++,Te=ee[ee.length-le],W.push({command:Fi.addLayer,args:[se[fe],Te]}),ee.splice(ee.length-le,0,fe),ce[fe]=!0);for(le=0;le<X.length;le++)if(fe=X[le],ye=ie[fe],Ie=se[fe],!ce[fe]&&!n.bh(ye,Ie))if(n.bh(ye.source,Ie.source)&&n.bh(ye["source-layer"],Ie["source-layer"])&&n.bh(ye.type,Ie.type)){for(be in Ll(ye.layout,Ie.layout,W,fe,null,Fi.setLayoutProperty),Ll(ye.paint,Ie.paint,W,fe,null,Fi.setPaintProperty),n.bh(ye.slot,Ie.slot)||W.push({command:Fi.setSlot,args:[fe,Ie.slot]}),n.bh(ye.filter,Ie.filter)||W.push({command:Fi.setFilter,args:[fe,Ie.filter]}),n.bh(ye.minzoom,Ie.minzoom)&&n.bh(ye.maxzoom,Ie.maxzoom)||W.push({command:Fi.setLayerZoomRange,args:[fe,Ie.minzoom,Ie.maxzoom]}),ye)ye.hasOwnProperty(be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&be!=="slot"&&(be.indexOf("paint.")===0?Ll(ye[be],Ie[be],W,fe,be.slice(6),Fi.setPaintProperty):n.bh(ye[be],Ie[be])||W.push({command:Fi.setLayerProperty,args:[fe,be,Ie[be]]}));for(be in Ie)Ie.hasOwnProperty(be)&&!ye.hasOwnProperty(be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&be!=="slot"&&(be.indexOf("paint.")===0?Ll(ye[be],Ie[be],W,fe,be.slice(6),Fi.setPaintProperty):n.bh(ye[be],Ie[be])||W.push({command:Fi.setLayerProperty,args:[fe,be,Ie[be]]}))}else W.push({command:Fi.removeLayer,args:[fe]}),Te=ee[ee.lastIndexOf(fe)+1],W.push({command:Fi.addLayer,args:[Ie,Te]})}(F,A.layers,C)}catch(L){console.warn("Unable to compute style diff:",L),C=[{command:Fi.setStyle,args:[A]}]}return C}(this.serialize(),t).filter(y=>!(y.command in ka));if(u.length===0)return!1;const p=u.filter(y=>!(y.command in qc));if(p.length>0)throw new Error(`Unimplemented: ${p.map(y=>y.command).join(", ")}.`);const _=[];return u.forEach(y=>{_.push(this[y.command].apply(this,y.args))}),r&&Promise.all(_).then(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,r){return this.getImage(t)?this.fire(new n.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,r),this._afterImageUpdated(t),this)}updateImage(t,r){this.imageManager.updateImage(t,this.scope,r)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new n.t(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new n.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,r,u={}){return this._checkLoaded(),this._validate(we,`models.${t}`,r,null,u)||(this.modelManager.addModel(t,r,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new n.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate($o,`sources.${t}`,r,null,u))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const p=va(t,r,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const _=y=>{const A=(y?"symbol:":"other:")+p.id,C=n.av(A,this.scope),L=this._sourceCaches[A]=new Vn(C,p,y);(y?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=L,L.onAdd(this.map)};_(!1),r.type!=="vector"&&r.type!=="geojson"||_(!0),p.onAdd&&p.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new n.t(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.t(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const u=this.getOwnSourceCaches(t);for(const p of u){const _=n.cm(p.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(p.id),p.fire(new n.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.setDirty()}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const u=this.getOwnSourceCache(r);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const r in t){const u=t[r]._tiles;for(const p in u){const _=u[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const p of t){if(this._validate(ya,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const _=this.ambientLight;_.set(p),_.updateTransitions(r)}else this.ambientLight=new Ji(p,gi||(gi=new n.a0({color:new n.a1(n._.properties_light_ambient.color),intensity:new n.a1(n._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const _=this.directionalLight;_.set(p),_.updateTransitions(r)}else this.directionalLight=new Ji(p,Xi||(Xi=new n.a0({direction:new n.ad(n._.properties_light_directional.direction),color:new n.a1(n._.properties_light_directional.color),intensity:new n.a1(n._.properties_light_directional.intensity),"cast-shadows":new n.a1(n._.properties_light_directional["cast-shadows"]),"shadow-intensity":new n.a1(n._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=new n.a3(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const u=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),p=t.properties.get("color").toRenderColor(null).toArray01(),_=t.properties.get("intensity"),y=t.properties.get("direction"),A=1-n.c7(y.x,y.y,y.z)[2]/90,C=u(p)*_*A,L=r.properties.get("color").toRenderColor(null).toArray01(),D=r.properties.get("intensity");return(C+u(L)*D)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(n.cn(t)){const r=n.co(t),u=this.fragments.find(({id:_})=>_===r);if(!u)throw new Error(`Style import not found: ${t}`);const p=n.cm(t);return u.style.getFragmentStyle(p)}{const r=this.fragments.find(({id:u})=>u===t);if(!r)throw new Error(`Style import not found: ${t}`);return r.style}}getConfigProperty(t,r){const u=this.getFragmentStyle(t);if(!u)return null;const p=n.av(r,u.scope),_=u.options.get(p),y=_?_.value||_.default:null;return y?y.serialize():null}setConfigProperty(t,r,u){const p=this.getFragmentStyle(t);if(!p)return;const _=p.stylesheet.schema;if(!_||!_[r])return;const y=n.M(u);if(y.result!=="success")return void es(this,y.value);const A=y.value.expression,C=n.av(r,p.scope),L=p.options.get(C);if(!L)return;let D;const{minValue:F,maxValue:B,stepValue:V,type:q,values:W}=_[r],Z=n.M(_[r].default);Z.result==="success"&&(D=Z.value.expression),D?(this.options.set(C,{...L,value:A,default:D,minValue:F,maxValue:B,stepValue:V,type:q,values:W}),this.updateConfigDependencies(r)):this.fire(new n.t(new Error(`No schema defined for the config option "${r}" in the "${t}" fragment.`)))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const u=r.stylesheet.schema;if(!u)return null;const p={};for(const _ in u){const y=n.av(_,r.scope),A=r.options.get(y),C=A?A.value||A.default:null;p[_]=C?C.serialize():null}return p}setConfig(t,r){const u=this.getFragmentStyle(t);u&&(u.updateConfig(r,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const r=this.getFragmentStyle(t);return r?r.stylesheet.schema:null}setSchema(t,r){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=r,u.updateConfig(u._config,r),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const u in r){let p,_;const y=n.M(r[u].default);if(y.result==="success"&&(p=y.value.expression),t&&t[u]!==void 0){const B=n.M(t[u]);B.result==="success"&&(_=B.value.expression)}const{minValue:A,maxValue:C,stepValue:L,type:D,values:F}=r[u];if(p){const B=n.av(u,this.scope);this.options.set(B,{default:p,value:_,minValue:A,maxValue:C,stepValue:L,type:D,values:F})}else this.fire(new n.t(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new n.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const r of this._configDependentLayers){const u=this.getLayer(r);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(r=>{if(r._styleColorTheme.colorTheme){const u=r._evaluateColorThemeData(r._styleColorTheme.colorTheme);(!r._styleColorTheme.lut&&u!==""||r._styleColorTheme.lut&&u!==r._styleColorTheme.lut.data)&&r.setColorTheme(r._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(t,r,u={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new n.t(new Error(`Layer with id "${p}" already exists on this map`)));let _;if(t.type==="custom"){if(es(this,n.cp(t)))return;_=n.cq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=n.cl(t),t=n.l(t,{source:p})),this._validate(We,`layers.${p}`,t,{arrayIndex:-1},u))return;_=n.cq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[_.id]=_.serialize()}_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid);let y=this._order.length;if(r){const D=this._order.indexOf(r);if(D===-1)return void this.fire(new n.t(new Error(`Layer with id "${r}" does not exist on this map.`)));_.slot===this._layers[r].slot?y=D:n.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,p),this._layerOrderChanged=!0,this._layers[p]=_;const A=this.getOwnLayerSourceCache(_),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&_.canCastShadows()&&C&&(A.castsShadows=!0);const L=this._changes.getRemovedLayer(_);if(L&&_.source&&A&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const D=n.av(_.source,_.scope);L.type!==_.type?this._changes.updateSourceCache(D,"clear"):(this._changes.updateSourceCache(D,"reload"),A.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===r)return;const p=this._order.indexOf(t);this._order.splice(p,1);let _=this._order.length;if(r){const y=this._order.indexOf(r);if(y===-1)return void this.fire(new n.t(new Error(`Layer with id "${r}" does not exist on this map.`)));u.slot===this._layers[r].slot?_=y:n.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const p=this.getOwnLayerSourceCache(r);if(p&&p.castsShadows){let _=!1;for(const y in this._layers)if(this._layers[y].source===r.source&&this._layers[y].canCastShadows()){_=!0;break}p.castsShadows=_}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,u){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===r&&p.maxzoom===u||(r!=null&&(p.minzoom=r),u!=null&&(p.maxzoom=u),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,r){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==r&&(u.slot=r,this._updateLayer(u))}setFilter(t,r,u={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!n.bh(p.filter,r))return r==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(Y,`layers.${p.id}.filter`,r,{layerType:p.type},u)||(p.filter=n.cl(r),this._updateLayer(p)))}getFilter(t){const r=this._checkLayer(t);if(r)return n.cl(r.filter)}setLayoutProperty(t,r,u,p={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!n.bh(_.getLayoutProperty(r),u)){if(u!=null&&(!p||p.validate!==!1)&&es(_,he.call(Kn,{key:`layers.${t}.layout.${r}`,layerType:_.type,objectKey:r,value:u,styleSpec:n._,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(r,u),_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(t,r){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(r)}setPaintProperty(t,r,u,p={}){this._checkLoaded();const _=this._checkLayer(t);if(!_||n.bh(_.getPaintProperty(r),u)||u!=null&&(!p||p.validate!==!1)&&es(_,J.call(Kn,{key:`layers.${t}.paint.${r}`,layerType:_.type,objectKey:r,value:u,styleSpec:n._})))return;const y=_.setPaintProperty(r,u);_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),y&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(t,r){const u=this._checkLayer(t);if(u)return u.getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const u=t.source,p=t.sourceLayer,_=this._checkSource(u);if(!_)return;const y=_.type;if(y==="geojson"&&p)return void this.fire(new n.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(y==="vector"&&!p)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided.")));const A=this.getOwnSourceCaches(u);for(const C of A)C.setFeatureState(p,t.id,r)}removeFeatureState(t,r){this._checkLoaded();const u=t.source,p=this._checkSource(u);if(!p)return;const _=p.type,y=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!y)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.t(new Error("A feature id is required to remove its specific state property.")));const A=this.getOwnSourceCaches(u);for(const C of A)C.removeFeatureState(y,t.id,r)}getFeatureState(t){this._checkLoaded();const r=t.source,u=t.sourceLayer,p=this._checkSource(r);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(u,t.id);this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=n.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return n.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),u=n.av(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[u]&&r&&r.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=A=>this._mergedLayers[A].is3D(),u=this.order,p={},_=[];for(let A=u.length-1;A>=0;A--){const C=u[A];if(r(C)){p[C]=A;for(const L of t){const D=L[C];if(D)for(const F of D)_.push(F)}}}_.sort((A,C)=>C.intersectionZ-A.intersectionZ);const y=[];for(let A=u.length-1;A>=0;A--){const C=u[A];if(r(C))for(let L=_.length-1;L>=0;L--){const D=_[L].feature;if(D.layer&&p[D.layer.id]<A)break;y.push(D),_.pop()}else for(const L of t){const D=L[C];if(D)for(const F of D)y.push(F.feature)}}return y}queryRenderedFeatures(t,r,u){r&&r.filter&&this._validate(Y,"queryRenderedFeatures.filter",r.filter,null,r),r.scope=this.scope,r.availableImages=this._availableImages,r.serializedLayers=this._serializedLayers;const p={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new n.t(new Error("parameters.layers must be an Array."))),[];for(const L of r.layers){const D=this._mergedLayers[L];if(!D)return this.fire(new n.t(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];p[D.source]=!0}}const _=[],y=r.serializedLayers||{},A=r&&r.layers?r.layers.some(L=>{const D=this.getLayer(L);return D&&D.is3D()}):this.has3DLayers(),C=yr.createFromScreenPoints(t,u);for(const L in this._mergedSourceCaches){const D=this._mergedSourceCaches[L].getSource();if(!D||D.scope!==r.scope)continue;const F=this._mergedSourceCaches[L].getSource().id;r.layers&&!p[F]||_.push(fh(this._mergedSourceCaches[L],this._mergedLayers,y,C,r,u,A,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(L,D,F,B,V,q,W){const Z={},X=q.queryRenderedSymbols(B),ie=[];for(const se of Object.keys(X).map(Number))ie.push(W[se]);ie.sort(ba);for(const se of ie){const ee=se.featureIndex.lookupSymbolFeatures(X[se.bucketInstanceId],D,se.bucketIndex,se.sourceLayerIndex,V.filter,V.layers,V.availableImages,L);for(const ce in ee){const le=Z[ce]=Z[ce]||[],me=ee[ce];me.sort((fe,ye)=>{const Ie=se.featureSortOrder;if(Ie){const Te=Ie.indexOf(fe.featureIndex);return Ie.indexOf(ye.featureIndex)-Te}return ye.featureIndex-fe.featureIndex});for(const fe of me)le.push(fe)}}for(const se in Z)Z[se].forEach(ee=>{const ce=ee.feature,le=F(L[se]);if(!le)return;const me=le.getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=me});return Z}(this._mergedLayers,y,this.getLayerSourceCache.bind(this),C.screenGeometry,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,r){r&&r.filter&&this._validate(Y,"querySourceFeatures.filter",r.filter,null,r);const u=this.getOwnSourceCaches(t);let p=[];for(const _ of u)p=p.concat(Cl(_,r));return p}addSourceType(t,r,u){return ts.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(ts.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,u={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const A in t)if(!n.bh(t[A],p[A])){_=!0;break}if(!_)return;const y=this._getTransitionParameters();this.light.setLight(t,r,u),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,r=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),r===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const p=t.source==null;if(r===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const A="terrain-dem-src";this.addSource(A,u.source),u=n.cl(u),u=n.l(u,{source:A})}const _=n.l({},u),y={};if(this.terrain&&p){_.source=this.terrain.get().source;const A=this.terrain?this.getFragmentStyle(this.terrain.scope):null;A&&(y.style=A.serialize())}if(this._validate(Il,"terrain",_,y))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&r!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,r),this.fire(new n.x("data",{dataType:"style"}))}else{const _=this.terrain,y=_.get();for(const A of Object.keys(n._.terrain))!u.hasOwnProperty(A)&&n._.terrain[A].default&&(u[A]=n._.terrain[A].default);for(const A in t)if(!n.bh(t[A],y[A])){_.set(t,this.options),this.stylesheet.terrain=t;const C=this._getTransitionParameters({duration:0});_.updateTransitions(C),this.fire(new n.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new qi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!n.bh(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}setColorTheme(t){this._checkLoaded();const r=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()};if(this._styleColorTheme.colorTheme=t,!t)return this._styleColorTheme.lut=null,void r();const u=this._evaluateColorThemeData(t);this._loadColorTheme(u).then(()=>{this.fire(new n.x("colorthemeset")),r()}).catch(p=>{n.w(`Couldn't set color theme: ${p}`)})}_getTransitionParameters(t){return{now:n.q.now(),transition:n.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):r.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const u=this.terrain=new rt(t,r,this.scope,this.options);r===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="fill-extrusion"&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="symbol"&&this._updateLayer(r)}}_validate(t,r,u,p,_={}){if(_&&_.validate===!1)return!1;const y=n.l({},this.serialize());return es(this,t.call(Kn,n.l({key:r,style:y,value:u,styleSpec:n._},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const u of r)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const r=this.getSourceCaches(t);for(const u of r)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let r;this.directionalLight&&(r=jc(this.directionalLight));for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].update(t,void 0,void 0,r)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,u,p,_,y,A=!1){let C=!1,L=!1;const D={},F={};for(const B of this._mergedOrder){const V=this._mergedLayers[B];if(V.type!=="symbol")continue;const q=n.av(V.source,V.scope);let W=D[q];if(!W){const X=this.getLayerSourceCache(V);if(!X)continue;const ie=X.getRenderableIds(!0).map(se=>X.getTileByID(se));F[q]=ie.slice(),W=D[q]=ie.sort((se,ee)=>ee.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(ee.tileID)?-1:1))}const Z=this.crossTileSymbolIndex.addLayer(V,W,r.center.lng,r.projection);C=C||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),A=A||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new n.x("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),r.zoom))&&(this.pauseablePlacement=new Dl(r,this._mergedOrder,A,u,p,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),L=!0),C&&this.pauseablePlacement.placement.setStale()),L||C){this._buildingIndex.onNewFrame(r.zoom);for(let B=0;B<this._mergedOrder.length;B++){const V=this._mergedLayers[this._mergedOrder[B]];if(V.type!=="symbol")continue;const q=this.isLayerClipped(V);this.placement.updateLayerOpacities(V,D[n.av(V.source,V.scope)],B,q?y:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:_})=>_===t.id)!==-1)return void this.fire(new n.t(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return u.push(t),this._loadImports([t],!0);const p=u.findIndex(({id:_})=>_===r);return p===-1&&this.fire(new n.t(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,p).concat(t).concat(u.slice(p)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof r=="string"?(this.setImportUrl(t,r),this):(r.url&&r.url!==u[p].url&&this.setImportUrl(t,r.url),n.bh(r.config,u[p].config)||this.setImportConfig(t,r.config),n.bh(r.data,u[p].data)||this.setImportData(t,r.data),this)}moveImport(t,r){this._checkLoaded();let u=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const _=this.getImportIndex(r);if(_===-1)return this;const y=u[p],A=this.fragments[p];return u=u.filter(({id:C})=>C!==t),this.fragments=this.fragments.filter(({id:C})=>C!==t),this.stylesheet.imports=u.slice(0,_).concat(y).concat(u.slice(_)),this.fragments=this.fragments.slice(0,_).concat(A).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(t,r){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;u[p].url=r;const _=this.fragments[p];return _.style=this._createFragmentStyle(u[p]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(r),this}setImportData(t,r){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];return u===-1?this:r?(this.fragments[u].style.setState(r),this._reloadImports(),this):(delete p[u].data,this.setImportUrl(t,p[u].url))}setImportConfig(t,r){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];if(u===-1)return this;r?p[u].config=r:delete p[u].config;const _=this.fragments[u],y=_.style.stylesheet&&_.style.stylesheet.schema;return _.config=r,_.style.updateConfig(r,y),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(r.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return r===-1&&this.fire(new n.t(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[r];u&&t.push(u.getSource())}return t}getSource(t,r){const u=this.getSourceCache(t,r);return u&&u.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const u=n.av(t,r);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const r=n.av(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const r in t){const u=t[r];u==="reload"?this.reloadSource(r):u==="clear"&&this.clearSource(r)}}updateLayers(t){const r=this._changes.getUpdatedPaintProperties();for(const u of r){const p=this.getLayer(u);p&&p.updateTransitions(t)}}getImages(t,r,u){this.imageManager.getImages(r.icons,r.scope,u),this._updateTilesForChangedImages();const p=_=>{_&&_.setDependencies(r.tileID.key,r.type,r.icons)};p(this._otherSourceCaches[r.source]),p(this._symbolSourceCaches[r.source])}getGlyphs(t,r,u){this.glyphManager.getGlyphs(r.stacks,r.scope,u)}getResource(t,r,u){return n.ct(r,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return r.length===0?(this.fire(new n.t(new Error(`There is no source with ID '${t}'`))),!1):r.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,r){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const u=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(u||r&&r.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ts.getSourceType=function(c){return Rc[c]},ts.setSourceType=function(c,t){Rc[c]=t},ts.registerForPluginStateChange=n.cc;var jf=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Ah=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ih=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Hc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Gf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,$f=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,qf=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Hf=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Mh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Wf=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ol=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Wc=[];So(jf,Wc),So(Ih,Wc),So(Ah,Wc);const kl={"_prelude_fog.vertex.glsl":$f,"_prelude_terrain.vertex.glsl":Gf,"_prelude_shadow.vertex.glsl":Wf,"_prelude_fog.fragment.glsl":qf,"_prelude_shadow.fragment.glsl":Ol,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Hf,"_prelude_raster_particle.glsl":Mh},Fa={};Ri("",Gf),Ri(qf,$f),Ri(Ol,Wf),Ri(Hf,""),Ri(Mh,"");const Fl=Ri(Ah,Ih),Zc=jf;var Eo={background:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ri("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ri(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ri("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ri("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ri(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ri(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ri(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ri(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ri("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ri("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ri(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ri(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ri("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ri(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Hc),skyboxGradient:Ri(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Hc),skyboxCapture:Ri(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ri(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ri(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ri(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Ri("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function So(c,t){const r=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of r)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const _ of p)t.includes(_)||t.push(_)}}function Ri(c,t){const r=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(L=>{const D=L.split(" ");return D[D.length-1]}),p=[...new Set(p)]);const _={},y=[],A=[];if(c=c.replace(r,(L,D)=>(A.push(D),"")),(t=t.replace(r,(L,D)=>(y.push(D),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...Wc];So(c,C),So(t,C);for(const L of[...y,...A])kl[L]||console.error(`Undefined include: ${L}`),Fa[L]||(Fa[L]=[],So(kl[L],Fa[L])),C=[...C,...Fa[L]];return{fragmentSource:c=c.replace(u,(L,D,F,B,V)=>(_[V]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${F} ${B} ${V};
#else
uniform ${F} ${B} u_${V};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${F} ${B} ${V} = u_${V};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${F} ${B} ${V};
#endif
`:D==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(u,(L,D,F,B,V)=>{const q=B==="float"?"vec2":B,W=V.match(/color/)?"color":q;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${F} ${B} a_${V};
#endif
`:_[V]?D==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${F} ${q} a_${V};
out ${F} ${B} ${V};
#else
uniform ${F} ${B} u_${V};
#endif
`:D==="initialize"?W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${F} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${F} ${B} ${V} = u_${V};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${F} ${B} a_${V};
    out ${F} ${B} ${V};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${F} ${q} a_${V};
#else
uniform ${F} ${B} u_${V};
#endif
`:D==="define-instanced"?W==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${F} ${B} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${q} a_${V};
#else
uniform ${F} ${B} u_${V};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${F} ${B} ${V} = a_${V};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${F} ${B} ${V} = a_${V};
#else
    ${F} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${F} ${B} ${V} = unpack_mix_${W}(a_${V}, u_${V}_t);
#else
    ${F} ${B} ${V} = u_${V};
#endif
`}),staticAttributes:p,usedDefines:C,vertexIncludes:y,fragmentIncludes:A}}class Ba{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,u,p,_,y,A,C){this.context=t;let L=this.boundPaintVertexBuffers.length!==p.length;for(let F=0;!L&&F<p.length;F++)this.boundPaintVertexBuffers[F]!==p[F]&&(L=!0);let D=this.boundDynamicVertexBuffers.length!==A.length;for(let F=0;!D&&F<A.length;F++)this.boundDynamicVertexBuffers[F]!==A[F]&&(D=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==u||L||D||this.boundIndexBuffer!==_||this.boundVertexOffset!==y)this.freshBind(r,u,p,_,y,A,C);else{t.bindVertexArrayOES.set(this.vao);for(const F of A)F&&(F.bind(),C&&F.instanceCount&&F.setVertexAttribDivisor(t.gl,r,C));_&&_.dynamicDraw&&_.bind()}}freshBind(t,r,u,p,_,y,A){const C=t.numAttributes,L=this.context,D=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=y,r.enableAttributes(D,t),r.bind(),r.setVertexAttribPointers(D,t,_);for(const F of u)F.enableAttributes(D,t),F.bind(),F.setVertexAttribPointers(D,t,_);for(const F of y)F&&(F.enableAttributes(D,t),F.bind(),F.setVertexAttribPointers(D,t,_),A&&F.instanceCount&&F.setVertexAttribDivisor(D,t,A));p&&p.bind(),L.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Bl(c,t){const r=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new n.a5(0,u/r).toLngLat().lat,new n.a5(0,(u+1)/r).toLngLat().lat]}function Xc(c,t,r,u,p,_,y){const A=c.context,C=A.gl,L=r.hillshadeFBO;if(!L)return;c.prepareDrawTile();const D=c.isTileAffectedByFog(t),F=c.getOrCreateProgram("hillshade",{overrideFog:D});A.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,L.colorAttachment.get());const B=((Z,X,ie,se)=>{const ee=ie.paint.get("hillshade-shadow-color"),ce=ie.paint.get("hillshade-highlight-color"),le=ie.paint.get("hillshade-accent-color"),me=ie.paint.get("hillshade-emissive-strength");let fe=n.bB(ie.paint.get("hillshade-illumination-direction"));if(ie.paint.get("hillshade-illumination-anchor")==="viewport")fe-=Z.transform.angle;else if(Z.style&&Z.style.enable3dLights()&&Z.style.directionalLight){const Ie=Z.style.directionalLight.properties.get("direction"),Te=n.c7(Ie.x,Ie.y,Ie.z);fe=n.bB(Te[1])}const ye=!Z.options.moving;return{u_matrix:se||Z.transform.calculateProjMatrix(X.tileID.toUnwrapped(),ye),u_image:0,u_latrange:Bl(0,X.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),fe],u_shadow:ee.toRenderColor(ie.lut),u_highlight:ce.toRenderColor(ie.lut),u_emissive_strength:me,u_accent:le.toRenderColor(ie.lut)}})(c,r,u,c.terrain?t.projMatrix:null);c.uploadCommonUniforms(A,F,t.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:q,tileBoundsSegments:W}=c.getTileBoundsBuffers(r);F.draw(c,C.TRIANGLES,p,_,y,oi.disabled,B,u.id,V,q,W)}function Yc(c,t,r){if(!t.needsDEMTextureUpload)return;const u=c.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(r.stride);const _=r.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new n.T(u,_,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Nl(c,t,r){const u=c.context,p=u.gl;if(!t.dem)return;const _=t.dem;if(u.activeTexture.set(p.TEXTURE1),Yc(c,t,_),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const y=_.dim;u.activeTexture.set(p.TEXTURE0);let A=t.hillshadeFBO;if(!A){const B=new n.T(u,{width:y,height:y,data:null},p.RGBA8);B.bind(p.LINEAR,p.CLAMP_TO_EDGE),A=t.hillshadeFBO=u.createFramebuffer(y,y,!0,"renderbuffer"),A.colorAttachment.set(B.texture)}u.bindFramebuffer.set(A.framebuffer),u.viewport.set([0,0,y,y]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:L,tileBoundsSegments:D}=c.getMercatorTileBoundsBuffers(),F=[];c.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(c,p.TRIANGLES,Yt.disabled,pi.disabled,Ei.unblended,oi.disabled,((B,V)=>{const q=V.stride,W=n.a6.mat4.create();return n.a6.mat4.ortho(W,0,n.ab,-n.ab,0,0,1),n.a6.mat4.translate(W,W,[0,-n.ab,0]),{u_matrix:W,u_image:1,u_dimension:[q,q],u_zoom:B.overscaledZ}})(t.tileID,_),r.id,C,L,D),t.needsHillshadePrepare=!1}class ir{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ch extends ir{getDefault(){return n.bz.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Zf extends ir{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ph extends ir{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Kc extends ir{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ul extends ir{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Xf extends ir{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Yf extends ir{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Kf extends ir{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Na extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Jf extends ir{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class v_ extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class b_ extends ir{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class w_ extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class Rh extends ir{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Lh extends ir{getDefault(){return n.bz.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Dh extends ir{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class zh extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class Qf extends ir{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ep extends ir{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let T_=class extends ir{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class Vl extends ir{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class jl extends ir{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class tp extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class is extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Oh extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Jc extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Qc extends ir{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class kh extends ir{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Fh extends ir{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class eu extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Bh extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Gl extends ir{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class tu extends Gl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Nh extends Gl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ip extends Gl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ua extends Nh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const E_=(c,t,r)=>({u_matrix:c,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),rp=(c,t,r,u,p,_,y,A,C,L,D,F,B,V,q,W)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:r,u_zoom_transition:p,u_merc_center:_,u_image0:0,u_frustum_tl:y,u_frustum_tr:A,u_frustum_br:C,u_frustum_bl:L,u_globe_pos:D,u_globe_radius:F,u_viewport:B,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:q});function np(c,t){return c!=null&&t!=null&&!(!c.hasData()||!t.hasData())&&c.demTexture!=null&&t.demTexture!=null&&c.tileID.key!==t.tileID.key}const Va=new class{constructor(){this.operations={}}newMorphing(c,t,r,u,p){if(c in this.operations){const _=this.operations[c];_.to.tileID.key!==r.tileID.key&&(_.queued=r)}else this.operations[c]={startTime:u,phase:0,duration:p,from:t,to:r,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const r=this.operations[t];for(r.phase=(c-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},sp={0:null,1:"TERRAIN_VERTEX_MORPHING"};function op(c,t,r){if(t===0)return 0;const u=t<1&&r===514?.25/t:1;return 6*Math.pow(1.5,22-c)*Math.max(t,1)*u}function Uh(c,t){const r=1<<c.z;return!t&&(c.x===0||c.x===r-1)||c.y===0||c.y===r-1}const $l=c=>({u_matrix:c});function iu(c,t,r,u,p){if(p>0){const _=n.q.now(),y=(_-c.timeAdded)/p,A=t?(_-t.timeAdded)/p:-1,C=r.getSource(),L=u.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),D=!t||Math.abs(t.tileID.overscaledZ-L)>Math.abs(c.tileID.overscaledZ-L),F=D&&c.refreshedUponExpiration?1:n.ap(D?y:1-A,0,1);return c.refreshedUponExpiration&&y>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class ja extends Vn{constructor(t){const r={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new n.cd(n.ce(),null),p=va("mock-dem",r,u,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class ap extends Vn{constructor(t){const r=va("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new n.cd(n.ce(),null),t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,y)=>{if(_[y.key]="",!this._tiles[y.key]){const A=new Fs(y,this._source.tileSize*y.overscaleFactor(),t.tileZoom);A.state="loaded",this._tiles[y.key]=A}return _},{});for(const _ in this._tiles)_ in p||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const r=this.proxyCachedFBO[t];if(r!==void 0){const u=Object.values(r);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Vh extends n.aA{constructor(t,r,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=u}}class jh extends n.cE{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,_]=function(C){const L=new n.a_,D=new n.aO,F=131;L.reserve(17161),D.reserve(33800);const B=n.ab/128,V=n.ab+B/2,q=V+B;for(let Z=-B;Z<q;Z+=B)for(let X=-B;X<q;X+=B){const ie=X<0||X>V||Z<0||Z>V?24575:0,se=n.ap(Math.round(X),0,n.ab),ee=n.ap(Math.round(Z),0,n.ab);L.emplaceBack(se+ie,ee)}const W=(Z,X)=>{const ie=X*F+Z;D.emplaceBack(ie+1,ie,ie+F),D.emplaceBack(ie+F,ie+F+1,ie+1)};for(let Z=1;Z<129;Z++)for(let X=1;X<129;X++)W(X,Z);return[0,129].forEach(Z=>{for(let X=0;X<130;X++)W(X,Z),W(Z,X)}),[L,D,32768]}(),y=t.context;this.gridBuffer=y.createVertexBuffer(u,n.b0.members),this.gridIndexBuffer=y.createIndexBuffer(p),this.gridSegments=n.b1.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=n.b1.simpleSegment(0,0,u.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ap(r.map),this.orthoMatrix=n.a6.mat4.create(),n.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.ab,0,n.ab,0,1);const A=y.gl;this._overlapStencilMode=new pi({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ja(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,_=t.terrain.drapeRenderMode===0,y=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();const A=t.terrain&&t.terrain.scope,C=p.get("source"),L=_?this._mockSourceCache:t.getSourceCache(C,A);if(!L)return void n.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=L,this._exaggeration=y?this.calculateExaggeration(r):p.get("exaggeration"),!r.projection.requiresDraping&&y&&this._exaggeration===0)return void this._disable();this.enabled=!0;const D=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(r,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),r.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){const r=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const p=r!=null?u-r:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const _=t.zoom,y=this._style.terrain;if(!this._previousUpdateTimestamp)return y.getExaggeration(_);let A=_-this._previousZoom;const C=this._previousUpdateTimestamp;let L=_;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(_-L)>.5&&(A=.5*(_-L+A)),A*p<0&&(L+=A)),this._evaluationZoom=L;const D=y.getExaggeration(L),F=D===y.getExaggeration(Math.max(0,L-.1));if(F&&Math.abs(D-this._exaggeration)<.01)return D;let B=Math.min(.1,.00375*(this._updateTimestamp-C));return(F||D<.1||Math.abs(A)<1e-4)&&(B=Math.min(.2,4*B)),n.aa(this._exaggeration,D,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(n.a5.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=r.getIds().map(C=>{const L=r.getTileByID(C).tileID;return L.projMatrix=u.calculateProjMatrix(L.toUnwrapped()),L});(function(C,L){const D=L.transform.pointCoordinate(L.transform.getCameraPoint()),F=new n.P(D.x,D.y);C.sort((B,V)=>{if(V.overscaledZ-B.overscaledZ)return V.overscaledZ-B.overscaledZ;const q=new n.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),W=new n.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),Z=F.mult(1<<B.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(q)-Z.distSqr(W)})})(p,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},p.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const y=this._style._mergedSourceCaches;for(const C in y){const L=y[C];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,t[C],_),L.usedForTerrain))continue;const D=t[C];L.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[r.id]=p.map(C=>new Vh(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const A={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const L=this.terrainTileForTile[C.key];if(!L)continue;const D=L.tileID.key;D in A||(this._visibleDemTiles.push(L),A[D]=D)}}_assignTerrainTiles(t){this._initializing||t.forEach(r=>{if(this.terrainTileForTile[r.key])return;const u=this._findTileCoveringTileID(r,this.sourceCache);u&&(this.terrainTileForTile[r.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],_=p.dem;!_||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),Yc(this.painter,p,_))}}_prepareDemTileUniforms(t,r,u,p){if(!r||r.demTexture==null)return!1;const _=t.tileID.canonical,y=Math.pow(2,r.tileID.canonical.z-_.z),A=p||"";return u[`u_dem_tl${A}`]=[_.x*y%1,_.y*y%1],u[`u_dem_scale${A}`]=y,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const r=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const _=p.dem.tree.minimums[0];return _>0&&t++,u+_},0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new n.cF({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(p,{premultiply:!1}):_=this._emptyDEMTexture=new n.T(t,p,r.R32F,{premultiply:!1}),_}setupElevationDraw(t,r,u){const p=this.painter.context,_=p.gl,y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};y.u_exaggeration=this.exaggeration();let A=null,C=null,L=1;if(u&&u.morphing&&this._useVertexMorphing){const V=u.morphing.srcDemTile,q=u.morphing.dstDemTile;L=u.morphing.phase,V&&q&&(this._prepareDemTileUniforms(t,V,y,"_prev")&&(C=V),this._prepareDemTileUniforms(t,q,y)&&(A=q))}const D=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST;let F=null;var B;if(this.enabled?C&&A?(F=A.demTexture,p.activeTexture.set(_.TEXTURE4),C.demTexture.bind(D(C),_.CLAMP_TO_EDGE),y.u_dem_lerp=L):(A=this.terrainTileForTile[t.tileID.key],F=this._prepareDemTileUniforms(t,A,y)?A.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,p.activeTexture.set(_.TEXTURE2),F&&(y.u_dem_size=(B=F).size[0]===1?1:B.size[0]-2,F.bind(D(A),_.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,r,y),u&&u.useMeterToDem&&A){const V=(1<<A.tileID.canonical.z)*n.bD(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;y.u_meter_to_dem=V}if(u&&u.labelPlaneMatrixInv&&(y.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),r.setTerrainUniformValues(p,y),this.painter.transform.projection.name==="globe"){const V=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);r.setGlobeUniformValues(p,V)}}globeUniformValues(t,r,u){const p=t.projection;return{u_tile_tl_up:p.upVector(r,0,0),u_tile_tr_up:p.upVector(r,n.ab,0),u_tile_br_up:p.upVector(r,n.ab,n.ab),u_tile_bl_up:p.upVector(r,0,n.ab),u_tile_up_scale:u?n.cG(1):p.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,_,y,A,C){if(p.transform.projection.name==="globe")(function(L,D,F,B,V){const q=L.context,W=q.gl;let Z,X;const ie=L.transform,se=n.cx(L,q,ie),ee=(ze,Je)=>{if(X===Je)return;const lt=[sp[Je],"PROJECTION_GLOBE_VIEW"];se&&lt.push("CUSTOM_ANTIALIASING");const Ke=L.isTileAffectedByFog(ze);Z=L.getOrCreateProgram("globeRaster",{defines:lt,overrideFog:Ke}),X=Je},ce=L.colorModeForRenderPass(),le=new Yt(W.LEQUAL,Yt.ReadWrite,L.depthRangeFor3D);Va.update(V);const me=n.cy(ie),fe=[n.am(ie.center.lng),n.at(ie.center.lat)],ye=L.globeSharedBuffers,Ie=[ie.width*n.q.devicePixelRatio,ie.height*n.q.devicePixelRatio],Te=Float32Array.from(ie.globeMatrix),be={useDenormalizedUpVectorScale:!0};{const ze=L.transform,Je=op(ze.zoom,D.exaggeration(),D.sourceCache._source.tileSize);X=-1;const lt=W.TRIANGLES;for(const Ke of B){const mt=F.getTile(Ke),Oe=pi.disabled,ot=D.prevTerrainTileForTile[Ke.key],it=D.terrainTileForTile[Ke.key];np(ot,it)&&Va.newMorphing(Ke.key,ot,it,V,250),q.activeTexture.set(W.TEXTURE0),mt.texture&&mt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const yt=Va.getMorphValuesForProxy(Ke.key),vt=yt?1:0;yt&&n.C(be,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:n.cw(yt.phase)}});const at=n.cz(Ke.canonical),ut=n.cA(at.getCenter().lat),Ht=n.cB(Ke.canonical,at,ut,ze.worldSize/ze._pixelsPerMercatorPixel),St=n.b5(n.cC(Ke.canonical)),Ot=rp(ze.expandedFarZProjMatrix,Te,me,St,n.a9(ze.zoom),fe,ze.frustumCorners.TL,ze.frustumCorners.TR,ze.frustumCorners.BR,ze.frustumCorners.BL,ze.globeCenterInViewSpace,ze.globeRadius,Ie,Je,ze._farZ,Ht);if(ee(Ke,vt),Z&&(D.setupElevationDraw(mt,Z,be),L.uploadCommonUniforms(q,Z,Ke.toUnwrapped()),ye)){const[ri,Vt,Qt]=ye.getGridBuffers(ut,Je!==0);Z.draw(L,lt,le,Oe,ce,oi.backCCW,Ot,"globe_raster",ri,Vt,Qt)}}}if(ye&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const ze=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];se&&ze.push("CUSTOM_ANTIALIASING"),Z=L.getOrCreateProgram("globeRaster",{defines:ze});for(const Je of B){const{x:lt,y:Ke,z:mt}=Je.canonical,Oe=Ke===0,ot=Ke===(1<<mt)-1,[it,yt,vt,at]=ye.getPoleBuffers(mt,!1);if(at&&(Oe||ot)){const ut=F.getTile(Je);q.activeTexture.set(W.TEXTURE0),ut.texture&&ut.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let Ht=n.cD(mt,lt,ie);const St=n.b5(n.cC(Je.canonical)),Ot=(ri,Vt)=>ri.draw(L,W.TRIANGLES,le,pi.disabled,ce,oi.disabled,rp(ie.expandedFarZProjMatrix,Ht,Ht,St,0,fe,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Ie,0,ie._farZ),"globe_pole_raster",Vt,vt,at);D.setupElevationDraw(ut,Z,be),L.uploadCommonUniforms(q,Z,Je.toUnwrapped()),Oe&&L.renderDefaultNorthPole&&Ot(Z,it),ot&&L.renderDefaultSouthPole&&(Ht=n.a6.mat4.scale(n.a6.mat4.create(),Ht,[1,-1,1]),Ot(Z,yt))}}}})(p,_,y,A,C);else{const L=p.context,D=L.gl;let F,B;const V=p.shadowRenderer,q=to(p,p.longestCutoffRange),W=ce=>{if(B===ce)return;const le=[];le.push(sp[ce]),q.shouldRenderCutoff&&le.push("RENDER_CUTOFF"),F=p.getOrCreateProgram("terrainRaster",{defines:le}),B=ce},Z=p.colorModeForRenderPass(),X=new Yt(D.LEQUAL,Yt.ReadWrite,p.depthRangeFor3D);Va.update(C);const ie=p.transform,se=op(ie.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let ee=[0,0,0];if(V){const ce=p.style.directionalLight,le=p.style.ambientLight;ce&&le&&(ee=Gc(p.style,ce,le))}{B=-1;const ce=D.TRIANGLES,[le,me]=[_.gridIndexBuffer,_.gridSegments];for(const fe of A){const ye=y.getTile(fe),Ie=pi.disabled,Te=_.prevTerrainTileForTile[fe.key],be=_.terrainTileForTile[fe.key];np(Te,be)&&Va.newMorphing(fe.key,Te,be,C,250),L.activeTexture.set(D.TEXTURE0),ye.texture&&ye.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const ze=Va.getMorphValuesForProxy(fe.key),Je=ze?1:0;let lt;ze&&(lt={morphing:{srcDemTile:ze.from,dstDemTile:ze.to,phase:n.cw(ze.phase)}});const Ke=E_(fe.projMatrix,Uh(fe.canonical,ie.renderWorldCopies)?se/10:se,ee);if(W(Je),!F)continue;_.setupElevationDraw(ye,F,lt);const mt=fe.toUnwrapped();V&&V.setupShadows(mt,F),p.uploadCommonUniforms(L,F,mt,null,q),F.draw(p,ce,X,Ie,Z,oi.backCCW,Ke,"terrain_raster",_.gridBuffer,le,me)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const r=this.painter,u=this.painter.context,p=this.proxySourceCache,_=this.proxiedCoords[p.id],y=this._drapedRenderBatches.shift(),A=r.style.order,C=[];let L=0;for(const D of _){const F=p.getTileByID(D.proxyTileKey),B=p.proxyCachedFBO[D.key]?p.proxyCachedFBO[D.key][t]:void 0,V=B!==void 0?p.renderCache[B]:this.pool[L++],q=B!==void 0;if(F.texture=V.tex,q&&!V.dirty){C.push(F.tileID);continue}let W;u.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(u.clear({color:n.bz.transparent,stencil:0}),V.dirty=!1);for(let Z=y.start;Z<=y.end;++Z){const X=r.style._mergedLayers[A[Z]];if(X.isHidden(r.transform.zoom))continue;const ie=r.style.getLayerSourceCache(X),se=ie?this.proxyToSource[D.key][ie.id]:[D];if(!se)continue;const ee=se;u.viewport.set([0,0,V.fb.width,V.fb.height]),W!==(ie?ie.id:null)&&(this._setupStencil(V,se,X,ie),W=ie?ie.id:null),r.renderLayer(r,ie,X,ee)}if(this._drapedRenderBatches.length===0)for(const Z of this._pendingGroundEffectLayers){const X=r.style._mergedLayers[A[Z]];if(X.isHidden(r.transform.zoom))continue;const ie=r.style.getLayerSourceCache(X),se=ie?this.proxyToSource[D.key][ie.id]:[D];if(!se)continue;const ee=se;u.viewport.set([0,0,V.fb.width,V.fb.height]),W!==(ie?ie.id:null)&&(this._setupStencil(V,se,X,ie),W=ie?ie.id:null),r.renderLayer(r,ie,X,ee)}this.renderedToTile?(V.dirty=!0,C.push(F.tileID)):q||--L,L===5&&(L=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,r.width,r.height]),y.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let u=-1,p=r;for(let _=0;_<r;++_)this._style.isLayerDraped(t._mergedLayers[t.order[_]])?u=Math.max(u,_):p=Math.min(p,_);return p>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(r=>r.dem).forEach(r=>{t=Math.min(t,r.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,r,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const y=_.tileID,A=1<<y.overscaledZ,{x:C,y:L}=y.canonical,D=C/A,F=(C+1)/A,B=L/A,V=(L+1)/A;return{minx:D,miny:B,maxx:F,maxy:V,t:_.dem.tree.raycastRoot(D,B,F,V,t,r,u),tile:_}});p.sort((_,y)=>(_.t!==null?_.t:Number.MAX_VALUE)-(y.t!==null?y.t:Number.MAX_VALUE));for(const _ of p){if(_.t==null)return null;const y=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,r,u);if(y!=null)return y}return null}_createFBO(){const t=this.painter.context,r=t.gl,u=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const p=new n.T(t,{width:u[0],height:u[1],data:null},r.RGBA8);p.bind(r.LINEAR,r.CLAMP_TO_EDGE);const _=t.createFramebuffer(u[0],u[1],!0,null);return _.colorAttachment.set(p.texture),_.depthAttachment=new Ua(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const r=this._style._mergedLayers[t],u=r.isHidden(this.painter.transform.zoom);return r.type==="hillshade"||r.type==="custom"?!u&&r.shouldRedrape():!u&&r.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof Pc){t=!0;break}if(!t)return;const r={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(p);if(_&&!r[_.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof n.a4){r[_.id]=!0;for(const y of this.proxyCoords){const A=this.proxyToSource[y.key][_.id];if(A)for(const C of A)this._clearRenderCacheForTile(_.id,C)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof Ml){t=!0;break}if(!t)return;const r={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(p);if(!_||r[_.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const y=p.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const C=this.proxyToSource[A.key][_.id];if(C)for(const L of C){const D=iu(_.getTile(L),_.findLoadedParent(L,0),_,this.painter.transform,y);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(_.id,L)}}}}_setupDrapedRenderBatches(){const t=this._style.order,r=t.length;if(r===0)return;const u=[];this._pendingGroundEffectLayers=[];let p,_=0,y=this._style._mergedLayers[t[_]];for(;!this._style.isLayerDraped(y)&&y.isHidden(this.painter.transform.zoom)&&++_<r;)y=this._style._mergedLayers[t[_]];for(;_<r;++_){const A=this._style._mergedLayers[t[_]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?p===void 0&&(p=_):(A.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),p!==void 0&&(u.push({start:p,end:_-1}),p=void 0)))}if(p!==void 0&&u.push({start:p,end:_-1}),u.length!==0){const A=u[u.length-1];this._pendingGroundEffectLayers.every(C=>C>A.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const y=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let A=0;A<y.length;++A){const C=Object.values(y[A]);r.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let y=u.length-1;y>=0;y--){const A=u[y];if(r.getTileByID(A.key),r.proxyCachedFBO[A.key]!==void 0){const C=t[A.key],L=this.proxyToSource[A.key];let D=0;for(const F in L){const B=L[F],V=C[F];if(!V||V.length!==B.length||B.some((q,W)=>q!==V[W]||p[F]&&p[F].hasOwnProperty(q.key))){D=-1;break}++D}for(const F in r.proxyCachedFBO[A.key])r.renderCache[r.proxyCachedFBO[A.key][F]].dirty=D<0||D!==Object.values(C).length}}const _=[...this._drapedRenderBatches];_.sort((y,A)=>A.end-A.start-(y.end-y.start));for(const y of _)for(const A of u){if(r.proxyCachedFBO[A.key])continue;let C=r.renderCachePool.pop();C===void 0&&r.renderCache.length<50&&(C=r.renderCache.length,r.renderCache.push(this._createFBO())),C!==void 0&&(r.proxyCachedFBO[A.key]={},r.proxyCachedFBO[A.key][y.start]=C,r.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,y=_.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let A;if(u.isTileClipped())A=r.length,this._overlapStencilMode.test={func:y.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:y.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):pi.disabled}_renderTileClippingMasks(t,r){const u=this.painter,p=this.painter.context,_=p.gl;u._tileClippingMaskIDs={},p.setColorMode(Ei.disabled),p.setDepthMode(Yt.disabled);const y=u.getOrCreateProgram("clippingMask");for(const A of t){const C=u._tileClippingMaskIDs[A.key]=--r;y.draw(u,_.TRIANGLES,Yt.disabled,new pi({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),Ei.disabled,oi.disabled,$l(A.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const u=[t.x,t.y,1,1];n.a6.vec4.transformMat4(u,u,r.pixelMatrixInverse),n.a6.vec4.scale(u,u,1/u[3]),u[0]/=r.worldSize,u[1]/=r.worldSize;const p=r._camera.position,_=n.bD(1,r.center.lat),y=[p[0],p[1],p[2]/_,0],A=n.a6.vec3.subtract([],u.slice(0,3),y);n.a6.vec3.normalize(A,A);const C=this.raycast(y,A,this._exaggeration);return C!==null&&C?(n.a6.vec3.scaleAndAdd(y,y,A,C),y[3]=y[2],y[2]*=_,y):null}_setupProxiedCoordsForOrtho(t,r,u){if(t.getSource()instanceof n.aD)return this._setupProxiedCoordsForImageSource(t,r,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let C=0;C<_.length;C++){const L=_[C],D=this._findTileCoveringTileID(L,t);if(D){const F=this._createProxiedId(L,D,u[L.key]&&u[L.key][t.id]);p.push(F),this.proxyToSource[L.key][t.id]=[F]}}let y=!1;const A=new Set;for(let C=0;C<r.length;C++){const L=t.getTile(r[C]);if(!L||!L.hasData())continue;const D=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==L.tileID.canonical.z){const F=this.proxyToSource[D.tileID.key][t.id],B=this._createProxiedId(D.tileID,L,u[D.tileID.key]&&u[D.tileID.key][t.id]);F?F.splice(F.length-1,0,B):this.proxyToSource[D.tileID.key][t.id]=[B];const V=this.proxyToSource[D.tileID.key][t.id];A.has(V)||A.add(V),p.push(B),y=!0}}if(this._sourceTilesOverlap[t.id]=y,y&&this._debugParams.sortTilesHiZFirst)for(const C of A)C.sort((L,D)=>D.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(t,r,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords,y=t.getSource(),A=y.tileID;if(!A)return;const C=new n.P(A.x,A.y)._div(1<<A.z),L=y.coordinates.map(n.a5.fromLngLat).reduce((F,B)=>(F.min.x=Math.min(F.min.x,B.x-C.x),F.min.y=Math.min(F.min.y,B.y-C.y),F.max.x=Math.max(F.max.x,B.x-C.x),F.max.y=Math.max(F.max.y,B.y-C.y),F),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(F,B)=>{const V=F.wrap+F.canonical.x/(1<<F.canonical.z),q=F.canonical.y/(1<<F.canonical.z),W=n.ab/(1<<F.canonical.z),Z=B.wrap+B.canonical.x/(1<<B.canonical.z),X=B.canonical.y/(1<<B.canonical.z);return V+W<Z+L.min.x||V>Z+L.max.x||q+W<X+L.min.y||q>X+L.max.y};for(let F=0;F<_.length;F++){const B=_[F];for(let V=0;V<r.length;V++){const q=t.getTile(r[V]);if(!q||!q.hasData()||D(B,q.tileID))continue;const W=this._createProxiedId(B,q,u[B.key]&&u[B.key][t.id]),Z=this.proxyToSource[B.key][t.id];Z?Z.push(W):this.proxyToSource[B.key][t.id]=[W],p.push(W)}}}_createProxiedId(t,r,u){let p=this.orthoMatrix;if(u){const _=u.find(y=>y.key===r.tileID.key);if(_)return _}if(r.tileID.key!==t.key){const _=t.canonical.z-r.tileID.canonical.z;let y,A,C;p=n.a6.mat4.create();const L=r.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(y=n.ab>>_,A=y*((r.tileID.canonical.x<<_)-t.canonical.x+L),C=y*((r.tileID.canonical.y<<_)-t.canonical.y)):(y=n.ab<<-_,A=n.ab*(r.tileID.canonical.x-(t.canonical.x+L<<-_)),C=n.ab*(r.tileID.canonical.y-(t.canonical.y<<-_))),n.a6.mat4.ortho(p,0,y,0,y,0,1),n.a6.mat4.translate(p,p,[A,C,0])}return new Vh(r.tileID,t.key,p)}_findTileCoveringTileID(t,r){let u=r.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[r.id],_=p[t.key];if(u=_?r.getTileByID(_):null,u&&u.hasData()||_===null)return u;let y=u?u.tileID:t,A=y.overscaledZ;const C=r.getSource().minzoom,L=[];if(!_){const F=r.getSource().maxzoom;if(t.canonical.z>=F){const B=t.canonical.z-F;r.getSource().reparseOverscaled?(A=Math.max(t.canonical.z+2,r.transform.tileZoom),y=new n.aA(A,t.wrap,F,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(A=F,y=new n.aA(A,t.wrap,F,t.canonical.x>>B,t.canonical.y>>B))}y.key!==t.key&&(L.push(y.key),u=r.getTile(y))}const D=F=>{L.forEach(B=>{p[B]=F}),L.length=0};for(A-=1;A>=C&&(!u||!u.hasData());A--){u&&D(u.tileID.key);const F=y.calculateScaledKey(A);if(u=r.getTileByID(F),u&&u.hasData())break;const B=p[F];if(B===null)break;B===void 0?L.push(F):u=r.getTileByID(B)}return D(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[r.key]=!0}}function Gh(c,t,r){const u=function(A,C,L){const D=n.a6.vec3.dot(C,A),F=n.a6.vec3.dot(L,[.2126,.7152,.0722]),B=(q,W,Z)=>(1-Z)*q+Z*W,V=B(1-.3*Math.min(F,1),1,Math.min(D+1,1));return B(.92,1,Math.asin(n.ap(C[2],-1,1))/Math.PI+.5)*V}(c,[0,0,1],t),p=[0,0,0];n.a6.vec3.scale(p,r.slice(0,3),u);const _=[0,0,0];n.a6.vec3.scale(_,t.slice(0,3),c[2]);const y=[0,0,0];return n.a6.vec3.add(y,p,_),n.cb(y)}const Ko=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],lp=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Ao{static cacheKey(t,r,u,p){let _=`${r}${p?p.cacheKey:""}`;for(const y of u)t.usedDefines.includes(y)&&(_+=`/${y}`);return _}constructor(t,r,u,p,_,y){const A=t.gl;this.program=A.createProgram(),this.configuration=p,this.name=r,this.fixedDefines=[...y];const C=p?p.getBinderAttributes():[],L=(u.staticAttributes||[]).concat(C);let D=p?p.defines():[];D=D.concat(y.map(Z=>`#define ${Z}`));const F=`#version 300 es
`;let B=F+D.concat("precision mediump float;",Zc,Fl.fragmentSource).join(`
`);for(const Z of u.fragmentIncludes)B+=`
${kl[Z]}`;B+=`
${u.fragmentSource}`;let V=F+D.concat("precision highp float;",Zc,Fl.vertexSource).join(`
`);for(const Z of u.vertexIncludes)V+=`
${kl[Z]}`;V+=`
${u.vertexSource}`;const q=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(q,B),A.compileShader(q),A.attachShader(this.program,q);const W=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(W,V),A.compileShader(W),A.attachShader(this.program,W),this.attributes={},this.numAttributes=L.length;for(let Z=0;Z<this.numAttributes;Z++)if(L[Z]){const X=L[Z].startsWith("a_")?L[Z]:`a_${L[Z]}`;A.bindAttribLocation(this.program,Z,X),this.attributes[X]=Z}A.linkProgram(this.program),A.deleteShader(W),A.deleteShader(q),this.fixedUniforms=_(t),this.binderUniforms=p?p.getUniforms(t):[],(y.includes("TERRAIN")||r.indexOf("symbol")!==-1||r.indexOf("circle")!==-1)&&(this.terrainUniforms=(Z=>({u_dem:new n.bJ(Z),u_dem_prev:new n.bJ(Z),u_dem_tl:new n.bG(Z),u_dem_scale:new n.bI(Z),u_dem_tl_prev:new n.bG(Z),u_dem_scale_prev:new n.bI(Z),u_dem_size:new n.bI(Z),u_dem_lerp:new n.bI(Z),u_exaggeration:new n.bI(Z),u_depth:new n.bJ(Z),u_depth_size_inv:new n.bG(Z),u_depth_range_unpack:new n.bG(Z),u_occluder_half_size:new n.bI(Z),u_occlusion_depth_offset:new n.bI(Z),u_meter_to_dem:new n.bI(Z),u_label_plane_matrix_inv:new n.bF(Z)}))(t)),y.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new n.bH(Z),u_tile_tr_up:new n.bH(Z),u_tile_br_up:new n.bH(Z),u_tile_bl_up:new n.bH(Z),u_tile_up_scale:new n.bI(Z)}))(t)),y.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new n.bF(Z),u_fog_range:new n.bG(Z),u_fog_color:new n.c6(Z),u_fog_horizon_blend:new n.bI(Z),u_fog_vertical_limit:new n.bG(Z),u_fog_temporal_offset:new n.bI(Z),u_frustum_tl:new n.bH(Z),u_frustum_tr:new n.bH(Z),u_frustum_br:new n.bH(Z),u_frustum_bl:new n.bH(Z),u_globe_pos:new n.bH(Z),u_globe_radius:new n.bI(Z),u_globe_transition:new n.bI(Z),u_is_globe:new n.bJ(Z),u_viewport:new n.bG(Z)}))(t)),y.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Z=>({u_cutoff_params:new n.c6(Z)}))(t)),y.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Z=>({u_lighting_ambient_color:new n.bH(Z),u_lighting_directional_dir:new n.bH(Z),u_lighting_directional_color:new n.bH(Z),u_ground_radiance:new n.bH(Z)}))(t)),y.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Z=>({u_light_matrix_0:new n.bF(Z),u_light_matrix_1:new n.bF(Z),u_fade_range:new n.bG(Z),u_shadow_normal_offset:new n.bH(Z),u_shadow_intensity:new n.bI(Z),u_shadow_texel_size:new n.bI(Z),u_shadow_map_resolution:new n.bI(Z),u_shadow_direction:new n.bH(Z),u_shadow_bias:new n.bH(Z),u_shadowmap_0:new n.bJ(Z),u_shadowmap_1:new n.bJ(Z)}))(t))}}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p]&&u[p].set(this.program,p,r[p])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p]&&u[p].set(this.program,p,r[p])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}_drawDebugWireframe(t,r,u,p,_,y,A,C,L,D){const F=t.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const B=t.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||t._terrain&&t._terrain.renderingToTexture||!Ko.includes(this.name))||!(!F.layers3D||!lp.includes(this.name))))return;const V=B.gl,q=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,_,B);if(!q)return;const W=[...this.fixedDefines];W.push("DEBUG_WIREFRAME");const Z=t.getOrCreateProgram(this.name,{config:this.configuration,defines:W});B.program.set(Z.program);const X=(ee,ce,le)=>{if(ce[ee]&&le[ee])for(const me in ce[ee])le[ee][me]&&le[ee][me].set(le.program,me,ce[ee][me].current)};L&&L.setUniforms(Z.program,B,Z.binderUniforms,A,{zoom:C}),X("fixedUniforms",this,Z),X("terrainUniforms",this,Z),X("globeUniforms",this,Z),X("fogUniforms",this,Z),X("lightsUniforms",this,Z),X("shadowUniforms",this,Z),q.bind(),B.setColorMode(new Ei([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],n.bz.transparent,[!0,!0,!0,!1])),B.setDepthMode(new Yt(r.func===V.LESS?V.LEQUAL:r.func,Yt.ReadOnly,r.range)),B.setStencilMode(pi.disabled);const ie=3*y.primitiveLength*2,se=3*y.primitiveOffset*2*2;D&&D>1?V.drawElementsInstanced(V.LINES,ie,V.UNSIGNED_SHORT,se,D):V.drawElements(V.LINES,ie,V.UNSIGNED_SHORT,se),_.bind(),B.program.set(this.program),B.setDepthMode(r),B.setStencilMode(u),B.setColorMode(p)}draw(t,r,u,p,_,y,A,C,L,D,F,B,V,q,W,Z){const X=t.context,ie=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(u),X.setStencilMode(p),X.setColorMode(_),X.setCullFace(y);for(const ce of Object.keys(this.fixedUniforms))this.fixedUniforms[ce].set(this.program,ce,A[ce]);q&&q.setUniforms(this.program,X,this.binderUniforms,B,{zoom:V});const se={[ie.POINTS]:1,[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[r],ee=Z&&Z>0?1:void 0;for(const ce of F.get()){const le=ce.vaos||(ce.vaos={});(le[C]||(le[C]=new Ba)).bind(X,this,L,q?q.getPaintVertexBuffers():[],D,ce.vertexOffset,W||[],ee),Z&&Z>1?ie.drawElementsInstanced(r,ce.primitiveLength*se,ie.UNSIGNED_SHORT,ce.primitiveOffset*se*2,Z):D?ie.drawElements(r,ce.primitiveLength*se,ie.UNSIGNED_SHORT,ce.primitiveOffset*se*2):ie.drawArrays(r,ce.vertexOffset,ce.vertexLength),r===ie.TRIANGLES&&D&&this._drawDebugWireframe(t,u,p,_,D,ce,B,V,q,Z)}}}function $h(c,t){const r=Math.pow(2,t.tileID.overscaledZ),u=t.tileSize*Math.pow(2,c.transform.tileZoom)/r,p=u*(t.tileID.canonical.x+t.tileID.wrap*r),_=u*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ak(t,1,c.transform.tileZoom),u_pixel_coord_upper:[p>>16,_>>16],u_pixel_coord_lower:[65535&p,65535&_]}}const ru=n.a6.mat4.create(),qh=(c,t,r,u,p,_,y,A,C,L,D,F,B,V,q,W)=>{const Z=t.style.light,X=Z.properties.get("position"),ie=[X.x,X.y,X.z],se=n.a6.mat3.create();Z.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation(se,-t.transform.angle),n.a6.vec3.transformMat3(ie,ie,se));const ee=Z.properties.get("color"),ce=t.transform,le={u_matrix:c,u_lightpos:ie,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_vertical_gradient:+r,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ru,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:p,u_edge_radius:_,u_width_scale:y,u_flood_light_color:B,u_vertical_scale:V,u_flood_light_intensity:q,u_ground_shadow_factor:W};return ce.projection.name==="globe"&&(le.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],le.u_zoom_transition=L,le.u_inv_rot_matrix=F,le.u_merc_center=D,le.u_up_dir=ce.projection.upVector(new n.bP(0,0,0),D[0]*n.ab,D[1]*n.ab),le.u_height_lift=C),le},cp=(c,t,r,u)=>({u_matrix:c,u_edge_radius:t,u_width_scale:r,u_vertical_scale:u}),Hh=(c,t,r,u,p,_,y,A,C,L,D,F,B,V,q)=>{const W=qh(c,t,r,u,p,_,y,A,L,D,F,B,V,q,1,[0,0,0]),Z={u_height_factor:-Math.pow(2,A.overscaledZ)/C.tileSize/8};return n.l(W,$h(t,C),Z)},nu=(c,t)=>({u_matrix:c,u_emissive_strength:t}),up=(c,t,r,u)=>n.l(nu(c,t),$h(r,u)),hp=(c,t,r)=>({u_matrix:c,u_world:r,u_emissive_strength:t}),ql=(c,t,r,u,p)=>n.l(up(c,t,r,u),{u_world:p}),S_=(c,t,r,u)=>{const p=n.ab/r.tileSize;return{u_matrix:c,u_camera_to_center_distance:t.getCameraToCenterDistance(u),u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},dp=(c,t,r=1)=>({u_matrix:c,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:r}),fp=n.a6.mat4.create(),A_=(c,t,r,u,p,_,y)=>{const A=c.transform,C=A.projection.name==="globe",L=C?n.cI(A.zoom,t.canonical)*A._pixelsPerMercatorPixel:n.ak(r,1,_),D={u_matrix:t.projMatrix,u_extrude_scale:L,u_intensity:y,u_inv_rot_matrix:fp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){D.u_inv_rot_matrix=u,D.u_merc_center=p,D.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],D.u_zoom_transition=n.a9(A.zoom);const F=p[0]*n.ab,B=p[1]*n.ab;D.u_up_dir=A.projection.upVector(new n.bP(0,0,0),F,B)}return D};function su(c,[t,r,u,p],[_,y]){if(_===y)return[0,0,0,0];const A=255*(c-1)/(c*(y-_));return[t*A,r*A,u*A,p*A]}function ou(c,t,[r,u]){return r===u?0:.5/c+(t-r)*(c-1)/(c*(u-r))}const Hl=(c,t,r,u,p,_,y,A,C,L,D,F,B,V,q,W,Z,X,ie,se,ee)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:L,u_fade_t:D.mix,u_opacity:D.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:n.cJ(F.paint.get("raster-saturation")),u_contrast_factor:n.cK(F.paint.get("raster-contrast")),u_spin_weights:Wh(F.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:V,u_zoom_transition:y,u_merc_center:A,u_cutoff_params:C,u_colorization_mix:su(n.cL,W,X),u_colorization_offset:ou(n.cL,Z,X),u_color_ramp:q,u_texture_offset:[se/(ie+2*se),ie/(ie+2*se)],u_texture_res:[ie+2*se,ie+2*se],u_emissive_strength:ee});function Wh(c){c*=Math.PI/180;const t=Math.sin(c),r=Math.cos(c);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Us=.05,pp=(c,t,r,u,p,_,y,A,C,L,D,F)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:L,u_fade_t:D.mix,u_opacity:D.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:y,u_merc_center:A,u_cutoff_params:C}),au=(c,t,r,u,p,_,y,A,C,L)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:u,u_color_ramp:_,u_velocity_res:p,u_max_speed:y,u_uv_offset:A,u_data_scale:[255*C[0],255*C[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Us,Us]}),lu=(c,t,r,u,p,_,y,A,C,L)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:u,u_max_speed:p,u_speed_factor:_,u_reset_rate:y,u_rand_seed:Math.random(),u_uv_offset:A,u_data_scale:[255*C[0],255*C[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Us,Us]}),cu=n.a6.mat4.create(),Zh=(c,t,r,u,p,_,y,A,C,L,D,F,B,V,q,W,Z,X,ie,se,ee)=>{const ce=p.transform,le={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ce.getCameraToCenterDistance(ie),u_rotate_symbol:+r,u_aspect_ratio:ce.width/ce.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:y,u_coord_matrix:A,u_is_text:+L,u_elevation_from_sea:C?1:0,u_pitch_with_map:+u,u_texsize:D,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:cu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:cu,u_up_vector:[0,-1,0],u_color_adj_mat:se,u_icon_transition:ee||0,u_gamma_scale:u?p.transform.getCameraToCenterDistance(ie)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:+B};return ie.name==="globe"&&(le.u_tile_id=[V.canonical.x,V.canonical.y,1<<V.canonical.z],le.u_zoom_transition=q,le.u_inv_rot_matrix=Z,le.u_merc_center=W,le.u_camera_forward=ce._camera.forward(),le.u_ecef_origin=n.cM(ce.globeMatrix,V.toUnwrapped()),le.u_tile_matrix=Float32Array.from(ce.globeMatrix),le.u_up_vector=X),le},mp=(c,t,r,u)=>({u_matrix:c,u_emissive_strength:t,u_opacity:r,u_color:u}),Jo=(c,t,r,u,p,_,y,A,C)=>n.l(function(L,D,F,B,V,q){const{width:W,height:Z}=B.imageManager.getPixelSize(D),X=Math.pow(2,q.tileID.overscaledZ),ie=q.tileSize*Math.pow(2,B.transform.tileZoom)/X,se=ie*(q.tileID.canonical.x+q.tileID.wrap*X),ee=ie*q.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[W,Z],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:V?[B.transform.width,-1*B.transform.height]:[1/n.ak(q,1,B.transform.tileZoom),1/n.ak(q,1,B.transform.tileZoom)],u_pixel_coord_upper:[se>>16,ee>>16],u_pixel_coord_lower:[65535&se,65535&ee]}}(0,_,y,u,A,C),{u_matrix:c,u_emissive_strength:t,u_opacity:r}),Ga=new Float32Array(n.a6.mat4.identity([])),Ft=(c,t,r,u,p,_,y,A,C,L,D,F,B,V=[0,0,0],q)=>{const W=p.style.light,Z=W.properties.get("position"),X=[-Z.x,-Z.y,Z.z],ie=n.a6.mat3.create();W.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation(ie,-p.transform.angle),n.a6.vec3.transformMat3(X,X,ie));const se=D.alphaMode==="MASK",ee=W.properties.get("color").toRenderColor(null),ce=B.paint.get("model-ambient-occlusion-intensity"),le=B.paint.get("model-color").constantOr(n.bz.white).toRenderColor(null),me=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:c,u_lighting_matrix:t,u_normal_matrix:r,u_node_matrix:u||Ga,u_lightpos:X,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_camera_pos:V,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+se,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:[y.r,y.g,y.b,y.a],u_emissiveFactor:[A[0],A[1],A[2],1],u_metallicFactor:C,u_roughnessFactor:L,u_baseColorTexture:gn.BaseColor,u_metallicRoughnessTexture:gn.MetallicRoughness,u_normalTexture:gn.Normal,u_occlusionTexture:gn.Occlusion,u_emissionTexture:gn.Emission,u_lutTexture:gn.LUT,u_color_mix:[le.r,le.g,le.b,me],u_aoIntensity:ce,u_emissive_strength:F,u_occlusionTextureTransform:q||[0,0,0,0]}},Xh=(c,t=Ga,r=Ga)=>({u_matrix:c,u_instance:t,u_node_matrix:r}),_p={fillExtrusion:c=>({u_matrix:new n.bF(c),u_lightpos:new n.bH(c),u_lightintensity:new n.bI(c),u_lightcolor:new n.bH(c),u_vertical_gradient:new n.bI(c),u_opacity:new n.bI(c),u_edge_radius:new n.bI(c),u_width_scale:new n.bI(c),u_ao:new n.bG(c),u_tile_id:new n.bH(c),u_zoom_transition:new n.bI(c),u_inv_rot_matrix:new n.bF(c),u_merc_center:new n.bG(c),u_up_dir:new n.bH(c),u_height_lift:new n.bI(c),u_flood_light_color:new n.bH(c),u_vertical_scale:new n.bI(c),u_flood_light_intensity:new n.bI(c),u_ground_shadow_factor:new n.bH(c)}),fillExtrusionDepth:c=>({u_matrix:new n.bF(c),u_edge_radius:new n.bI(c),u_width_scale:new n.bI(c),u_vertical_scale:new n.bI(c)}),fillExtrusionPattern:c=>({u_matrix:new n.bF(c),u_lightpos:new n.bH(c),u_lightintensity:new n.bI(c),u_lightcolor:new n.bH(c),u_vertical_gradient:new n.bI(c),u_height_factor:new n.bI(c),u_edge_radius:new n.bI(c),u_width_scale:new n.bI(c),u_ao:new n.bG(c),u_tile_id:new n.bH(c),u_zoom_transition:new n.bI(c),u_inv_rot_matrix:new n.bF(c),u_merc_center:new n.bG(c),u_up_dir:new n.bH(c),u_height_lift:new n.bI(c),u_image:new n.bJ(c),u_texsize:new n.bG(c),u_pixel_coord_upper:new n.bG(c),u_pixel_coord_lower:new n.bG(c),u_tile_units_to_pixels:new n.bI(c),u_opacity:new n.bI(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new n.bF(c),u_opacity:new n.bI(c),u_ao_pass:new n.bI(c),u_meter_to_tile:new n.bI(c),u_ao:new n.bG(c),u_flood_light_intensity:new n.bI(c),u_flood_light_color:new n.bH(c),u_attenuation:new n.bI(c),u_edge_radius:new n.bI(c),u_fb:new n.bJ(c),u_fb_size:new n.bI(c),u_dynamic_offset:new n.bI(c)}),fill:c=>({u_matrix:new n.bF(c),u_emissive_strength:new n.bI(c)}),fillPattern:c=>({u_matrix:new n.bF(c),u_emissive_strength:new n.bI(c),u_image:new n.bJ(c),u_texsize:new n.bG(c),u_pixel_coord_upper:new n.bG(c),u_pixel_coord_lower:new n.bG(c),u_tile_units_to_pixels:new n.bI(c)}),fillOutline:c=>({u_matrix:new n.bF(c),u_emissive_strength:new n.bI(c),u_world:new n.bG(c)}),fillOutlinePattern:c=>({u_matrix:new n.bF(c),u_emissive_strength:new n.bI(c),u_world:new n.bG(c),u_image:new n.bJ(c),u_texsize:new n.bG(c),u_pixel_coord_upper:new n.bG(c),u_pixel_coord_lower:new n.bG(c),u_tile_units_to_pixels:new n.bI(c)}),circle:n.cN,collisionBox:c=>({u_matrix:new n.bF(c),u_camera_to_center_distance:new n.bI(c),u_extrude_scale:new n.bG(c)}),collisionCircle:c=>({u_matrix:new n.bF(c),u_inv_matrix:new n.bF(c),u_camera_to_center_distance:new n.bI(c),u_viewport_size:new n.bG(c)}),debug:c=>({u_color:new n.cu(c),u_matrix:new n.bF(c),u_overlay:new n.bJ(c),u_overlay_scale:new n.bI(c)}),clippingMask:c=>({u_matrix:new n.bF(c)}),heatmap:c=>({u_extrude_scale:new n.bI(c),u_intensity:new n.bI(c),u_matrix:new n.bF(c),u_inv_rot_matrix:new n.bF(c),u_merc_center:new n.bG(c),u_tile_id:new n.bH(c),u_zoom_transition:new n.bI(c),u_up_dir:new n.bH(c)}),heatmapTexture:c=>({u_image:new n.bJ(c),u_color_ramp:new n.bJ(c),u_opacity:new n.bI(c)}),hillshade:c=>({u_matrix:new n.bF(c),u_image:new n.bJ(c),u_latrange:new n.bG(c),u_light:new n.bG(c),u_shadow:new n.cu(c),u_highlight:new n.cu(c),u_emissive_strength:new n.bI(c),u_accent:new n.cu(c)}),hillshadePrepare:c=>({u_matrix:new n.bF(c),u_image:new n.bJ(c),u_dimension:new n.bG(c),u_zoom:new n.bI(c)}),line:n.cO,linePattern:n.cP,raster:c=>({u_matrix:new n.bF(c),u_normalize_matrix:new n.bF(c),u_globe_matrix:new n.bF(c),u_merc_matrix:new n.bF(c),u_grid_matrix:new n.cv(c),u_tl_parent:new n.bG(c),u_scale_parent:new n.bI(c),u_fade_t:new n.bI(c),u_opacity:new n.bI(c),u_image0:new n.bJ(c),u_image1:new n.bJ(c),u_brightness_low:new n.bI(c),u_brightness_high:new n.bI(c),u_saturation_factor:new n.bI(c),u_contrast_factor:new n.bI(c),u_spin_weights:new n.bH(c),u_perspective_transform:new n.bG(c),u_raster_elevation:new n.bI(c),u_zoom_transition:new n.bI(c),u_merc_center:new n.bG(c),u_cutoff_params:new n.c6(c),u_colorization_mix:new n.c6(c),u_colorization_offset:new n.bI(c),u_color_ramp:new n.bJ(c),u_texture_offset:new n.bG(c),u_texture_res:new n.bG(c),u_emissive_strength:new n.bI(c)}),rasterParticle:c=>({u_matrix:new n.bF(c),u_normalize_matrix:new n.bF(c),u_globe_matrix:new n.bF(c),u_merc_matrix:new n.bF(c),u_grid_matrix:new n.cv(c),u_tl_parent:new n.bG(c),u_scale_parent:new n.bI(c),u_fade_t:new n.bI(c),u_opacity:new n.bI(c),u_image0:new n.bJ(c),u_image1:new n.bJ(c),u_raster_elevation:new n.bI(c),u_zoom_transition:new n.bI(c),u_merc_center:new n.bG(c),u_cutoff_params:new n.c6(c)}),rasterParticleTexture:c=>({u_texture:new n.bJ(c),u_opacity:new n.bI(c)}),rasterParticleDraw:c=>({u_particle_texture:new n.bJ(c),u_particle_texture_side_len:new n.bI(c),u_tile_offset:new n.bG(c),u_velocity:new n.bJ(c),u_color_ramp:new n.bJ(c),u_velocity_res:new n.bG(c),u_max_speed:new n.bI(c),u_uv_offset:new n.bG(c),u_data_scale:new n.bG(c),u_data_offset:new n.bI(c),u_particle_pos_scale:new n.bI(c),u_particle_pos_offset:new n.bG(c)}),rasterParticleUpdate:c=>({u_particle_texture:new n.bJ(c),u_particle_texture_side_len:new n.bI(c),u_velocity:new n.bJ(c),u_velocity_res:new n.bG(c),u_max_speed:new n.bI(c),u_speed_factor:new n.bI(c),u_reset_rate:new n.bI(c),u_rand_seed:new n.bI(c),u_uv_offset:new n.bG(c),u_data_scale:new n.bG(c),u_data_offset:new n.bI(c),u_particle_pos_scale:new n.bI(c),u_particle_pos_offset:new n.bG(c)}),symbol:c=>({u_is_size_zoom_constant:new n.bJ(c),u_is_size_feature_constant:new n.bJ(c),u_size_t:new n.bI(c),u_size:new n.bI(c),u_camera_to_center_distance:new n.bI(c),u_rotate_symbol:new n.bJ(c),u_aspect_ratio:new n.bI(c),u_fade_change:new n.bI(c),u_matrix:new n.bF(c),u_label_plane_matrix:new n.bF(c),u_coord_matrix:new n.bF(c),u_is_text:new n.bJ(c),u_elevation_from_sea:new n.bJ(c),u_pitch_with_map:new n.bJ(c),u_texsize:new n.bG(c),u_texsize_icon:new n.bG(c),u_texture:new n.bJ(c),u_texture_icon:new n.bJ(c),u_gamma_scale:new n.bI(c),u_device_pixel_ratio:new n.bI(c),u_tile_id:new n.bH(c),u_zoom_transition:new n.bI(c),u_inv_rot_matrix:new n.bF(c),u_merc_center:new n.bG(c),u_camera_forward:new n.bH(c),u_tile_matrix:new n.bF(c),u_up_vector:new n.bH(c),u_ecef_origin:new n.bH(c),u_is_halo:new n.bJ(c),u_icon_transition:new n.bI(c),u_color_adj_mat:new n.bF(c)}),background:c=>({u_matrix:new n.bF(c),u_emissive_strength:new n.bI(c),u_opacity:new n.bI(c),u_color:new n.cu(c)}),backgroundPattern:c=>({u_matrix:new n.bF(c),u_emissive_strength:new n.bI(c),u_opacity:new n.bI(c),u_image:new n.bJ(c),u_pattern_tl:new n.bG(c),u_pattern_br:new n.bG(c),u_texsize:new n.bG(c),u_pattern_size:new n.bG(c),u_pixel_coord_upper:new n.bG(c),u_pixel_coord_lower:new n.bG(c),u_pattern_units_to_pixels:new n.bG(c)}),terrainRaster:c=>({u_matrix:new n.bF(c),u_image0:new n.bJ(c),u_skirt_height:new n.bI(c),u_ground_shadow_factor:new n.bH(c)}),skybox:c=>({u_matrix:new n.bF(c),u_sun_direction:new n.bH(c),u_cubemap:new n.bJ(c),u_opacity:new n.bI(c),u_temporal_offset:new n.bI(c)}),skyboxGradient:c=>({u_matrix:new n.bF(c),u_color_ramp:new n.bJ(c),u_center_direction:new n.bH(c),u_radius:new n.bI(c),u_opacity:new n.bI(c),u_temporal_offset:new n.bI(c)}),skyboxCapture:c=>({u_matrix_3f:new n.cv(c),u_sun_direction:new n.bH(c),u_sun_intensity:new n.bI(c),u_color_tint_r:new n.c6(c),u_color_tint_m:new n.c6(c),u_luminance:new n.bI(c)}),globeRaster:c=>({u_proj_matrix:new n.bF(c),u_globe_matrix:new n.bF(c),u_normalize_matrix:new n.bF(c),u_merc_matrix:new n.bF(c),u_zoom_transition:new n.bI(c),u_merc_center:new n.bG(c),u_image0:new n.bJ(c),u_grid_matrix:new n.cv(c),u_skirt_height:new n.bI(c),u_far_z_cutoff:new n.bI(c),u_frustum_tl:new n.bH(c),u_frustum_tr:new n.bH(c),u_frustum_br:new n.bH(c),u_frustum_bl:new n.bH(c),u_globe_pos:new n.bH(c),u_globe_radius:new n.bI(c),u_viewport:new n.bG(c)}),globeAtmosphere:c=>({u_frustum_tl:new n.bH(c),u_frustum_tr:new n.bH(c),u_frustum_br:new n.bH(c),u_frustum_bl:new n.bH(c),u_horizon:new n.bI(c),u_transition:new n.bI(c),u_fadeout_range:new n.bI(c),u_color:new n.c6(c),u_high_color:new n.c6(c),u_space_color:new n.c6(c),u_temporal_offset:new n.bI(c),u_horizon_angle:new n.bI(c)}),model:c=>({u_matrix:new n.bF(c),u_lighting_matrix:new n.bF(c),u_normal_matrix:new n.bF(c),u_node_matrix:new n.bF(c),u_lightpos:new n.bH(c),u_lightintensity:new n.bI(c),u_lightcolor:new n.bH(c),u_camera_pos:new n.bH(c),u_opacity:new n.bI(c),u_baseColorFactor:new n.c6(c),u_emissiveFactor:new n.c6(c),u_metallicFactor:new n.bI(c),u_roughnessFactor:new n.bI(c),u_baseTextureIsAlpha:new n.bJ(c),u_alphaMask:new n.bJ(c),u_alphaCutoff:new n.bI(c),u_baseColorTexture:new n.bJ(c),u_metallicRoughnessTexture:new n.bJ(c),u_normalTexture:new n.bJ(c),u_occlusionTexture:new n.bJ(c),u_emissionTexture:new n.bJ(c),u_lutTexture:new n.bJ(c),u_color_mix:new n.c6(c),u_aoIntensity:new n.bI(c),u_emissive_strength:new n.bI(c),u_occlusionTextureTransform:new n.c6(c)}),modelDepth:c=>({u_matrix:new n.bF(c),u_instance:new n.bF(c),u_node_matrix:new n.bF(c)}),groundShadow:c=>({u_matrix:new n.bF(c),u_ground_shadow_factor:new n.bH(c)}),stars:c=>({u_matrix:new n.bF(c),u_up:new n.bH(c),u_right:new n.bH(c),u_intensity_multiplier:new n.bI(c)}),occlusion:c=>({u_matrix:new n.bF(c),u_anchorPos:new n.bH(c),u_screenSizePx:new n.bG(c),u_occluderSizePx:new n.bG(c),u_color:new n.c6(c)})};class $n{constructor(t,r,u,p){this.id=$n.uniqueIdxCounter,$n.uniqueIdxCounter++,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||p||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=$n.uniqueIdxCounter,$n.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}$n.uniqueIdxCounter=0;const Qo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gt{constructor(t,r,u,p,_,y){this.length=r.length,this.attributes=u,this.itemSize=r.bytesPerElement,this.dynamicDraw=p,this.instanceCount=y,this.context=t;const A=t.gl;this.buffer=A.createBuffer(),t.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||_||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let u=0;u<this.attributes.length;u++){const p=r.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,r,u){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],y=r.attributes[_.name];y!==void 0&&t.vertexAttribPointer(y,_.components,t[Qo[_.type]],!1,this.itemSize,_.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,r,u){for(let p=0;p<this.attributes.length;p++){const _=r.attributes[this.attributes[p].name];_!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(_,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class uu{constructor(t,r,u,p,_){this.context=t,this.width=r,this.height=u;const y=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new tu(t,y)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new Nh(t,y):new ip(t,y))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class I_{constructor(t,r){this.gl=t,this.clearColor=new Ch(this),this.clearDepth=new Zf(this),this.clearStencil=new Ph(this),this.colorMask=new Kc(this),this.depthMask=new Ul(this),this.stencilMask=new Xf(this),this.stencilFunc=new Yf(this),this.stencilOp=new Kf(this),this.stencilTest=new Na(this),this.depthRange=new Jf(this),this.depthTest=new v_(this),this.depthFunc=new b_(this),this.blend=new w_(this),this.blendFunc=new Rh(this),this.blendColor=new Lh(this),this.blendEquation=new Dh(this),this.cullFace=new zh(this),this.cullFaceSide=new Qf(this),this.frontFace=new ep(this),this.program=new T_(this),this.activeTexture=new Vl(this),this.viewport=new jl(this),this.bindFramebuffer=new tp(this),this.bindRenderbuffer=new is(this),this.bindTexture=new Oh(this),this.bindVertexBuffer=new Jc(this),this.bindElementBuffer=new Qc(this),this.bindVertexArrayOES=new kh(this),this.pixelStoreUnpack=new Fh(this),this.pixelStoreUnpackPremultiplyAlpha=new eu(this),this.pixelStoreUnpackFlipY=new Bh(this),this.options=r?{...r}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,u){return new $n(this,t,r,u)}createVertexBuffer(t,r,u,p,_){return new Gt(this,t,r,u,p,_)}createRenderbuffer(t,r,u){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,t,r,u),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,u,p){return new uu(this,t,r,u,p)}clear({color:t,depth:r,stencil:u,colorMask:p}){const _=this.gl;let y=0;t&&(y|=_.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(p||[!0,!0,!0,!0])),r!==void 0&&(y|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),u!==void 0&&(y|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),_.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.bh(t.blendFunction,Ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let hu;function du(c,t,r,u,p,_,y){const A=c.context,C=A.gl,L=c.transform,D=c.getOrCreateProgram("collisionBox"),F=[];let B=0,V=0;for(let ee=0;ee<u.length;ee++){const ce=u[ee],le=t.getTile(ce),me=le.getBucket(r);if(!me)continue;const fe=Of(ce,me,L);let ye=fe;p[0]===0&&p[1]===0||(ye=c.translatePosMatrix(fe,le,p,_));const Ie=y?me.textCollisionBox:me.iconCollisionBox,Te=me.collisionCircleArray;if(Te.length>0){const be=n.a6.mat4.create(),ze=ye;n.a6.mat4.mul(be,me.placementInvProjMatrix,L.glCoordMatrix),n.a6.mat4.mul(be,be,me.placementViewportMatrix),F.push({circleArray:Te,circleOffset:V,transform:ze,invTransform:be,projection:me.getProjection()}),B+=Te.length/4,V=B}Ie&&(c.terrain&&c.terrain.setupElevationDraw(le,D),D.draw(c,C.LINES,Yt.disabled,pi.disabled,c.colorModeForRenderPass(),oi.disabled,S_(ye,L,le,me.getProjection()),r.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,null,L.zoom,null,[Ie.collisionVertexBuffer,Ie.collisionVertexBufferExt]))}if(!y||!F.length)return;const q=c.getOrCreateProgram("collisionCircle"),W=new n.cQ;W.resize(4*B),W._trim();let Z=0;for(const ee of F)for(let ce=0;ce<ee.circleArray.length/4;ce++){const le=4*ce,me=ee.circleArray[le+0],fe=ee.circleArray[le+1],ye=ee.circleArray[le+2],Ie=ee.circleArray[le+3];W.emplace(Z++,me,fe,ye,Ie,0),W.emplace(Z++,me,fe,ye,Ie,1),W.emplace(Z++,me,fe,ye,Ie,2),W.emplace(Z++,me,fe,ye,Ie,3)}(!hu||hu.length<2*B)&&(hu=function(ee){const ce=2*ee,le=new n.aO;le.resize(ce),le._trim();for(let me=0;me<ce;me++){const fe=6*me;le.uint16[fe+0]=4*me+0,le.uint16[fe+1]=4*me+1,le.uint16[fe+2]=4*me+2,le.uint16[fe+3]=4*me+2,le.uint16[fe+4]=4*me+3,le.uint16[fe+5]=4*me+0}return le}(B));const X=A.createIndexBuffer(hu,!0),ie=A.createVertexBuffer(W,n.cR.members,!0);for(const ee of F){const ce={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(se=L).getCameraToCenterDistance(ee.projection),u_viewport_size:[se.width,se.height]};q.draw(c,C.TRIANGLES,Yt.disabled,pi.disabled,c.colorModeForRenderPass(),oi.disabled,ce,r.id,ie,X,n.b1.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,L.zoom)}var se;ie.destroy(),X.destroy()}const Wl=n.a6.mat4.create();function Yh(c){const t=c._camera.getWorldToCamera(c.worldSize,1),r=n.a6.mat4.multiply([],t,c.globeMatrix);n.a6.mat4.invert(r,r);const u=[0,0,0],p=[0,1,0,0];return n.a6.vec4.transformMat4(p,p,r),u[0]=p[0],u[1]=p[1],u[2]=p[2],n.a6.vec3.normalize(u,u),u}function M_({width:c,height:t,anchor:r,textOffset:u,textScale:p},_){const{horizontalAlign:y,verticalAlign:A}=n.bx(r),C=-(y-.5)*c,L=-(A-.5)*t,D=n.bw(r,u);return new n.P((C/p+D[0])*_,(L/p+D[1])*_)}function C_(c,t,r,u,p,_,y,A,C,L,D){const F=c.text.placedSymbolArray,B=c.text.dynamicLayoutVertexArray,V=c.icon.dynamicLayoutVertexArray,q={},W=c.getProjection(),Z=wo(A,W,_),X=_.elevation,ie=W.upVectorScale(A.canonical,_.center.lat,_.worldSize).metersToTile;B.clear();for(let se=0;se<F.length;se++){const ee=F.get(se),{tileAnchorX:ce,tileAnchorY:le,numGlyphs:me}=ee,fe=ee.hidden||!ee.crossTileID||c.allowVerticalPlacement&&!ee.placedOrientation?null:u[ee.crossTileID];if(fe){let ye=0,Ie=0,Te=0;if(X){const it=X?X.getAtTileOffset(A,ce,le):0,[yt,vt,at]=W.upVector(A.canonical,ce,le);ye=it*yt*ie,Ie=it*vt*ie,Te=it*at*ie}let[be,ze,Je,lt]=wn(ee.projectedAnchorX+ye,ee.projectedAnchorY+Ie,ee.projectedAnchorZ+Te,r?Z:y);const Ke=Di(_.getCameraToCenterDistance(W),lt);let mt=p.evaluateSizeForFeature(c.textSizeData,L,ee)*Ke/n.bq;r&&(mt*=c.tilePixelRatio/C);const Oe=M_(fe,mt);r?({x:be,y:ze,z:Je}=W.projectTilePoint(ce+Oe.x,le+Oe.y,A.canonical),[be,ze,Je]=wn(be+ye,ze+Ie,Je+Te,y)):(t&&Oe._rotate(-_.angle),be+=Oe.x,ze+=Oe.y,Je=0);const ot=c.allowVerticalPlacement&&ee.placedOrientation===n.bk.vertical?Math.PI/2:0;for(let it=0;it<me;it++)n.bn(B,be,ze,Je,ot);D&&ee.associatedIconIndex>=0&&(q[ee.associatedIconIndex]={x:be,y:ze,z:Je,angle:ot})}else Ns(me,B)}if(D){V.clear();const se=c.icon.placedSymbolArray;for(let ee=0;ee<se.length;ee++){const ce=se.get(ee),{numGlyphs:le}=ce,me=q[ee];if(ce.hidden||!me)Ns(le,V);else{const{x:fe,y:ye,z:Ie,angle:Te}=me;for(let be=0;be<le;be++)n.bn(V,fe,ye,Ie,Te)}}c.icon.dynamicLayoutVertexBuffer.updateData(V)}c.text.dynamicLayoutVertexBuffer.updateData(B)}function Zl(c,t,r,u,p,_,y={}){const A=r.paint.get("icon-translate"),C=r.paint.get("text-translate"),L=r.paint.get("icon-translate-anchor"),D=r.paint.get("text-translate-anchor"),F=r.layout.get("icon-rotation-alignment"),B=r.layout.get("text-rotation-alignment"),V=r.layout.get("icon-pitch-alignment"),q=r.layout.get("text-pitch-alignment"),W=r.layout.get("icon-keep-upright"),Z=r.layout.get("text-keep-upright"),X=r.paint.get("icon-color-saturation"),ie=r.paint.get("icon-color-contrast"),se=r.paint.get("icon-color-brightness-min"),ee=r.paint.get("icon-color-brightness-max"),ce=r.paint.get("symbol-elevation-reference")==="sea",le=r.paint.get("text-occlusion-opacity").constantOr(0),me=c.context,fe=me.gl,ye=c.transform,Ie=F==="map",Te=B==="map",be=V==="map",ze=q==="map",Je=r.layout.get("symbol-sort-key").constantOr(1)!==void 0;let lt=!1;const Ke=c.depthModeForSublayer(0,Yt.ReadOnly),mt=[n.am(ye.center.lng),n.at(ye.center.lat)],Oe=r.layout.get("text-variable-anchor"),ot=ye.projection.name==="globe",it=[],yt=[0,-1,0];for(const vt of u){const at=t.getTile(vt),ut=at.getBucket(r);if(!ut||ut.projection.name==="mercator"&&ot||ut.fullyClipped)continue;const Ht=ut.projection.name==="globe",St=Ht?n.a9(ye.zoom):0,Ot=wo(vt,ut.getProjection(),ye),ri=ye.calculatePixelsToTileUnitsMatrix(at),Vt=Oe&&ut.hasTextData(),Qt=ut.hasIconTextFit()&&Vt&&ut.hasIconData(),bi=ut.getProjection().createInversionMatrix(ye,vt.canonical),yi=Qi=>{ye.depthOcclusionForSymbolsAndCircles&&(r.hasInitialOcclusionOpacityProperties||c.terrain)&&(Qi.push("DEPTH_D24"),Qi.push("DEPTH_OCCLUSION"))},Yi=()=>{const Qi=Ie&&r.layout.get("symbol-placement")!=="point",xi=[];yi(xi);const Ni=Qi||Qt,Wi=r.paint.get("icon-image-cross-fade").constantOr(0);c.terrainRenderModeElevated()&&be&&xi.push("PITCH_WITH_MAP_TERRAIN"),Ht&&(xi.push("PROJECTION_GLOBE_VIEW"),Ni&&xi.push("PROJECTED_POS_ON_VIEWPORT")),Wi>0&&xi.push("ICON_TRANSITION"),ut.icon.zOffsetVertexBuffer&&xi.push("Z_OFFSET"),X===0&&ie===0&&se===0&&ee===1||xi.push("COLOR_ADJUSTMENT"),ut.sdfIcons&&xi.push("RENDER_SDF");const Mr=ut.icon.programConfigurations.get(r.id),Br=c.getOrCreateProgram("symbol",{config:Mr,defines:xi}),Li=at.imageAtlasTexture?at.imageAtlasTexture.size:[0,0],Yr=ut.iconSizeData,nn=n.bj(Yr,ye.zoom),Kr=be||ye.pitch!==0,ar=Ci(Ot,at.tileID.canonical,be,Ie,ye,ut.getProjection(),ri),zn=jn(Ot,at.tileID.canonical,be,Ie,ye,ut.getProjection(),ri),On=c.translatePosMatrix(zn,at,A,L,!0),ds=c.translatePosMatrix(Ot,at,A,L),ns=Ni?Wl:ar,Hn=Ie&&!be&&!Qi;let fs=yt;!ot&&!ye.mercatorFromTransition||Ie||(fs=Yh(ye));const ao=Ht?fs:yt,Do=r.getColorAdjustmentMatrix(X,ie,se,ee),$s=Zh(Yr.kind,nn,Hn,be,c,ds,ns,On,ce,!1,Li,[0,0],!0,vt,St,mt,bi,ao,ut.getProjection(),Do,Wi),el=at.imageAtlasTexture?at.imageAtlasTexture:null,tl=r.layout.get("icon-size").constantOr(0)!==1||ut.iconsNeedLinear,Cu=ut.sdfIcons||c.options.rotating||c.options.zooming||tl||Kr?fe.LINEAR:fe.NEAREST,il=ut.sdfIcons&&r.paint.get("icon-halo-width").constantOr(1)!==0,lr=c.terrain&&be&&Qi?n.a6.mat4.invert(n.a6.mat4.create(),ar):Wl;if(Qi&&ut.icon){const sa=ye.elevation,$_=sa?sa.getAtTileOffsetFunc(vt,ye.center.lat,ye.worldSize,ut.getProjection()):null,Op=Pi(Ot,at.tileID.canonical,be,Ie,ye,ut.getProjection(),ri);Sa(ut,Ot,c,!1,Op,zn,be,W,$_,vt)}return{program:Br,buffers:ut.icon,uniformValues:$s,atlasTexture:el,atlasTextureIcon:null,atlasInterpolation:Cu,atlasInterpolationIcon:null,isSDF:ut.sdfIcons,hasHalo:il,tile:at,labelPlaneMatrixInv:lr}},rr=()=>{const Qi=Te&&r.layout.get("symbol-placement")!=="point",xi=[],Ni=Qi||Oe||Qt;c.terrainRenderModeElevated()&&ze&&xi.push("PITCH_WITH_MAP_TERRAIN"),Ht&&(xi.push("PROJECTION_GLOBE_VIEW"),Ni&&xi.push("PROJECTED_POS_ON_VIEWPORT")),ut.text.zOffsetVertexBuffer&&xi.push("Z_OFFSET"),ut.iconsInText&&xi.push("RENDER_TEXT_AND_SYMBOL"),xi.push("RENDER_SDF"),yi(xi);const Wi=ut.text.programConfigurations.get(r.id),Mr=c.getOrCreateProgram("symbol",{config:Wi,defines:xi});let Br,Li=[0,0],Yr=null;const nn=ut.textSizeData;ut.iconsInText&&(Li=at.imageAtlasTexture?at.imageAtlasTexture.size:[0,0],Yr=at.imageAtlasTexture?at.imageAtlasTexture:null,Br=ze||ye.pitch!==0||c.options.rotating||c.options.zooming||nn.kind==="composite"||nn.kind==="camera"?fe.LINEAR:fe.NEAREST);const Kr=at.glyphAtlasTexture?at.glyphAtlasTexture.size:[0,0],ar=n.bj(nn,ye.zoom),zn=Ci(Ot,at.tileID.canonical,ze,Te,ye,ut.getProjection(),ri),On=jn(Ot,at.tileID.canonical,ze,Te,ye,ut.getProjection(),ri),ds=c.translatePosMatrix(On,at,C,D,!0),ns=c.translatePosMatrix(Ot,at,C,D),Hn=Ni?Wl:zn,fs=Te&&!ze&&!Qi;let ao=yt;!ot&&!ye.mercatorFromTransition||Te||(ao=Yh(ye));const Do=Zh(nn.kind,ar,fs,ze,c,ns,Hn,ds,ce,!0,Kr,Li,!0,vt,St,mt,bi,Ht?ao:yt,ut.getProjection(),le),$s=at.glyphAtlasTexture?at.glyphAtlasTexture:null,el=fe.LINEAR,tl=r.paint.get("text-halo-width").constantOr(1)!==0,Cu=c.terrain&&ze&&Qi?n.a6.mat4.invert(n.a6.mat4.create(),zn):Wl;if(Qi&&ut.text){const il=ye.elevation,lr=il?il.getAtTileOffsetFunc(vt,ye.center.lat,ye.worldSize,ut.getProjection()):null,sa=Pi(Ot,at.tileID.canonical,ze,Te,ye,ut.getProjection(),ri);Sa(ut,Ot,c,!0,sa,On,ze,Z,lr,vt)}return{program:Mr,buffers:ut.text,uniformValues:Do,atlasTexture:$s,atlasTextureIcon:Yr,atlasInterpolation:el,atlasInterpolationIcon:Br,isSDF:!0,hasHalo:tl,tile:at,labelPlaneMatrixInv:Cu}},ur=ut.icon.segments.get().length,hs=ut.text.segments.get().length,Fr=ur&&!y.onlyText?Yi():null,Ai=hs&&!y.onlyIcons?rr():null,tr=r.paint.get("icon-opacity").constantOr(1),mr=r.paint.get("text-opacity").constantOr(1);if(Je&&ut.canOverlap){lt=!0;const Qi=tr&&!y.onlyText?ut.icon.segments.get():[],xi=mr&&!y.onlyIcons?ut.text.segments.get():[];for(const Ni of Qi)it.push({segments:new n.b1([Ni]),sortKey:Ni.sortKey,state:Fr});for(const Ni of xi)it.push({segments:new n.b1([Ni]),sortKey:Ni.sortKey,state:Ai})}else y.onlyText||it.push({segments:tr?ut.icon.segments:new n.b1([]),sortKey:0,state:Fr}),y.onlyIcons||it.push({segments:mr?ut.text.segments:new n.b1([]),sortKey:0,state:Ai})}lt&&it.sort((vt,at)=>vt.sortKey-at.sortKey);for(const vt of it){const at=vt.state;if(at)if(c.terrain?c.terrain.setupElevationDraw(at.tile,at.program,{useDepthForOcclusion:ye.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:at.labelPlaneMatrixInv}):c.setupDepthForOcclusion(ye.depthOcclusionForSymbolsAndCircles,at.program),me.activeTexture.set(fe.TEXTURE0),at.atlasTexture&&at.atlasTexture.bind(at.atlasInterpolation,fe.CLAMP_TO_EDGE,!0),at.atlasTextureIcon&&(me.activeTexture.set(fe.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,fe.CLAMP_TO_EDGE,!0)),c.uploadCommonLightUniforms(c.context,at.program),at.hasHalo){const ut=at.uniformValues;ut.u_is_halo=1,Xl(at.buffers,vt.segments,r,c,at.program,Ke,p,_,ut,2),ut.u_is_halo=0}else{if(at.isSDF){const ut=at.uniformValues;at.hasHalo&&(ut.u_is_halo=1,Xl(at.buffers,vt.segments,r,c,at.program,Ke,p,_,ut,1)),ut.u_is_halo=0}Xl(at.buffers,vt.segments,r,c,at.program,Ke,p,_,at.uniformValues,1)}}}function Xl(c,t,r,u,p,_,y,A,C,L){const D=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer];p.draw(u,u.context.gl.TRIANGLES,_,y,A,oi.disabled,C,r.id,c.layoutVertexBuffer,c.indexBuffer,t,r.paint,u.transform.zoom,c.programConfigurations.get(r.id),D,L)}function fu(c,t,r,u,p,_,y){const A=c.context.gl,C=r.paint.get("fill-pattern"),L=r.is3D(),D=L?c.stencilModeFor3D():pi.disabled,F=C&&C.constantOr(1);let B,V,q,W,Z;y?(V=F&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=A.LINES):(V=F?"fillPattern":"fill",B=A.TRIANGLES);for(const X of u){const ie=t.getTile(X);if(F&&!ie.patternsLoaded())continue;const se=ie.getBucket(r);if(!se)continue;c.prepareDrawTile();const ee=se.programConfigurations.get(r.id),ce=c.isTileAffectedByFog(X),le=c.getOrCreateProgram(V,{config:ee,overrideFog:ce});F&&(c.context.activeTexture.set(A.TEXTURE0),ie.imageAtlasTexture&&ie.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ee.updatePaintBuffers());const me=C.constantOr(null);if(me&&ie.imageAtlas){const Ie=ie.imageAtlas.patternPositions[me.toString()];Ie&&ee.setConstantPatternPositions(Ie)}const fe=c.translatePosMatrix(X.projMatrix,ie,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),ye=r.paint.get("fill-emissive-strength");if(y){W=se.indexBuffer2,Z=se.segments2;const Ie=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];q=V==="fillOutlinePattern"&&F?ql(fe,ye,c,ie,Ie):hp(fe,ye,Ie)}else W=se.indexBuffer,Z=se.segments,q=F?up(fe,ye,c,ie):nu(fe,ye);c.uploadCommonUniforms(c.context,le,X.toUnwrapped()),le.draw(c,B,p,L?D:c.stencilModeForClipping(X),_,oi.disabled,q,r.id,se.layoutVertexBuffer,W,Z,r.paint,c.transform.zoom,ee,void 0)}}function $a(c,t,r,u,p,_,y,A){r.resetLayerRenderingStats(c);const C=c.context,L=C.gl,D=c.transform,F=r.paint.get("fill-extrusion-pattern"),B=F.constantOr(1),V=r.paint.get("fill-extrusion-opacity"),q=c.style.enable3dLights(),W=r.paint.get(q&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Z=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),W],X=r.layout.get("fill-extrusion-edge-radius"),ie=X>0&&!r.paint.get("fill-extrusion-rounded-roof"),se=ie?0:X,ee=D.projection.name==="globe"?n.c_():0,ce=D.projection.name==="globe",le=ce?n.a9(D.zoom):0,me=[n.am(D.center.lng),n.at(D.center.lat)],fe=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(r.lut).toArray01().slice(0,3),ye=r.paint.get("fill-extrusion-flood-light-intensity"),Ie=r.paint.get("fill-extrusion-vertical-scale"),Te=r.paint.get("fill-extrusion-line-width").constantOr(1)!==0,be=to(c,r.paint.get("fill-extrusion-cutoff-fade-range")),ze=[];let Je;ce&&ze.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&ze.push("FAUX_AO"),ie&&ze.push("ZERO_ROOF_RADIUS"),A&&ze.push("HAS_CENTROID"),ye>0&&ze.push("FLOOD_LIGHT"),be.shouldRenderCutoff&&ze.push("RENDER_CUTOFF"),Te&&ze.push("RENDER_WALL_MODE");const lt=c.renderPass==="shadow",Ke=c.shadowRenderer,mt=lt&&!!Ke;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let Oe=[0,0,0];if(Ke){const yt=c.style.directionalLight,vt=c.style.ambientLight;yt&&vt&&(Oe=Gc(c.style,yt,vt)),Je=ze.concat(["SHADOWS_SINGLE_CASCADE"])}const ot=mt?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",it=r.getLayerRenderingStats();for(const yt of u){const vt=t.getTile(yt),at=vt.getBucket(r);if(!at||at.projection.name!==D.projection.name)continue;let ut=!1;Ke&&(ut=Ke.getMaxCascadeForTile(yt.toUnwrapped())===0);const Ht=c.isTileAffectedByFog(yt),St=at.programConfigurations.get(r.id),Ot=c.getOrCreateProgram(ot,{config:St,defines:ut?Je:ze,overrideFog:Ht});if(c.terrain&&c.terrain.setupElevationDraw(vt,Ot,{useMeterToDem:!0}),!at.centroidVertexBuffer){const rr=Ot.attributes.a_centroid_pos;rr!==void 0&&L.vertexAttrib2f(rr,0,0)}!lt&&Ke&&Ke.setupShadows(vt.tileID.toUnwrapped(),Ot,"vector-tile",vt.tileID.overscaledZ),B&&(c.context.activeTexture.set(L.TEXTURE0),vt.imageAtlasTexture&&vt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),St.updatePaintBuffers());const ri=F.constantOr(null);if(ri&&vt.imageAtlas){const rr=vt.imageAtlas.patternPositions[ri.toString()];rr&&St.setConstantPatternPositions(rr)}const Vt=r.paint.get("fill-extrusion-vertical-gradient"),Qt=1/at.tileToMeter;let bi;if(lt&&Ke){if(Qh(vt.tileID,at,c))continue;const rr=Ke.calculateShadowPassMatrixFromTile(vt.tileID.toUnwrapped());bi=cp(rr,se,Qt,Ie)}else{const rr=c.translatePosMatrix(yt.expandedProjMatrix,vt,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),ur=D.projection.createInversionMatrix(D,yt.canonical);bi=B?Hh(rr,c,Vt,V,Z,se,Qt,yt,vt,ee,le,me,ur,fe,Ie):qh(rr,c,Vt,V,Z,se,Qt,yt,ee,le,me,ur,fe,Ie,ye,Oe)}c.uploadCommonUniforms(C,Ot,yt.toUnwrapped(),null,be);let yi=at.segments;if(D.projection.name==="mercator"&&!lt&&(yi=at.getVisibleSegments(vt.tileID,c.terrain,c.transform.getFrustum(0)),!yi.get().length))continue;if(it)if(lt)for(const rr of yi.get())it.numRenderedVerticesInShadowPass+=rr.primitiveLength;else for(const rr of yi.get())it.numRenderedVerticesInTransparentPass+=rr.primitiveLength;const Yi=[];(c.terrain||A)&&Yi.push(at.centroidVertexBuffer),ce&&Yi.push(at.layoutVertexExtBuffer),Te&&Yi.push(at.wallVertexBuffer),Ot.draw(c,C.gl.TRIANGLES,p,_,y,oi.backCCW,bi,r.id,at.layoutVertexBuffer,at.indexBuffer,yi,r.paint,c.transform.zoom,St,Yi)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}function an(c,t,r,u,p,_,y,A,C,L,D,F,B,V,q,W,Z,X,ie){const se=c.context,ee=se.gl,ce=c.transform,le=c.transform.zoom,me=[],fe=to(c,r.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(me.push("CLEAR_SUBPASS"),ie&&(me.push("CLEAR_FROM_TEXTURE"),se.activeTexture.set(ee.TEXTURE0),ie.bind(ee.LINEAR,ee.CLAMP_TO_EDGE))):L==="sdf"&&me.push("SDF_SUBPASS"),Z&&me.push("HAS_CENTROID"),fe.shouldRenderCutoff&&me.push("RENDER_CUTOFF");const ye=r.layout.get("fill-extrusion-edge-radius"),Ie=(Te,be,ze,Je,lt)=>{const Ke=be.programConfigurations.get(r.id),mt=c.isTileAffectedByFog(Te),Oe=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ke,defines:me,overrideFog:mt}),ot=((yt,vt,at,ut,Ht,St,Ot,ri,Vt,Qt,bi)=>({u_matrix:vt,u_opacity:at,u_ao_pass:ut?1:0,u_meter_to_tile:Ht,u_ao:St,u_flood_light_intensity:Ot,u_flood_light_color:ri,u_attenuation:Vt,u_edge_radius:Qt,u_fb:0,u_fb_size:bi,u_dynamic_offset:1}))(0,Je,D,C,lt,[F,B*lt],V,q,W,le>=17?0:ye*lt,ie?ie.size[0]:0),it=[];Z&&it.push(be.hiddenByLandmarkVertexBuffer),c.uploadCommonUniforms(se,Oe,Te.toUnwrapped(),null,fe),Oe.draw(c,se.gl.TRIANGLES,p,_,y,A,ot,r.id,be.vertexBuffer,be.indexBuffer,ze,r.paint,le,Ke,it)};for(const Te of u){const be=t.getTile(Te),ze=be.getBucket(r);if(!ze||ze.projection.name!==ce.projection.name||!ze.groundEffect||ze.groundEffect&&!ze.groundEffect.hasData())continue;const Je=ze.groundEffect,lt=1/ze.tileToMeter;{const Ke=c.translatePosMatrix(Te.projMatrix,be,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),mt=Je.getDefaultSegment();Ie(Te,Je,mt,Ke,lt)}if(X)for(let Ke=0;Ke<4;Ke++){const mt=n.c$[Ke](Te),Oe=t.getTile(mt);if(!Oe)continue;const ot=Oe.getBucket(r);if(!ot||ot.projection.name!==ce.projection.name||!ot.groundEffect||ot.groundEffect&&!ot.groundEffect.hasData())continue;const it=ot.groundEffect;let yt,vt;Ke===0?(yt=[-n.ab,0,0],vt=1):Ke===1?(yt=[n.ab,0,0],vt=0):Ke===2?(yt=[0,-n.ab,0],vt=3):(yt=[0,n.ab,0],vt=2);const at=it.regionSegments[vt];if(!at)continue;const ut=new Float32Array(16);n.a6.mat4.translate(ut,Te.projMatrix,yt),Ie(Te,it,at,c.translatePosMatrix(ut,be,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),lt)}}}function Io(c,t,r,u,p,_,y){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const A=_?_.findDEMTileFor(r):null;if(!(A&&A.dem||y))return;const C=X=>new n.P(Math.ceil((X+n.d2)*n.d3),0),L=X=>{const ie=t.getSource().minzoom,se=ce=>{const le=t.getTileByID(ce);if(le&&le.hasData())return le.getBucket(p)},ee=[0,-1,1];for(const ce of ee){if(X.overscaledZ+ce<ie)continue;const le=se(X.calculateScaledKey(X.overscaledZ+ce));if(le)return le}},D=[0,0,0],F=(X,ie)=>(D[0]=Math.min(X.min.y,ie.min.y),D[1]=Math.max(X.max.y,ie.max.y),D[2]=n.ab-ie.min.x>X.max.x?ie.min.x-n.ab:X.max.x,D),B=(X,ie)=>(D[0]=Math.min(X.min.x,ie.min.x),D[1]=Math.max(X.max.x,ie.max.x),D[2]=n.ab-ie.min.y>X.max.y?ie.min.y-n.ab:X.max.y,D),V=[(X,ie)=>F(X,ie),(X,ie)=>F(ie,X),(X,ie)=>B(X,ie),(X,ie)=>B(ie,X)],q=(X,ie,se,ee,ce,le,me)=>{if(!_)return 0;const fe=[[le?se:X,le?X:se,0],[le?se:ie,le?ie:se,0]],ye=me<0?n.ab+me:me,Ie=[le?ye:(X+ie)/2,le?(X+ie)/2:ye,0];return se===0&&me<0||se!==0&&me>0?_.getForTilePoints(ce,[Ie],!0,ee):fe.push(Ie),_.getForTilePoints(r,fe,!0,A),Math.max(fe[0][2],fe[1][2],Ie[2])/_.exaggeration()};for(let X=0;X<4;X++){const ie=u.borderFeatureIndices[X];if(ie.length===0)continue;const se=n.c$[X](r),ee=L(se);if(!(ee&&ee instanceof n.d0)||u.borderDoneWithNeighborZ[X]===ee.canonical.z)continue;ee.centroidVertexArray.length===0&&ee.createCentroidsBuffer();const ce=_?_.findDEMTileFor(se):null;if(!(ce&&ce.dem||y))continue;const le=(X<2?1:5)-X,me=ee.borderDoneWithNeighborZ[le]!==u.canonical.z,fe=ee.borderFeatureIndices[le];let ye=0;if(u.canonical.z!==ee.canonical.z){for(const Ie of ie)u.showCentroid(u.featuresOnBorder[Ie]);if(me)for(const Ie of fe)ee.showCentroid(ee.featuresOnBorder[Ie]);u.borderDoneWithNeighborZ[X]=ee.canonical.z,ee.borderDoneWithNeighborZ[le]=u.canonical.z}for(const Ie of ie){const Te=u.featuresOnBorder[Ie],be=u.centroidData[Te.centroidDataIndex],ze=Te.borders[X];let Je;for(;ye<fe.length;){Je=ee.featuresOnBorder[fe[ye]];const lt=Je.borders[le];if(lt[1]>ze[0]+3||lt[0]>ze[0]-3)break;ee.showCentroid(Je),ye++}if(Je&&ye<fe.length){const lt=ye;let Ke=0;for(;!(Je.borders[le][0]>ze[1]-3)&&(Ke++,++ye!==fe.length);)Je=ee.featuresOnBorder[fe[ye]];Je=ee.featuresOnBorder[fe[lt]];let mt=!1;if(Ke>=1){const it=Je.borders[le];Math.abs(ze[0]-it[0])<3&&Math.abs(ze[1]-it[1])<3&&(Ke=1,mt=!0,ye=lt+1)}else if(Ke===0){u.showCentroid(Te);continue}const Oe=ee.centroidData[Je.centroidDataIndex];y&&mt&&(((W=be).flags|(Z=Oe).flags)&n.d1?(W.flags|=n.d1,Z.flags|=n.d1):(W.flags&=~n.d1,Z.flags&=~n.d1));const ot=Te.intersectsCount()>1||Je.intersectsCount()>1;if(Ke>1)ye=lt,be.centroidXY=Oe.centroidXY=new n.P(0,0);else if(ce&&ce.dem&&!ot){const it=V[X](be,Oe),yt=X%2?n.ab-1:0,vt=q(it[0],Math.min(n.ab-1,it[1]),yt,ce,se,X<2,it[2]);be.centroidXY=Oe.centroidXY=C(vt)}else ot?be.centroidXY=Oe.centroidXY=new n.P(0,0):(be.centroidXY=u.encodeBorderCentroid(Te),Oe.centroidXY=ee.encodeBorderCentroid(Je));u.writeCentroidToBuffer(be),ee.writeCentroidToBuffer(Oe)}else u.showCentroid(Te)}u.borderDoneWithNeighborZ[X]=ee.canonical.z,ee.borderDoneWithNeighborZ[le]=u.canonical.z}var W,Z;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}const gp=[1,0,0],Kh=[0,1,0],Jh=[0,0,1];function Qh(c,t,r){const u=r.transform,p=r.shadowRenderer;if(!p)return!0;const _=c.toUnwrapped(),y=u.tileSize*p._cascades[r.currentShadowCascade].scale;let A=t.maxHeight;if(u.elevation){const W=u.elevation.getMinMaxForTile(c);W&&(A+=W.max)}const C=[...p.shadowDirection];C[2]=-C[2];const L=p.computeSimplifiedTileShadowVolume(_,A,y,C);if(!L)return!1;const D=[gp,Kh,Jh,C,[C[0],0,C[2]],[0,C[1],C[2]]],F=u.projection.name==="globe",B=u.scaleZoom(y),V=n.bN.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,B,!F),q=p.getCurrentCascadeFrustum();return V.intersectsPrecise(L.vertices,L.planes,D)===0||q.intersectsPrecise(L.vertices,L.planes,D)===0}function ed(c){return[c[0]*n.d4,c[1]*n.d4,c[2]*n.d4,0]}function qn(c,t,r,u,p,_,y,A,C){const L=u.getSource(),D=r.globeSharedBuffers;if(!D)return;let F,B,V;if(t&&(F=u.getTile(t)),L instanceof n.aD?(B=L.texture,V=n.cD(0,0,r.transform)):F&&t&&(B=F.texture,V=n.cD(t.canonical.z,t.canonical.x,r.transform)),!B||!V)return;c||(V=n.a6.mat4.scale(n.a6.mat4.create(),V,[1,-1,1]));const q=r.context,W=q.gl,Z=p.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR,X=r.colorModeForDrapableLayerRenderPass(_),ie=y.defines;ie.push("GLOBE_POLES");const se=new Yt(W.LEQUAL,Yt.ReadWrite,r.depthRangeFor3D),ee=Float32Array.from(r.transform.expandedFarZProjMatrix),ce=Float32Array.from(n.b5(n.cC(new n.bP(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),q.activeTexture.set(W.TEXTURE0),B.bind(Z,W.CLAMP_TO_EDGE),q.activeTexture.set(W.TEXTURE1),B.bind(Z,W.CLAMP_TO_EDGE),B.useMipmap&&q.extTextureFilterAnisotropic&&r.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const[le,me,fe,ye]=t?D.getPoleBuffers(t.canonical.z,!1):D.getPoleBuffers(0,!0),Ie=p.paint.get("raster-elevation");let Te;c?(Te=le,r.renderDefaultNorthPole=Ie!==0):(Te=me,r.renderDefaultSouthPole=Ie!==0);const be=ed(y.mix),ze=((lt,Ke,mt,Oe,ot,it,yt,vt,at,ut,Ht,St,Ot)=>Hl(lt,Ke,mt,new Float32Array(16),new Float32Array(9),[0,0],Oe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},it,[0,0],vt,2,ut,Ht,St,1,0,Ot))(ee,ce,V,n.a9(r.transform.zoom),0,p,0,Ie,0,be,y.offset,y.range,_),Je=r.getOrCreateProgram("raster",{defines:ie});r.uploadCommonUniforms(q,Je,null),Je.draw(r,W.TRIANGLES,se,C,X,A,ze,p.id,Te,fe,ye)}function Ar(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),u=r-t,p=.2*c.height,_=t+p;return[t,r,(_-p-t)/u,(_-t)/u]}function pu(c,t,r,u){if(c)return t instanceof xa&&c instanceof Lc?t.getTextureDescriptor(c,r,!0):{texture:c.texture,mix:ed(u.mix),offset:u.offset,buffer:0,tileSize:1}}var td=n.d5([{name:"a_index",type:"Int16",components:1}]);class yp{constructor(t,r,u,p){const _={width:u[0],height:u[1],data:null},y=t.gl;this.targetColorTexture=new n.T(t,_,y.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,_,y.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,p),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,p=r.width*r.height;this.particleTexture0=new n.T(this.context,r,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,r,u.RGBA8,{premultiply:!1,useMipmap:!1});const _=new n.d6;_.reserve(p);for(let y=0;y<p;y++)_.emplaceBack(y);this.particleIndexBuffer=this.context.createVertexBuffer(_,td.members,!0),this.particleSegment=n.b1.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function xp(c,t,r){if(!c)return null;const u=t.getTextureDescriptor(c,r,!0);if(!u)return null;let{texture:p,mix:_,offset:y,tileSize:A,buffer:C,format:L}=u;if(!p||!L)return null;let D=!1;return L==="uint32"&&(D=!0,_[3]=0,_=su(n.d7,_,[0,r.paint.get("raster-particle-max-speed")]),y=ou(n.d7,y,[0,r.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[C/(A+2*C),A/(A+2*C)],tileSize:A,scalarData:D,scale:_,offset:y,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function vp(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),u=r-t,p=.2*c.height,_=t+p;return[t,r,(_-p-t)/u,(_-t)/u]}const P_=new n.bz(1,0,0,1),qa=new n.bz(0,1,0,1),Ha=new n.bz(0,0,1,1),bt=new n.bz(1,0,1,1),qt=new n.bz(0,1,1,1);function Ss(c,t,r,u,p,_,y){const A=c.context,C=c.transform,L=A.gl,D=C.projection.name==="globe",F=D?["PROJECTION_GLOBE_VIEW"]:[];let B=n.a6.mat4.clone(r.projMatrix);if(D&&n.a9(C.zoom)>0){const be=n.b4(r.canonical,C),ze=n.d8(be);B=n.a6.mat4.multiply(new Float32Array(16),C.globeMatrix,ze),n.a6.mat4.multiply(B,C.projMatrix,B)}const V=n.a6.mat4.create();V[12]+=2*p/(n.q.devicePixelRatio*C.width),V[13]+=2*_/(n.q.devicePixelRatio*C.height),n.a6.mat4.multiply(B,V,B);const q=c.getOrCreateProgram("debug",{defines:F}),W=t.getTileByID(r.key);c.terrain&&c.terrain.setupElevationDraw(W,q);const Z=Yt.disabled,X=pi.disabled,ie=c.colorModeForRenderPass(),se="$debug";A.activeTexture.set(L.TEXTURE0),c.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),D?W._makeGlobeTileDebugBuffers(c.context,C):W._makeDebugTileBoundsBuffers(c.context,C.projection);const ee=W._tileDebugBuffer||c.debugBuffer,ce=W._tileDebugIndexBuffer||c.debugIndexBuffer,le=W._tileDebugSegments||c.debugSegments;if(q.draw(c,L.LINE_STRIP,Z,X,ie,oi.disabled,dp(B,u),se,ee,ce,le,null,null,null,[W._globeTileDebugBorderBuffer]),y){const be=W.latestRawTileData,ze=Math.floor((be&&be.byteLength||0)/1024);let Je=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(Je+=` => ${r.overscaledZ}`),Je+=` ${W.state}`,Je+=` ${ze}kb`,function(lt,Ke){lt.initDebugOverlayCanvas();const mt=lt.debugOverlayCanvas,Oe=lt.context.gl,ot=lt.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,mt.width,mt.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(Ke,5,5),ot.strokeText(Ke,5,5),lt.debugOverlayTexture.update(mt),lt.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(c,Je)}const me=t.getTile(r).tileSize,fe=512/Math.min(me,512)*(r.overscaledZ/C.zoom)*.5,ye=W._tileDebugTextBuffer||c.debugBuffer,Ie=W._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,Te=W._tileDebugTextSegments||c.debugSegments;q.draw(c,L.TRIANGLES,Z,X,Ei.alphaBlended,oi.disabled,dp(B,n.bz.transparent,fe),se,ye,Ie,Te,null,null,null,[W._globeTileDebugTextBuffer])}function pr(c,t,r,u){Yl(c,0,t+r/2,c.transform.width,r,u)}function Ue(c,t,r,u){Yl(c,t-r/2,0,r,c.transform.height,u)}function Yl(c,t,r,u,p,_){const y=c.context,A=y.gl;A.enable(A.SCISSOR_TEST),A.scissor(t*n.q.devicePixelRatio,r*n.q.devicePixelRatio,u*n.q.devicePixelRatio,p*n.q.devicePixelRatio),y.clear({color:_}),A.disable(A.SCISSOR_TEST)}const mu=n.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:id}=mu;function As(c,t,r,u){c.emplaceBack(t,r,u)}class rd{constructor(t){this.vertexArray=new n.d9,this.indices=new n.aO,As(this.vertexArray,-1,-1,1),As(this.vertexArray,1,-1,1),As(this.vertexArray,-1,1,1),As(this.vertexArray,1,1,1),As(this.vertexArray,-1,-1,-1),As(this.vertexArray,1,-1,-1),As(this.vertexArray,-1,1,-1),As(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,id),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.b1.simpleSegment(0,0,36,12)}}function ea(c,t,r,u,p,_){const y=c.context.gl,A=t.paint.get("sky-atmosphere-color"),C=t.paint.get("sky-atmosphere-halo-color"),L=t.paint.get("sky-atmosphere-sun-intensity"),D=((F,B,V,q,W)=>({u_matrix_3f:F,u_sun_direction:B,u_sun_intensity:V,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(n.a6.mat3.fromMat4(n.a6.mat3.create(),u),p,L,A,C);y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),r.draw(c,y.TRIANGLES,Yt.disabled,pi.disabled,Ei.unblended,oi.frontCW,D,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Wa=n.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class R_{constructor(t){const r=new n.da;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const u=new n.aO;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,Wa.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=n.b1.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const L_=n.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class bp{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class _u{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Ei([1,Qn,1,Qn],n.bz.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ei([1,0,1,0],n.bz.transparent,[!1,!1,!1,!0]),this.params=new bp,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new R_(r);const u=this.params.sizeRange,p=this.params.intensityRange,_=function(D){const F=n.dd(30),B=[];for(let V=0;V<D;++V){const q=2*Math.PI*F(),W=Math.acos(1-2*F())-.5*Math.PI;B.push(n.a6.vec3.fromValues(Math.cos(W)*Math.cos(q),Math.cos(W)*Math.sin(q),Math.sin(W)))}return B}(this.params.starsCount),y=n.dd(300),A=new n.db,C=new n.aO;let L=0;for(let D=0;D<_.length;++D){const F=n.a6.vec3.scale([],_[D],200),B=Math.max(0,1+.01*u*(1*y()-.5)),V=Math.max(0,1+.01*p*(1*y()-.5));A.emplaceBack(F[0],F[1],F[2],-1,-1,B,V),A.emplaceBack(F[0],F[1],F[2],1,-1,B,V),A.emplaceBack(F[0],F[1],F[2],1,1,B,V),A.emplaceBack(F[0],F[1],F[2],-1,1,B,V),C.emplaceBack(L+0,L+1,L+2),C.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=r.createVertexBuffer(A,L_.members),this.starsIdx=r.createIndexBuffer(C),this.starsSegments=n.b1.simpleSegment(0,0,A.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const u=t.context,p=u.gl,_=t.transform,y=new Yt(p.LEQUAL,Yt.ReadOnly,[0,1]),A=n.a9(_.zoom),C=t.style.getLut(r.scope),L=r.properties.get("color").toRenderColor(C).toArray01(),D=r.properties.get("high-color").toRenderColor(C).toArray01(),F=r.properties.get("space-color").toRenderColor(C).toArray01PremultipliedAlpha(),B=5e-4,V=n.dc(r.properties.get("horizon-blend"),0,1,B,.25),q=n.cx(t,u,_)&&V===B?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,W=t.frameCounter/1e3%1,Z=n.a6.vec3.length(_.globeCenterInViewSpace),X=Math.sqrt(Math.pow(Z,2)-Math.pow(q,2)),ie=Math.acos(X/Z),se=ee=>{const ce=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ee&&ce.push("ALPHA_PASS");const le=t.getOrCreateProgram("globeAtmosphere",{defines:ce}),me=((ye,Ie,Te,be,ze,Je,lt,Ke,mt,Oe,ot,it)=>({u_frustum_tl:ye,u_frustum_tr:Ie,u_frustum_br:Te,u_frustum_bl:be,u_horizon:ze,u_transition:Je,u_fadeout_range:lt,u_color:Ke,u_high_color:mt,u_space_color:Oe,u_temporal_offset:ot,u_horizon_angle:it}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,A,V,L,D,F,W,ie);t.uploadCommonUniforms(u,le);const fe=this.atmosphereBuffer;fe&&le.draw(t,p.TRIANGLES,y,pi.disabled,ee?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,oi.backCW,me,ee?"atmosphere_glow_alpha":"atmosphere_glow",fe.vertexBuffer,fe.indexBuffer,fe.segments)};se(!1),se(!0)}drawStars(t,r){const u=n.ap(r.properties.get("star-intensity"),0,1);if(u===0)return;const p=t.context,_=p.gl,y=t.transform,A=t.getOrCreateProgram("stars"),C=n.a6.quat.identity([]);n.a6.quat.rotateX(C,C,-y._pitch),n.a6.quat.rotateZ(C,C,-y.angle),n.a6.quat.rotateX(C,C,n.bB(y._center.lat)),n.a6.quat.rotateY(C,C,-n.bB(y._center.lng));const L=n.a6.mat4.fromQuat(new Float32Array(16),C),D=n.a6.mat4.multiply([],y.starsProjMatrix,L),F=n.a6.mat3.fromMat4([],L),B=n.a6.mat3.invert([],F),V=[0,1,0];n.a6.vec3.transformMat3(V,V,B),n.a6.vec3.scale(V,V,this.params.sizeMultiplier);const q=[1,0,0];n.a6.vec3.transformMat3(q,q,B),n.a6.vec3.scale(q,q,this.params.sizeMultiplier);const W=(Z=V,X=q,ie=u,{u_matrix:Float32Array.from(D),u_up:Z,u_right:X,u_intensity_multiplier:ie});var Z,X,ie;t.uploadCommonUniforms(p,A),this.starsVx&&this.starsIdx&&A.draw(t,_.TRIANGLES,Yt.disabled,pi.disabled,this.colorModeAlphaBlendedWriteRGB,oi.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function gu(c,t){const r=[...c],u=t.cameraWorldSizeForFog/t.worldSize,p=n.a6.mat4.identity([]);return n.a6.mat4.scale(p,p,[u,u,1]),n.a6.mat4.multiply(r,p,r),n.a6.mat4.multiply(r,t.worldToFogMatrix,r),r}function yu(c,t,r,u,p){const _=r.material,y=u.context,{baseColorTexture:A,metallicRoughnessTexture:C}=_.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:D,emissionTexture:F}=_;function B(V,q,W){if(V&&(c.push(q),y.activeTexture.set(y.gl.TEXTURE0+W),V.gfxTexture)){const{minFilter:Z,magFilter:X,wrapS:ie,wrapT:se}=V.sampler;V.gfxTexture.bindExtraParam(Z,X,ie,se)}}B(A,"HAS_TEXTURE_u_baseColorTexture",gn.BaseColor),B(C,"HAS_TEXTURE_u_metallicRoughnessTexture",gn.MetallicRoughness),B(L,"HAS_TEXTURE_u_normalTexture",gn.Normal),B(D,"HAS_TEXTURE_u_occlusionTexture",gn.Occlusion),B(F,"HAS_TEXTURE_u_emissionTexture",gn.Emission),p&&(p.texture||(p.texture=new n.df(u.context,p.image,[p.image.height,p.image.height,p.image.height],y.gl.RGBA8)),y.activeTexture.set(y.gl.TEXTURE0+gn.LUT),p.texture&&p.texture.bind(y.gl.LINEAR,y.gl.CLAMP_TO_EDGE),c.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(c.push(r.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||c.push("DIFFUSE_SHADED"),c.push("USE_STANDARD_DERIVATIVES")}function Kl(c,t,r,u,p,_){const y=r.paint.get("model-opacity"),A=t.context,C=new Yt(t.context.gl.LEQUAL,Yt.ReadWrite,t.depthRangeFor3D),L=t.transform,D=c.mesh,F=D.material,B=F.pbrMetallicRoughness,V=t.style.fog;let q;q=t.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:n.a6.mat4.multiply([],u.zScaleMatrix,c.nodeModelMatrix),n.a6.mat4.multiply(q,u.negCameraPosMatrix,q);const W=n.a6.mat4.invert([],q);n.a6.mat4.transpose(W,W);const Z=r.paint.get("model-emissive-strength").constantOr(0),X=Ft(new Float32Array(c.worldViewProjection),new Float32Array(q),new Float32Array(W),null,t,y,B.baseColorFactor.toRenderColor(null),F.emissiveFactor,B.metallicFactor,B.roughnessFactor,F,Z,r),ie={defines:[]},se=[];yu(ie.defines,se,D,t,r.lut);const ee=t.shadowRenderer;ee&&(ee.useNormalOffset=!1);let ce=null;if(V){const fe=gu(c.nodeModelMatrix,t.transform);if(ce=new Float32Array(fe),L.projection.name!=="globe"){const ye=D.aabb.min,Ie=D.aabb.max,[Te,be]=V.getOpacityForBounds(fe,ye[0],ye[1],Ie[0],Ie[1]);ie.overrideFog=Te>=Lt||be>=Lt}}const le=to(t,r.paint.get("model-cutoff-fade-range"));le.shouldRenderCutoff&&ie.defines.push("RENDER_CUTOFF");const me=t.getOrCreateProgram("model",ie);t.uploadCommonUniforms(A,me,null,ce,le),t.renderPass!=="shadow"&&ee&&ee.setupShadowsFromMatrix(c.nodeModelMatrix,me),me.draw(t,A.gl.TRIANGLES,C,p,_,D.material.doubleSided?oi.disabled:oi.backCCW,X,r.id,D.vertexBuffer,D.indexBuffer,D.segments,r.paint,t.transform.zoom,void 0,se)}function Jl(c,t,r,u,p,_,y){let A;A=c.projection.name==="globe"?n.dg(r,c):[...r],n.a6.mat4.multiply(A,A,t.matrix);const C=n.a6.mat4.multiply([],u,A);if(t.meshes)for(const L of t.meshes){if(L.material.alphaMode!=="BLEND"){y.push({mesh:L,depth:0,modelIndex:p,worldViewProjection:C,nodeModelMatrix:A});continue}const D=n.a6.vec3.transformMat4([],L.centroid,C);D[2]>0&&_.push({mesh:L,depth:D[2],modelIndex:p,worldViewProjection:C,nodeModelMatrix:A})}if(t.children)for(const L of t.children)Jl(c,L,r,u,p,_,y)}function Za(c,t,r,u){const p=r.shadowRenderer;if(!p)return;const _=p.getShadowPassDepthMode(),y=p.getShadowPassColorMode(),A=p.calculateShadowPassMatrixFromMatrix(t),C=Xh(A);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,_,pi.disabled,y,oi.backCCW,C,u.id,c.vertexBuffer,c.indexBuffer,c.segments,u.paint,r.transform.zoom,void 0,void 0)}function wp(c,t,r){const u=t.updateZoomBasedPaintProperties(),p=function(_,y,A){let C,L,D,F=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&F>0){const B=_.terrain,V=B.findDEMTileFor(A);V&&V.dem?C=n.di.create(B,A,V):F=0}if(F===0&&(y.terrainElevationMin=0,y.terrainElevationMax=0),F===y.validForExaggeration&&(F===0||C&&C._demTile&&C._demTile.tileID===y.validForDEMTile.id&&C._dem._timestamp===y.validForDEMTile.timestamp))return!1;for(const B in y.instancesPerModel){const V=y.instancesPerModel[B];for(let q=0;q<V.instancedDataArray.length;++q){const W=(C?F*C.getElevationAt(0|V.instancedDataArray.float32[16*q],0|V.instancedDataArray.float32[16*q+1],!0,!0):0)+V.instancesEvaluatedElevation[q];V.instancedDataArray.float32[16*q+6]=W,L=L?Math.min(y.terrainElevationMin,W):W,D=D?Math.max(y.terrainElevationMax,W):W}}return y.terrainElevationMin=L||0,y.terrainElevationMax=D||0,y.validForExaggeration=F,y.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(c,t,r);(u||p)&&(t.uploaded=!1,t.upload(c.context))}const Is={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.c9([0,0,0],[n.ab,n.ab,0])};function D_(c,t){const r=1<<c.canonical.z,u=t.getFreeCameraOptions().position,p=t.elevation,_=c.canonical.x/r,y=(c.canonical.x+1)/r,A=c.canonical.y/r,C=(c.canonical.y+1)/r;let L=t._centerAltitude;if(p){const V=p.getMinMaxForTile(c);V&&V.max>L&&(L=V.max)}const D=n.ap(u.x,_,y)-u.x,F=n.ap(u.y,A,C)-u.y,B=n.bD(L,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(D*D+F*F+B*B))}function En(c,t,r,u,p,_,y){const A=c.context,C=c.renderPass==="shadow",L=c.shadowRenderer,D=C&&L?L.getShadowPassDepthMode():new Yt(A.gl.LEQUAL,Yt.ReadWrite,c.depthRangeFor3D),F=c.isTileAffectedByFog(_);if(r.meshes)for(const B of r.meshes){const V=["MODEL_POSITION_ON_GPU"],q=[];let W,Z,X;u.instancedDataArray.length>20&&V.push("INSTANCED_ARRAYS");const ie=to(c,t.paint.get("model-cutoff-fade-range"));if(ie.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),C&&L)W=c.getOrCreateProgram("modelDepth",{defines:V}),Z=Xh(y.shadowTileMatrix,y.shadowTileMatrix,Float32Array.from(r.matrix)),X=L.getShadowPassColorMode();else{yu(V,q,B,c,t.lut),W=c.getOrCreateProgram("model",{defines:V,overrideFog:F});const ee=B.material,ce=ee.pbrMetallicRoughness,le=t.paint.get("model-opacity"),me=t.paint.get("model-emissive-strength").constantOr(0);Z=Ft(_.expandedProjMatrix,Float32Array.from(r.matrix),new Float32Array(16),null,c,le,ce.baseColorFactor.toRenderColor(null),ee.emissiveFactor,ce.metallicFactor,ce.roughnessFactor,ee,me,t,p),L&&(y.shadowUniformsInitialized?W.setShadowUniformValues(A,L.getShadowUniformValues()):(L.setupShadows(_.toUnwrapped(),W,"model-tile",_.overscaledZ),y.shadowUniformsInitialized=!0)),X=ie.shouldRenderCutoff||le<1||ee.alphaMode!=="OPAQUE"?Ei.alphaBlended:Ei.unblended}c.uploadCommonUniforms(A,W,_.toUnwrapped(),null,ie);const se=B.material.doubleSided?oi.disabled:oi.backCCW;if(u.instancedDataArray.length>20)q.push(u.instancedDataBuffer),W.draw(c,A.gl.TRIANGLES,D,pi.disabled,X,se,Z,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,c.transform.zoom,void 0,q,u.instancedDataArray.length);else{const ee=C?"u_instance":"u_normal_matrix";for(let ce=0;ce<u.instancedDataArray.length;++ce)Z[ee]=new Float32Array(u.instancedDataArray.arrayBuffer,64*ce,16),W.draw(c,A.gl.TRIANGLES,D,pi.disabled,X,se,Z,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,c.transform.zoom,void 0,q)}}if(r.children)for(const B of r.children)En(c,t,B,u,p,_,y)}const z_=[1,-1,1];function Ql(c,t,r,u){if(!r.modelManager)return!0;const p=r.modelManager;if(!r.shadowRenderer)return!0;const _=r.shadowRenderer,y=t.aabb;let A=!0,C=c.maxHeight;if(C===0){let D=0;for(const F in c.instancesPerModel){const B=p.getModel(F,u);B?D=Math.max(D,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):A=!1}C=c.maxScale*D*1.41+c.maxVerticalOffset,A&&(c.maxHeight=C)}y.max[2]=C,y.min[2]+=c.terrainElevationMin,y.max[2]+=c.terrainElevationMax,n.a6.vec3.transformMat4(y.min,y.min,t.tileMatrix),n.a6.vec3.transformMat4(y.max,y.max,t.tileMatrix);const L=y.intersects(_.getCurrentCascadeFrustum());return r.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=L===2),L===0}function dr(c,t){const r=c.uniformValues.u_cutoff_params[0],u=c.uniformValues.u_cutoff_params[1],p=c.uniformValues.u_cutoff_params[2],_=c.uniformValues.u_cutoff_params[3];return u===r||_===p?1:n.ap(((t-r)/(u-r)-p)/(_-p),0,1)}function Bi(c,t,r,u){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();n.a6.mat4.multiply(p,p,c);const _=n.a6.vec4.fromValues(r.min[0],r.min[1],r.min[2],1);let y=n.a6.vec4.transformMat4(n.a6.vec4.create(),_,p),A=y,C=y;_[1]=r.max[1],y=n.a6.vec4.transformMat4(n.a6.vec4.create(),_,p),A=y[1]<A[1]?y:A,C=y[1]>C[1]?y:C,_[0]=r.max[0],y=n.a6.vec4.transformMat4(n.a6.vec4.create(),_,p),A=y[1]<A[1]?y:A,C=y[1]>C[1]?y:C,_[1]=r.min[1],y=n.a6.vec4.transformMat4(n.a6.vec4.create(),_,p),A=y[1]<A[1]?y:A,C=y[1]>C[1]?y:C;const L=n.ap(u[0],0,1),D=100*t.pixelsPerMeter*n.ap(u[1],0,1),F=n.ap(u[2],0,1),B=n.a6.vec4.lerp(n.a6.vec4.create(),A,C,L),V=Math.tan(.5*t.fovX),q=-B[2]*V;if(D===0)return B[1]<-Math.abs(q)?F:1;const W=(-Math.abs(q)-B[1])/D,Z=(ie,se,ee)=>(1-ee)*ie+ee*se,X=n.ap(Z(1,F,W),F,1);return Z(1,X,n.ap((t.pitch-20)/20,0,1))}class Tp{}class Mo{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,u){{const F=this._storage.get(r.id);if(F)return F.lastUsedFrameIdx=t,F.buf}const p=u.gl,_=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),y=new ArrayBuffer(_),A=new Int16Array(y);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(y));const C=new n.dk;for(let F=0;F<_/2;F+=3){const B=A[F],V=A[F+1],q=A[F+2];C.emplaceBack(B,V),C.emplaceBack(V,q),C.emplaceBack(q,B)}const L=u.bindVertexArrayOES.current,D=new Tp;return D.buf=new $n(u,C),D.lastUsedFrameIdx=t,this._storage.set(r.id,D),u.bindVertexArrayOES.set(L),D.buf}update(t){for(const[r,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}class xu{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Co={symbol:function(c,t,r,u,p){if(c.renderPass!=="translucent")return;const _=pi.disabled,y=c.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(L,D,F,B,V,q,W){const Z=D.transform,X=V==="map",ie=q==="map";for(const se of L){const ee=B.getTile(se),ce=ee.getBucket(F);if(!ce||!ce.text||!ce.text.segments.get().length)continue;const le=n.bj(ce.textSizeData,Z.zoom),me=wo(se,ce.getProjection(),Z),fe=Z.calculatePixelsToTileUnitsMatrix(ee),ye=Ci(me,ee.tileID.canonical,ie,X,Z,ce.getProjection(),fe),Ie=ce.hasIconTextFit()&&ce.hasIconData();if(le){const Te=Math.pow(2,Z.zoom-ee.tileID.overscaledZ);C_(ce,X,ie,W,n.cS,Z,ye,se,Te,le,Ie)}}}(u,c,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),p);const A=r.paint.get("icon-opacity").constantOr(1)!==0,C=r.paint.get("text-opacity").constantOr(1)!==0;r.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(A||C)?Zl(c,t,r,u,_,y):(A&&Zl(c,t,r,u,_,y,{onlyIcons:!0}),C&&Zl(c,t,r,u,_,y,{onlyText:!0})),t.map.showCollisionBoxes&&(du(c,t,r,u,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),du(c,t,r,u,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,r,u){if(c.renderPass!=="translucent")return;const p=r.paint.get("circle-opacity"),_=r.paint.get("circle-stroke-width"),y=r.paint.get("circle-stroke-opacity"),A=r.layout.get("circle-sort-key").constantOr(1)!==void 0,C=r.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(_.constantOr(1)===0||y.constantOr(1)===0))return;const L=c.context,D=L.gl,F=c.transform,B=c.depthModeForSublayer(0,Yt.ReadOnly),V=pi.disabled,q=c.colorModeForDrapableLayerRenderPass(C),W=F.projection.name==="globe",Z=[n.am(F.center.lng),n.at(F.center.lat)],X=[];for(let se=0;se<u.length;se++){const ee=u[se],ce=t.getTile(ee),le=ce.getBucket(r);if(!le||le.projection.name!==F.projection.name)continue;const me=le.programConfigurations.get(r.id),fe=n.cT(r),ye=c.isTileAffectedByFog(ee);W&&fe.push("PROJECTION_GLOBE_VIEW"),fe.push("DEPTH_D24"),c.terrain&&F.depthOcclusionForSymbolsAndCircles&&fe.push("DEPTH_OCCLUSION");const Ie=c.getOrCreateProgram("circle",{config:me,defines:fe,overrideFog:ye}),Te=le.layoutVertexBuffer,be=le.globeExtVertexBuffer,ze=le.indexBuffer,Je=F.projection.createInversionMatrix(F,ee.canonical),lt={programConfiguration:me,program:Ie,layoutVertexBuffer:Te,globeExtVertexBuffer:be,indexBuffer:ze,uniformValues:n.cU(c,ee,ce,Je,Z,r),tile:ce};if(A){const Ke=le.segments.get();for(const mt of Ke)X.push({segments:new n.b1([mt]),sortKey:mt.sortKey,state:lt})}else X.push({segments:le.segments,sortKey:0,state:lt})}A&&X.sort((se,ee)=>se.sortKey-ee.sortKey);const ie={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const se of X){const{programConfiguration:ee,program:ce,layoutVertexBuffer:le,globeExtVertexBuffer:me,indexBuffer:fe,uniformValues:ye,tile:Ie}=se.state,Te=se.segments;c.terrain&&c.terrain.setupElevationDraw(Ie,ce,ie),c.uploadCommonUniforms(L,ce,Ie.tileID.toUnwrapped()),ce.draw(c,D.TRIANGLES,B,V,q,oi.disabled,ye,r.id,le,fe,Te,r.paint,F.zoom,ee,[me])}},heatmap:function(c,t,r,u){if(r.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const p=c.context,_=p.gl,y=pi.disabled,A=new Ei([_.ONE,_.ONE,_.ONE,_.ONE],n.bz.transparent,[!0,!0,!0,!0]);(function(V,q,W,Z){const X=V.gl,ie=q.width*Z,se=q.height*Z;V.activeTexture.set(X.TEXTURE1),V.viewport.set([0,0,ie,se]);let ee=W.heatmapFbo;if(!ee||ee&&(ee.width!==ie||ee.height!==se)){ee&&ee.destroy();const ce=X.createTexture();X.bindTexture(X.TEXTURE_2D,ce),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),ee=W.heatmapFbo=V.createFramebuffer(ie,se,!0,null),function(le,me,fe,ye,Ie,Te){const be=le.gl;be.texImage2D(be.TEXTURE_2D,0,le.extRenderToTextureHalfFloat?be.RGBA16F:be.RGBA,Ie,Te,0,be.RGBA,le.extRenderToTextureHalfFloat?be.HALF_FLOAT:be.UNSIGNED_BYTE,null),ye.colorAttachment.set(fe)}(V,0,ce,ee,ie,se)}else X.bindTexture(X.TEXTURE_2D,ee.colorAttachment.get()),V.bindFramebuffer.set(ee.framebuffer)})(p,c,r,c.transform.projection.name==="globe"?.5:.25),p.clear({color:n.bz.transparent});const C=c.transform,L=C.projection.name==="globe",D=L?["PROJECTION_GLOBE_VIEW"]:[],F=L?oi.frontCCW:oi.disabled,B=[n.am(C.center.lng),n.at(C.center.lat)];for(let V=0;V<u.length;V++){const q=u[V];if(t.hasRenderableParent(q))continue;const W=t.getTile(q),Z=W.getBucket(r);if(!Z||Z.projection.name!==C.projection.name)continue;const X=c.isTileAffectedByFog(q),ie=Z.programConfigurations.get(r.id),se=c.getOrCreateProgram("heatmap",{config:ie,defines:D,overrideFog:X}),{zoom:ee}=c.transform;c.terrain&&c.terrain.setupElevationDraw(W,se),c.uploadCommonUniforms(p,se,q.toUnwrapped());const ce=C.projection.createInversionMatrix(C,q.canonical);se.draw(c,_.TRIANGLES,Yt.disabled,y,A,F,A_(c,q,W,ce,B,ee,r.paint.get("heatmap-intensity")),r.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,r.paint,c.transform.zoom,ie,L?[Z.globeExtVertexBuffer]:null)}p.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(p,_){const y=p.context,A=y.gl,C=_.heatmapFbo;if(!C)return;y.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,C.colorAttachment.get()),y.activeTexture.set(A.TEXTURE1);let L=_.colorRampTexture;L||(L=_.colorRampTexture=new n.T(y,_.colorRamp,A.RGBA8)),L.bind(A.LINEAR,A.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,A.TRIANGLES,Yt.disabled,pi.disabled,p.colorModeForRenderPass(),oi.disabled,((D,F,B,V)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,_),_.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,_.paint,p.transform.zoom)}(c,r))},line:function(c,t,r,u){if(c.renderPass!=="translucent")return;const p=r.paint.get("line-opacity"),_=r.paint.get("line-width");if(p.constantOr(1)===0||_.constantOr(1)===0)return;const y=r.paint.get("line-emissive-strength"),A=r.paint.get("line-occlusion-opacity"),C=c.context,L=C.gl,D=r.layout.get("line-z-offset"),F=!D.isConstant()||!!D.constantOr(0),B=F?new Yt(c.depthOcclusion?L.GREATER:L.LEQUAL,Yt.ReadOnly,c.depthRangeFor3D):c.depthModeForSublayer(0,Yt.ReadOnly),V=c.colorModeForDrapableLayerRenderPass(y),q=c.terrain&&c.terrain.renderingToTexture,W=q?1:n.q.devicePixelRatio,Z=r.paint.get("line-dasharray"),X=Z.constantOr(1),ie=r.layout.get("line-cap"),se=Z.constantOr(null),ee=ie.constantOr(null),ce=r.paint.get("line-pattern"),le=ce.constantOr(1),me=ce.constantOr(null),fe=r.paint.get("line-opacity").constantOr(1);let ye=!le&&fe!==1||c.depthOcclusion&&A>0&&A<1;const Ie=r.paint.get("line-gradient"),Te=le?"linePattern":"line",be=n.cV(r);let ze;if(q&&c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(ye=!1),A!==0&&c.depthOcclusion){const lt=r.paint._values["line-opacity"];lt&&lt.value&&lt.value.kind==="constant"?ze=lt.value:n.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}if(F&&(c.forceTerrainMode=!0),!F&&A!==0&&c.terrain&&!q)return void n.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const Je=ye&&F?c.stencilModeFor3D():pi.disabled;for(const lt of u){const Ke=t.getTile(lt);if(le&&!Ke.patternsLoaded())continue;const mt=Ke.getBucket(r);if(!mt)continue;c.prepareDrawTile();const Oe=mt.programConfigurations.get(r.id),ot=c.isTileAffectedByFog(lt),it=c.getOrCreateProgram(Te,{config:Oe,defines:F?[...be,"ELEVATED"]:be,overrideFog:ot});if(me&&Ke.imageAtlas){const St=Ke.imageAtlas.patternPositions[me.toString()];St&&Oe.setConstantPatternPositions(St)}if(!le&&se&&ee&&Ke.lineAtlas){const St=Ke.lineAtlas.getDash(se,ee);St&&Oe.setConstantPatternPositions(St)}let[yt,vt]=r.paint.get("line-trim-offset");(ee==="round"||ee==="square")&&yt!==vt&&(yt===0&&(yt-=1),vt===1&&(vt+=1));const at=q?lt.projMatrix:null,ut=le?n.cW(c,Ke,r,at,W,[yt,vt]):n.cX(c,Ke,r,at,mt.lineClipsArray.length,W,[yt,vt]);if(Ie){const St=mt.gradients[r.id];let Ot=St.texture;if(r.gradientVersion!==St.version){let ri=256;if(r.stepInterpolant){const Vt=t.getSource().maxzoom,Qt=lt.canonical.z===Vt?Math.ceil(1<<c.transform.maxZoom-lt.canonical.z):1;ri=n.ap(n.cY(mt.maxLineLength/n.ab*1024*Qt),256,C.maxTextureSize)}St.gradient=n.cZ({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:ri,image:St.gradient||void 0,clips:mt.lineClipsArray}),St.texture?St.texture.update(St.gradient):St.texture=new n.T(C,St.gradient,L.RGBA8),St.version=r.gradientVersion,Ot=St.texture}C.activeTexture.set(L.TEXTURE1),Ot.bind(r.stepInterpolant?L.NEAREST:L.LINEAR,L.CLAMP_TO_EDGE)}X&&(C.activeTexture.set(L.TEXTURE0),Ke.lineAtlasTexture&&Ke.lineAtlasTexture.bind(L.LINEAR,L.REPEAT),Oe.updatePaintBuffers()),le&&(C.activeTexture.set(L.TEXTURE0),Ke.imageAtlasTexture&&Ke.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Oe.updatePaintBuffers()),F&&c.terrain.setupElevationDraw(Ke,it),c.uploadCommonUniforms(C,it,lt.toUnwrapped());const Ht=St=>{ze!=null&&(ze.value=fe*A),it.draw(c,L.TRIANGLES,B,St,V,oi.disabled,ut,r.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,r.paint,c.transform.zoom,Oe,[mt.layoutVertexBuffer2,mt.patternVertexBuffer,mt.zOffsetVertexBuffer]),ze!=null&&(ze.value=fe)};if(ye&&!F){const St=c.stencilModeForClipping(lt).ref;St===0&&q&&C.clear({stencil:0});const Ot={func:L.EQUAL,mask:255};ut.u_alpha_discard_threshold=.8,Ht(new pi(Ot,St,255,L.KEEP,L.KEEP,L.INVERT)),ut.u_alpha_discard_threshold=0,Ht(new pi(Ot,St,255,L.KEEP,L.KEEP,L.KEEP))}else ye&&F&&(ut.u_alpha_discard_threshold=.001),Ht(F?Je:c.stencilModeForClipping(lt))}ye&&(c.resetStencilClippingMasks(),q&&C.clear({stencil:0})),A===0||c.depthOcclusion||q||c.layersWithOcclusionOpacity.push(c.currentLayer),F&&(c.forceTerrainMode=!1)},fill:function(c,t,r,u){const p=r.paint.get("fill-color"),_=r.paint.get("fill-opacity"),y=r.is3D(),A=new Yt(c.context.gl.LEQUAL,Yt.ReadWrite,c.depthRangeFor3D);if(_.constantOr(1)===0)return;const C=r.paint.get("fill-emissive-strength"),L=c.colorModeForDrapableLayerRenderPass(C),D=r.paint.get("fill-pattern"),F=c.opaquePassEnabledForLayer()&&!D.constantOr(1)&&p.constantOr(n.bz.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===F){const B=y?A:c.depthModeForSublayer(1,c.renderPass==="opaque"?Yt.ReadWrite:Yt.ReadOnly);fu(c,t,r,u,B,L,!1)}if(!y&&c.renderPass==="translucent"&&r.paint.get("fill-antialias")){const B=y?A:c.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Yt.ReadOnly);fu(c,t,r,u,B,L,!0)}},"fill-extrusion":function(c,t,r,u){const p=r.paint.get("fill-extrusion-opacity"),_=c.context,y=_.gl,A=c.terrain,C=A&&A.renderingToTexture;if(p===0)return;const L=c.conflationActive&&c.style.isLayerClipped(r,t.getSource()),D=c.style.order.indexOf(r.fqid);if(L&&function(F,B,V,q,W){for(const Z of q){const X=B.getTile(Z).getBucket(V);X&&(X.updateReplacement(Z,F.replacementSource,W),X.uploadCentroid(F.context))}}(c,t,r,u,D),A||L)for(const F of u){const B=t.getTile(F).getBucket(r);B&&Io(c.context,t,F,B,r,A,L)}if(c.renderPass==="shadow"&&c.shadowRenderer){const F=c.shadowRenderer;if(A&&p<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.a4)return;const B=F.getShadowPassDepthMode(),V=F.getShadowPassColorMode();$a(c,t,r,u,B,pi.disabled,V,L)}else if(c.renderPass==="translucent"){const F=!r.paint.get("fill-extrusion-pattern").constantOr(1),B=r.paint.get("fill-extrusion-color").constantOr(n.bz.white);if(!C&&B.a!==0){const V=new Yt(c.context.gl.LEQUAL,Yt.ReadWrite,c.depthRangeFor3D);p===1&&F?$a(c,t,r,u,V,pi.disabled,Ei.unblended,L):($a(c,t,r,u,V,pi.disabled,Ei.disabled,L),$a(c,t,r,u,V,c.stencilModeFor3D(),c.colorModeForRenderPass(),L),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&F&&(!A&&c.transform.projection.name!=="globe"||C)){const V=r.paint.get("fill-extrusion-opacity"),q=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Z=r.paint.get("fill-extrusion-flood-light-intensity"),X=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(r.lut).toArray01().slice(0,3),ie=q>0&&W>0,se=Z>0,ee=(le,me,fe)=>(1-fe)*le+fe*me,ce=le=>{const me=c.depthModeForSublayer(1,Yt.ReadOnly,y.LEQUAL,!0),fe=r.paint.get(le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ye=ee(.1,3,fe),Ie=c._showOverdrawInspector;if(!Ie){const Te=new pi({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),be=new Ei([y.ONE,y.ONE,y.ONE,y.ONE],n.bz.transparent,[!1,!1,!1,!0],y.MIN);an(c,t,r,u,me,Te,be,oi.disabled,le,"sdf",V,q,W,Z,X,ye,L,!1)}{const Te=Ie?pi.disabled:new pi({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),be=Ie?c.colorModeForRenderPass():new Ei([y.ONE_MINUS_DST_ALPHA,y.DST_ALPHA,y.ONE,y.ONE],n.bz.transparent,[!0,!0,!0,!0]);an(c,t,r,u,me,Te,be,oi.disabled,le,"color",V,q,W,Z,X,ye,L,!1)}};if(C){const le=(me,fe,ye)=>{const Ie=c.depthModeForSublayer(1,Yt.ReadOnly,y.LEQUAL,!1),Te=r.paint.get(me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),be=ee(.1,3,Te);{const ze=new Ei([y.ONE,y.ONE,y.ONE,y.ONE],n.bz.transparent,[!1,!1,!1,!0]);an(c,t,r,u,Ie,pi.disabled,ze,oi.disabled,me,"clear",V,q,W,Z,X,be,L,fe)}{const ze=new pi({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),Je=new Ei([y.ONE,y.ONE,y.ONE,y.ONE],n.bz.transparent,[!1,!1,!1,!0],y.MIN);an(c,t,r,u,Ie,ze,Je,oi.disabled,me,"sdf",V,q,W,Z,X,be,L,fe)}{const ze=me?y.ZERO:y.ONE_MINUS_DST_ALPHA,Je=new pi({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),lt=new Ei([ze,y.DST_ALPHA,y.ONE_MINUS_DST_ALPHA,y.ZERO],n.bz.transparent,[!0,!0,!0,!0]);an(c,t,r,u,Ie,Je,lt,oi.disabled,me,"color",V,q,W,Z,X,be,L,fe)}{const ze=new Ei([y.ONE,y.ONE,y.ONE,me?y.ZERO:y.ONE],n.bz.transparent,[!1,!1,!1,!0],me?y.FUNC_ADD:y.MAX);an(c,t,r,u,Ie,pi.disabled,ze,oi.disabled,me,"clear",V,q,W,Z,X,be,L,fe,ye)}};if(ie||se){let me;if(c.prepareDrawTile(),A){const fe=A.drapeBufferSize[0],ye=A.drapeBufferSize[1];me=A.framebufferCopyTexture,me&&(!me||me.size[0]===fe&&me.size[1]===ye)||(me&&me.destroy(),me=A.framebufferCopyTexture=new n.T(_,new n.r({width:fe,height:ye}),y.RGBA8)),me.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.copyTexImage2D(y.TEXTURE_2D,0,y.RGBA,0,0,fe,ye,0)}ie&&le(!0,!1,me),se&&le(!1,!0,me)}}else ie&&ce(!0),se&&ce(!1),(ie||se)&&c.resetStencilClippingMasks()}}},hillshade:function(c,t,r,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;const p=c.context,_=c.terrain&&c.terrain.renderingToTexture,[y,A]=c.renderPass!=="translucent"||_?[{},u]:c.stencilConfigForOverlap(u);for(const C of A){const L=t.getTile(C);if(L.needsHillshadePrepare&&c.renderPass==="offscreen")Nl(c,L,r);else if(c.renderPass==="translucent"){const D=c.depthModeForSublayer(0,Yt.ReadOnly),F=r.paint.get("hillshade-emissive-strength"),B=c.colorModeForDrapableLayerRenderPass(F),V=_&&c.terrain?c.terrain.stencilModeForRTTOverlap(C):y[C.overscaledZ];Xc(c,C,L,r,D,V,B)}}p.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,r,u,p,_){if(c.renderPass!=="translucent"||r.paint.get("raster-opacity")===0)return;const y=c.transform.projection.name==="globe",A=r.paint.get("raster-elevation")!==0,C=A&&y;if(c.renderElevatedRasterBackface&&!C)return;const L=c.context,D=L.gl,F=t.getSource(),B=function(le,me,fe,ye){const Ie=me.paint.get("raster-color"),Te=le.type==="raster-array",be=[],ze=me.paint.get("raster-resampling"),Je=me.paint.get("raster-color-mix");let lt=me.paint.get("raster-color-range");const Ke=[Je[0],Je[1],Je[2],0],mt=Je[3];let Oe=ze==="nearest"?ye.NEAREST:ye.LINEAR;if(Te&&(be.push("RASTER_ARRAY"),Ie||be.push("RASTER_COLOR"),ze==="linear"&&be.push("RASTER_ARRAY_LINEAR"),Oe=ye.NEAREST,!lt&&le.rasterLayers)){const ot=le.rasterLayers.find(({id:it})=>it===me.sourceLayer);ot&&ot.fields&&ot.fields.range&&(lt=ot.fields.range)}if(lt=lt||[0,1],Ie){be.push("RASTER_COLOR"),fe.activeTexture.set(ye.TEXTURE2),me.updateColorRamp(lt);let ot=me.colorRampTexture;ot||(ot=me.colorRampTexture=new n.T(fe,me.colorRamp,ye.RGBA8)),ot.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}return{mix:Ke,range:lt,offset:mt,defines:be,resampling:Oe}}(F,r,L,D);if(F instanceof n.aD&&!u.length&&!y)return;const V=r.paint.get("raster-emissive-strength"),q=c.colorModeForDrapableLayerRenderPass(V),W=c.terrain&&c.terrain.renderingToTexture,Z=!c.options.moving,X=r.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;if(F instanceof n.aD&&!u.length&&(F.onNorthPole||F.onSouthPole)){const le=A?c.stencilModeFor3D():pi.disabled;return void qn(!!F.onNorthPole,null,c,t,r,V,B,oi.disabled,le)}if(!u.length)return;const[ie,se]=F instanceof n.aD||W?[{},u]:c.stencilConfigForOverlap(u),ee=se[se.length-1].overscaledZ;C&&B.defines.push("PROJECTION_GLOBE_VIEW"),A&&B.defines.push("RENDER_CUTOFF");const ce=(le,me,fe)=>{for(const ye of le){const Ie=ye.toUnwrapped(),Te=t.getTile(ye);if(W&&(!Te||!Te.hasData()))continue;L.activeTexture.set(D.TEXTURE0);const be=pu(Te,F,r,B);if(!be||!be.texture)continue;const{texture:ze,mix:Je,offset:lt,tileSize:Ke,buffer:mt}=be;let Oe,ot;W?(Oe=Yt.disabled,ot=ye.projMatrix):A?(Oe=new Yt(D.LEQUAL,Yt.ReadWrite,c.depthRangeFor3D),ot=y?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(Ie,Z)):(Oe=c.depthModeForSublayer(ye.overscaledZ-ee,r.paint.get("raster-opacity")===1?Yt.ReadWrite:Yt.ReadOnly,D.LESS),ot=c.transform.calculateProjMatrix(Ie,Z));const it=c.terrain&&W?c.terrain.stencilModeForRTTOverlap(ye):ie[ye.overscaledZ],yt=_?0:r.paint.get("raster-fade-duration");Te.registerFadeDuration(yt);const vt=t.findLoadedParent(ye,0),at=iu(Te,vt,t,c.transform,yt);let ut,Ht;c.terrain&&c.terrain.prepareDrawTile(),L.activeTexture.set(D.TEXTURE0),ze.bind(X,D.CLAMP_TO_EDGE),L.activeTexture.set(D.TEXTURE1),vt?(vt.texture&&vt.texture.bind(X,D.CLAMP_TO_EDGE),ut=Math.pow(2,vt.tileID.overscaledZ-Te.tileID.overscaledZ),Ht=[Te.tileID.canonical.x*ut%1,Te.tileID.canonical.y*ut%1]):ze.bind(X,D.CLAMP_TO_EDGE),ze.useMipmap&&L.extTextureFilterAnisotropic&&c.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const St=c.transform;let Ot;const ri=A?Ar(St):[0,0,0,0];let Vt,Qt,bi,yi,Yi,rr=0;if(C&&F instanceof n.aD&&F.coordinates.length>3)Vt=Float32Array.from(n.b5(n.cC(new n.bP(0,0,0)))),Qt=Float32Array.from(St.globeMatrix),bi=Float32Array.from(n.cy(St)),yi=[n.am(St.center.lng),n.at(St.center.lat)],Ot=F.elevatedGlobePerspectiveTransform,Yi=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const Ai=n.cz(ye.canonical);rr=n.cA(Ai.getCenter().lat),Vt=Float32Array.from(n.b5(n.cC(ye.canonical))),Qt=Float32Array.from(St.globeMatrix),bi=Float32Array.from(n.cy(St)),yi=[n.am(St.center.lng),n.at(St.center.lat)],Ot=[0,0],Yi=Float32Array.from(n.cB(ye.canonical,Ai,rr,St.worldSize/St._pixelsPerMercatorPixel))}else Ot=F instanceof n.aD?F.perspectiveTransform:[0,0],Vt=new Float32Array(16),Qt=new Float32Array(9),bi=new Float32Array(16),yi=[0,0],Yi=new Float32Array(9);const ur=Hl(ot,Vt,Qt,bi,Yi,Ht||[0,0],n.a9(c.transform.zoom),yi,ri,ut||1,at,r,Ot,A?r.paint.get("raster-elevation"):0,2,Je,lt,B.range,Ke,mt,V),hs=c.isTileAffectedByFog(ye),Fr=c.getOrCreateProgram("raster",{defines:B.defines,overrideFog:hs});if(c.uploadCommonUniforms(L,Fr,Ie),F instanceof n.aD){const Ai=F.elevatedGlobeVertexBuffer,tr=F.elevatedGlobeIndexBuffer;if(W||!y)F.boundsBuffer&&F.boundsSegments&&Fr.draw(c,D.TRIANGLES,Oe,pi.disabled,q,oi.disabled,ur,r.id,F.boundsBuffer,c.quadTriangleIndexBuffer,F.boundsSegments);else if(Ai&&tr){const mr=St.zoom<=n.c2?F.elevatedGlobeSegments:F.getSegmentsForLongitude(St.center.lng);mr&&Fr.draw(c,D.TRIANGLES,Oe,pi.disabled,q,me,ur,r.id,Ai,tr,mr)}}else if(C){Oe=new Yt(D.LEQUAL,Yt.ReadOnly,c.depthRangeFor3D);const Ai=c.globeSharedBuffers;if(Ai){const[tr,mr,Qi]=Ai.getGridBuffers(rr,!1);Fr.draw(c,D.TRIANGLES,Oe,fe||it,c.colorModeForRenderPass(),me,ur,r.id,tr,mr,Qi)}}else{const{tileBoundsBuffer:Ai,tileBoundsIndexBuffer:tr,tileBoundsSegments:mr}=c.getTileBoundsBuffers(Te);Fr.draw(c,D.TRIANGLES,Oe,it,q,oi.disabled,ur,r.id,Ai,tr,mr)}}if(!(F instanceof n.aD)&&C)for(const ye of le){const Ie=ye.canonical.y===(1<<ye.canonical.z)-1;ye.canonical.y===0&&qn(!0,ye,c,t,r,V,B,me,fe||pi.disabled),Ie&&qn(!1,ye,c,t,r,V,B,me===oi.frontCW?oi.backCW:oi.frontCW,fe||pi.disabled)}};C?ce(se,c.renderElevatedRasterBackface?oi.backCW:oi.frontCW,c.stencilModeFor3D()):ce(se,oi.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,t,r,u,p,_){c.renderPass==="offscreen"&&function(y,A,C,L){if(!L.length)return;const D=y.context,F=D.gl,B=A.getSource();if(!(B instanceof xa))return;const V=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let q=C.particlePositionRGBAImage;if(!q||q.width!==V){const se=function(ee){const ce=ee*ee,le=new Uint8Array(4*ce),me=function(ye){return ye|=0,ye=Math.imul(2747636419^ye,2654435769),ye=Math.imul(ye^ye>>>16,2654435769),((ye=Math.imul(ye^ye>>>16,2654435769))>>>0)/4294967296},fe=1/1.1;for(let ye=0;ye<ce;ye++){const Ie=fe*(me(2*ye+0)+Us),Te=fe*(me(2*ye+1)+Us),be=255*Ie%1,ze=255*Te%1,Je=be,lt=Te-ze/255,Ke=ze;le[4*ye+0]=255*(Ie-be/255),le[4*ye+1]=255*Je,le[4*ye+2]=255*lt,le[4*ye+3]=255*Ke}return le}(V);q=C.particlePositionRGBAImage=new n.r({width:V,height:V},se)}let W=C.particleFramebuffer;W?W.width!==V&&(W.destroy(),W=C.particleFramebuffer=D.createFramebuffer(V,V,!0,null)):W=C.particleFramebuffer=D.createFramebuffer(V,V,!0,null);const Z=[];for(const se of L){const ee=A.getTile(se);if(!(ee instanceof Lc))continue;const ce=xp(ee,B,C);if(!ce)continue;const le=[ee.tileSize,ee.tileSize];let me=C.tileFramebuffer;me||(me=C.tileFramebuffer=D.createFramebuffer(le[0],le[1],!0,null));let fe=ee.rasterParticleState;fe||(fe=ee.rasterParticleState=new yp(D,se,le,q));const ye=fe.update(C.lastInvalidatedAt);fe.particleTextureDimension!==V&&fe.updateParticleTexture(se,q);const Ie=fe.targetColorTexture;fe.targetColorTexture=fe.backgroundColorTexture,fe.backgroundColorTexture=Ie;const Te=fe.particleTexture0;fe.particleTexture0=fe.particleTexture1,fe.particleTexture1=Te,Z.push([se,ce,fe,ye])}if(Z.length===0)return;const X=n.q.now(),ie=C.previousDrawTimestamp?.001*(X-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=X,C.hasColorMap()){D.activeTexture.set(F.TEXTURE0+2);let se=C.colorRampTexture;se||(se=C.colorRampTexture=new n.T(D,C.colorRamp,F.RGBA8)),se.bind(F.LINEAR,F.CLAMP_TO_EDGE)}D.bindFramebuffer.set(C.tileFramebuffer.framebuffer),function(se,ee,ce){const le=se.context,me=le.gl,fe=ee.tileFramebuffer;le.activeTexture.set(me.TEXTURE0);const ye={u_texture:0,u_opacity:1.05*(Te=ee.paint.get("raster-particle-fade-opacity-factor"))/(Te+.05)},Ie=se.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Te;for(const be of ce){const[,,ze,Je]=be;fe.colorAttachment.set(ze.targetColorTexture.texture),le.viewport.set([0,0,fe.width,fe.height]),le.clear({color:n.bz.transparent}),Je&&(ze.backgroundColorTexture.bind(me.NEAREST,me.CLAMP_TO_EDGE),Ie.draw(se,me.TRIANGLES,Yt.disabled,pi.disabled,Ei.alphaBlended,oi.disabled,ye,ee.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments))}}(y,C,Z),function(se,ee,ce,le){const me=se.context,fe=me.gl,ye=ce.tileFramebuffer,Ie=se.transform.projection.name==="globe",Te=ce.paint.get("raster-particle-max-speed");for(const be of le){const[ze,Je,lt]=be;me.activeTexture.set(fe.TEXTURE0+0),Je.texture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),ye.colorAttachment.set(lt.targetColorTexture.texture);const Ke=se.getOrCreateProgram("rasterParticleDraw",{defines:Je.defines,overrideFog:!1});me.activeTexture.set(fe.TEXTURE0+1);const mt=Je.scalarData?[]:[0,1,2,3].map(it=>n.c$[it](ze));mt.push(ze);const Oe=ze.canonical.x,ot=ze.canonical.y;for(const it of mt){const yt=ee.getTile(Ie?it.wrapped():it);if(!yt)continue;const vt=yt.rasterParticleState;if(!vt)continue;const at=it.canonical.x+(1<<it.canonical.z)*(it.wrap-ze.wrap),ut=it.canonical.y;vt.particleTexture0.bind(fe.NEAREST,fe.CLAMP_TO_EDGE);const Ht=au(1,vt.particleTexture0.size[0],[at-Oe,ut-ot],0,Je.texture.size,2,Te,Je.textureOffset,Je.scale,Je.offset);Ke.draw(se,fe.POINTS,Yt.disabled,pi.disabled,Ei.alphaBlended,oi.disabled,Ht,ce.id,vt.particleIndexBuffer,void 0,vt.particleSegment)}}}(y,A,C,Z),D.bindFramebuffer.set(C.particleFramebuffer.framebuffer),function(se,ee,ce,le){const me=se.context,fe=me.gl,ye=ee.paint.get("raster-particle-max-speed"),Ie=le*ee.paint.get("raster-particle-speed-factor")*.15,Te=function(ze){return Math.pow(ze,6)}(.01+1*ee.paint.get("raster-particle-reset-rate-factor")),be=ee.particleFramebuffer;me.viewport.set([0,0,be.width,be.height]);for(const ze of ce){const[,Je,lt]=ze;me.activeTexture.set(fe.TEXTURE0+0),Je.texture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),me.activeTexture.set(fe.TEXTURE0+1);const Ke=lt.particleTexture0;Ke.bind(fe.NEAREST,fe.CLAMP_TO_EDGE);const mt=lu(1,Ke.size[0],0,Je.texture.size,ye,Ie,Te,Je.textureOffset,Je.scale,Je.offset);be.colorAttachment.set(lt.particleTexture1.texture),me.clear({color:n.bz.transparent}),se.getOrCreateProgram("rasterParticleUpdate",{defines:Je.defines}).draw(se,fe.TRIANGLES,Yt.disabled,pi.disabled,Ei.unblended,oi.disabled,mt,ee.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments)}}(y,C,Z,ie)}(c,t,r,u),c.renderPass==="translucent"&&(function(y,A,C,L,D){const F=y.context,B=F.gl,V=A.getSource().tileSize,q=5*(1-n.a7(n.bU,n.bU+1,y.transform.zoom))*V+C.paint.get("raster-particle-elevation"),W=!y.options.moving,Z=y.transform.projection.name==="globe";if(!L.length)return;const[X,ie]=y.stencilConfigForOverlap(L),se=[];Z&&se.push("PROJECTION_GLOBE_VIEW");const ee=y.stencilModeFor3D();for(const ce of ie){const le=ce.toUnwrapped(),me=A.getTile(ce);if(!me.rasterParticleState)continue;const fe=me.rasterParticleState,ye=100;me.registerFadeDuration(ye);const Ie=A.findLoadedParent(ce,0),Te=iu(me,Ie,A,y.transform,ye);let be,ze;y.terrain&&y.terrain.prepareDrawTile(),F.activeTexture.set(B.TEXTURE0),fe.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),F.activeTexture.set(B.TEXTURE1),Ie&&Ie.rasterParticleState?(Ie.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),be=Math.pow(2,Ie.tileID.overscaledZ-me.tileID.overscaledZ),ze=[me.tileID.canonical.x*be%1,me.tileID.canonical.y*be%1]):fe.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Je=Z?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(le,W),lt=y.transform,Ke=vp(lt),mt=n.cz(ce.canonical),Oe=n.cA(mt.getCenter().lat);let ot,it,yt,vt,at;Z?(ot=Float32Array.from(n.b5(n.cC(ce.canonical))),it=Float32Array.from(lt.globeMatrix),yt=Float32Array.from(n.cy(lt)),vt=[n.am(lt.center.lng),n.at(lt.center.lat)],at=Float32Array.from(n.cB(ce.canonical,mt,Oe,lt.worldSize/lt._pixelsPerMercatorPixel))):(ot=new Float32Array(16),it=new Float32Array(9),yt=new Float32Array(16),vt=[0,0],at=new Float32Array(9));const ut=pp(Je,ot,it,yt,at,ze||[0,0],n.a9(y.transform.zoom),vt,Ke,be||1,Te,q),Ht=y.isTileAffectedByFog(ce),St=y.getOrCreateProgram("rasterParticle",{defines:se,overrideFog:Ht});if(y.uploadCommonUniforms(F,St,le),Z){const Ot=new Yt(B.LEQUAL,Yt.ReadOnly,y.depthRangeFor3D),ri=0,Vt=y.globeSharedBuffers;if(Vt){const[Qt,bi,yi]=Vt.getGridBuffers(Oe,ri!==0);St.draw(y,B.TRIANGLES,Ot,ee,Ei.alphaBlended,y.renderElevatedRasterBackface?oi.frontCCW:oi.backCCW,ut,C.id,Qt,bi,yi)}}else{const Ot=y.depthModeForSublayer(0,Yt.ReadOnly),ri=X[ce.overscaledZ],{tileBoundsBuffer:Vt,tileBoundsIndexBuffer:Qt,tileBoundsSegments:bi}=y.getTileBoundsBuffers(me);St.draw(y,B.TRIANGLES,Ot,ri,Ei.alphaBlended,oi.disabled,ut,C.id,Vt,Qt,bi)}}y.resetStencilClippingMasks()}(c,t,r,u),c.style.map.triggerRepaint())},background:function(c,t,r,u){const p=r.paint.get("background-color"),_=r.paint.get("background-opacity"),y=r.paint.get("background-emissive-strength"),A=r.paint.get("background-pitch-alignment")==="viewport";if(_===0)return;const C=c.context,L=C.gl,D=c.transform,F=D.tileSize,B=r.paint.get("background-pattern");let V;if(B!==void 0&&(B===null||(V=c.imageManager.getPattern(B.toString(),r.scope,c.style.getLut(r.scope)),!V)))return;const q=!B&&p.a===1&&_===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==q)return;const W=pi.disabled,Z=c.depthModeForSublayer(0,q==="opaque"?Yt.ReadWrite:Yt.ReadOnly),X=c.colorModeForDrapableLayerRenderPass(y),ie=B?"backgroundPattern":"background";let se,ee=u;if(ee||(se=c.getBackgroundTiles(),ee=Object.values(se).map(ce=>ce.tileID)),B&&(C.activeTexture.set(L.TEXTURE0),c.imageManager.bind(c.context,r.scope)),A){const ce=c.getOrCreateProgram(ie,{overrideFog:!1,overrideRtt:!0}),le=new Float32Array(n.a6.mat4.identity([])),me=new n.aA(0,0,0,0,0),fe=B?Jo(le,y,_,c,0,r.scope,V,A,{tileID:me,tileSize:F}):mp(le,y,_,p.toRenderColor(r.lut));ce.draw(c,L.TRIANGLES,Z,W,X,oi.disabled,fe,r.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments)}else for(const ce of ee){const le=c.isTileAffectedByFog(ce),me=c.getOrCreateProgram(ie,{overrideFog:le}),fe=ce.toUnwrapped(),ye=u?ce.projMatrix:c.transform.calculateProjMatrix(fe);c.prepareDrawTile();const Ie=t?t.getTile(ce):se?se[ce.key]:new Fs(ce,F,D.zoom,c),Te=B?Jo(ye,y,_,c,0,r.scope,V,A,{tileID:ce,tileSize:F}):mp(ye,y,_,p.toRenderColor(r.lut));c.uploadCommonUniforms(C,me,fe);const{tileBoundsBuffer:be,tileBoundsIndexBuffer:ze,tileBoundsSegments:Je}=c.getTileBoundsBuffers(Ie);me.draw(c,L.TRIANGLES,Z,W,X,oi.disabled,Te,r.id,be,ze,Je)}},sky:function(c,t,r){const u=c._atmosphere?n.a9(c.transform.zoom):1,p=r.paint.get("sky-opacity")*u;if(p===0)return;const _=c.context,y=r.paint.get("sky-type"),A=new Yt(_.gl.LEQUAL,Yt.ReadOnly,[0,1]),C=c.frameCounter/1e3%1;y==="atmosphere"?c.renderPass==="offscreen"?r.needsSkyboxCapture(c)&&(function(L,D,F,B){const V=L.context,q=V.gl;let W=D.skyboxFbo;if(!W){W=D.skyboxFbo=V.createFramebuffer(32,32,!0,null),D.skyboxGeometry=new rd(V),D.skyboxTexture=V.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,D.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let se=0;se<6;++se)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(W.framebuffer),V.viewport.set([0,0,32,32]);const Z=D.getCenter(L,!0),X=L.getOrCreateProgram("skyboxCapture"),ie=new Float64Array(16);n.a6.mat4.identity(ie),n.a6.mat4.rotateY(ie,ie,.5*-Math.PI),ea(L,D,X,ie,Z,0),n.a6.mat4.identity(ie),n.a6.mat4.rotateY(ie,ie,.5*Math.PI),ea(L,D,X,ie,Z,1),n.a6.mat4.identity(ie),n.a6.mat4.rotateX(ie,ie,.5*-Math.PI),ea(L,D,X,ie,Z,2),n.a6.mat4.identity(ie),n.a6.mat4.rotateX(ie,ie,.5*Math.PI),ea(L,D,X,ie,Z,3),n.a6.mat4.identity(ie),ea(L,D,X,ie,Z,4),n.a6.mat4.identity(ie),n.a6.mat4.rotateY(ie,ie,Math.PI),ea(L,D,X,ie,Z,5),V.viewport.set([0,0,L.width,L.height])}(c,r),r.markSkyboxValid(c)):c.renderPass==="sky"&&function(L,D,F,B,V){const q=L.context,W=q.gl,Z=L.transform,X=L.getOrCreateProgram("skybox");q.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,D.skyboxTexture);const ie=((se,ee,ce,le,me)=>({u_matrix:se,u_sun_direction:ee,u_cubemap:0,u_opacity:le,u_temporal_offset:me}))(Z.skyboxMatrix,D.getCenter(L,!1),0,B,V);L.uploadCommonUniforms(q,X),X.draw(L,W.TRIANGLES,F,pi.disabled,L.colorModeForRenderPass(),oi.backCW,ie,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(c,r,A,p,C):y==="gradient"&&c.renderPass==="sky"&&function(L,D,F,B,V){const q=L.context,W=q.gl,Z=L.transform,X=L.getOrCreateProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new rd(q)),q.activeTexture.set(W.TEXTURE0);let ie=D.colorRampTexture;ie||(ie=D.colorRampTexture=new n.T(q,D.colorRamp,W.RGBA8)),ie.bind(W.LINEAR,W.CLAMP_TO_EDGE);const se=((ee,ce,le,me,fe)=>({u_matrix:ee,u_color_ramp:0,u_center_direction:ce,u_radius:n.bB(le),u_opacity:me,u_temporal_offset:fe}))(Z.skyboxMatrix,D.getCenter(L,!1),D.paint.get("sky-gradient-radius"),B,V);L.uploadCommonUniforms(q,X),X.draw(L,W.TRIANGLES,F,pi.disabled,L.colorModeForRenderPass(),oi.backCW,se,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(c,r,A,p,C)},debug:function(c,t,r,u,p,_){for(let y=0;y<r.length;y++)if(p){const L=new n.bz(u.r*.8,u.g*.8,u.b*.8,1);Ss(c,t,r[y],u,-1,-1,_),Ss(c,t,r[y],u,-1,1,_),Ss(c,t,r[y],u,1,1,_),Ss(c,t,r[y],u,1,-1,_),Ss(c,t,r[y],L,0,0,_)}else Ss(c,t,r[y],u,0,0,_)},custom:function(c,t,r,u){const p=c.context,_=r.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&r.isDraped(t)){if(c.renderPass==="offscreen"){const y=_.prerender;if(y){if(c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const A=c.transform.pointMerc;y.call(_,p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),n.a9(c.transform.zoom),[A.x,A.y],c.transform.pixelsPerMeterRatio)}else y.call(_,p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const A=_.renderToTile;if(A){const C=u[0].canonical,L=new n.a5(C.x+u[0].wrap*(1<<C.z),C.y,C.z);p.setDepthMode(Yt.disabled),p.setStencilMode(pi.disabled),p.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),A.call(_,p.gl,L),p.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),p.setStencilMode(pi.disabled);const y=_.renderingMode==="3d"?new Yt(c.context.gl.LEQUAL,Yt.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Yt.ReadOnly);if(p.setDepthMode(y),c.transform.projection.name==="globe"){const A=c.transform.pointMerc;_.render(p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),n.a9(c.transform.zoom),[A.x,A.y],c.transform.pixelsPerMeterRatio)}else _.render(p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState(),p.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,t,r,u){if(c.renderPass==="opaque")return;const p=r.paint.get("model-opacity");if(p===0)return;const _=r.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!_||c.terrain&&p<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof n.a4))return;const y=c.shadowRenderer,A=r.paint.get("model-receive-shadows");y&&(y.useNormalOffset=!0,A||(y.enabled=!1));const C=()=>{y&&(y.useNormalOffset=!0,A||(y.enabled=!0))},L=t.getSource();if(c.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(X,ie,se,ee,ce){const le=X.transform;if(le.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${le.projection.name} projection is not yet implemented`);const me=le.getFreeCameraOptions().position;if(!X.modelManager)return;const fe=X.modelManager;se.modelManager=fe;const ye=X.shadowRenderer;if(!se._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ie=se._unevaluatedLayout._values["model-id"],Te={...se.layout.get("model-id").parameters},be=X.style.order.indexOf(se.fqid);for(const ze of ee){const Je=ie.getTile(ze).getBucket(se);if(!Je||Je.projection.name!==le.projection.name)continue;const lt=Je.getModelUris();lt&&!Je.modelsRequested&&(fe.addModelsFromBucket(lt,ce),Je.modelsRequested=!0);const Ke=D_(ze,le);Te.zoom=Ke;const mt=Ie.possiblyEvaluate(Te);if(wp(X,Je,ze),Is.shadowUniformsInitialized=!1,Is.useSingleShadowCascade=!!ye&&ye.getMaxCascadeForTile(ze.toUnwrapped())===0,X.renderPass==="shadow"&&ye){if(X.currentShadowCascade===1&&Je.isInsideFirstShadowMapFrustum)continue;const it=le.calculatePosMatrix(ze.toUnwrapped(),le.worldSize);if(Is.tileMatrix.set(it),Is.shadowTileMatrix=Float32Array.from(ye.calculateShadowPassMatrixFromMatrix(it)),Is.aabb.min.fill(0),Is.aabb.max[0]=Is.aabb.max[1]=n.ab,Is.aabb.max[2]=0,Ql(Je,Is,X,se.scope))continue}const Oe=1<<ze.canonical.z,ot=[((me.x-ze.wrap)*Oe-ze.canonical.x)*n.ab,(me.y*Oe-ze.canonical.y)*n.ab,me.z*Oe*n.ab];X.conflationActive&&Object.keys(Je.instancesPerModel).length>0&&X.style.isLayerClipped(se,ie.getSource())&&Je.updateReplacement(ze,X.replacementSource,be,ce)&&(Je.uploaded=!1,Je.upload(X.context));for(let it in Je.instancesPerModel){const yt=Je.instancesPerModel[it];yt.features.length>0&&(it=mt.evaluate(yt.features[0].feature,{}));const vt=fe.getModel(it,ce);if(vt&&vt.uploaded)for(const at of vt.nodes)En(X,se,at,yt,ot,ze,Is)}}}(c,t,r,u,L.type==="vector"?r.scope:""),void C();if(!L.loaded())return;if(L.type==="batched-model")return function(X,ie,se,ee){se.resetLayerRenderingStats(X);const ce=X.context,le=X.transform,me=X.style.fog,fe=X.shadowRenderer;if(le.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${le.projection.name} projection is not yet implemented`);const ye=X.transform.getFreeCameraOptions().position,Ie=n.a6.vec3.scale([],[ye.x,ye.y,ye.z],X.transform.worldSize),Te=n.a6.vec3.negate([],Ie),be=n.a6.mat4.identity([]),ze=n.de(le.center.lat,le.zoom),Je=n.a6.mat4.fromScaling([],[1,1,1/ze]);n.a6.mat4.translate(be,be,Te);const lt=se.paint.get("model-opacity"),Ke=new Yt(ce.gl.LEQUAL,Yt.ReadWrite,X.depthRangeFor3D),mt=new Yt(ce.gl.LEQUAL,Yt.ReadOnly,X.depthRangeFor3D),Oe=new n.c9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ot=X.renderPass==="shadow",it=ot&&fe?fe.getCurrentCascadeFrustum():le.getFrustum(le.scaleZoom(le.worldSize)),yt=se.paint.get("model-front-cutoff"),vt=yt[2]<1,at=to(X,se.paint.get("model-cutoff-fade-range")),ut=se.getLayerRenderingStats();(function(Ht,St,Ot,ri){const Vt=Ht.terrain?Ht.terrain.exaggeration():0,Qt=Ht.transform.zoom;for(const bi of ri){const yi=St.getTile(bi).getBucket(Ot);yi&&(Ht.conflationActive&&yi.updateReplacement(bi,Ht.replacementSource),yi.evaluateScale(Ht,Ot),Ht.terrain&&Vt>0&&yi.elevationUpdate(Ht.terrain,Vt,bi,Ot.source),yi.needsReEvaluation(Ht,Qt,Ot)&&yi.evaluate(Ot))}})(X,ie,se,ee),function(){let Ht,St,Ot;vt?(Ht=ee.length-1,St=-1,Ot=-1):(Ht=0,St=ee.length,Ot=1);const ri=new Float64Array(16),Vt=n.a6.vec3.create(),Qt=new n.P(0,0);for(let bi=Ht;bi!==St;bi+=Ot){const yi=ee[bi],Yi=ie.getTile(yi).getBucket(se);if(!Yi||!Yi.uploaded)continue;let rr=!1;fe&&(rr=fe.getMaxCascadeForTile(yi.toUnwrapped())===0);const ur=le.calculatePosMatrix(yi.toUnwrapped(),le.worldSize),hs=Yi.modelTraits;!ot&&vt&&(n.a6.mat4.invert(ri,ur),n.a6.vec3.transformMat4(Vt,Ie,ri),Qt.x=Vt[0],Qt.y=Vt[1]);const Fr=[];for(const Ai of Yi.getNodesInfo()){if(Ai.hiddenByReplacement||!Ai.node.meshes)continue;const tr=Ai.node;let mr=0;X.terrain&&tr.elevation&&(mr=tr.elevation*X.terrain.exaggeration());const Qi=(()=>{const ar=Ai.aabb;return Oe.min=[...ar.min],Oe.max=[...ar.max],Oe.min[2]+=mr,Oe.max[2]+=mr,n.a6.vec3.transformMat4(Oe.min,Oe.min,ur),n.a6.vec3.transformMat4(Oe.max,Oe.max,ur),Oe})(),xi=Ai.evaluatedScale;if(xi[0]<=1&&xi[1]<=1&&xi[2]<=1&&Qi.intersects(it)===0)continue;if(!ot&&vt){const ar=.16666666666666666;Ai.cameraCollisionOpacity=Ie[0]>Qi.min[0]&&Ie[0]<Qi.max[0]&&Ie[1]>Qi.min[1]&&Ie[1]<Qi.max[1]&&Ie[2]*ze<Qi.max[2]&&tr.footprint&&n.bu(Qt,tr.footprint)?Math.max(Ai.cameraCollisionOpacity-ar,0):Math.min(1,Ai.cameraCollisionOpacity+ar)}const Ni=[...ur],Wi=tr.anchor?tr.anchor[0]:0,Mr=tr.anchor?tr.anchor[1]:0;n.a6.mat4.translate(Ni,Ni,[Wi*(xi[0]-1),Mr*(xi[1]-1),mr]),n.a6.vec3.exactEquals(xi,n.dh)||n.a6.mat4.scale(Ni,Ni,xi);const Br=n.a6.mat4.multiply([],Ni,tr.matrix),Li=n.a6.mat4.multiply([],le.expandedFarZProjMatrix,Br),Yr=n.a6.mat4.multiply([],le.expandedFarZProjMatrix,Ni),nn=n.a6.vec4.transformMat4([],[Wi,Mr,mr,1],Li)[2];tr.hidden=!1;let Kr=lt;ot||(vt&&(Kr*=Ai.cameraCollisionOpacity,Kr*=Bi(Ni,le,Ai.aabb,yt)),Kr*=dr(at,nn)),Kr!==0?Fr.push({nodeInfo:Ai,depth:nn,opacity:Kr,wvpForNode:Li,wvpForTile:Yr,nodeModelMatrix:Br,tileModelMatrix:Ni}):tr.hidden=!0}ot||Fr.sort((Ai,tr)=>!vt||Ai.opacity===1&&tr.opacity===1?Ai.depth<tr.depth?-1:1:Ai.opacity===1?-1:tr.opacity===1?1:Ai.depth>tr.depth?-1:1);for(const Ai of Fr){const tr=Ai.nodeInfo,mr=tr.node;let Qi=n.a6.mat4.multiply([],Je,Ai.tileModelMatrix);n.a6.mat4.multiply(Qi,be,Qi);const xi=n.a6.mat4.invert([],Qi);n.a6.mat4.transpose(xi,xi),n.a6.mat4.scale(xi,xi,z_),Qi=n.a6.mat4.multiply(Qi,Qi,mr.matrix);const Ni=X.renderPass==="light-beam",Wi=hs&n.dj.HasMapboxMeshFeatures,Mr=Wi?0:tr.evaluatedRMEA[0][2];for(let Br=0;Br<mr.meshes.length;++Br){const Li=mr.meshes[Br],Yr=Br===mr.lightMeshIndex;let nn=Ai.wvpForNode;if(Yr){if(!Ni&&!X.terrain&&X.shadowRenderer){X.currentLayer<X.firstLightBeamLayer&&(X.firstLightBeamLayer=X.currentLayer);continue}nn=Ai.wvpForTile}else if(Ni)continue;const Kr={defines:[]},ar=[];if(yu(Kr.defines,ar,Li,X,se.lut),Wi||Kr.defines.push("DIFFUSE_SHADED"),rr&&Kr.defines.push("SHADOWS_SINGLE_CASCADE"),ut&&(ot?ut.numRenderedVerticesInShadowPass+=Li.vertexArray.length:ut.numRenderedVerticesInTransparentPass+=Li.vertexArray.length),ot){Za(Li,Ai.nodeModelMatrix,X,se);continue}let zn=null;if(me){const ao=gu(Ai.nodeModelMatrix,X.transform);if(zn=new Float32Array(ao),le.projection.name!=="globe"){const Do=Li.aabb.min,$s=Li.aabb.max,[el,tl]=me.getOpacityForBounds(ao,Do[0],Do[1],$s[0],$s[1]);Kr.overrideFog=el>=Lt||tl>=Lt}}const On=Li.material;let ds;On.occlusionTexture&&On.occlusionTexture.offsetScale&&(ds=On.occlusionTexture.offsetScale,Kr.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ot&&fe&&(fe.useNormalOffset=!!Li.normalBuffer);const ns=X.getOrCreateProgram("model",Kr);!ot&&fe&&fe.setupShadowsFromMatrix(Ai.tileModelMatrix,ns,fe.useNormalOffset),X.uploadCommonUniforms(ce,ns,null,zn);const Hn=On.pbrMetallicRoughness;Hn.metallicFactor=.9,Hn.roughnessFactor=.5;const fs=Ft(new Float32Array(nn),new Float32Array(Qi),new Float32Array(xi),new Float32Array(mr.matrix),X,Ai.opacity,Hn.baseColorFactor.toRenderColor(null),On.emissiveFactor,Hn.metallicFactor,Hn.roughnessFactor,On,Mr,se,[0,0,0],ds);!Yr&&(tr.hasTranslucentParts||Ai.opacity<1)&&ns.draw(X,ce.gl.TRIANGLES,Ke,pi.disabled,Ei.disabled,oi.backCCW,fs,se.id,Li.vertexBuffer,Li.indexBuffer,Li.segments,se.paint,X.transform.zoom,void 0,ar),ns.draw(X,ce.gl.TRIANGLES,Yr?mt:Ke,pi.disabled,Yr||Ai.opacity<1||tr.hasTranslucentParts?Ei.alphaBlended:Ei.unblended,oi.backCCW,fs,se.id,Li.vertexBuffer,Li.indexBuffer,Li.segments,se.paint,X.transform.zoom,void 0,ar)}}}}()}(c,t,r,u),void C();if(L.type!=="model")return;const D=L.getModels(),F=[],B=c.transform.getFreeCameraOptions().position,V=n.a6.vec3.scale([],[B.x,B.y,B.z],c.transform.worldSize);n.a6.vec3.negate(V,V);const q=[],W=[];let Z=0;for(const X of D){const ie=r.paint.get("model-rotation").constantOr(null),se=r.paint.get("model-scale").constantOr(null),ee=r.paint.get("model-translation").constantOr(null);X.computeModelMatrix(c,ie,se,ee,!0,!0,!1);const ce=n.a6.mat4.identity([]),le=n.de(X.position.lat,c.transform.zoom),me=n.a6.mat4.fromScaling([],[1,1,1/le]);n.a6.mat4.translate(ce,ce,V),F.push({zScaleMatrix:me,negCameraPosMatrix:ce});for(const fe of X.nodes)Jl(c.transform,fe,X.matrix,c.transform.expandedFarZProjMatrix,Z,q,W);Z++}if(q.sort((X,ie)=>ie.depth-X.depth),c.renderPass!=="shadow"){if(p===1)for(const X of W)Kl(X,c,r,F[X.modelIndex],pi.disabled,c.colorModeForRenderPass());else{for(const X of W)Kl(X,c,r,F[X.modelIndex],pi.disabled,Ei.disabled);for(const X of W)Kl(X,c,r,F[X.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}for(const X of q)Kl(X,c,r,F[X.modelIndex],pi.disabled,c.colorModeForRenderPass());C()}else{for(const X of W)Za(X.mesh,X.nodeModelMatrix,c,r);for(const X of q)Za(X.mesh,X.nodeModelMatrix,c,r);C()}}},vu={model:function(c,t,r){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(r.modelManager&&r.modelManager.upload(r,u.type==="vector"?c.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const p=u.getModels();for(const _ of p)_.upload(r.context)},raster:function(c,t,r){const u=t.getSource();if(!(u instanceof xa&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const _=c.paint.get("raster-array-band")||u.getInitialBand(p);if(_==null)return;const y=t.getIds().map(A=>t.getTileByID(A));for(const A of y)A.updateNeeded(p,_)&&u.prepareTile(A,p,_)},"raster-particle":function(c,t,r){const u=t.getSource();if(!(u instanceof xa&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const _=c.paint.get("raster-particle-array-band")||u.getInitialBand(p);if(_==null)return;const y=t.getIds().map(A=>t.getTileByID(A));for(const A of y)A.updateNeeded(p,_)&&u.prepareTile(A,p,_)}};class nd{constructor(t,r,u,p){this.context=new I_(t,r),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=p,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const _=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const A of _)this._debugParams.enabledLayers[A]=!0;p.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),p.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),p.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),p.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),p.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const A of _)p.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],A);this.occlusionParams=new xu(p),this.setup(),this.numSublayers=Vn.maxUnderzooming+Vn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Nf(this),this._wireframeDebugCache=new Mo,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const y=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,y,t.RGBA8),this._clippingActiveLastFrame=!1}updateTerrain(t,r){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new jh(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,r),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||this.transform.projection.name==="globe"||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=r.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const _=u+.78*(p-u);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new jh(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*n.q.devicePixelRatio,this.height=r*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,r=new n.a_;r.emplaceBack(0,0),r.emplaceBack(n.ab,0),r.emplaceBack(0,n.ab),r.emplaceBack(n.ab,n.ab),this.tileExtentBuffer=t.createVertexBuffer(r,n.b0.members),this.tileExtentSegments=n.b1.simpleSegment(0,0,4,2);const u=new n.a_;u.emplaceBack(0,0),u.emplaceBack(n.ab,0),u.emplaceBack(0,n.ab),u.emplaceBack(n.ab,n.ab),this.debugBuffer=t.createVertexBuffer(u,n.b0.members),this.debugSegments=n.b1.simpleSegment(0,0,4,5);const p=new n.a_;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,n.b0.members),this.viewportSegments=n.b1.simpleSegment(0,0,4,2);const _=new n.aN;_.emplaceBack(0,0,0,0),_.emplaceBack(n.ab,0,n.ab,0),_.emplaceBack(0,n.ab,0,n.ab),_.emplaceBack(n.ab,n.ab,n.ab,n.ab),this.mercatorBoundsBuffer=t.createVertexBuffer(_,n.b3.members),this.mercatorBoundsSegments=n.b1.simpleSegment(0,0,4,2);const y=new n.aO;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y);const A=new n.a$;for(const L of[0,1,3,2,0])A.emplaceBack(L);this.debugIndexBuffer=t.createIndexBuffer(A),this.emptyTexture=new n.T(t,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.a6.mat4.create();const C=this.context.gl;this.stencilClearMode=new pi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Yt.disabled,this.stencilClearMode,Ei.disabled,oi.disabled,$l(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,u){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const C of u)if(this._tileClippingMaskIDs[C.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=r.id;const p=this.context,_=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(Ei.disabled),p.setDepthMode(Yt.disabled);const y=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of u){const C=r.getTile(A),L=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:F,tileBoundsSegments:B}=this.getTileBoundsBuffers(C);y.draw(this,_.TRIANGLES,Yt.disabled,new pi({func:_.ALWAYS,mask:0},L,255,_.KEEP,_.KEEP,_.REPLACE),Ei.disabled,oi.disabled,$l(A.projMatrix),"$clipping",D,F,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new pi({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new pi({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,u=t.sort((y,A)=>A.overscaledZ-y.overscaledZ),p=u[u.length-1].overscaledZ,_=u[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const y={};for(let A=0;A<_;A++)y[A+p]=new pi({func:r.GEQUAL,mask:255},A+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[y,u]}return[{[p]:pi.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ei([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.bz(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ei.unblended:Ei.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ei([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new n.bz(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,u,p=!1){if(this.depthOcclusion)return new Yt(this.context.gl.GREATER,Yt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return Yt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Yt(u||this.context.gl.LEQUAL,r,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),u=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),_=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),r!==0&&u!==0&&(this.depthFBO=new uu(this.context,r,u,!1,"texture"),this.depthTexture=new n.T(this.context,{width:r,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,_),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,u,0,0,r,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,r)=>t+r/this._fpsHistory.length,0))}render(t,r){const u=n.q.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const p=this.style._mergedLayers,_=this.style.order.filter(Te=>{const be=p[Te];return!(be.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[be.type]});let y=!1,A=!1;for(const Te of _){const be=p[Te];be.type==="circle"&&(y=!0),be.type==="symbol"&&(be.hasInitialOcclusionOpacityProperties?A=!0:y=!0)}const C=_.map(Te=>p[Te]),L=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let D=0,F=!1;for(const Te in L){const be=L[Te];be.used&&(be.prepare(this.context),be.getSource().usedInConflation&&++D)}let B=!1;for(const Te of C)Te.isHidden(this.transform.zoom)||(Te.type==="clip"&&(B=!0),this.prepareLayer(Te));const V={},q={},W={},Z={},X={};for(const Te in L){const be=L[Te];V[Te]=be.getVisibleCoordinates(),q[Te]=V[Te].slice().reverse(),W[Te]=be.getVisibleCoordinates(!0).reverse(),Z[Te]=be.getShadowCasterCoordinates(),X[Te]=be.sortCoordinatesByDistance(V[Te])}const ie=Te=>{const be=this.style.getLayerSourceCache(Te);return be&&be.used?be.getSource():null};if(D||B||this._clippingActiveLastFrame){const Te=[],be=[];let ze=0;for(const Je of C)this.isSourceForClippingOrConflation(Je,ie(Je))&&(Te.push(Je),be.push(ze)),ze++;if(Te&&(B||Te.length>1)||this._clippingActiveLastFrame){B=!1;const Je=[];for(let lt=0;lt<Te.length;lt++){const Ke=Te[lt],mt=be[lt],Oe=this.style.getLayerSourceCache(Ke);if(!Oe||!Oe.used||!Oe.getSource().usedInConflation&&Ke.type!=="clip")continue;let ot=n.dn,it=n.bs.None;const yt=[];let vt=!0;if(Ke.type==="clip"){ot=mt;for(const at of Ke.layout.get("clip-layer-types"))it|=at==="model"?n.bs.Model:at==="symbol"?n.bs.Symbol:n.bs.FillExtrusion;for(const at of Ke.layout.get("clip-layer-scope"))yt.push(at);Ke.isHidden(this.transform.zoom)?vt=!1:B=!0}vt&&Je.push({layer:Ke.fqid,cache:Oe,order:ot,clipMask:it,clipScope:yt})}this.replacementSource.setSources(Je),F=!0}}this._clippingActiveLastFrame=B,F||this.replacementSource.clear(),this.conflationActive=F,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Te=0;Te<C.length;Te++){const be=C[Te],ze=be.cutoffRange();if(this.longestCutoffRange=Math.max(ze,this.longestCutoffRange),ze>0){const Je=ie(be);Je&&(this.minCutoffZoom=Math.max(Je.minzoom,this.minCutoffZoom)),be.minzoom&&(this.minCutoffZoom=Math.max(be.minzoom,this.minCutoffZoom))}be.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Te),this._lastOcclusionLayer=Te)}const se=this.style&&this.style.fog;se?(this._fogVisible=se.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=se.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(W),this.opaquePassCutoff=0);const ee=this._shadowRenderer;if(ee){ee.updateShadowParameters(this.transform,this.style.directionalLight);for(const Te in L)for(const be of V[Te]){let ze={min:0,max:0};this.terrain&&(ze=this.terrain.getMinMaxForTile(be)||ze),ee.addShadowReceiver(be.toUnwrapped(),ze.min,ze.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new _u(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Ki.has(this.context.gl))return;this.renderPass="offscreen";for(const Te of C){const be=t.getLayerSourceCache(Te);if(!Te.hasOffscreenPass()||Te.isHidden(this.transform.zoom))continue;const ze=be?q[be.id]:void 0;(Te.type==="custom"||Te.type==="raster"||Te.type==="raster-particle"||Te.isSky()||ze&&ze.length)&&this.renderLayer(this,be,Te,ze)}this.depthRangeFor3D=[0,1-(C.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Z)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ce=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),le=(()=>{if(r.showOverdrawInspector)return n.bz.black;const Te=this.style.fog;if(Te&&this.transform.projection.supportsFog){const be=this.style.getLut(Te.scope);if(!ce){const ze=Te.properties.get("color").toRenderColor(be).toArray01();return new n.bz(...ze)}if(ce){const ze=Te.properties.get("space-color").toRenderColor(be).toArray01();return new n.bz(...ze)}}return n.bz.transparent})();if(this.context.clear({color:le,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ce&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const Te=C[this.currentLayer],be=t.getLayerSourceCache(Te);if(Te.isSky())continue;const ze=be?(Te.is3D()?X:q)[be.id]:void 0;this._renderTileClippingMasks(Te,be,ze),this.renderLayer(this,be,Te,ze)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ce&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const Te=C[this.currentLayer],be=t.getLayerSourceCache(Te);Te.isSky()&&this.renderLayer(this,be,Te,be?q[be.id]:void 0)}function me(Te,be){let ze;return be&&(ze=(Te.type==="symbol"?W:Te.is3D()?X:q)[be.id]),ze}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<_.length;){const Te=C[this.currentLayer];if(Te.type==="raster"||Te.type==="raster-particle"){const be=t.getLayerSourceCache(Te);this.renderLayer(this,be,Te,me(Te,be))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let fe=0;ee&&(fe=ee.getShadowCastingLayerCount());let ye=!1,Ie=-1;for(let Te=0;Te<_.length;++Te){const be=C[Te];be.isHidden(this.transform.zoom)||be.is3D()&&(Ie=Te)}for(A&&Ie===-1&&(y=!0);this.currentLayer<_.length;){const Te=C[this.currentLayer],be=t.getLayerSourceCache(Te);if(Te.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Te)){if(Te.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(y&&!ye&&this.terrain&&!this.transform.isOrthographic&&(ye=!0,this.blitDepth()),A&&Ie!==-1&&this.currentLayer===Ie+1&&!this.transform.isOrthographic&&this.blitDepth(),Te.is3D()||this.terrain||this._renderTileClippingMasks(Te,be,be?V[be.id]:void 0),this.renderLayer(this,be,Te,me(Te,be)),!this.terrain&&ee&&fe>0&&Te.hasShadowPass()&&--fe==0&&(ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ze=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ze;this.currentLayer++){const Je=C[this.currentLayer];if(!Je.hasLightBeamPass())continue;const lt=t.getLayerSourceCache(Je);this.renderLayer(this,lt,Je,lt?q[lt.id]:void 0)}this.currentLayer=ze,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ze=this.currentLayer;this.depthOcclusion=!0;for(const Je of this.layersWithOcclusionOpacity){this.currentLayer=Je;const lt=C[this.currentLayer],Ke=t.getLayerSourceCache(lt),mt=Ke?q[Ke.id]:void 0;lt.is3D()||this.terrain||this._renderTileClippingMasks(lt,Ke,Ke?V[Ke.id]:void 0),this.renderLayer(this,Ke,lt,mt)}this.depthOcclusion=!1,this.currentLayer=ze,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Te=null;C.forEach(be=>{const ze=t.getLayerSourceCache(be);ze&&!be.isHidden(this.transform.zoom)&&ze.getVisibleCoordinates().length&&(!Te||Te.getSource().maxzoom<ze.getSource().maxzoom)&&(Te=ze)}),Te&&this.options.showTileBoundaries&&Co.debug(this,Te,Te.getVisibleCoordinates(),n.bz.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Co.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.bz(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Te){const be=Te.transform.padding;pr(Te,Te.transform.height-(be.top||0),3,P_),pr(Te,be.bottom||0,3,qa),Ue(Te,be.left||0,3,Ha),Ue(Te,Te.transform.width-(be.right||0),3,bt);const ze=Te.transform.centerPoint;(function(Je,lt,Ke,mt){Yl(Je,lt-1,Ke-10,2,20,mt),Yl(Je,lt-10,Ke-1,20,2,mt)})(Te,ze.x,Te.transform.height-ze.y,qt)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),F||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:r}=this.transform.projection,u=!r||!r.includes(t.type);if(vu[t.type]&&(u||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);vu[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,r,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||Co[u.type](t,r,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,u=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),p.calls++,u.beginQuery(r.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,u=r.createQuery();this.deferredRenderGpuTimeQueries.push(u),r.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const u in t){const p=t[u],_=this.context.extTimerQuery,y=_.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(p.query),r[u]=y}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.extTimerQuery,u=this.context.gl;let p=0;for(const _ of t)p+=r.getQueryParameter(_,u.QUERY_RESULT)/1e6,r.deleteQueryEXT(_);return p}translatePosMatrix(t,r,u,p,_){if(!u[0]&&!u[1])return t;const y=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(y){const L=Math.sin(y),D=Math.cos(y);u=[u[0]*D-u[1]*L,u[0]*L+u[1]*D]}const A=[_?u[0]:n.ak(r,u[0],this.transform.zoom),_?u[1]:n.ak(r,u[1],this.transform.zoom),0],C=new Float32Array(16);return n.a6.mat4.translate(C,t,A),C}saveTileTexture(t){const r=t.size[0],u=this._tileTextures[r];u?u.push(t):this._tileTextures[r]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,r,u){const p=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,_=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||_.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?_.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):_.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||p||r!==void 0&&!r||_.push("FOG","FOG_DITHERING"),p&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(t,r){this.cache=this.cache||{};const u=r&&r.defines||[],p=r&&r.config,_=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(u),y=Ao.cacheKey(Eo[t],t,_,p);return this.cache[y]||(this.cache[y]=new Ao(this.context,t,Eo[t],p,_p[t],_)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const u=this.style.directionalLight,p=this.style.ambientLight;if(u&&p){const _=((y,A,C)=>{const L=y.properties.get("direction"),D=y.properties.get("color").toRenderColor(C.getLut(y.scope)).toArray01(),F=y.properties.get("intensity"),B=A.properties.get("color").toRenderColor(C.getLut(A.scope)).toArray01(),V=A.properties.get("intensity"),q=[L.x,L.y,L.z],W=n.cH(B,V),Z=n.cH(D,F);return{u_lighting_ambient_color:W,u_lighting_directional_dir:q,u_lighting_directional_color:Z,u_ground_radiance:Gh(q,Z,W)}})(u,p,this.style);r.setLightsUniformValues(t,_)}}}uploadCommonUniforms(t,r,u,p,_){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const A=y.getOpacity(this.transform.pitch),C=((L,D,F,B,V,q,W,Z,X,ie,se,ee)=>{const ce=L.transform,le=D.properties.get("color").toRenderColor(L.style.getLut(D.scope)).toArray01();le[3]=B;const me=L.frameCounter/1e3%1,[fe,ye]=D.properties.get("vertical-range");return{u_fog_matrix:F?ce.calculateFogTileMatrix(F):ee||L.identityMat,u_fog_range:D.getFovAdjustedRange(ce._fov),u_fog_color:le,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(fe,ye),ye],u_fog_temporal_offset:me,u_frustum_tl:V,u_frustum_tr:q,u_frustum_br:W,u_frustum_bl:Z,u_globe_pos:X,u_globe_radius:ie,u_viewport:se,u_globe_transition:n.a9(ce.zoom),u_is_globe:+(ce.projection.name==="globe")}})(this,y,u,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],p);r.setFogUniformValues(t,C)}_&&r.setCutoffUniformValues(t,_.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)r[p.key]=t[p.key]||new Fs(p,512,this.transform.tileZoom,this);return r}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,r){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!r||r.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=Lt||r[1]>=Lt}setupDepthForOcclusion(t,r,u){const p=this.context,_=p.gl,y=!!u;var A;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(_.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((A=this.depthRangeFor3D)[1]-A[0]),-1-2*A[0]/(A[1]-A[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),p.activeTexture.set(_.TEXTURE0),y||r.setTerrainUniformValues(p,u)}}function ro(c,t){let r=!1,u=null;const p=()=>{u=null,r&&(c(),u=setTimeout(p,t),r=!1)};return()=>(r=!0,u||p(),u)}class Po{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ro(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=no(t);if(this._hashName){const u=this._hashName;let p=!1;const _=location.hash.slice(1).split("&").map(y=>{const A=y.split("=")[0];return A===u?(p=!0,`${A}=${r}`):y}).filter(y=>y);return p||_.push(`${u}=${r}`),`#${_.join("&")}`}return`#${r}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(r=u)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some(u=>isNaN(u))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:u,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function no(c,t){const r=c.getCenter(),u=Math.round(100*c.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),y=Math.round(r.lng*_)/_,A=Math.round(r.lat*_)/_,C=c.getBearing(),L=c.getPitch();let D=t?`/${y}/${A}/${u}`:`${u}/${A}/${y}`;return(C||L)&&(D+="/"+Math.round(10*C)/10),L&&(D+=`/${Math.round(L)}`),D}const ta={linearity:.3,easing:n.dp(0,0,.3,1)},bu=n.l({deceleration:2500,maxSpeed:1400},ta),sd=n.l({deceleration:20,maxSpeed:1400},ta),od=n.l({deceleration:1e3,maxSpeed:360},ta),ad=n.l({deceleration:1e3,maxSpeed:90},ta);class Ro{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=n.q.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(r.pan.mag()){const _=ia(r.pan.mag(),u,n.l({},bu,t||{}));p.offset=r.pan.mult(_.amount/r.pan.mag()),p.center=this._map.transform.center,Xa(p,_)}if(r.zoom){const _=ia(r.zoom,u,sd);p.zoom=this._map.transform.zoom+_.amount,Xa(p,_)}if(r.bearing){const _=ia(r.bearing,u,od);p.bearing=this._map.transform.bearing+n.ap(_.amount,-179,179),Xa(p,_)}if(r.pitch){const _=ia(r.pitch,u,ad);p.pitch=this._map.transform.pitch+_.amount,Xa(p,_)}if(p.zoom||p.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function Xa(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function ia(c,t,r){const{maxSpeed:u,linearity:p,deceleration:_}=r,y=n.ap(c*p/(t/1e3),-u,u),A=Math.abs(y)/(_*p);return{easing:r.easing,duration:1e3*A,amount:y*(A/2)}}class Dn extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,u,p={}){const _=zi(r.getCanvasContainer(),u),y=r.unproject(_);super(t,n.l({point:_,lngLat:y,originalEvent:u},p)),this._defaultPrevented=!1,this.target=r}}class Ya extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,u){const p=t==="touchend"?u.changedTouches:u.touches,_=or(r.getCanvasContainer(),p),y=_.map(C=>r.unproject(C)),A=_.reduce((C,L,D,F)=>C.add(L.div(F.length)),new n.P(0,0));super(t,{points:_,point:A,lngLats:y,lngLat:r.unproject(A),originalEvent:u}),this._defaultPrevented=!1}}class fn extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r){super("wheel",{originalEvent:r}),this._defaultPrevented=!1}}class ld{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new fn(this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Dn(t.type,this._map,t))}mouseup(t){this._map.fire(new Dn(t.type,this._map,t))}preclick(t){const r=n.l({},t);r.type="preclick",this._map.fire(new Dn(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Dn(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Dn(t.type,this._map,t))}mouseover(t){this._map.fire(new Dn(t.type,this._map,t))}mouseout(t){this._map.fire(new Dn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ya(t.type,this._map,t))}touchmove(t){this._map.fire(new Ya(t.type,this._map,t))}touchend(t){this._map.fire(new Ya(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ya(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cd{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Dn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Dn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ka{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(ft(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const u=r,p=this._startPos,_=this._lastPos;if(!p||!_||_.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=Xe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(p.x,u.x),A=Math.max(p.x,u.x),C=Math.min(p.y,u.y),L=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${C}px)`,this._box.style.width=A-y+"px",this._box.style.height=L-C+"px")})}mouseupWindow(t,r){if(!this._active)return;const u=this._startPos,p=r;if(u&&t.button===0){if(this.reset(),zt(),u.x!==p.x||u.y!==p.y)return this._map.fire(new n.x("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Bt(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new n.x(t,{originalEvent:r}))}}function so(c,t){const r={};for(let u=0;u<c.length;u++)r[c[u].identifier]=t[u];return r}class ud{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const _=new n.P(0,0);for(const y of p)_._add(y);return _.div(p.length)}(r),this.touches=so(u,r)))}touchmove(t,r,u){if(this.aborted||!this.centroid)return;const p=so(u,r);for(const _ in this.touches){const y=p[_];(!y||y.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class ec{constructor(t){this.singleTap=new ud(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,u){this.singleTap.touchstart(t,r,u)}touchmove(t,r,u){this.singleTap.touchmove(t,r,u)}touchend(t,r,u){const p=this.singleTap.touchend(t,r,u);if(p){const _=t.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(p)<30;if(_&&y||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class hd{constructor(){this._zoomIn=new ec({numTouches:1,numTaps:2}),this._zoomOut=new ec({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,u){this._zoomIn.touchstart(t,r,u),this._zoomOut.touchstart(t,r,u)}touchmove(t,r,u){this._zoomIn.touchmove(t,r,u),this._zoomOut.touchmove(t,r,u)}touchend(t,r,u){const p=this._zoomIn.touchend(t,r,u),_=this._zoomOut.touchend(t,r,u);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(p)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const tc={0:1,2:2};class ic{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const u=$t(t);this._correctButton(t,u)&&(this._lastPoint=r,this._eventButton=u)}mousemoveWindow(t,r){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(p,_){const y=tc[_];return p.buttons===void 0||(p.buttons&y)!==y}(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(u,r)}}mouseupWindow(t){this._lastPoint&&$t(t)===this._eventButton&&(this._moved&&zt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wu extends ic{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return r===0&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class Tu extends ic{_correctButton(t,r){return r===0&&t.ctrlKey||r===2}_move(t,r){const u=.8*(r.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){t.preventDefault()}}class Eu extends ic{_correctButton(t,r){return r===0&&t.ctrlKey||r===2}_move(t,r){const u=-.5*(r.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){t.preventDefault()}}class Ep{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),n.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,r,u){return this._calculateTransform(t,r,u)}touchmove(t,r,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!n.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,u)}}touchend(t,r,u){this._calculateTransform(t,r,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,u){u.length>0&&(this._active=!0);const p=so(u,r),_=new n.P(0,0),y=new n.P(0,0);let A=0;for(const L in p){const D=p[L],F=this._touches[L];F&&(_._add(D),y._add(D.sub(F)),A++,p[L]=D)}if(this._touches=p,A<this._minTouches||!y.mag())return;const C=y.div(A);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(A),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Su{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,u){return{}}touchstart(t,r,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[_,y]=p,A=rc(u,r,_),C=rc(u,r,y);if(!A||!C)return;const L=this._aroundCenter?null:A.add(C).div(2);return this._move([A,C],L,t)}touchend(t,r,u){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,y=rc(u,r,p),A=rc(u,r,_);y&&A||(this._active&&zt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function rc(c,t,r){for(let u=0;u<c.length;u++)if(c[u].identifier===r)return t[u]}function dd(c,t){return Math.log(c/t)/Math.LN2}class Sp extends Su{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(dd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:dd(this._distance,u),pinchAround:r}}}function fd(c,t){return 180*c.angleWith(t)/Math.PI}class Ap extends Su{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:fd(this._vector,u),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=fd(t,u);return Math.abs(p)<r}}function Au(c){return Math.abs(c.y)>Math.abs(c.x)}class Ip extends Su{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Au(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,u){const p=this._lastPoints;if(!p)return;const _=t[0].sub(p[0]),y=t[1].sub(p[1]);return this._map._cooperativeGestures&&!n.dq()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(_,y,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+y.y)/2*-.5})}gestureBeginsVertically(t,r,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,_=r.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const y=t.y>0==r.y>0;return Au(t)&&Au(r)&&y}}const Mp={panStep:100,bearingStep:15,pitchStep:10};class Cp{constructor(){const t=Mp;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,u=0,p=0,_=0,y=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),y=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:A=>{const C=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:Pp,zoom:r?Math.round(C)+r*(t.shiftKey?2:1):C,bearing:A.getBearing()+u*this._bearingStep,pitch:A.getPitch()+p*this._pitchStep,offset:[-_*this._panStep,-y*this._panStep],center:A.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Pp(c){return c*(2-c)}const pd=4.000244140625,O_=1/450;class k_{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=O_,n.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=n.q.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,r!==0&&r%pd==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=zi(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>pd?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&D!==0&&(D=1/D);const F=r(),B=Math.pow(2,F),V=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(V*D))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:r(),p=this._startZoom,_=this._easing;let y,A=!1;if(this._type==="wheel"&&p&&_){const L=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),D=_(L);y=n.aa(p,u,D),L<1?this._frameId||(this._frameId=!0):A=!0}else y=u,A=!0;this._active=!0,A&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=y-r();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!A,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=n.dr;if(this._prevEase){const u=this._prevEase,p=(n.q.now()-u.start)/u.duration,_=u.easing(p+.01)-u.easing(p),y=.27/Math.sqrt(_*_+1e-4)*.01,A=Math.sqrt(.0729-y*y);r=n.dp(y,A,.25,1)}return this._prevEase={start:n.q.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ir{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class F_{constructor(){this._tap=new ec({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=r[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,r,u))}touchmove(t,r,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=r[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,u)}touchend(t,r,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,r,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class B_{constructor(t,r,u){this._el=t,this._mousePan=r,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class nc{constructor(t,r,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Lp{constructor(t,r,u,p){this._el=t,this._touchZoom=r,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ja=c=>c.zoom||c.drag||c.pitch||c.rotate;class Iu extends n.x{}class oo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const u=n.a6.vec3.sub([],r,t);this.radius=n.a6.vec3.length(u[2]<0?n.a6.vec3.div([],u,this.constants):[u[0],u[1],0])}projectRay(t){n.a6.vec3.div(t,t,this.constants),n.a6.vec3.normalize(t,t),n.a6.vec3.mul(t,t,this.constants);const r=n.a6.vec3.scale([],t,this.radius);if(r[2]>0){const u=n.a6.vec3.scale([],[0,0,1],n.a6.vec3.dot(r,[0,0,1])),p=n.a6.vec3.scale([],n.a6.vec3.normalize([],[r[0],r[1],0]),this.radius),_=n.a6.vec3.add([],r,n.a6.vec3.scale([],n.a6.vec3.sub([],n.a6.vec3.add([],p,u),r),2));r[0]=_[0],r[1]=_[1]}return r}}function ra(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Sn{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ro(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new oo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),n.aJ(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,_,y]of this._listeners){const A=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(_,A,y)}}destroy(){for(const[t,r,u]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(r,p,u)}}_addDefaultHandlers(t){const r=this._map,u=r.getCanvasContainer();this._add("mapEvent",new ld(r,t));const p=r.boxZoom=new Ka(r,t);this._add("boxZoom",p);const _=new hd,y=new Rp;r.doubleClickZoom=new Ir(y,_),this._add("tapZoom",_),this._add("clickZoom",y);const A=new F_;this._add("tapDragZoom",A);const C=r.touchPitch=new Ip(r);this._add("touchPitch",C);const L=new Tu(t),D=new Eu(t);r.dragRotate=new nc(t,L,D),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const F=new wu(t),B=new Ep(r,t);r.dragPan=new B_(u,F,B),this._add("mousePan",F),this._add("touchPan",B,["touchZoom","touchRotate"]);const V=new Ap,q=new Sp;r.touchZoomRotate=new Lp(u,q,V,A),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new cd(r));const W=r.scrollZoom=new k_(r,this);this._add("scrollZoom",W,["mousePan"]);const Z=r.keyboard=new Cp;this._add("keyboard",Z);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[X]&&r[X].enable(t[X])}_add(t,r,u){this._handlers.push({handlerName:t,handler:r,allowed:u}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ja(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,u){for(const p in t)if(p!==u&&(!r||r.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const u of t)this._el.contains(u.target)&&r.push(u);return r}handleEvent(t,r){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,_={needsRenderFrame:!1},y={},A={},C=t.touches?this._getMapTouches(t.touches):void 0,L=C?or(this._el,C):u?void 0:zi(this._el,t);for(const{handlerName:B,handler:V,allowed:q}of this._handlers){if(!V.isEnabled())continue;let W;this._blockedByActive(A,q,B)?V.reset():V[r||t.type]&&(W=V[r||t.type](t,L,C),this.mergeHandlerResult(_,y,W,B,p),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||V.isActive())&&(A[B]=V)}const D={};for(const B in this._previousActiveHandlers)A[B]||(D[B]=p);this._previousActiveHandlers=A,(Object.keys(D).length||ra(_))&&(this._changes.push([_,y,D]),this._triggerRenderFrame()),(Object.keys(A).length||ra(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=_;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(t,r,u,p,_){if(!u)return;n.l(t,u);const y={handlerName:p,originalEvent:u.originalEvent||_};u.zoomDelta!==void 0&&(r.zoom=y),u.panDelta!==void 0&&(r.drag=y),u.pitchDelta!==void 0&&(r.pitch=y),u.bearingDelta!==void 0&&(r.rotate=y)}_applyChanges(){const t={},r={},u={};for(const[p,_,y]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),n.l(r,_),n.l(u,y);this._updateMapTransform(t,r,u),this._changes=[]}_updateMapTransform(t,r,u){const p=this._map,_=p.transform,y=ie=>[ie.x,ie.y,ie.z];if((ie=>{const se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!ra(t)){const ie=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),ie!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&p._stop(!0),!ra(t))return void this._fireEvents(r,u,!0);let{panDelta:A,zoomDelta:C,bearingDelta:L,pitchDelta:D,around:F,aroundCoord:B,pinchAround:V}=t;_._isCameraConstrained&&(C>0&&(C=0),_._isCameraConstrained=!1),V!==void 0&&(F=V),(C||(ie=>r[ie]&&!this._eventsInProgress[ie])("drag"))&&F&&(this._dragOrigin=y(_.pointCoordinate3D(F)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",p._stop(!0),F=F||p.transform.centerPoint,L&&(_.bearing+=L),D&&(_.pitch+=D),_._updateCameraState();const q=[0,0,0];if(A)if(_.projection.name==="mercator"){const ie=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(F).dir),se=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(F.sub(A)).dir);q[0]=se[0]-ie[0],q[1]=se[1]-ie[1]}else{const ie=_.pointCoordinate(F);if(_.projection.name==="globe"){A=A.rotate(-_.angle);const se=_._pixelsPerMercatorPixel/_.worldSize;q[0]=-A.x*n.ds(n.aM(ie.y))*se,q[1]=-A.y*n.ds(_.center.lat)*se}else{const se=_.pointCoordinate(F.sub(A));ie&&se&&(q[0]=se.x-ie.x,q[1]=se.y-ie.y)}}const W=_.zoom,Z=[0,0,0];if(C){const ie=y(B||_.pointCoordinate3D(F)),se={dir:n.a6.vec3.normalize([],n.a6.vec3.sub([],ie,_._camera.position))};if(se.dir[2]<0){const ee=_.zoomDeltaToMovement(ie,C);n.a6.vec3.scale(Z,se.dir,ee)}}const X=n.a6.vec3.add(q,q,Z);_._translateCameraConstrained(X),C&&Math.abs(_.zoom-W)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,u,!0)}_fireEvents(t,r,u){const p=Ja(this._eventsInProgress),_=Ja(t),y={};for(const D in t){const{originalEvent:F}=t[D];this._eventsInProgress[D]||(y[`${D}start`]=F),this._eventsInProgress[D]=t[D]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const D in y)this._fireEvent(D,y[D]);_&&this._fireEvent("move",_.originalEvent);for(const D in t){const{originalEvent:F}=t[D];this._fireEvent(D,F)}const A={};let C;for(const D in this._eventsInProgress){const{handlerName:F,originalEvent:B}=this._eventsInProgress[D];this._handlersById[F].isActive()||(delete this._eventsInProgress[D],C=r[F]||B,A[`${D}end`]=C)}for(const D in A)this._fireEvent(D,A[D]);const L=Ja(this._eventsInProgress);if(u&&(p||_)&&!L){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;D?(F(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:C})):(this._map.fire(new n.x("moveend",{originalEvent:C})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new n.x(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Iu("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Vs="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class md extends n.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=r.respectPrefersReducedMotion!==!1,n.aJ(["_renderFrameCallback"],this)}getCenter(){return new n.bK(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,u){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,n.l({offset:t},r),u)}panTo(t,r,u){return this.easeTo(n.l({center:t},r),u)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,u){return this.easeTo(n.l({zoom:t},r),u)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,u){return this.easeTo(n.l({bearing:t},r),u)}resetNorth(t,r){return this.rotateTo(0,n.l({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(n.l({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=n.as.convert(t);const u=r&&r.bearing||0,p=r&&r.pitch||0,_=t.getNorthWest(),y=t.getSouthEast();return this._cameraForBounds(this.transform,_,y,u,p,r)}_extendPadding(t){const r={top:0,right:0,bottom:0,left:0};return t==null?n.l({},r,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:n.l({},r,t)}_extendCameraOptions(t){return(t=n.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,r){const u=r.max[0]-r.min[0],p=r.max[1]-r.min[1];return u/p>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,u,p,_,y){const A=t.clone(),C=this._extendCameraOptions(y);A.bearing=p,A.pitch=_;const L=n.bK.convert(r),D=n.bK.convert(u),F=.5*(L.lat+D.lat),B=.5*(L.lng+D.lng),V=n.dt(F,B),q=n.a6.vec3.normalize([],V),W=n.a6.vec3.normalize([],n.a6.vec3.cross([],q,[0,1,0])),Z=n.a6.vec3.cross([],W,q),X=[W[0],W[1],W[2],0,Z[0],Z[1],Z[2],0,q[0],q[1],q[2],0,0,0,0,1],ie=[V,n.dt(L.lat,L.lng),n.dt(D.lat,L.lng),n.dt(D.lat,D.lng),n.dt(L.lat,D.lng),n.dt(F,L.lng),n.dt(F,D.lng),n.dt(L.lat,B),n.dt(D.lat,B)];let se=n.c9.fromPoints(ie.map(it=>[n.a6.vec3.dot(W,it),n.a6.vec3.dot(Z,it),n.a6.vec3.dot(q,it)]));const ee=n.a6.vec3.transformMat4([],se.center,X);n.a6.vec3.squaredLength(ee)===0&&n.a6.vec3.set(ee,0,0,1),n.a6.vec3.normalize(ee,ee),n.a6.vec3.scale(ee,ee,n.aq),A.center=n.du(ee);const ce=A.getWorldToCameraMatrix(),le=n.a6.mat4.invert(new Float64Array(16),ce);se=n.c9.applyTransform(se,n.a6.mat4.multiply([],ce,X));const me=this._extendAABB(se,A,C,p);if(!me)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");se=me,n.a6.vec3.transformMat4(ee,ee,ce);const fe=.5*(se.max[2]-se.min[2]),ye=this._minimumAABBFrustumDistance(A,se),Ie=n.a6.vec3.scale([],[0,0,1],fe),Te=n.a6.vec3.add(Ie,ee,Ie),be=ye+(A.pitch===0?0:n.a6.vec3.distance(ee,Te)),ze=A.globeCenterInViewSpace,Je=n.a6.vec3.sub([],ee,[ze[0],ze[1],ze[2]]);n.a6.vec3.normalize(Je,Je),n.a6.vec3.scale(Je,Je,be);const lt=n.a6.vec3.add([],ee,Je);n.a6.vec3.transformMat4(lt,lt,le);const Ke=n.dw/n.aq,mt=n.a6.vec3.length(lt),Oe=n.bD(Math.max(mt*Ke-n.dw,Number.EPSILON),0),ot=Math.min(A.zoomFromMercatorZAdjusted(Oe),C.maxZoom);return ot>.5*(n.c2+n.bU)?(A.setProjection({name:"mercator"}),A.zoom=ot,this._cameraForBounds(A,r,u,p,_,y)):{center:A.center,zoom:ot,bearing:p,pitch:_}}_extendAABB(t,r,u,p){const _=.5*((u.padding.left||0)+(u.padding.right||0)),y=.5*((u.padding.top||0)+(u.padding.bottom||0)),A=y,C=_,L=_,D=y,F=r.width-(C+L),B=r.height-(A+D),V=n.a6.vec3.sub([],t.max,t.min),q=Math.min(F/V[0],B/V[1]),W=Math.min(r.scaleZoom(r.scale*q),u.maxZoom);if(isNaN(W))return null;const Z=r.scale/r.zoomScale(W),X=new n.c9([t.min[0]-C*Z,t.min[1]-D*Z,t.min[2]],[t.max[0]+L*Z,t.max[1]+A*Z,t.max[2]]),ie=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new n.P(u.offset.x,u.offset.y):n.P.convert(u.offset)).rotate(-n.bB(p));return X.center[0]-=ie.x*Z,X.center[1]+=ie.y*Z,X}queryTerrainElevation(t,r){const u=this.transform.elevation;return u?(r=n.l({},{exaggerated:!0},r),u.getAtPoint(n.a5.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,u,p,_,y){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,r,u,p,_,y);const A=t.clone(),C=this._extendCameraOptions(y);A.bearing=p,A.pitch=_;const L=n.bK.convert(r),D=n.bK.convert(u),F=new n.bK(L.lng,D.lat),B=new n.bK(D.lng,L.lat),V=A.project(L),q=A.project(D),W=this.queryTerrainElevation(L),Z=this.queryTerrainElevation(D),X=this.queryTerrainElevation(F),ie=this.queryTerrainElevation(B),se=[[V.x,V.y,Math.min(W||0,Z||0,X||0,ie||0)],[q.x,q.y,Math.max(W||0,Z||0,X||0,ie||0)]];let ee=n.c9.fromPoints(se);const ce=A.getWorldToCameraMatrix(),le=n.a6.mat4.invert(new Float64Array(16),ce);ee=n.c9.applyTransform(ee,ce);const me=this._extendAABB(ee,A,C,p);if(!me)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ee=me;const fe=.5*n.a6.vec3.sub([],ee.max,ee.min)[2],ye=this._minimumAABBFrustumDistance(A,ee),Ie=[0,0,1,0];n.a6.vec4.transformMat4(Ie,Ie,ce),n.a6.vec4.normalize(Ie,Ie);const Te=n.a6.vec3.scale([],Ie,ye+fe),be=n.a6.vec3.add([],ee.center,Te);n.a6.vec3.transformMat4(ee.center,ee.center,le),n.a6.vec3.transformMat4(be,be,le);const ze=A.unproject(new n.P(ee.center[0],ee.center[1])),Je=n.dv(A.projection,ze),lt=Math.pow(2,Je),Ke=Math.min(A._zoomFromMercatorZ(be[2]*A.pixelsPerMeter*lt/A.worldSize),C.maxZoom);return A.mercatorFromTransition&&Ke<.5*(n.c2+n.bU)?(A.setProjection({name:"globe"}),A.zoom=Ke,this._cameraForBounds(A,r,u,p,_,y)):{center:ze,zoom:Ke,bearing:p,pitch:_}}fitBounds(t,r,u){const p=this.cameraForBounds(t,r);return this._fitInternal(p,r,u)}fitScreenCoordinates(t,r,u,p,_){const y=n.P.convert(t),A=n.P.convert(r),C=new n.P(Math.min(y.x,A.x),Math.min(y.y,A.y)),L=new n.P(Math.max(y.x,A.x),Math.max(y.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(y,A))return this;const D=this.transform.pointLocation3D(C),F=this.transform.pointLocation3D(L),B=this.transform.pointLocation3D(new n.P(C.x,L.y)),V=this.transform.pointLocation3D(new n.P(L.x,C.y)),q=[Math.min(D.lng,F.lng,B.lng,V.lng),Math.min(D.lat,F.lat,B.lat,V.lat)],W=[Math.max(D.lng,F.lng,B.lng,V.lng),Math.max(D.lat,F.lat,B.lat,V.lat)],Z=p&&p.pitch?p.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,q,W,u,Z,p);return this._fitInternal(X,p,_)}_fitInternal(t,r,u){return t?(r=n.l(t,r)).linear?this.easeTo(r,u):this.flyTo(r,u):this}jumpTo(t,r){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,_=!1,y=!1;"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=n.bK.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(_=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(y=!0,u.pitch=+t.pitch);const A=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(A))if(t.retainPadding===!1){const C=u.clone();C.padding=A,u.setLocationAtPoint(u.center,C.centerPoint)}else u.padding=A;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new n.x("movestart",r)).fire(new n.x("move",r)),p&&this.fire(new n.x("zoomstart",r)).fire(new n.x("zoom",r)).fire(new n.x("zoomend",r)),_&&this.fire(new n.x("rotatestart",r)).fire(new n.x("rotate",r)).fire(new n.x("rotateend",r)),y&&this.fire(new n.x("pitchstart",r)).fire(new n.x("pitch",r)).fire(new n.x("pitchend",r)),this.fire(new n.x("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(Vs),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const u=this.transform;if(!u.projection.supportsFreeCamera)return n.w(Vs),this;this.stop();const p=u.zoom,_=u.pitch,y=u.bearing;u.setFreeCameraOptions(t);const A=p!==u.zoom,C=_!==u.pitch,L=y!==u.bearing;return this.fire(new n.x("movestart",r)).fire(new n.x("move",r)),A&&this.fire(new n.x("zoomstart",r)).fire(new n.x("zoom",r)).fire(new n.x("zoomend",r)),L&&this.fire(new n.x("rotatestart",r)).fire(new n.x("rotate",r)).fire(new n.x("rotateend",r)),C&&this.fire(new n.x("pitchstart",r)).fire(new n.x("pitch",r)).fire(new n.x("pitchend",r)),this.fire(new n.x("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),((t=n.l({offset:[0,0],duration:500,easing:n.dr},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,p=this.getZoom(),_=this.getBearing(),y=this.getPitch(),A=this.getPadding(),C="zoom"in t?+t.zoom:p,L="bearing"in t?this._normalizeBearing(t.bearing,_):_,D="pitch"in t?+t.pitch:y,F=this._extendPadding(t.padding),B=n.P.convert(t.offset);let V,q,W;if(u.projection.name==="globe"){const Ie=n.a5.fromLngLat(u.center),Te=B.rotate(-u.angle);Ie.x+=Te.x/u.worldSize,Ie.y+=Te.y/u.worldSize;const be=Ie.toLngLat(),ze=n.bK.convert(t.center||be);this._normalizeCenter(ze),V=u.centerPoint.add(Te),q=new n.P(Ie.x,Ie.y).mult(u.worldSize),W=new n.P(n.am(ze.lng),n.at(ze.lat)).mult(u.worldSize).sub(q)}else{V=u.centerPoint.add(B);const Ie=u.pointLocation(V),Te=n.bK.convert(t.center||Ie);this._normalizeCenter(Te),q=u.project(Ie),W=u.project(Te).sub(q)}const Z=u.zoomScale(C-p);let X,ie;t.around&&(X=n.bK.convert(t.around),ie=u.locationPoint(X));const se=this._zooming||C!==p,ee=this._rotating||_!==L,ce=this._pitching||D!==y,le=!u.isPaddingEqual(F),me=t.retainPadding===!1?u.clone():u,fe=Ie=>Te=>{if(se&&(Ie.zoom=n.aa(p,C,Te)),ee&&(Ie.bearing=n.aa(_,L,Te)),ce&&(Ie.pitch=n.aa(y,D,Te)),le&&(me.interpolatePadding(A,F,Te),V=me.centerPoint.add(B)),X)Ie.setLocationAtPoint(X,ie);else{const be=Ie.zoomScale(Ie.zoom-p),ze=C>p?Math.min(2,Z):Math.max(.5,Z),Je=Math.pow(ze,1-Te),lt=Ie.unproject(q.add(W.mult(Te*Je)).mult(be));Ie.setLocationAtPoint(Ie.renderWorldCopies?lt.wrap():lt,V)}return t.preloadOnly||this._fireMoveEvents(r),Ie};if(t.preloadOnly){const Ie=this._emulate(fe,t.duration,u);return this._preloadTiles(Ie),this}const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=se,this._rotating=ee,this._pitching=ce,this._padding=le,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,ye),this._ease(fe(u),Ie=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(r,Ie)},t),this}_prepareEase(t,r,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),r||u.moving||this.fire(new n.x("movestart",t)),this._zooming&&!u.zooming&&this.fire(new n.x("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new n.x("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new n.x("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.x("move",t)),this._zooming&&this.fire(new n.x("zoom",t)),this._rotating&&this.fire(new n.x("rotate",t)),this._pitching&&this.fire(new n.x("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new n.x("zoomend",t)),p&&this.fire(new n.x("rotateend",t)),_&&this.fire(new n.x("pitchend",t)),this.fire(new n.x("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const it=n.ar(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(it,r)}this.stop(),t=n.l({offset:[0,0],speed:1.2,curve:1.42,easing:n.dr},t);const u=this.transform,p=this.getZoom(),_=this.getBearing(),y=this.getPitch(),A=this.getPadding(),C="zoom"in t?n.ap(+t.zoom,u.minZoom,u.maxZoom):p,L="bearing"in t?this._normalizeBearing(t.bearing,_):_,D="pitch"in t?+t.pitch:y,F=this._extendPadding(t.padding),B=u.zoomScale(C-p),V=n.P.convert(t.offset);let q=u.centerPoint.add(V);const W=u.pointLocation(q),Z=n.bK.convert(t.center||W);this._normalizeCenter(Z);const X=u.project(W),ie=u.project(Z).sub(X);let se=t.curve;const ee=Math.max(u.width,u.height),ce=ee/B,le=ie.mag();if("minZoom"in t){const it=n.ap(Math.min(t.minZoom,p,C),u.minZoom,u.maxZoom),yt=ee/u.zoomScale(it-p);se=Math.sqrt(yt/le*2)}const me=se*se;function fe(it){const yt=(ce*ce-ee*ee+(it?-1:1)*me*me*le*le)/(2*(it?ce:ee)*me*le);return Math.log(Math.sqrt(yt*yt+1)-yt)}function ye(it){return(Math.exp(it)-Math.exp(-it))/2}function Ie(it){return(Math.exp(it)+Math.exp(-it))/2}const Te=fe(0);let be=function(it){return Ie(Te)/Ie(Te+se*it)},ze=function(it){return ee*((Ie(Te)*(ye(yt=Te+se*it)/Ie(yt))-ye(Te))/me)/le;var yt},Je=(fe(1)-Te)/se;if(Math.abs(le)<1e-6||!isFinite(Je)){if(Math.abs(ee-ce)<1e-6)return this.easeTo(t,r);const it=ce<ee?-1:1;Je=Math.abs(Math.log(ce/ee))/se,ze=function(){return 0},be=function(yt){return Math.exp(it*se*yt)}}t.duration="duration"in t?+t.duration:1e3*Je/("screenSpeed"in t?+t.screenSpeed/se:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const lt=_!==L,Ke=D!==y,mt=!u.isPaddingEqual(F),Oe=t.retainPadding===!1?u.clone():u,ot=it=>yt=>{const vt=yt*Je,at=1/be(vt);it.zoom=yt===1?C:p+it.scaleZoom(at),lt&&(it.bearing=n.aa(_,L,yt)),Ke&&(it.pitch=n.aa(y,D,yt)),mt&&(Oe.interpolatePadding(A,F,yt),q=Oe.centerPoint.add(V));const ut=yt===1?Z:it.unproject(X.add(ie.mult(ze(vt))).mult(at));return it.setLocationAtPoint(it.renderWorldCopies?ut.wrap():ut,q),it._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),it};if(t.preloadOnly){const it=this._emulate(ot,t.duration,u);return this._preloadTiles(it),this}return this._zooming=!0,this._rotating=lt,this._pitching=Ke,this._padding=mt,this._prepareEase(r,!1),this._ease(ot(u),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,r)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,r,u){u.animate===!1||u.duration===0?(t(1),r()):(this._easeStart=n.q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=n.bA(t,-180,180);const u=Math.abs(t-r);return Math.abs(t-360-r)<u&&(t-=360),Math.abs(t+360-r)<u&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(r.maxBounds||r.projection.name!=="globe"&&!r.renderWorldCopies)return;const u=t.lng-r.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,u){const p=Math.ceil(15*r/1e3),_=[],y=t(u.clone());for(let A=0;A<=p;A++){const C=y(A/p);_.push(C.clone())}return _}_preloadTiles(t,r){}}class Mu{constructor(t={}){this.options=t,n.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Xe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const p=Xe("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",u),this._innerContainer=Xe("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),r===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){const u=r.reduce((p,_,y)=>(_.value&&(p+=`${_.key}=${_.value}${y<r.length-1?"&":""}`),p),"?");t.href=`${n.e.FEEDBACK_URL}/${u}#${no(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const r=this._map.style._mergedSourceCaches;for(const p in r){const _=r[p];if(_.used){const y=_.getSource();y.attribution&&t.indexOf(y.attribution)<0&&t.push(y.attribution)}}t.sort((p,_)=>p.length-_.length),t=t.filter((p,_)=>{for(let y=_+1;y<t.length;y++)if(t[y].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class _d{constructor(){n.aJ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Xe("div","mapboxgl-ctrl");const r=Xe("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const r in t){const u=t[r].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class Dp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,u=r?this._queue.concat(r):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const u of r)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class sc{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=n.cw((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,u){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+u}}const N_={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class U_{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class gd{constructor(t){this.map=t,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(t,r){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const{type:u,filter:p}=r;if(p){const y=n.M(p,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(y.result==="error")throw new Error(y.value.map(A=>`${A.key}: ${A.message}`).join(", "));this.filters.set(t,y.value)}const _=this.interactionsByType.get(u)||new Map;_.size===0&&(this.map.on(u,this.handleType),this.interactionsByType.set(u,_)),_.set(t,r),this.typeById.set(t,u)}remove(t){const r=this.typeById.get(t);if(!r)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(r);u&&(u.delete(t),u.size===0&&this.map.off(r,this.handleType))}handleType(t){const r=t.features||this.map.queryRenderedFeatures(t.point);if(!r)return;const u=this.interactionsByType.get(t.type),p={zoom:0};for(const[_,y]of u){const A=this.filters.get(_),{handler:C,layers:L}=y;for(const D of r)if((!L||L.includes(D.layer.id))&&(!A||A.evaluate(p,D))&&C({id:_,feature:D,interaction:y})!==!1)break}}}const yd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},oc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qa{constructor(t,r,u=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new Tu({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new Eu({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),ft()}move(t,r){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,r),_=p&&p.bearingDelta;if(_&&u.setBearing(u.getBearing()+_),this.mousePitch){const y=this.mousePitch.mousemoveWindow(t,r),A=y&&y.pitchDelta;A&&u.setPitch(u.getPitch()+A)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Bt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(n.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),zi(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,zi(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=or(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=or(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function js(c,t,r){if(c=new n.bK(c.lng,c.lat),t){const u=new n.bK(c.lng-360,c.lat),p=new n.bK(c.lng+360,c.lat),_=360*Math.ceil(Math.abs(c.lng-r.center.lng)/360),y=r.locationPoint(c).distSqr(t),A=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint(u).distSqr(t)<y&&(A||Math.abs(u.lng-r.center.lng)<_)?c=u:r.locationPoint(p).distSqr(t)<y&&(A||Math.abs(p.lng-r.center.lng)<_)&&(c=p)}for(;Math.abs(c.lng-r.center.lng)>180;){const u=r.locationPoint(c);if(u.x>=0&&u.y>=0&&u.x<=r.width&&u.y<=r.height)break;c.lng>r.center.lng?c.lng-=360:c.lng+=360}return c}const rs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Gs extends n.E{constructor(t,r){if(super(),(t instanceof HTMLElement||r)&&(t=n.l({element:t},r)),n.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Xe("div");const _=41,y=27,A=Ne("svg",{display:"block",height:_*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${_}`},this._element),C=Ne("radialGradient",{id:"shadowGradient"},Ne("defs",{},A));Ne("stop",{offset:"10%","stop-opacity":.4},C),Ne("stop",{offset:"100%","stop-opacity":.05},C),Ne("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),Ne("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),Ne("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),Ne("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=n.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const u=this._element.classList;for(const _ in rs)u.remove(`mapboxgl-marker-anchor-${_}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`);const p=t&&t.className?t.className.trim().split(/\s+/):[];u.add(...p),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.bK.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,u=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,u=this._element;this._popup&&(r===u||u.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const u=t.unproject(r),p=t.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(u)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(r);let p;t._showingGlobe()&&n.dz(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${rs[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${r.x}px,${r.y}px)
        `}_calculateXYTransform(){const t=this._pos,r=this._map,u=this.getPitchAlignment();if(!r||!t||u!=="map")return"";if(!r._showingGlobe()){const C=r.getPitch();return C?`rotateX(${C}deg)`:""}const p=n.c0(n.dA(r.transform,this._lngLat)),_=t.sub(n.dB(r.transform)),y=Math.abs(_.x)+Math.abs(_.y);if(y===0)return"";const A=p/y;return`rotateX(${-_.y*A}deg) rotateY(${_.x*A}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(r._showingGlobe()){const _=r.project(new n.bK(this._lngLat.lng,this._lngLat.lat+.001)),y=r.project(new n.bK(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);u=n.c0(Math.atan2(y.y,y.x))-90}else u=-r.getBearing();else if(p==="horizon"){const _=n.a7(4,6,r.getZoom()),y=n.dB(r.transform);y.y+=_*r.transform.height;const A=t.sub(y),C=n.c0(Math.atan2(A.y,A.x));u=(C>90?C-270:C+90)*(1-_)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=js(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),r._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const _=this._clickTolerance||r._clickTolerance;if(t.point.dist(u)<_)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=r.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.x("dragstart"))),this.fire(new n.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.x("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,u=this._pos;r&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const na={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Lo={maxWidth:100,unit:"metric"},V_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},j_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},G_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zp(c=new n.P(0,0),t="bottom"){if(typeof c=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new n.P(0,c);case"top-left":return new n.P(r,r);case"top-right":return new n.P(-r,r);case"bottom":return new n.P(0,-c);case"bottom-left":return new n.P(r,-r);case"bottom-right":return new n.P(-r,-r);case"left":return new n.P(c,0);case"right":return new n.P(-c,0)}return new n.P(0,0)}return c instanceof n.P||Array.isArray(c)?n.P.convert(c):n.P.convert(c[t]||[0,0])}return{version:ne,supported:Qe.supported,setRTLTextPlugin:n.dC,getRTLTextPluginStatus:n.dD,Map:class extends md{constructor(c){ue.mark(ae.create);const t=c;if((c=n.l({},yd,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&n.dx(window)&&(c.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Vc(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._repaint=!!c.repaint,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new Dp,this._domRenderTaskQueue=new Dp,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.aP(),this._locale=n.l({},N_,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._tessellationStep=c.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=c.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new sc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new Mn(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?{...c.contextCreateOptions}:{},typeof c.container=="string"){const r=document.getElementById(c.container);if(!r)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=r}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),n.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new U_),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Sn(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||n.e.DEFAULT_STYLE,{config:c.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),c.hash&&(this._hash=new Po(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});const r=c.bounds;r&&(this.resize(),this.fitBounds(r,n.l({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new Mu({customAttribution:c.customAttribution})),this._logoControl=new _d,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new n.x(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new n.x(`${r.dataType}dataloading`,r))}),this._interactions=new gd(this)}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new n.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=c.onAdd(this);this._controls.push(c);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(r,u.firstChild):u.appendChild(r),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new n.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new n.x("movestart",c)).fire(new n.x("move",c)),this.fire(new n.x("resize",c)),t&&this.fire(new n.x("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(n.as.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(t=>t==="auto"?navigator.language:t):c}setLanguage(c){const t=this._parseLanguage(c);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,t=c.projection.name;let r;t==="globe"&&c.zoom>=n.bU?(c.setMercatorFromTransition(),r=!0):t==="mercator"&&c.zoom<n.bU&&(c.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,t){return this._updateProjection(c||t||{name:"mercator"})}_updateProjection(c){let t;return t=c.name==="globe"&&this.transform.zoom>=n.bU?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c){return this.transform.locationPoint3D(n.bK.convert(c))}unproject(c){return this.transform.pointLocation3D(n.P.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,t,r){if(c==="mouseenter"||c==="mouseover"){let u=!1;const p=y=>{const A=t.filter(L=>this.getLayer(L)),C=A.length?this.queryRenderedFeatures(y.point,{layers:A}):[];C.length?u||(u=!0,r.call(this,new Dn(c,this,y.originalEvent,{features:C}))):u=!1},_=()=>{u=!1};return{layers:new Set(t),listener:r,delegates:{mousemove:p,mouseout:_}}}if(c==="mouseleave"||c==="mouseout"){let u=!1;const p=y=>{const A=t.filter(C=>this.getLayer(C));(A.length?this.queryRenderedFeatures(y.point,{layers:A}):[]).length?u=!0:u&&(u=!1,r.call(this,new Dn(c,this,y.originalEvent)))},_=y=>{u&&(u=!1,r.call(this,new Dn(c,this,y.originalEvent)))};return{layers:new Set(t),listener:r,delegates:{mousemove:p,mouseout:_}}}{const u=p=>{const _=t.filter(A=>this.getLayer(A)),y=_.length?this.queryRenderedFeatures(p.point,{layers:_}):[];y.length&&(p.features=y,r.call(this,p),delete p.features)};return{layers:new Set(t),listener:r,delegates:{[c]:u}}}}on(c,t,r){if(typeof t=="function"||r===void 0)return super.on(c,t);if(Array.isArray(t)||(t=[t]),t){for(const p of t)if(!this._isValidId(p))return this}const u=this._createDelegatedListener(c,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(c,t,r){if(typeof t=="function"||r===void 0)return super.once(c,t);if(Array.isArray(t)||(t=[t]),t){for(const p of t)if(!this._isValidId(p))return this}const u=this._createDelegatedListener(c,t,r);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(c,t,r){if(typeof t=="function"||r===void 0)return super.off(c,t);const u=new Set(Array.isArray(t)?t:[t]);for(const y of u)if(!this._isValidId(y))return this;const p=(y,A)=>{if(y.size!==A.size)return!1;for(const C of y)if(!A.has(C))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[c]:void 0;return _&&(y=>{for(let A=0;A<y.length;A++){const C=y[A];if(C.listener===r&&p(C.layers,u)){for(const L in C.delegates)this.off(L,C.delegates[L]);return y.splice(A,1),this}}})(_),this}queryRenderedFeatures(c,t){if(!this.style)return[];if(t!==void 0||c===void 0||c instanceof n.P||Array.isArray(c)||(t=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers)){for(const r of t.layers)if(!this._isValidId(r))return[]}return this.style.queryRenderedFeatures(c,t,this.transform)}querySourceFeatures(c,t){return this._isValidId(c)?this.style.querySourceFeatures(c,t):[]}isPointOnSurface(c){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(c))}addInteraction(c,t){return this._interactions.add(c,t),this}removeInteraction(c){return this._interactions.remove(c),this}setStyle(c,t){return t=n.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&c&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(c,(r,u)=>{r?(n.w(`Unable to perform style diff: ${String(r.message||r.error||r)}. Rebuilding the style from scratch.`),this._updateStyle(c,t)):u&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c){const r=n.l({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new ts(this,r).load(c),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ts(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new n.t(new Error("IDs can't be empty."))),!1):!n.cn(c)||(this.fire(new n.t(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}addSource(c,t){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,r)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,t,{pixelRatio:r=1,sdf:u=!1,stretchX:p,stretchY:_,content:y}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:A,height:C,data:L}=n.q.getImageData(t);this.style.addImage(c,{data:new n.r({width:A,height:C},L),pixelRatio:r,stretchX:p,stretchY:_,content:y,sdf:u,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new n.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:C}=t,L=t;this.style.addImage(c,{data:new n.r({width:A,height:C},new Uint8Array(L.data)),pixelRatio:r,stretchX:p,stretchY:_,content:y,sdf:u,version:0,userImage:L}),L.onAdd&&L.onAdd(this,c)}}updateImage(c,t){this._lazyInitEmptyStyle();const r=this.style.getImage(c);if(!r)return void this.fire(new n.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.q.getImageData(t):t,{width:p,height:_,data:y}=u;if(p===void 0||_===void 0)return void this.fire(new n.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==r.data.width||_!==r.data.height)return void this.fire(new n.t(new Error(`The width and height of the updated image (${p}, ${_})
                must be that same as the previous version of the image
                (${r.data.width}, ${r.data.height})`)));const A=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);r.data.replace(y,A),this.style.updateImage(c,r)}hasImage(c){return c?!!this.style&&!!this.style.getImage(c):(this.fire(new n.t(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,t){n.o(this._requestManager.transformRequest(c,n.R.Image),(r,u)=>{t(r,u instanceof HTMLImageElement?n.q.getImageData(u):u)})}listImages(){return this.style.listImages()}addModel(c,t){this._lazyInitEmptyStyle(),this.style.addModel(c,t)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new n.t(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,t){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)):this}getSlot(c){const t=this.getLayer(c);return t&&t.slot||null}setSlot(c,t){return this.style.setSlot(c,t),this.style.mergeLayers(),this._update(!0)}addImport(c,t){return this.style.addImport(c,t),this}updateImport(c,t){return typeof t!="string"&&t.id!==c?(this.removeImport(c),this.addImport(t)):(this.style.updateImport(c,t),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,t){return this.style.moveImport(c,t),this._update(!0)}moveLayer(c,t){return this._isValidId(c)?(this.style.moveLayer(c,t),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){if(!this._isValidId(c))return null;const t=this.style.getOwnLayer(c);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(c,t,r){return this._isValidId(c)?(this.style.setLayerZoomRange(c,t,r),this._update(!0)):this}setFilter(c,t,r={}){return this._isValidId(c)?(this.style.setFilter(c,t,r),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,t,r,u={}){return this._isValidId(c)?(this.style.setPaintProperty(c,t,r,u),this._update(!0)):this}getPaintProperty(c,t){return this._isValidId(c)?this.style.getPaintProperty(c,t):null}setLayoutProperty(c,t,r,u={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,t,r,u),this._update(!0)):this}getLayoutProperty(c,t){return this._isValidId(c)?this.style.getLayoutProperty(c,t):null}getSchema(c){return this.style.getSchema(c)}setSchema(c,t){return this.style.setSchema(c,t),this._update(!0)}getConfig(c){return this.style.getConfig(c)}setConfig(c,t){return this.style.setConfig(c,t),this._update(!0)}getConfigProperty(c,t){return this.style.getConfigProperty(c,t)}setConfigProperty(c,t,r){return this.style.setConfigProperty(c,t,r),this._update(!0)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){const t=c[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(c){return this._lazyInitEmptyStyle(),this.style.setColorTheme(c),this._update(!0)}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.bK.convert(c),this.transform):0}setFeatureState(c,t){return this._isValidId(c.source)?(this.style.setFeatureState(c,t),this._update()):this}removeFeatureState(c,t){return this._isValidId(c.source)?(this.style.removeFeatureState(c,t),this._update()):this}getFeatureState(c){return this._isValidId(c.source)?this.style.getFeatureState(c):null}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,u,p,_=this._container;for(;_&&(!u||!p);){const y=window.getComputedStyle(_).transform;y&&y!=="none"&&(r=y.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&r[0]!=="0"&&r[0]!=="1"&&(u=r[0]),r[3]&&r[3]!=="0"&&r[3]!=="1"&&(p=r[3])),_=_.parentElement}this._containerWidth=u?Math.abs(c/u):c,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=Xe("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Xe("div","mapboxgl-canvas-container",c);this._canvas=Xe("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=Xe("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(p=>{u[p]=Xe("div",`mapboxgl-ctrl-${p}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const r=n.q.devicePixelRatio||1;this._canvas.width=r*Math.ceil(c),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);t!==-1&&this._markers.splice(t,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const t=this._popups.indexOf(c);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const c=n.l({},Qe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",c);t?(Ae(t,!0),this.painter=new nd(t,this._contextCreateOptions,this.transform,this._tp),this.on("data",r=>{r.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.m.testSupport(t)):this.fire(new n.t(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.x("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new n.x("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;this.fire(new n.x("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,u=n.q.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,D=this.transform.pitch,F=n.q.now(),B=new n.a3(L,{now:F,fadeDuration:_,pitch:D,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let y=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),y=this._updateAverageElevation(u),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):y=this._updateAverageElevation(u);const A=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,this.painter.replacementSource);if(A&&(this._placementDirty=A.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ue.mark(ae.load),this.fire(new n.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const L=n.q.now()-u;p.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const D=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new n.x("gpu-timing-frame",{cpuTime:L,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(L);this.fire(new n.x("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(L);this.fire(new n.x("gpu-timing-deferred-render",{gpuTime:D}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(C||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(y=this._updateAverageElevation(u,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new n.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new n.x("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,ue.mark(ae.fullLoad),this._performanceMetricsCollection&&Zt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const t of this._markers)c&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!c||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(c,t=!1){const r=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&r(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=c;const y=Math.abs(p-_);if(y>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(_),r(_);this._averageElevation.easeTo(_,c,300)}else if(y>1e-4)return this._averageElevation.jumpTo(_),r(_)}return!!this._averageElevation.isEasing(c)&&r(this._averageElevation.getValue(c))}_authenticate(){ge(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===un||c.status===401)){const t=this.painter.context.gl;Ae(t,!1),this._logoControl instanceof _d&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Yn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Tt(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,u=r.createFramebuffer();function p(_){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,_,0);const y=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,y),y}return r.bindFramebuffer(r.FRAMEBUFFER,u),this._canvasPixelComparison(p(c),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(c,t,r){let u=r[1]-r[0];const p=c.length/4;for(let _=0;_<t.length;_++){const y=t[_];let A=0;for(let C=0;C<y.length;C+=4)y[C]===c[C]&&y[C+1]===c[C+1]&&y[C+2]===c[C+2]&&y[C+3]===c[C+3]&&(A+=1);u+=(r[_+2]-r[_+1])*(1-A/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ki.delete(this.painter.context.gl),ni.remove(),ti.remove(),this._removed=!0,this.fire(new n.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=n.q.frame(t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)}))}_preloadTiles(c){const t=this.style?this.style.getSourceCaches():[];return n.bf(t,(r,u)=>r._preloadTiles(c,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,this._tp.refreshUI(),c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,this._tp.refreshUI(),c&&this._update())}_setCacheLimits(c,t){n.dy(c,t)}get version(){return ne}},NavigationControl:class{constructor(c={}){this.options=n.l({},oc,c),this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Xe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Xe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))}),this._compassIcon=Xe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),r=t===c.getMaxZoom(),u=t===c.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qa(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const r=Xe("button",c,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(c,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",r),c.firstElementChild&&c.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends n.E{constructor(c={}){super();const t=navigator.geolocation;this.options=n.l({geolocation:t},na,c),n.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ro(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,c(r)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(r=>t(r.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),r=c.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new n.x("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("geolocate",c)),this._finish()}}_updateCamera(c){const t=new n.bK(c.coords.longitude,c.coords.latitude),r=c.coords.accuracy,u=this._map.getBearing(),p=n.l({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),p,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new n.bK(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,t=n.bD(1,c._center.lat)*c.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Xe("button","mapboxgl-ctrl-geolocate",this._container),Xe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Xe("div","mapboxgl-user-location"),this._dotElement.appendChild(Xe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Xe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Gs({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Xe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.x("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mu,ScaleControl:class{constructor(c={}){this.options=n.l({},Lo,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,u=t._containerWidth/2-c/2,p=t.unproject([u,r]),_=t.unproject([u+c,r]),y=p.distanceTo(_);if(this.options.unit==="imperial"){const A=3.2808*y;A>5280?this._setScale(c,A/5280,"mile"):this._setScale(c,A,"foot")}else this.options.unit==="nautical"?this._setScale(c,y/1852,"nautical-mile"):y>=1e3?this._setScale(c,y/1e3,"kilometer"):this._setScale(c,y,"meter")}_setScale(c,t,r){this._map._requestDomTask(()=>{const u=function(_){const y=Math.pow(10,`${Math.floor(_)}`.length-1);let A=_/y;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(C){const L=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*L)/L}(A),y*A}(t),p=u/t;this._container.innerHTML=this._isNumberFormatSupported&&r!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(u):`${u}&nbsp;${V_[r]}`,this._container.style.width=c*p+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c={}){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:n.w("Full screen control 'container' must be a DOM element.")),n.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=Xe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Xe("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(c){super(),this.options=n.l(Object.create(j_),c),n.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new n.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new n.x("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=n.bK.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),r=document.createElement("body");let u;for(r.innerHTML=c;u=r.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Xe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const r=this._closeButton=Xe("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.setAttribute("aria-hidden","true"),r.innerHTML="&#215;",r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,u=this._pos;if(!t||!r||!u)return"bottom";const p=r.offsetWidth,_=r.offsetHeight,y=u.x<p/2,A=u.x>t.transform.width-p/2;if(u.y+c<_)return y?"top-left":A?"top-right":"top";if(u.y>t.transform.height-_){if(y)return"bottom-left";if(A)return"bottom-right"}return y?"left":A?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let u=this._container;if(u||(u=this._container=Xe("div","mapboxgl-popup",t.getContainer()),this._tip=Xe("div","mapboxgl-popup-tip",u),u.appendChild(r)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=js(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const p=this._pos=this._trackPointer&&c instanceof n.P?c:t.project(this._lngLat),_=zp(this.options.offset),y=this._anchor=this._getAnchor(_.y),A=zp(this.options.offset,y),C=p.add(A).round();t._requestDomTask(()=>{this._container&&y&&(this._container.style.transform=`${rs[y]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&t._showingGlobe()){const p=n.dz(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(G_);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Gs,Style:ts,LngLat:n.bK,LngLatBounds:n.as,Point:n.P,MercatorCoordinate:n.a5,FreeCameraOptions:To,Evented:n.E,config:n.e,prewarm:n.dE,clearPrewarmedResources:n.dF,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(c){n.e.ACCESS_TOKEN=c},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(c){n.e.API_URL=c},get workerCount(){return n.dG.workerCount},set workerCount(c){n.dG.workerCount=c},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){n.e.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){n.dH(c)},get workerUrl(){return n.dI.workerUrl},set workerUrl(c){n.dI.workerUrl=c},get workerClass(){return n.dI.workerClass},set workerClass(c){n.dI.workerClass=c},get workerParams(){return n.dI.workerParams},set workerParams(c){n.dI.workerParams=c},get dracoUrl(){return n.dJ()},set dracoUrl(c){n.dK(c)},get meshoptUrl(){return n.dL()},set meshoptUrl(c){n.dM(c)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var H=O;return H})})(iS);var vO=iS.exports;const Mm=xO(vO),bO={name:"Map",data(){return{map:null,userMarker:null,destination:null,accessToken:"pk.eyJ1IjoibWVycmlsbGdvbnNhbHZlcyIsImEiOiJjajN6ampkbzcwM3VxMzJyemR5Y2dqdTZuIn0.EGosEkXFJM5K_82Vy0XuCA"}},mounted(){try{Mm.accessToken=this.accessToken,this.initMap()}catch(a){console.error("Error during mounted hook:",a)}},methods:{initMap(){if(!this.$refs.mapContainer){console.error("Map container not found.");return}this.map=new Mm.Map({container:this.$refs.mapContainer,style:"mapbox://styles/mapbox/streets-v11",center:[72.90714,19.11818],zoom:14}),this.map.on("load",()=>{console.log("Map has loaded successfully!"),this.userMarker=new Mm.Marker({color:"blue"}).setLngLat([0,0]).addTo(this.map),this.trackUserLocation()})},trackUserLocation(){navigator.geolocation?navigator.geolocation.watchPosition(a=>{const f=a.coords.longitude,T=a.coords.latitude;this.userMarker.setLngLat([f,T]),this.destination||this.map.setCenter([f,T])},a=>{console.error("Error getting location:",a)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):console.error("Geolocation not supported by this browser.")},setDestination(){if(this.destination=[72.85368,19.11734],console.log("Destination set to:",this.destination),this.userMarker.getLngLat()){const a=this.userMarker.getLngLat().toArray();this.getDirections(a,this.destination)}},async getDirections(a,f){const T=`https://api.mapbox.com/directions/v5/mapbox/driving/${a[0]},${a[1]};${f[0]},${f[1]}?geometries=geojson&access_token=${this.accessToken}`;try{const I=await cn.get(T);console.log("Directions API response:",I.data);const P=I.data.routes[0].geometry;if(!P||!P.coordinates.length){console.error("No route found.");return}this.map.getSource("route")&&(this.map.removeLayer("route"),this.map.removeSource("route")),this.map.addSource("route",{type:"geojson",data:{type:"Feature",geometry:P}}),this.map.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b9ddd","line-width":5}});const O=new Mm.LngLatBounds;P.coordinates.forEach(N=>O.extend(N)),this.map.fitBounds(O,{padding:20})}catch(I){console.error("Error fetching directions:",I)}}}},wO={ref:"mapContainer",style:{width:"800px",height:"500px"}};function TO(a,f,T,I,P,O){return Qr(),pn("div",null,[sn("div",wO,null,512),sn("button",{onClick:f[0]||(f[0]=(...N)=>O.setDestination&&O.setDestination(...N))},"Set Destination")])}const EO=yo(bO,[["render",TO]]),SO=[{path:"/",component:sD},{path:"/about",component:aO},{path:"/contact",component:gO},{path:"/Map",component:EO}],AO=pR({history:$P(),routes:SO}),IO={en:{welcome:"Welcome",changeLanguage:"Change Language"},hi:{welcome:"",changeLanguage:" "},mr:{welcome:" ",changeLanguage:" "}},MO=jz({locale:"en",messages:IO}),U0=sP(fP);U0.use(AO);U0.use(MO);U0.mount("#app");
